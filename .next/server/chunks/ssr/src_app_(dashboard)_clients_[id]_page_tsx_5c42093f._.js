module.exports=[476162,a=>{"use strict";a.s(["default",()=>ag],476162);var b=a.i(187924),c=a.i(572131),d=a.i(50944);let e=({label:a,value:c})=>(0,b.jsxs)("div",{className:"flex items-start gap-6 py-2 border-b border-transparent last:border-b-0",children:[(0,b.jsx)("div",{className:"w-40 text-sm text-slate-600",children:a}),(0,b.jsx)("div",{className:"text-sm text-slate-800",children:c??"—"})]});var f=a.i(699570),g=a.i(400210),h=a.i(104720),i=a.i(883706);let j=(0,i.default)("sticky-note",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);var k=a.i(238246);let l=({clientName:a,clientId:c,onBack:d,onOpenTab:e,activeTab:i="profile"})=>(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-semibold",children:a}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Client ID: ",c]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(f.Button,{variant:"ghost",className:"hidden sm:inline-flex items-center gap-2",onClick:d,children:[(0,b.jsx)(g.ArrowLeft,{className:"mr-1 h-4 w-4"})," Back to Clients"]}),(0,b.jsx)(k.default,{href:`/clients/${c}/documents`,children:(0,b.jsxs)(f.Button,{variant:"outline",className:"flex items-center gap-2",children:[(0,b.jsx)(h.FileText,{className:"h-4 w-4"})," Documents"]})}),(0,b.jsx)(k.default,{href:`/clients/${c}/notes`,children:(0,b.jsxs)(f.Button,{variant:"outline",className:"flex items-center gap-2",children:[(0,b.jsx)(j,{className:"h-4 w-4"})," Notes"]})})]})]}),(0,b.jsx)("div",{className:"mt-6 border-b",children:(0,b.jsx)("nav",{className:"flex gap-6 text-sm text-slate-600",children:[{key:"profile",label:"Profile"},{key:"projects",label:"Projects"},{key:"invoices",label:"Invoices"},{key:"creditnotes",label:"Credit Notes "},{key:"payments",label:"Payments"},{key:"documents",label:"Documents"},{key:"notes",label:"Notes"}].map(a=>(0,b.jsx)("button",{onClick:()=>e?.(a.key),className:`pb-3 ${i===a.key?"border-b-2 border-primary text-primary font-medium":""}`,children:a.label},a.key))})})]});var m=a.i(591119),n=a.i(872233);let o=({projectCount:a,totalEarning:c,unpaidInvoiceCount:d,totalUnpaidAmount:e})=>(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 mb-6",children:[(0,b.jsx)("div",{className:"col-span-1",children:(0,b.jsx)(m.Card,{children:(0,b.jsxs)(m.CardContent,{className:"flex items-center gap-4",children:[(0,b.jsxs)(n.Avatar,{className:"h-16 w-16",children:[(0,b.jsx)(n.AvatarImage,{src:"/mnt/data/Screenshot 2025-11-25 124734.png",alt:"client"}),(0,b.jsx)(n.AvatarFallback,{children:"NA"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:"Client"}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground"})]})]})})}),(0,b.jsxs)("div",{className:"lg:col-span-3 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,b.jsx)(m.Card,{children:(0,b.jsxs)(m.CardContent,{children:[(0,b.jsx)("div",{className:"text-sm text-slate-600",children:"Total Projects"}),(0,b.jsx)("div",{className:"text-2xl font-semibold text-blue-600 mt-2",children:a??"—"})]})}),(0,b.jsx)(m.Card,{children:(0,b.jsxs)(m.CardContent,{children:[(0,b.jsx)("div",{className:"text-sm text-slate-600",children:"Total Earnings"}),(0,b.jsx)("div",{className:"text-2xl font-semibold text-blue-600 mt-2",children:null!==c?c.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"—"})]})}),(0,b.jsx)(m.Card,{children:(0,b.jsxs)(m.CardContent,{children:[(0,b.jsx)("div",{className:"text-sm text-slate-600",children:"Due Invoices"}),(0,b.jsx)("div",{className:"text-2xl font-semibold text-blue-600 mt-2",children:d??"—"}),null!==e&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.toLocaleString(void 0,{style:"currency",currency:"USD",minimumFractionDigits:2})})]})})]})]}),p=[{key:"FINISHED",label:"Finished",color:"#16A34A"},{key:"ON_HOLD",label:"To Do",color:"#F59E0B"},{key:"IN_PROGRESS",label:"In Progress",color:"#2563EB"},{key:"CANCELLED",label:"Cancelled",color:"#EF4444"},{key:"NOT_STARTED",label:"Not Started",color:"#9CA3AF"}],q=({client:a,projects:d=[]})=>{let f=(0,c.useMemo)(()=>{let a=Array.isArray(d)?d.length:0,b={};return p.forEach(a=>b[a.key]=0),(d||[]).forEach(a=>{let c=function(a){if(!a)return"NOT_STARTED";let b=(a.projectStatus??a.status??a.state??a.project_state??"").toString().trim().toUpperCase().replace(/ /g,"_");return["FINISHED","COMPLETED","DONE"].includes(b)?"FINISHED":["IN_PROGRESS","INPROGRESS","IN-PROGRESS","ONGOING","RUNNING"].includes(b)?"IN_PROGRESS":["ON_HOLD","HOLD","PAUSED","TODO","TO_DO","TO-DO"].includes(b)?"ON_HOLD":["CANCELLED","CANCELED","CANCEL"].includes(b)?"CANCELLED":["NOT_STARTED","NOTSTARTED","PENDING","PLANNED"].includes(b)?"NOT_STARTED":p.some(a=>a.key===b)?b:"NOT_STARTED"}(a);b[c]=(b[c]||0)+1}),{total:a,items:p.map(c=>{let d=b[c.key]??0;return{key:c.key,label:c.label,color:c.color,count:d,pct:a>0?d/a*100:0}})}},[d]),g=(0,c.useMemo)(()=>{let a=[],b=0;return f.items.forEach(c=>{let d=b,e=b+Math.max(0,Math.round(100*c.pct)/100);a.push(`${c.color} ${d}% ${e}%`),b=e}),b<100&&a.push(`#ffffff ${b}% 100%`),a.join(", ")},[f.items]);return(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-2",children:(0,b.jsxs)(m.Card,{children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Profile Information "}),(0,b.jsx)(m.CardDescription,{children:"Details about client"})]}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-0",children:[(0,b.jsx)(e,{label:"Name",value:a.name}),(0,b.jsx)(e,{label:"Email",value:a.email}),(0,b.jsx)(e,{label:"Gender",value:"—"}),(0,b.jsx)(e,{label:"Company Name",value:a.company?.companyName??"—"}),(0,b.jsx)(e,{label:"Company Logo",value:a.companyLogoUrl?"Uploaded":"—"}),(0,b.jsx)(e,{label:"Mobile",value:a.mobile??"—"}),(0,b.jsx)(e,{label:"Office Phone No.",value:"—"}),(0,b.jsx)(e,{label:"Official Website",value:"—"}),(0,b.jsx)(e,{label:"Tax No.",value:"—"}),(0,b.jsx)(e,{label:"Address",value:"—"}),(0,b.jsx)(e,{label:"State",value:a.company?.state??"—"}),(0,b.jsx)(e,{label:"Country",value:a.country??"usa"}),(0,b.jsx)(e,{label:"Postal Code",value:"—"}),(0,b.jsx)(e,{label:"Language",value:"English"})]})})]})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)(m.Card,{children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Projects"}),(0,b.jsx)(m.CardDescription,{children:f.total>0?`${f.total} project${f.total>1?"s":""}`:"No projects yet"})]}),(0,b.jsx)(m.CardContent,{children:0===f.total?(0,b.jsx)("div",{className:"h-40 flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-28 h-28 rounded-full bg-blue-500/90"})}):(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsxs)("div",{className:"relative",style:{width:140,height:140},children:[(0,b.jsx)("div",{"aria-hidden":!0,className:"rounded-full",style:{width:140,height:140,background:`conic-gradient(${g})`,boxShadow:"0 1px 4px rgba(0,0,0,0.06)"}}),(0,b.jsx)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full",style:{width:90,height:90,background:"#ffffff",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.6)"}}),(0,b.jsx)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center pointer-events-none",children:(()=>{let a=[...f.items].sort((a,b)=>b.pct-a.pct)[0];return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"text-sm font-semibold",style:{color:a?.color??"#111"},children:[Math.round(a?.pct??0),"%"]}),(0,b.jsx)("div",{className:"text-xs text-gray-500 -mt-0.5",children:a?.label})]})})()})]})}),(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)("div",{className:"flex flex-col gap-3",children:f.items.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-6 h-6 rounded-sm flex-shrink-0",style:{background:a.color}}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:a.label}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:[a.count," project",1!==a.count?"s":""]})]})]},a.key))})})]})})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsx)(m.CardTitle,{children:"Invoices "})}),(0,b.jsx)(m.CardContent,{children:(0,b.jsx)("div",{className:"h-40 flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-32 h-32 rounded-full bg-green-600/90"})})})]})]})]})};var r=a.i(786304),s=a.i(335732),t=a.i(417755),u=a.i(915618),v=a.i(816201),w=a.i(217201),x=a.i(773320),y=a.i(705151),z=a.i(510448),A=a.i(177156);let B=(0,i.default)("circle-dollar-sign",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]]);var C=a.i(523312);let D=(0,i.default)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var E=a.i(284505),F=a.i(633508);let G=(0,i.default)("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]),H="https://6jnqmj85-80.inc1.devtunnels.ms",I=async a=>{try{return{parsed:await a.clone().json(),raw:null}}catch{try{let b=await a.clone().text();return{parsed:JSON.parse(b),raw:b}}catch{return{parsed:null,raw:null}}}};function J({clientId:a,invoicesProp:d,onInvoiceCreated:e}){let[g,i]=(0,c.useState)(d??[]),[j,k]=(0,c.useState)(!d),[l,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),[q,s]=(0,c.useState)(""),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)({invoiceNumber:"",invoiceDate:"",currency:"USD",projectId:"",clientId:a?String(a):d&&d[0]?.client?.clientId?String(d[0].client.clientId):"",amount:0,taxPercent:10,discountValue:0,discountIsPercent:!0,notes:""}),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(!1),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)({invoiceNumber:"",issueDate:"",currency:"USD",sellerCompanyName:"",sellerCompanyAddress:"",sellerCompanyCode:"",sellerCompanyTaxNumber:"",sellerCompanyEmail:"",sellerCompanyPhoneNumber:"",sellerCompanyBankName:"",sellerCompanyBankAccountNumber:"",buyerCompanyName:"",buyerCompanyAddress:"",buyerCompanyCode:"",buyerCompanyTaxNumber:"",buyerCleintName:"",buyerCompanyEmail:"",buyerCompanyPhoneNumber:"",buyerCompanyBankName:"",buyerCompanyBankAccountNumber:"",productName:"",tax:0,priceWithOutTax:0,quantity:1,description:""}),[ad,ae]=(0,c.useState)(!1),[af,ag]=(0,c.useState)(!1),[ah,ai]=(0,c.useState)(null),[aj,ak]=(0,c.useState)([]),[al,am]=(0,c.useState)(null),[an,ao]=(0,c.useState)(null),[ap,aq]=(0,c.useState)(null),ar=(0,c.useRef)(null),[as,at]=(0,c.useState)([]),[au,av]=(0,c.useState)(!1),[aw,ax]=(0,c.useState)([]),[ay,az]=(0,c.useState)(!1),aA=(0,c.useRef)(null),[aB,aC]=(0,c.useState)(null),aD=(0,c.useRef)(null),[aE,aF]=(0,c.useState)(!1),[aG,aH]=(0,c.useState)(!1),[aI,aJ]=(0,c.useState)(null),[aK,aL]=(0,c.useState)(null),[aM,aN]=(0,c.useState)(null),[aO,aP]=(0,c.useState)(null),aQ=(0,c.useRef)(null);(0,c.useEffect)(()=>{S(b=>({...b,clientId:a?String(a):b.clientId??""}))},[a,d]);let aR=(a={})=>a,aS=a=>{let b=[];return a&&(a.invoiceNumber&&b.push(`${H}/api/invoices/${encodeURIComponent(String(a.invoiceNumber))}`),void 0!==a.id&&null!==a.id&&b.push(`${H}/api/invoices/${encodeURIComponent(String(a.id))}`)),b},aT=async b=>{k(!0),n(null),p(null);try{let c=b??a??null;if(!c){i([]),n("No client specified (pass invoicesProp or clientId)"),k(!1);return}let d=[`${H}/api/invoices/client/${encodeURIComponent(String(c))}`,`/api/invoices/client/${encodeURIComponent(String(c))}`,`${H}/api/finance/invoices?clientId=${encodeURIComponent(String(c))}`,`/api/finance/invoices?clientId=${encodeURIComponent(String(c))}`],e=null;for(let a of d)try{let b=await fetch(a,{headers:aR(),cache:"no-store"});if(401===b.status||403===b.status){let a=await b.text().catch(()=>"");n(`Auth error ${b.status}. Check access token.`),i([]),p(a||null),k(!1);return}if(!b.ok){e={url:a,status:b.status,text:await b.text().catch(()=>"")};continue}let c=await I(b);if(Array.isArray(c.parsed)){i(c.parsed),k(!1);return}if("string"==typeof c.raw)try{let a=JSON.parse(c.raw);if(Array.isArray(a)){i(a),k(!1);return}}catch{}if(c.parsed&&"object"==typeof c.parsed){let a=c.parsed;if(Array.isArray(a.invoices)){i(a.invoices),k(!1);return}if(Array.isArray(a.items)){i(a.items),k(!1);return}}p(c.raw??null),i([]),n("Server returned unexpected payload. See rawResponse for details."),k(!1);return}catch(a){e=a;continue}i([]),n(`All fetch attempts failed. Last error: ${JSON.stringify(e)}`)}catch(a){i([]),n(a?.message??"Failed to fetch invoices")}finally{k(!1)}};(0,c.useEffect)(()=>{if(d&&Array.isArray(d)){i(d),k(!1),n(null);return}if(a)return void aT(a);i([]),k(!1),n("No client specified (pass invoicesProp or clientId)")},[a,d]);let aU=async()=>{av(!0);try{let a=await fetch(`${H}/projects/AllProject`,{headers:aR()});if(!a.ok){at([]),av(!1);return}let b=await a.text(),c=null;try{c=JSON.parse(b)}catch{c=null}if(Array.isArray(c))at(c);else try{let a=JSON.parse(String(c??b));Array.isArray(a)?at(a):at([])}catch{at([])}}catch(a){console.error("fetchProjectsList",a),at([])}finally{av(!1)}},aV=async()=>{az(!0);try{let a=await fetch(`${H}/clients`,{headers:aR()});if(!a.ok){ax([]),az(!1);return}let b=await a.text(),c=null;try{c=JSON.parse(b)}catch{c=null}if(Array.isArray(c))ax(c);else try{let a=JSON.parse(String(c??b));Array.isArray(a)?ax(a):ax([])}catch{ax([])}}catch(a){console.error("fetchClientsList",a),ax([])}finally{az(!1)}};(0,c.useEffect)(()=>{aU(),aV()},[]),(0,c.useEffect)(()=>{let a=a=>{let b=a.target;!(!b||aQ.current&&aQ.current.contains(b)||ar.current&&ar.current.contains(b)||b.closest(".invoice-action-button"))&&(b.closest(".receipt-action-button")||(aN(null),aP(null),ao(null),aq(null)))},b=()=>{aN(null),aP(null),ao(null),aq(null)};return document.addEventListener("click",a),window.addEventListener("scroll",b,!0),window.addEventListener("resize",b),()=>{document.removeEventListener("click",a),window.removeEventListener("scroll",b,!0),window.removeEventListener("resize",b)}},[]);let aW=async()=>{if(!aI)return void aL("Please choose a file first");let b=aD.current;if(!b)return void aL("Upload target not set");aF(!0),aL(null);try{let c=b.invoiceNumber??b.id??null;if(!c)throw Error("Invoice number not available for upload");let f=`${H}/api/invoices/${encodeURIComponent(String(c))}/files`,g=new FormData;g.append("file",aI);let h=await fetch(f,{method:"POST",headers:aR(),body:g});if(!h.ok){let a=await h.text().catch(()=>"");throw Error(`Upload failed ${h.status} ${a}`)}let j=await h.text().catch(()=>""),k=null;try{let a=JSON.parse(j);"string"==typeof a?k=a:a&&"string"==typeof a.url&&(k=a.url)}catch{"string"==typeof j&&j.trim().length>0&&(k=j.trim())}d&&"function"==typeof e?e(null):await aT(a),ad&&al&&((a,b)=>{if(!a||!b)return!1;let c=a.id??a.invoiceId??a.invoiceNumber??null,d=b.id??b.invoiceId??b.invoiceNumber??null;return null!=c&&null!=d&&String(c)===String(d)})(al,b)&&await a8(al),k&&i(a=>a.map(a=>{let c=a.id??a.invoiceNumber??null,d=b.id??b.invoiceNumber??null;if(null!=c&&null!=d&&String(c)===String(d)){let b=Array.isArray(a.files)?[...a.files]:[];b.unshift({url:k,name:aI.name});let c=Array.isArray(a.fileUrls)?[...a.fileUrls]:[];return c.includes(k)||c.unshift(k),{...a,files:b,fileUrls:c}}return a})),alert("Upload successful"),aH(!1),aD.current=null,aJ(null)}catch(a){aL(a?.message??"Upload failed"),alert(a?.message??"Upload failed")}finally{aF(!1)}};(0,c.useEffect)(()=>{aB&&(async()=>{let b=aD.current;if(!b){alert("Upload target not set"),aC(null);return}aF(!0);try{let c=aS(b)[0];if(!c)throw Error("Cannot determine invoice resource for upload");let f=new FormData;f.append("file",aB);let g=await fetch(`${c}/files`,{method:"POST",headers:aR(),body:f});if(!g.ok){let a=await g.text().catch(()=>"");throw Error(`Upload failed ${g.status} ${a}`)}d&&"function"==typeof e?e(null):await aT(a),alert("Upload successful")}catch(a){alert(a?.message??"Upload failed")}finally{aC(null),aF(!1),aD.current=null,aN(null),aP(null)}})()},[aB]);let aX=async a=>{if(!a)return a;for(let b of aS(a))try{let c=await fetch(b,{headers:aR(),cache:"no-store"});if(!c.ok)continue;let d=await I(c);return d.parsed??d.raw??a}catch{}return a},aY=async a=>{K(await aX(a)),M(!0),aN(null),aP(null)},aZ=async()=>{Q(!0);try{let b={invoiceNumber:R.invoiceNumber||void 0,invoiceDate:R.invoiceDate||void 0,currency:R.currency,projectId:R.projectId||void 0,clientId:R.clientId||String(a??R.clientId??""),amount:Number(R.amount||0),tax:Number(R.taxPercent||0),discount:Number(R.discountValue||0),discountIsPercent:!!R.discountIsPercent,notes:R.notes||void 0},c=await fetch(`${H}/api/invoices`,{method:"POST",headers:aR({"Content-Type":"application/json"}),body:JSON.stringify(b)});if(!c.ok){let a=await c.text().catch(()=>"");throw Error(`Create failed: ${c.status} ${a}`)}let f=(await I(c)).parsed??null;if(d&&"function"==typeof e?e(f):await aT(a),O(!1),S(a=>({...a,invoiceNumber:"",invoiceDate:"",projectId:"",amount:0,taxPercent:10,discountValue:0,discountIsPercent:!0,notes:""})),f?.id||f?.invoiceNumber){let a=await aX(f);K(a),M(!0)}}catch(a){alert(a?.message??"Create failed")}finally{Q(!1),aN(null),aP(null)}},a$=async a=>{let b=await aX(a);Y({id:b.id??b.invoiceNumber??null,invoiceNumber:b.invoiceNumber??"",invoiceDate:b.invoiceDate??"",currency:b.currency??"USD",projectId:b.project?.projectId??b.projectId??"",amount:b.amount??b.total??0,tax:b.tax??0,discount:b.discount??0,notes:b.notes??""}),U(!0),aN(null),aP(null)},a_=async()=>{if(X){W(!0);try{let b=[];X.id&&b.push(`${H}/api/invoices/${encodeURIComponent(String(X.id))}`),X.invoiceNumber&&b.push(`${H}/api/invoices/${encodeURIComponent(String(X.invoiceNumber))}`);let c=!1;for(let a of b)try{if(!(await fetch(a,{method:"PUT",headers:aR({"Content-Type":"application/json"}),body:JSON.stringify({invoiceNumber:X.invoiceNumber,invoiceDate:X.invoiceDate,currency:X.currency,projectId:X.projectId,amount:Number(X.amount||0),tax:Number(X.tax||0),discount:Number(X.discount||0),notes:X.notes||void 0})})).ok)continue;c=!0;break}catch{}if(!c)throw Error("Edit/save failed (no supported endpoint)");d&&"function"==typeof e?e(null):await aT(a),U(!1)}catch(a){alert(a?.message??"Save failed")}finally{W(!1),aN(null),aP(null)}}},a0=b=>{K(b),aN(null),aP(null);let c=prompt("Credit amount:");if(!c)return;let f=Number(c);if(isNaN(f)||f<=0)return alert("Invalid amount");(async()=>{try{let c=aS(b)[0];if(c&&!(await fetch(`${c}/credit-note`,{method:"POST",headers:aR({"Content-Type":"application/json"}),body:JSON.stringify({amount:f})})).ok)throw Error("Credit creation failed");d&&"function"==typeof e?e(null):await aT(a),alert("Credit created")}catch(a){alert(a?.message??"Credit failed")}})()},a1=async b=>{if(!b||!confirm("Mark this invoice as paid?"))return;let c=!1;for(let a of aS(b))try{if((await fetch(`${a}/mark-paid`,{method:"POST",headers:aR()})).ok){c=!0;break}}catch{}if(!c)return alert("Mark paid failed (endpoint not supported?)");d&&"function"==typeof e?e(null):await aT(a),aN(null),aP(null)},a2=async b=>{if(!b||!confirm("Delete this invoice?"))return;let c=!1;for(let a of aS(b))try{if((await fetch(a,{method:"DELETE",headers:aR()})).ok){c=!0;break}}catch{}if(!c)return alert("Delete failed (endpoint missing?)");d&&"function"==typeof e?e(null):await aT(a),aN(null),aP(null)},a3=b=>{S({invoiceNumber:"",invoiceDate:b?.invoiceDate??"",currency:b?.currency??"USD",projectId:b?.project?.projectId??"",clientId:b?.client?.clientId??(a?String(a):""),amount:b?.amount??b?.total??0,taxPercent:b?.tax??0,discountValue:b?.discount??0,discountIsPercent:!0,notes:b?.notes??""}),O(!0),aN(null),aP(null)},a4=b=>{let c=prompt("Payment amount:");if(!c)return;let f=Number(c);if(isNaN(f)||f<=0)return alert("Invalid amount");(async()=>{try{let c=aS(b)[0];if(!c)throw Error("Cannot determine invoice endpoint for payment");if(!(await fetch(`${c}/payments`,{method:"POST",headers:aR({"Content-Type":"application/json"}),body:JSON.stringify({amount:f,note:"Manual payment added via UI"})})).ok&&!(await fetch(`${H}/api/payments`,{method:"POST",headers:aR({"Content-Type":"application/json"}),body:JSON.stringify({invoiceId:b.id??null,invoiceNumber:b.invoiceNumber??null,amount:f})})).ok)throw Error("Payment creation failed");d&&"function"==typeof e?e(null):await aT(a),alert("Payment added")}catch(a){alert(a?.message??"Add payment failed")}finally{aN(null),aP(null)}})()},a5=async a=>{try{let b=aS(a)[0];if(!b)throw Error("Cannot determine invoice endpoint for payments");let c=await fetch(`${b}/payments`,{headers:aR()});if(!c.ok)return void alert("Payments not available");let d=(await I(c)).parsed??[];alert("Payments:\n"+JSON.stringify(d,null,2))}catch(a){alert(a?.message??"View payments failed")}finally{aN(null),aP(null)}},a6=async a=>{if(a&&confirm("Send payment reminder?"))try{let b=aS(a)[0];if(!b)throw Error("Cannot determine invoice endpoint for reminder");if(!(await fetch(`${b}/reminder`,{method:"POST",headers:aR()})).ok)throw Error("Reminder send failed");alert("Reminder sent")}catch(a){alert(a?.message??"Send reminder failed")}finally{aN(null),aP(null)}},a7=a=>{aD.current=a,ac(b=>({...b,invoiceNumber:a?.invoiceNumber??b.invoiceNumber,issueDate:b.issueDate,currency:a?.currency??b.currency,sellerCompanyName:b.sellerCompanyName,sellerCompanyAddress:b.sellerCompanyAddress,productName:a?.project?.projectName??b.productName,priceWithOutTax:a?.amount??a?.total??b.priceWithOutTax,tax:a?.tax??b.tax,quantity:b.quantity,description:a?.notes??b.description,buyerCleintName:a?.client?.name??b.buyerCleintName,buyerCompanyEmail:a?.client?.email??b.buyerCompanyEmail,buyerCompanyPhoneNumber:a?.client?.mobile??b.buyerCompanyPhoneNumber})),$(!0),aN(null),aP(null)},a8=async a=>{ai(null),ak([]),ag(!0);try{if(!(a?.id??a?.invoiceId??a?.invoiceNumber))throw Error("Invoice id not available");let b=`${H}/api/invoice/receipt/${a.invoiceNumber}`,c=await fetch(b,{headers:aR()});if(!c.ok){let a=await c.text().catch(()=>"");throw Error(`Receipts fetch failed ${c.status} ${a}`)}let d=await I(c),e=[];if(Array.isArray(d.parsed))e=d.parsed;else if(Array.isArray(d.parsed?.data))e=d.parsed.data;else if(Array.isArray(d.raw))e=d.raw;else if("string"==typeof d.raw)try{let a=JSON.parse(d.raw);Array.isArray(a)&&(e=a)}catch{}ak(e),am(a),ae(!0)}catch(a){ai(a?.message??"Failed to fetch receipts"),alert(a?.message??"Failed to fetch receipts")}finally{ag(!1),aN(null),aP(null)}},a9=async a=>{try{let b=aS(a)[0];if(!b)throw Error("Cannot determine invoice endpoint for credits");let c=await fetch(`${b}/credit-notes`,{headers:aR()});if(!c.ok)return void alert("Credits not available");let d=(await I(c)).parsed??[];alert("Credit notes:\n"+JSON.stringify(d,null,2))}catch(a){alert(a?.message??"View credits failed")}finally{aN(null),aP(null)}},ba=(0,c.useMemo)(()=>{let a=q.trim().toLowerCase();return a?g.filter(b=>!!b&&(String(b.invoiceNumber??"").toLowerCase().includes(a)||String(b.project?.projectName??b.project?.projectCode??"").toLowerCase().includes(a)||String(b.client?.name??"").toLowerCase().includes(a))):g},[g,q]),bb=Number(R.amount||0),bc=R.discountIsPercent?bb*(Number(R.discountValue||0)/100):Number(R.discountValue||0),bd=(bb-bc)*(Number(R.taxPercent||0)/100),be=Math.max(0,bb-bc+bd),bf=a=>{if(!a)return null;let b=a=>a?"string"==typeof a?a:a.url??a.fileUrl??a.path??a.downloadUrl??null:null;return b(Array.isArray(a.fileUrls)&&a.fileUrls.length>0?a.fileUrls[a.fileUrls.length-1]:Array.isArray(a.files)&&a.files.length>0?a.files[a.files.length-1]:Array.isArray(a.attachments)&&a.attachments.length>0?a.attachments[a.attachments.length-1]:Array.isArray(a.filesList)&&a.filesList.length>0?a.filesList[a.filesList.length-1]:a.fileUrl??a.downloadUrl??null)},bg=async()=>{aa(!0);try{let b={invoiceId:ab.invoiceNumber||(aD.current?.invoiceNumber??void 0),issueDate:ab.issueDate||void 0,currency:ab.currency||void 0,sellerCompanyName:ab.sellerCompanyName,sellerCompanyAddress:ab.sellerCompanyAddress,sellerCompanyCode:ab.sellerCompanyCode,sellerCompanyTaxNumber:ab.sellerCompanyTaxNumber,sellerCompanyEmail:ab.sellerCompanyEmail,sellerCompanyPhoneNumber:ab.sellerCompanyPhoneNumber,sellerCompanyBankName:ab.sellerCompanyBankName,sellerCompanyBankAccountNumber:ab.sellerCompanyBankAccountNumber,buyerCompanyName:ab.buyerCompanyName,buyerCompanyAddress:ab.buyerCompanyAddress,buyerCompanyCode:ab.buyerCompanyCode,buyerCompanyTaxNumber:ab.buyerCompanyTaxNumber,buyerCleintName:ab.buyerCleintName,buyerCompanyEmail:ab.buyerCompanyEmail,buyerCompanyPhoneNumber:ab.buyerCompanyPhoneNumber,buyerCompanyBankName:ab.buyerCompanyBankName,buyerCompanyBankAccountNumber:ab.buyerCompanyBankAccountNumber,productName:ab.productName,tax:Number(ab.tax||0),priceWithOutTax:Number(ab.priceWithOutTax||0),quantity:Number(ab.quantity||1),description:ab.description},c=await fetch(`${H}/api/invoice`,{method:"POST",headers:aR({"Content-Type":"application/json"}),body:JSON.stringify(b)});if(!c.ok){let a=await c.text().catch(()=>"");throw Error(`Save failed: ${c.status} ${a}`)}let f=await I(c),g=f.parsed??null;if(!g&&"string"==typeof f.raw)try{g=JSON.parse(f.raw)}catch{g=null}d&&"function"==typeof e?e(null):await aT(a);let h=aD.current;g&&(ad&&al&&((a,b)=>{if(!a||!b)return!1;let c=a.id??a.invoiceId??a.invoiceNumber??null,d=b.id??b.invoiceId??b.invoiceNumber??null;return null!=c&&null!=d&&String(c)===String(d)})(al,aD.current??g)?ak(a=>[g,...a]):h&&(am(h),ak(a=>[g,...a]),ae(!0))),$(!1),alert("Receipt created")}catch(a){alert(a?.message??"Save receipt failed")}finally{aD.current=null,aa(!1),aN(null),aP(null)}},bh=async a=>{if(a&&confirm("Delete this receipt?"))try{let b=a.id??a.invoiceId??null;if(!b)throw Error("Receipt id not available for delete");let c=`${H}/api/invoice/${encodeURIComponent(String(b))}`,d=await fetch(c,{method:"DELETE",headers:aR()});if(!d.ok){let a=await d.text().catch(()=>"");throw Error(`Delete failed ${d.status} ${a}`)}ak(a=>a.filter(a=>{let c=a.id??a.invoiceId??a.invoiceNumber??null;return String(c)!==String(b)})),ao(null),aq(null),alert("Receipt deleted")}catch(a){alert(a?.message??"Delete failed")}},bi=a=>a._downloadUrl??a.downloadUrl??a.fileUrl??null;return(0,b.jsxs)(m.Card,{children:[(0,b.jsxs)(m.CardHeader,{className:"flex items-center justify-between",children:[(0,b.jsx)(m.CardTitle,{children:"Client Invoices"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(f.Button,{onClick:()=>{O(!0),S(b=>({...b,clientId:String(a??b.clientId??"")}))},className:"flex items-center",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Create Invoice"]}),(0,b.jsx)(f.Button,{variant:"ghost",onClick:async()=>{d&&"function"==typeof e?e(null):await aT(a),ad&&al&&await a8(al)},children:"Refresh"})]})]}),(0,b.jsxs)(m.CardContent,{children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,b.jsx)("div",{children:(0,b.jsx)("input",{placeholder:"Search invoice number / project / client",className:"w-64 px-3 py-2 border rounded",value:q,onChange:a=>s(a.target.value)})}),(0,b.jsx)("div",{className:"text-sm text-gray-500",children:j?"Loading...":`${g.length} invoices`})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-blue-50 text-left text-xs",children:[(0,b.jsx)("th",{className:"px-4 py-3",children:"Invoice #"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Date"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Project"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Currency"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Total"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Unpaid"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Status"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Action"})]})}),(0,b.jsx)("tbody",{children:j?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:8,className:"text-center py-8",children:"Loading invoices..."})}):l?(0,b.jsx)("tr",{children:(0,b.jsxs)("td",{colSpan:8,className:"text-center py-8 text-red-600",children:[l,o&&(0,b.jsx)("div",{className:"mt-2 text-xs text-gray-600",children:(0,b.jsx)("pre",{className:"whitespace-pre-wrap",children:o})})]})}):0===ba.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:8,className:"text-center py-8",children:"No invoices found"})}):ba.map(a=>{let c=a.id??a.invoiceNumber??Math.random();return(0,b.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-4 py-3",children:a.invoiceNumber??"—"}),(0,b.jsx)("td",{className:"px-4 py-3",children:a.invoiceDate?new Date(a.invoiceDate).toLocaleDateString():"—"}),(0,b.jsx)("td",{className:"px-4 py-3",children:a.project?.projectName??a.project?.projectCode??"—"}),(0,b.jsx)("td",{className:"px-4 py-3",children:a.currency??"—"}),(0,b.jsx)("td",{className:"px-4 py-3",children:"number"==typeof a.total?a.total.toLocaleString(void 0,{minimumFractionDigits:2}):a.total?String(a.total):"—"}),(0,b.jsx)("td",{className:"px-4 py-3",children:"number"==typeof a.unpaidAmount?a.unpaidAmount.toLocaleString(void 0,{minimumFractionDigits:2}):a.unpaidAmount?String(a.unpaidAmount):"—"}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)(r.Badge,{variant:"secondary",children:a.status??"—"})}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)("div",{className:"flex items-center gap-2 relative",children:(0,b.jsx)("button",{className:"invoice-action-button inline-flex items-center px-2 py-1 border rounded",onClick:b=>{b.stopPropagation();let c=b.currentTarget;aM&&(aM.id??aM.invoiceNumber)===(a.id??a.invoiceNumber)?(aN(null),aP(null)):((a,b)=>{if(!b)return;let c=b.getBoundingClientRect(),d=c.right-260;d<8&&(d=c.left);let e=c.bottom+window.scrollY+6,f=window.scrollX+window.innerWidth-260-8;d+window.scrollX>f&&(d=Math.max(window.scrollX+8,f)),aP({left:Math.max(d,window.scrollX+8),top:e}),aN(a)})(a,c)},title:"Actions","aria-expanded":aM&&(aM.id??aM.invoiceNumber)===(a.id??a.invoiceNumber),children:(0,b.jsx)(t.MoreHorizontal,{className:"h-4 w-4"})})})})]},c)})})]})})]}),aM&&aO&&(0,b.jsx)("div",{ref:aQ,style:{position:"fixed",left:`${aO.left}px`,top:`${aO.top}px`,width:260,zIndex:10050,boxShadow:"0 8px 24px rgba(0,0,0,0.12)"},className:"bg-white border rounded overflow-hidden",onClick:a=>a.stopPropagation(),children:(0,b.jsx)("ul",{children:(c=>(a=>{if(!a)return!1;let b=String(a?.status??"").toLowerCase();return!!(b.includes("credit")||b.includes("creditnote")||b.includes("credit-note")||a.isCreditNote||Array.isArray(a.creditNotes)&&a.creditNotes.length>0)})(c)?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>aY(c),children:[(0,b.jsx)(A.Eye,{className:"inline mr-2 -mt-1"})," View"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a4(c),children:[(0,b.jsx)(D,{className:"inline mr-2 -mt-1"})," Add Payment"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a5(c),children:[(0,b.jsx)(B,{className:"inline mr-2 -mt-1"})," View Payment(s)"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>(b=>{let c=prompt("Credit amount for duplicate:",String(b.unpaidAmount??b.total??0));if(!c)return;let f=Number(c);if(isNaN(f)||f<=0)return alert("Invalid amount");(async()=>{try{let c=aS(b)[0];if(!c)throw Error("Cannot determine credit endpoint");if(!(await fetch(`${c}/credit-note`,{method:"POST",headers:aR({"Content-Type":"application/json"}),body:JSON.stringify({amount:f})})).ok)throw Error("Credit duplicate failed");d&&"function"==typeof e?e(null):await aT(a),alert("Credit created")}catch(a){alert(a?.message??"Credit failed")}finally{aN(null),aP(null)}})()})(c),children:[(0,b.jsx)(y.Copy,{className:"inline mr-2 -mt-1"})," Credit Duplicate"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100 text-red-600",onClick:()=>a2(c),children:[(0,b.jsx)(w.Trash,{className:"inline mr-2 -mt-1"})," Delete"]})})]}):c&&(String(c?.status??"").toLowerCase().includes("paid")||"number"==typeof c.unpaidAmount&&0===c.unpaidAmount||"number"==typeof c.total&&"number"==typeof c.paidAmount&&c.total<=(c.paidAmount??0))?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>aY(c),children:[(0,b.jsx)(A.Eye,{className:"inline mr-2 -mt-1"})," View"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a7(c),children:[(0,b.jsx)(D,{className:"inline mr-2 -mt-1"})," Add Receipt"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a8(c),children:[(0,b.jsx)(h.FileText,{className:"inline mr-2 -mt-1"})," View Receipt(s)"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>{aD.current=c,aJ(null),aL(null),aH(!0),aN(null),aP(null)},children:[(0,b.jsx)(x.Upload,{className:"inline mr-2 -mt-1"})," Upload File"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a5(c),children:[(0,b.jsx)(B,{className:"inline mr-2 -mt-1"})," View Payment(s)"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a0(c),children:[(0,b.jsx)(h.FileText,{className:"inline mr-2 -mt-1"})," Add Credit"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a9(c),children:[(0,b.jsx)(h.FileText,{className:"inline mr-2 -mt-1"})," View Credit(s)"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100 text-red-600",onClick:()=>a2(c),children:[(0,b.jsx)(w.Trash,{className:"inline mr-2 -mt-1"})," Delete"]})})]}):(a=>{if(!a)return!1;let b=String(a?.status??"").toLowerCase();return!!(b.includes("unpaid")||b.includes("partial")||b.includes("partially"))||"number"==typeof a.unpaidAmount&&!!(a.unpaidAmount>0)})(c)?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>aY(c),children:[(0,b.jsx)(A.Eye,{className:"inline mr-2 -mt-1"})," View"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a$(c),children:[(0,b.jsx)(z.Edit2,{className:"inline mr-2 -mt-1"})," Edit"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a1(c),children:[(0,b.jsx)(v.CheckCircle,{className:"inline mr-2 -mt-1"})," Mark as Paid"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a4(c),children:[(0,b.jsx)(D,{className:"inline mr-2 -mt-1"})," Add Payment"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a6(c),children:[(0,b.jsx)(C.Bell,{className:"inline mr-2 -mt-1"})," Payment Reminder"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a0(c),children:[(0,b.jsx)(h.FileText,{className:"inline mr-2 -mt-1"})," Credit"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a3(c),children:[(0,b.jsx)(y.Copy,{className:"inline mr-2 -mt-1"})," Duplicate"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100 text-red-600",onClick:()=>a2(c),children:[(0,b.jsx)(w.Trash,{className:"inline mr-2 -mt-1"})," Delete"]})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>aY(c),children:[(0,b.jsx)(A.Eye,{className:"inline mr-2 -mt-1"})," View"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a$(c),children:[(0,b.jsx)(z.Edit2,{className:"inline mr-2 -mt-1"})," Edit"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>a3(c),children:[(0,b.jsx)(y.Copy,{className:"inline mr-2 -mt-1"})," Duplicate"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100 text-red-600",onClick:()=>a2(c),children:[(0,b.jsx)(w.Trash,{className:"inline mr-2 -mt-1"})," Delete"]})})]}))(aM)})}),(0,b.jsx)("input",{ref:aA,type:"file",style:{display:"none"},onChange:a=>{let b=a.target.files?.[0]??null;b&&(aJ(b),aL(null)),a.currentTarget.value=""}}),L&&J&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center overflow-auto p-6",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{M(!1),K(null)}}),(0,b.jsxs)("div",{className:"relative z-10 w-full max-w-4xl bg-white rounded shadow-lg overflow-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Invoice Details"}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>{M(!1),K(null)},children:(0,b.jsx)(F.X,{className:"h-4 w-4"})})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-sm font-semibold mb-2",children:"Client Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm text-gray-700",children:[(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-28 text-gray-500",children:"Name"}),(0,b.jsx)("div",{className:"font-medium",children:J.client?.name??"—"})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-28 text-gray-500",children:"Email"}),(0,b.jsx)("div",{className:"font-medium",children:J.client?.email??J.client?.contactEmail??"—"})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-28 text-gray-500",children:"Company Name"}),(0,b.jsx)("div",{className:"font-medium",children:J.client?.company?.companyName??J.client?.companyName??"—"})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-28 text-gray-500",children:"Mobile"}),(0,b.jsx)("div",{className:"font-medium",children:J.client?.mobile??J.client?.phone??"—"})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-28 text-gray-500",children:"Address"}),(0,b.jsx)("div",{className:"font-medium",children:J.client?.address??J.client?.street??"—"})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-28 text-gray-500",children:"Country"}),(0,b.jsx)("div",{className:"font-medium",children:J.client?.country??"—"})]})]})]}),(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-sm font-semibold mb-2",children:"Project Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm text-gray-700",children:[(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-32 text-gray-500",children:"Project Name"}),(0,b.jsx)("div",{className:"font-medium",children:J.project?.projectName??J.project?.name??"—"})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-32 text-gray-500",children:"Project Code"}),(0,b.jsx)("div",{className:"font-medium",children:J.project?.projectCode??J.project?.code??"—"})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-32 text-gray-500",children:"Start Date"}),(0,b.jsx)("div",{className:"font-medium",children:J.project?.startDate?new Date(J.project.startDate).toLocaleDateString():J.startDate?new Date(J.startDate).toLocaleDateString():"—"})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-32 text-gray-500",children:"End Date"}),(0,b.jsx)("div",{className:"font-medium",children:J.project?.endDate?new Date(J.project.endDate).toLocaleDateString():J.endDate?new Date(J.endDate).toLocaleDateString():"—"})]})]})]}),(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-sm font-semibold mb-3",children:"Invoice Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-700",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Invoice No."}),(0,b.jsx)("div",{className:"font-medium",children:J.invoiceNumber??J.id??"—"})]}),(0,b.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Invoice Date"}),(0,b.jsx)("div",{className:"font-medium",children:J.invoiceDate?new Date(J.invoiceDate).toLocaleDateString():"—"})]}),(0,b.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Currency"}),(0,b.jsx)("div",{className:"font-medium",children:J.currency??"—"})]}),(0,b.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Amount"}),(0,b.jsx)("div",{className:"font-medium",children:"number"==typeof J.amount?(J.currency?`${J.currency} `:"")+Number(J.amount).toLocaleString():J.total??"—"})]}),(0,b.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Tax"}),(0,b.jsx)("div",{className:"font-medium",children:J.tax??J.taxPercent?`${J.tax??J.taxPercent}%`:"—"})]}),(0,b.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Subtotal"}),(0,b.jsx)("div",{className:"font-medium",children:"number"==typeof J.subtotal?J.subtotal:J.amount?Number(J.amount).toLocaleString():"—"})]}),(0,b.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Discount"}),(0,b.jsx)("div",{className:"font-medium",children:J.discount??"0.00"})]}),(0,b.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Total Amount"}),(0,b.jsx)("div",{className:"font-medium",children:"number"==typeof J.total?J.total:J.amount?Number(J.amount).toLocaleString():"—"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Status"}),(0,b.jsx)("div",{children:J.status?(0,b.jsx)(r.Badge,{children:J.status}):"—"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-gray-500 mb-2",children:"Files"}),(0,b.jsx)("div",{className:"w-full h-40 bg-gray-50 rounded overflow-hidden border relative flex items-center justify-center",children:bf(J)?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("img",{src:bf(J),alt:"file",className:"object-cover w-full h-full"}),(0,b.jsx)("a",{href:bf(J),target:"_blank",rel:"noreferrer",className:"absolute top-2 right-2 bg-white rounded p-1 shadow",title:"Download",children:(0,b.jsx)(E.Download,{className:"h-4 w-4"})})]}):(0,b.jsx)("div",{className:"text-xs text-gray-400",children:"No files attached"})}),(J.files&&J.files.length>0||J.attachments&&J.attachments.length>0||J.filesList&&J.filesList.length>0||J.fileUrls&&J.fileUrls.length>0)&&(0,b.jsx)("div",{className:"mt-3 space-y-2 text-sm",children:(()=>{let a=[],c=b=>{if(!b)return;if("string"==typeof b)return void a.push({url:b,name:b.split("/").pop()});let c=b.url??b.fileUrl??b.path??b.downloadUrl??null,d=b.name??b.filename??b.fileName??("string"==typeof c?c.split("/").pop():void 0);a.push({url:c,name:d})};return(J.files??[]).forEach(c),(J.attachments??[]).forEach(c),(J.filesList??[]).forEach(c),(J.fileUrls??[]).forEach(c),a.reverse().map((a,c)=>a.url?(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsx)("div",{className:"text-gray-700 truncate",children:a.name??`File ${c+1}`}),(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noreferrer",className:"inline-flex items-center px-2 py-1 border rounded text-xs",children:[(0,b.jsx)(E.Download,{className:"h-3 w-3 mr-1"})," Download"]})]},c):null)})()})]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"Notes"}),(0,b.jsx)("div",{className:"mt-2 text-sm text-gray-800",children:J.notes??"No notes"})]})]})]})]})]}),ad&&al&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center overflow-auto p-6",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{ae(!1),am(null),ak([])}}),(0,b.jsxs)("div",{className:"relative z-10 w-full max-w-4xl bg-white rounded shadow-lg overflow-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Receipts"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(f.Button,{onClick:()=>a7(al),children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Add a Receipt"]}),(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>{ae(!1),am(null),ak([])},children:(0,b.jsx)(F.X,{className:"h-4 w-4"})})]})]}),(0,b.jsx)("div",{className:"p-6",children:af?(0,b.jsx)("div",{className:"text-center py-8",children:"Loading receipts..."}):ah?(0,b.jsx)("div",{className:"text-red-600",children:ah}):(0,b.jsxs)("div",{className:"overflow-x-auto",children:[(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-blue-50 text-left text-xs",children:[(0,b.jsx)("th",{className:"px-4 py-3",children:"Invoice No."}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Project"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Client"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Amount"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Issue Date"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Action"})]})}),(0,b.jsx)("tbody",{children:0===aj.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:6,className:"text-center py-8",children:"No receipts found"})}):aj.map((a,c)=>{let d=a.id??a.invoiceId??c,e=a.issueDate??a.createdAt??"—",f=a.totalAmount??a.totalExcluidingTax??a.subtotal??a.priceWithOutTax??0;return(0,b.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-4 py-3",children:a.invoiceId??"—"}),(0,b.jsx)("td",{className:"px-4 py-3",children:a.productName??a.projectName??"—"}),(0,b.jsx)("td",{className:"px-4 py-3",children:a.buyerCleintName??a.buyerCompanyName??"—"}),(0,b.jsx)("td",{className:"px-4 py-3",children:"number"==typeof f?(a.currency?`${a.currency} `:"")+Number(f).toLocaleString(void 0,{minimumFractionDigits:2}):f}),(0,b.jsx)("td",{className:"px-4 py-3",children:e?new Date(e).toLocaleDateString():"—"}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2 relative",children:[bi(a)&&(0,b.jsx)("a",{href:bi(a),target:"_blank",rel:"noreferrer",className:"inline-flex items-center px-2 py-1 border rounded",title:"Download",children:(0,b.jsx)(E.Download,{className:"h-4 w-4"})}),(0,b.jsx)("button",{className:"receipt-action-button inline-flex items-center px-2 py-1 border rounded",onClick:b=>{b.stopPropagation();let c=b.currentTarget;an&&(an.id??an.invoiceId)===(a.id??a.invoiceId)?(ao(null),aq(null)):((a,b)=>{if(!b)return;let c=b.getBoundingClientRect(),d=c.right-220;d<8&&(d=c.left);let e=c.bottom+window.scrollY+6,f=window.scrollX+window.innerWidth-220-8;d+window.scrollX>f&&(d=Math.max(window.scrollX+8,f)),aq({left:Math.max(d,window.scrollX+8),top:e}),ao(a)})(a,c)},title:"Actions","aria-expanded":an&&(an.id??an.invoiceId)===(a.id??a.invoiceId),children:(0,b.jsx)(t.MoreHorizontal,{className:"h-4 w-4"})})]})})]},d)})})]}),an&&ap&&(0,b.jsx)("div",{ref:ar,style:{position:"fixed",left:`${ap.left}px`,top:`${ap.top}px`,width:220,zIndex:11e3,boxShadow:"0 8px 24px rgba(0,0,0,0.12)"},className:"bg-white border rounded overflow-hidden",onClick:a=>a.stopPropagation(),children:(0,b.jsxs)("ul",{children:[(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>{alert(JSON.stringify(an,null,2)),ao(null),aq(null)},children:[(0,b.jsx)(A.Eye,{className:"inline mr-2 -mt-1"})," View"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>{let a=bi(an);a?window.open(a,"_blank"):alert("No download URL available"),ao(null),aq(null)},children:[(0,b.jsx)(E.Download,{className:"inline mr-2 -mt-1"})," Download as PDF"]})}),(0,b.jsx)("li",{children:(0,b.jsxs)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-100 text-red-600",onClick:()=>bh(an),children:[(0,b.jsx)(w.Trash,{className:"inline mr-2 -mt-1"})," Delete"]})})]})})]})})]})]}),N&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center overflow-auto p-6",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>O(!1)}),(0,b.jsxs)("div",{className:"relative z-10 w-full max-w-3xl bg-white rounded shadow-lg overflow-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Create Invoice"}),(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>O(!1),children:"Close"})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Invoice Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Invoice Number"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:R.invoiceNumber,onChange:a=>S(b=>({...b,invoiceNumber:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Invoice Date"}),(0,b.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2",value:R.invoiceDate,onChange:a=>S(b=>({...b,invoiceDate:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Currency"}),(0,b.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:R.currency,onChange:a=>S(b=>({...b,currency:a.target.value})),children:[(0,b.jsx)("option",{value:"USD",children:"USD $"}),(0,b.jsx)("option",{value:"USD",children:"USD ₹"}),(0,b.jsx)("option",{value:"EUR",children:"EUR €"})]})]})]})]}),(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Project Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Project"}),(0,b.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:R.projectId,onChange:a=>S(b=>({...b,projectId:a.target.value})),children:[(0,b.jsx)("option",{value:"",children:"Select Project"}),au?(0,b.jsx)("option",{children:"Loading..."}):as.map(a=>{let c=a.id??a.projectId??a._id??a.id,d=a.projectName??a.name??a.title??a.shortCode??String(c);return(0,b.jsx)("option",{value:String(c),children:d},String(c))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Client"}),(0,b.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:R.clientId,onChange:a=>S(b=>({...b,clientId:a.target.value})),children:[(0,b.jsx)("option",{value:"",children:"Select Client"}),ay?(0,b.jsx)("option",{children:"Loading..."}):aw.map(a=>{let c=a.clientId??a.id??a.client_id??a.clientId,d=a.name??a.company?.companyName??String(c);return(0,b.jsx)("option",{value:String(c),children:d},String(c))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Project Budget"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"px-2 py-2 bg-gray-100 rounded",children:" $ "}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:"",disabled:!0,placeholder:"$ 30,000"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Amount"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"px-2 py-2 bg-gray-100 rounded",children:"USD"===R.currency?"₹":"$"}),(0,b.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2",value:R.amount,onChange:a=>S(b=>({...b,amount:Number(a.target.value)}))})]})]}),(0,b.jsxs)("div",{className:"w-36",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Tax %"}),(0,b.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2",value:R.taxPercent,onChange:a=>S(b=>({...b,taxPercent:Number(a.target.value)}))})]}),(0,b.jsxs)("div",{className:"w-36",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1 text-right",children:"Amount"}),(0,b.jsx)("div",{className:"bg-gray-100 rounded px-3 py-2 text-right font-medium",children:be.toFixed(2)})]})]}),(0,b.jsx)("div",{className:"mt-4 border-t pt-3",children:(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[(0,b.jsx)("div",{}),(0,b.jsx)("div",{className:"text-right text-xs text-gray-500",children:"Sub Total"}),(0,b.jsx)("div",{className:"text-right font-medium",children:bb.toFixed(2)}),(0,b.jsx)("div",{}),(0,b.jsx)("div",{className:"text-right text-xs text-gray-500",children:"Discount"}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)("input",{type:"number",className:"w-20 border rounded px-2 py-1",value:R.discountValue,onChange:a=>S(b=>({...b,discountValue:Number(a.target.value)}))}),(0,b.jsxs)("select",{className:"border rounded px-2 py-1",value:R.discountIsPercent?"percent":"fixed",onChange:a=>S(b=>({...b,discountIsPercent:"percent"===a.target.value})),children:[(0,b.jsx)("option",{value:"percent",children:"%"}),(0,b.jsx)("option",{value:"fixed",children:"₹ / $"})]}),(0,b.jsx)("div",{className:"w-20 text-right",children:bc.toFixed(2)})]}),(0,b.jsx)("div",{}),(0,b.jsx)("div",{className:"text-right text-xs text-gray-500",children:"Tax"}),(0,b.jsx)("div",{className:"text-right font-medium",children:bd.toFixed(2)}),(0,b.jsx)("div",{}),(0,b.jsx)("div",{className:"text-right text-xs text-gray-500 font-medium",children:"Total"}),(0,b.jsx)("div",{className:"text-right font-semibold",children:be.toFixed(2)})]})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Amount in words"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",placeholder:"Amount in words"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Note / Description for the recipient"}),(0,b.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:3,value:R.notes,onChange:a=>S(b=>({...b,notes:a.target.value}))})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>O(!1),children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:aZ,disabled:P,children:P?"Creating...":"Save"})]})]})]})]}),Z&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center overflow-auto p-6",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{$(!1),aD.current=null}}),(0,b.jsxs)("div",{className:"relative z-10 w-full max-w-4xl bg-white rounded shadow-lg overflow-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Create Receipt"}),(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>{$(!1),aD.current=null},children:(0,b.jsx)(F.X,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Invoice Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Invoice Number *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.invoiceNumber,onChange:a=>ac(b=>({...b,invoiceNumber:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Issue Date *"}),(0,b.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2",value:ab.issueDate,onChange:a=>ac(b=>({...b,issueDate:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Currency *"}),(0,b.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:ab.currency,onChange:a=>ac(b=>({...b,currency:a.target.value})),children:[(0,b.jsx)("option",{value:"USD",children:"USD $"}),(0,b.jsx)("option",{value:"USD",children:"USD ₹"}),(0,b.jsx)("option",{value:"EUR",children:"EUR €"})]})]})]})]}),(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Seller Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Company Name *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.sellerCompanyName,onChange:a=>ac(b=>({...b,sellerCompanyName:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Email Id *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.sellerCompanyEmail,onChange:a=>ac(b=>({...b,sellerCompanyEmail:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Contact No. *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.sellerCompanyPhoneNumber,onChange:a=>ac(b=>({...b,sellerCompanyPhoneNumber:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Company Code *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.sellerCompanyCode,onChange:a=>ac(b=>({...b,sellerCompanyCode:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Tax No. *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.sellerCompanyTaxNumber,onChange:a=>ac(b=>({...b,sellerCompanyTaxNumber:a.target.value}))})]}),(0,b.jsx)("div",{})]}),(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Company Address *"}),(0,b.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:3,value:ab.sellerCompanyAddress,onChange:a=>ac(b=>({...b,sellerCompanyAddress:a.target.value}))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Bank Account No. *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.sellerCompanyBankAccountNumber,onChange:a=>ac(b=>({...b,sellerCompanyBankAccountNumber:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Name of the Bank *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.sellerCompanyBankName,onChange:a=>ac(b=>({...b,sellerCompanyBankName:a.target.value}))})]})]})]}),(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Buyer Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Client Name *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.buyerCleintName,onChange:a=>ac(b=>({...b,buyerCleintName:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Company Name *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.buyerCompanyName,onChange:a=>ac(b=>({...b,buyerCompanyName:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Email Id *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.buyerCompanyEmail,onChange:a=>ac(b=>({...b,buyerCompanyEmail:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Contact No. *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.buyerCompanyPhoneNumber,onChange:a=>ac(b=>({...b,buyerCompanyPhoneNumber:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Company Code *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.buyerCompanyCode,onChange:a=>ac(b=>({...b,buyerCompanyCode:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Tax No. *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.buyerCompanyTaxNumber,onChange:a=>ac(b=>({...b,buyerCompanyTaxNumber:a.target.value}))})]})]}),(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Company Address *"}),(0,b.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:3,value:ab.buyerCompanyAddress,onChange:a=>ac(b=>({...b,buyerCompanyAddress:a.target.value}))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Bank Account No. *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.buyerCompanyBankAccountNumber,onChange:a=>ac(b=>({...b,buyerCompanyBankAccountNumber:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Name of the Bank *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.buyerCompanyBankName,onChange:a=>ac(b=>({...b,buyerCompanyBankName:a.target.value}))})]})]})]}),(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Project Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Product / Project *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:ab.productName,onChange:a=>ac(b=>({...b,productName:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Quantity *"}),(0,b.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2",value:ab.quantity,onChange:a=>ac(b=>({...b,quantity:Number(a.target.value)}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Price Without Tax *"}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsxs)("span",{className:"px-2 py-2 bg-gray-100 rounded-l border",children:[" ","USD"===ab.currency?"₹":"$"," "]}),(0,b.jsx)("input",{type:"number",className:"w-full border rounded-r px-3 py-2",value:ab.priceWithOutTax,onChange:a=>ac(b=>({...b,priceWithOutTax:Number(a.target.value)}))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Tax *"}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("span",{className:"px-2 py-2 bg-gray-100 rounded-l border",children:" % "}),(0,b.jsx)("input",{type:"number",className:"w-full border rounded-r px-3 py-2",value:ab.tax,onChange:a=>ac(b=>({...b,tax:Number(a.target.value)}))})]})]})]}),(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Note/ Description for the recipient *"}),(0,b.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:3,value:ab.description,onChange:a=>ac(b=>({...b,description:a.target.value}))})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>{$(!1),aD.current=null},children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:bg,disabled:_,children:_?"Saving...":"Save"})]})]})]})]}),T&&X&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center overflow-auto p-6",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>U(!1)}),(0,b.jsxs)("div",{className:"relative z-10 w-full max-w-2xl bg-white rounded shadow-lg overflow-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Edit Invoice"}),(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>U(!1),children:"Close"})]}),(0,b.jsxs)("div",{className:"p-4 space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Invoice Number"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:X.invoiceNumber,onChange:a=>Y(b=>({...b,invoiceNumber:a.target.value}))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Invoice Date"}),(0,b.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2",value:X.invoiceDate,onChange:a=>Y(b=>({...b,invoiceDate:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Currency"}),(0,b.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:X.currency,onChange:a=>Y(b=>({...b,currency:a.target.value})),children:[(0,b.jsx)("option",{value:"USD",children:"USD"}),(0,b.jsx)("option",{value:"USD",children:"USD"}),(0,b.jsx)("option",{value:"EUR",children:"EUR"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-1",children:"Amount"}),(0,b.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2",value:X.amount,onChange:a=>Y(b=>({...b,amount:Number(a.target.value)}))})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>U(!1),children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:a_,disabled:V,children:V?"Saving...":"Save"})]})]})]})]}),aG&&(0,b.jsxs)("div",{className:"fixed inset-0 z-60 flex items-start justify-center overflow-auto p-6",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{aH(!1),aD.current=null,aJ(null),aL(null)}}),(0,b.jsxs)("div",{className:"relative z-10 w-full max-w-2xl bg-white rounded shadow-lg overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border-b",children:[(0,b.jsx)("h3",{className:"text-base font-semibold ml-3",children:"Upload File"}),(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>{aH(!1),aD.current=null,aJ(null),aL(null)},children:(0,b.jsx)(F.X,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{onDrop:a=>{a.preventDefault(),a.stopPropagation();let b=a.dataTransfer.files?.[0]??null;b&&(aJ(b),aL(null))},onDragOver:a=>{a.preventDefault()},className:"w-full h-36 border-2 border-dashed rounded-md flex flex-col items-center justify-center gap-2 cursor-pointer",onClick:()=>{aA.current?.click()},children:[(0,b.jsx)(G,{className:"h-6 w-6 text-gray-400"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Choose a file"}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:"or drag & drop here"}),aI&&(0,b.jsx)("div",{className:"mt-2 text-sm text-gray-700",children:aI.name})]}),aK&&(0,b.jsx)("div",{className:"mt-3 text-sm text-red-600",children:aK}),(0,b.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>{aH(!1),aD.current=null,aJ(null),aL(null)},children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:aW,disabled:aE,children:aE?"Uploading...":"Save"})]})]})]})]})]})}var K=a.i(866718),L=a.i(206015),M=a.i(580701),N=a.i(879360),O=a.i(101239),P=a.i(642900),Q=a.i(781560),R=a.i(587532),S=a.i(571987);let T=(0,i.default)("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);function U({clientId:a}){(0,d.useRouter)();let[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(null);(0,c.useEffect)(()=>{if(!a&&0!==a){h([]),j("No client selected."),f(!1);return}let b=new AbortController,c=String(a),d=`https://6jnqmj85-80.inc1.devtunnels.ms/api/credit-notes/client/${encodeURIComponent(c)}`;f(!0),j(null);let e=localStorage.getItem("accessToken");return fetch(d,{method:"GET",headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}}).then(async a=>{if(!a.ok){let b=await a.text().catch(()=>"");throw Error(`HTTP ${a.status} ${b}`)}return a.json()}).then(a=>{Array.isArray(a)?h(a):a&&"object"==typeof a?Array.isArray(a.data)?h(a.data):Array.isArray(a.creditNotes)?h(a.creditNotes):h([]):h([])}).catch(a=>{"AbortError"!==a.name&&(console.error("Error fetching credit notes:",a),j("Failed to load credit notes."),h([]))}).finally(()=>f(!1)),()=>b.abort()},[a]);let o=a=>{if(!a)return"-";try{let b=new Date(a),c=String(b.getDate()).padStart(2,"0"),d=String(b.getMonth()+1).padStart(2,"0"),e=b.getFullYear();return`${c}/${d}/${e}`}catch{return a}},p=(a,b)=>{if(null==a||Number.isNaN(Number(a)))return"$ 0.00";let c=b||"USD";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:c,maximumFractionDigits:2}).format(Number(a))}catch{return`${c} ${Number(a).toFixed(2)}`}},q=(0,c.useCallback)(a=>{n(a),l(!0)},[]),r=(0,c.useCallback)(()=>{l(!1),n(null)},[]);return(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg border p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Credit Notes"}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:[g.length," record",1!==g.length?"s":""]})]}),e?(0,b.jsx)("div",{className:"py-12 flex justify-center",children:(0,b.jsx)(T,{className:"animate-spin"})}):i?(0,b.jsx)("div",{className:"py-6 text-center text-red-600",children:i}):0===g.length?(0,b.jsx)("div",{className:"py-8 text-center text-gray-600",children:"No credit notes found for this client."}):(0,b.jsxs)("div",{className:"rounded-lg border overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-[#e8f3ff] px-6 py-3 flex text-sm text-gray-700 font-medium",children:[(0,b.jsx)("div",{className:"w-1/6",children:"Credit Note"}),(0,b.jsx)("div",{className:"w-1/6",children:"Invoice"}),(0,b.jsx)("div",{className:"w-2/6",children:"Client"}),(0,b.jsx)("div",{className:"w-1/6",children:"Total"}),(0,b.jsx)("div",{className:"w-1/6",children:"Credit Note Date"}),(0,b.jsx)("div",{className:"w-12 text-center",children:"Action"})]}),(0,b.jsx)("div",{className:"px-6 py-4",children:(0,b.jsx)("div",{className:"space-y-3",children:g.map(a=>(0,b.jsxs)("div",{className:"flex items-center rounded-md border px-4 py-4 bg-white",style:{boxShadow:"0 0 0 1px rgba(0,0,0,0.02) inset"},children:[(0,b.jsx)("div",{className:"w-1/6 text-sm",children:(0,b.jsx)("div",{className:"font-medium",children:a.creditNoteNumber??`CN#${a.id}`})}),(0,b.jsx)("div",{className:"w-1/6 text-sm",children:a.invoiceNumber??"-"}),(0,b.jsxs)("div",{className:"w-2/6 flex items-center gap-3 text-sm",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full overflow-hidden bg-gray-100 relative flex-shrink-0",children:a.client?.profilePictureUrl?(0,b.jsx)(S.default,{src:a.client.profilePictureUrl,alt:a.client?.name??"client",fill:!0,sizes:"32px",style:{objectFit:"cover"},unoptimized:!0}):(0,b.jsx)("div",{className:"flex items-center justify-center h-full text-xs text-gray-500",children:a.client?.name?a.client.name.charAt(0):"U"})}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-medium text-sm",children:a.client?.name??"-"}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:a.project?.projectName??""})]})]}),(0,b.jsxs)("div",{className:"w-1/6 text-sm",children:[(0,b.jsx)("div",{className:"text-sm font-semibold",children:p(a.totalAmount??a.amount,a.currency)}),(0,b.jsxs)("div",{className:"text-xs text-amber-600",children:["Adjustment : ",null!=a.adjustment?Number(a.adjustment).toFixed(2):"0.00"]})]}),(0,b.jsx)("div",{className:"w-1/6 text-sm",children:o(a.creditNoteDate??a.createdAt)}),(0,b.jsx)("div",{className:"w-12 text-center",children:(0,b.jsx)("button",{type:"button",onClick:()=>q(a),className:"inline-flex items-center justify-center h-8 w-8 rounded-full hover:bg-gray-100",title:"View details",children:(0,b.jsx)(A.Eye,{size:16})})})]},a.id))})})]})]}),k&&m&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-20 px-4",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:r}),(0,b.jsx)("div",{className:"relative z-10 w-[820px] max-w-full",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg border shadow",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-3 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Credit Note Details"}),(0,b.jsx)("button",{onClick:r,className:"text-gray-600 hover:text-gray-800","aria-label":"Close",children:"✕"})]}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("div",{className:"rounded-md border p-5",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Credit Note #"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Credit Note Date"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Client"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Project"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Invoice Amount"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Adjustment"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Tax"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Note"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"File"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:m.creditNoteNumber??`CN#${m.id}`}),(0,b.jsx)("div",{className:"text-sm",children:o(m.creditNoteDate??m.createdAt)}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full overflow-hidden bg-gray-100 relative",children:m.client?.profilePictureUrl?(0,b.jsx)(S.default,{src:m.client.profilePictureUrl,alt:m.client?.name??"client",fill:!0,sizes:"32px",style:{objectFit:"cover"},unoptimized:!0}):(0,b.jsx)("div",{className:"flex items-center justify-center h-full text-xs text-gray-500",children:m.client?.name?m.client.name.charAt(0):"U"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:m.client?.name??"-"}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:m.client?.companyName??""})]})]}),(0,b.jsx)("div",{className:"text-sm",children:m.project?.projectName??"-"}),(0,b.jsx)("div",{className:"text-sm",children:p(m.totalAmount??m.amount,m.currency)}),(0,b.jsxs)("div",{className:"text-sm",children:[null!=m.adjustment?p(m.adjustment,m.currency):p(0,m.currency)," ",m.adjustmentPositive?"(Add)":""]}),(0,b.jsx)("div",{className:"text-sm",children:null!=m.tax?`${m.tax} %`:"-"}),(0,b.jsx)("div",{className:"text-sm text-gray-700",children:m.notes??"-"}),(0,b.jsx)("div",{className:"text-sm",children:(0,b.jsx)(({url:a,alt:c})=>a?(0,b.jsxs)("div",{className:"relative inline-block",children:[(0,b.jsx)("a",{href:a,target:"_blank",rel:"noreferrer",children:(0,b.jsx)("img",{src:a,alt:c??"file",style:{width:140,height:90,objectFit:"cover",borderRadius:4},className:"border"})}),(0,b.jsx)("a",{href:a,download:!0,target:"_blank",rel:"noreferrer",className:"absolute top-1 right-1 bg-white rounded-full p-1 shadow",title:"Download",onClick:a=>a.stopPropagation(),children:(0,b.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M12 3v12",stroke:"#333",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M8 11l4 4 4-4",stroke:"#333",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M21 21H3",stroke:"#333",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}):(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"No file attached"}),{url:m.fileUrl,alt:m.creditNoteNumber??`CN#${m.id}`})})]})]})})}),(0,b.jsx)("div",{className:"flex items-center justify-end px-6 py-3 border-t",children:(0,b.jsx)("button",{onClick:r,className:"px-4 py-2 rounded border bg-white hover:bg-gray-50",children:"Close"})})]})})]})]})}let V="https://6jnqmj85-80.inc1.devtunnels.ms";function W({clientId:a,onAdd:d,onSearch:e,onAction:f}){let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!1),[s,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)("view"),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)("pre filled"),[D,E]=(0,c.useState)(()=>a?String(a):"pre filled"),[G,H]=(0,c.useState)("pre filled"),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)("USD"),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)("Net Banking"),[R,T]=(0,c.useState)(""),U=(0,c.useRef)(null),[W,X]=(0,c.useState)(null),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)([]),[aa,ab]=(0,c.useState)("");(0,c.useEffect)(()=>{if(!a&&0!==a){h([]),l("No client selected."),j(!1);return}let b=new AbortController,c=String(a),d=`${V}/api/payments/client/${encodeURIComponent(c)}`;return j(!0),l(null),fetch(d,{method:"GET",signal:b.signal,headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}).then(async a=>{if(!a.ok){let b=await a.text().catch(()=>"");throw Error(`HTTP ${a.status} ${b}`)}return a.json()}).then(a=>{if(!Array.isArray(a))return void h([]);h(a.map(a=>({id:a.id,code:a.project?.projectCode??void 0,project:a.project?.projectName??void 0,invoice:a.invoice?.invoiceNumber??void 0,client:{clientId:a.client?.clientId,name:a.client?.name??void 0,companyName:a.client?.companyName??void 0,profilePictureUrl:a.client?.profilePictureUrl??void 0},orderNumber:a.orderNumber??void 0,amount:"number"==typeof a.amount?a.amount:a.amount?Number(a.amount):void 0,currency:a.currency??void 0,paidOn:a.paymentDate??void 0,paymentGateway:a.paymentGateway?.name??void 0,status:a.status?"completed"===String(a.status).toLowerCase()?"Complete":a.status:void 0,receiptFileUrl:a.receiptFileUrl??void 0})))}).catch(a=>{"AbortError"!==a.name&&(console.error("Error fetching payments:",a),l("Failed to load payments."),h([]))}).finally(()=>{j(!1)}),()=>b.abort()},[a]);let ac=(0,c.useMemo)(()=>{let a=m.trim().toLowerCase();return a?g.filter(b=>String(b.code??"").toLowerCase().includes(a)||String(b.project??"").toLowerCase().includes(a)||String(b.invoice??"").toLowerCase().includes(a)||String(b.client?.name??"").toLowerCase().includes(a)||String(b.client?.companyName??"").toLowerCase().includes(a)||String(b.orderNumber??"").toLowerCase().includes(a)):g},[g,m]),ad=a=>{if(!a)return"--";try{let b=new Date(a),c=String(b.getDate()).padStart(2,"0"),d=String(b.getMonth()+1).padStart(2,"0"),e=b.getFullYear();return`${c}/${d}/${e}`}catch{return a}},ae=(a,b)=>{if(null==a)return"--";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:b||"USD",maximumFractionDigits:2}).format(Number(a))}catch{return`${b??"$"} ${Number(a).toFixed(2)}`}},af=()=>U.current?.click(),ag=a=>X(a.target.files?.[0]??null),ah=()=>{W?.name,A(!1)},ai=async()=>{try{let a=await fetch(`${V}/api/payment-gateways`,{headers:{Authorization:"Bearer ",Accept:"application/json"}});if(!a.ok){console.error("Failed to fetch gateways",a.status),_([]);return}let b=await a.json();Array.isArray(b)?_(b.map(a=>({id:a.id,name:a.name}))):_([])}catch(a){console.error("fetchGateways error",a),_([])}},aj=()=>{ab(""),Z(!0),ai()},ak=async()=>{let a=aa.trim();if(!a)return void alert("Enter gateway name");try{let b=await fetch(`${V}/api/payment-gateways`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({name:a})});if(!b.ok){let a=await b.text().catch(()=>"");console.error("POST gateway failed",b.status,a),alert("Failed to create gateway");return}let c=await b.json();_(a=>[...a,{id:c.id,name:c.name}]),P(c.name),Z(!1)}catch(a){console.error("handleSaveGateway error",a),alert("Failed to create gateway")}},al=async a=>{if(confirm("Delete this gateway?"))try{let b=await fetch(`${V}/api/payment-gateways/${encodeURIComponent(String(a))}`,{method:"DELETE",headers:{Authorization:"Bearer "}});if(!b.ok){console.error("Failed delete gateway",b.status),alert("Failed to delete gateway");return}if(_(b=>b.filter(b=>b.id!==a)),$.find(b=>b.id===a&&b.name===O)){let b=$.filter(b=>b.id!==a);P(b[0]?.name??"")}}catch(a){console.error("handleDeleteGateway error",a),alert("Failed to delete gateway")}};return(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg border p-5",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Payments"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{children:(0,b.jsx)("button",{onClick:()=>{if(d)try{d()}catch{}E(a?String(a):D),A(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"+ Add Payment"})}),(0,b.jsx)("div",{children:(0,b.jsx)("input",{type:"search",placeholder:"Search",value:m,onChange:a=>{n(a.target.value),e&&e(a.target.value)},className:"border rounded px-3 py-2 text-sm w-56"})})]})]}),i?(0,b.jsx)("div",{className:"py-6 text-center text-gray-600",children:"Loading payments..."}):k?(0,b.jsx)("div",{className:"py-6 text-center text-red-600",children:k}):(0,b.jsxs)("div",{className:"rounded-lg border overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-[#e8f3ff] px-4 py-3 flex text-sm text-gray-700 font-medium",children:[(0,b.jsx)("div",{className:"w-1/12",children:"Code"}),(0,b.jsx)("div",{className:"w-2/12",children:"Project"}),(0,b.jsx)("div",{className:"w-1/12",children:"Invoice"}),(0,b.jsx)("div",{className:"w-2/12",children:"Client"}),(0,b.jsx)("div",{className:"w-1/12",children:"Order#"}),(0,b.jsx)("div",{className:"w-1/12",children:"Amount"}),(0,b.jsx)("div",{className:"w-1/12",children:"Paid On"}),(0,b.jsx)("div",{className:"w-1/12",children:"Payment Gateway"}),(0,b.jsx)("div",{className:"w-1/12",children:"Status"}),(0,b.jsx)("div",{className:"w-10 text-center",children:"Action"})]}),(0,b.jsx)("div",{className:"px-4 py-4",children:0===ac.length?(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"No payments to display."}):(0,b.jsx)("div",{className:"space-y-3",children:ac.map(a=>(0,b.jsxs)("div",{className:"flex items-center rounded-md border px-4 py-3 bg-white",style:{boxShadow:"0 0 0 1px rgba(0,0,0,0.02) inset"},children:[(0,b.jsx)("div",{className:"w-1/12 text-sm",children:a.code??"--"}),(0,b.jsx)("div",{className:"w-2/12 text-sm",children:a.project??"--"}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:a.invoice??"--"}),(0,b.jsxs)("div",{className:"w-2/12 flex items-center gap-3 text-sm",children:[(0,b.jsx)("div",{className:"h-7 w-7 rounded-full overflow-hidden bg-gray-100 relative flex-shrink-0",children:a.client?.profilePictureUrl?(0,b.jsx)(S.default,{src:a.client.profilePictureUrl,alt:a.client?.name??"client",fill:!0,sizes:"28px",style:{objectFit:"cover"},unoptimized:!0}):(0,b.jsx)("div",{className:"flex items-center justify-center h-full text-xs text-gray-500",children:a.client?.name?.charAt(0)??"U"})}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:a.client?.name??"--"}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:a.client?.companyName??""})]})]}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:a.orderNumber??"--"}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:ae(a.amount,a.currency)}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:ad(a.paidOn)}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:a.paymentGateway??"--"}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:"Complete"===a.status?(0,b.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-emerald-600 block"}),(0,b.jsx)("span",{children:"Complete"})]}):"Pending"===a.status?(0,b.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-yellow-500 block"}),(0,b.jsx)("span",{children:"Pending"})]}):(0,b.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-red-500 block"}),(0,b.jsx)("span",{children:a.status??"--"})]})}),(0,b.jsxs)("div",{className:"w-10 text-center relative",children:[(0,b.jsx)("button",{onClick:()=>p(o===a.id?null:a.id),className:"p-2 rounded hover:bg-gray-100 inline-flex items-center justify-center",title:"Actions",children:(0,b.jsx)(t.MoreHorizontal,{size:16})}),o===a.id&&(0,b.jsxs)("div",{className:"absolute right-0 top-9 bg-white border rounded-md shadow-lg w-32 z-20",children:[(0,b.jsx)("button",{onClick:()=>{w(a),y("view"),r(!0),p(null)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100",children:"View"}),(0,b.jsx)("button",{onClick:()=>{w(a),y("edit"),u(!0),p(null)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100",children:"Edit"})]})]})]},a.id))})})]})]}),z&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[10000] flex items-start justify-center pt-8 px-4 overflow-y-auto",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>A(!1)}),(0,b.jsxs)("div",{className:"relative w-full max-w-4xl bg-white rounded-xl shadow-2xl overflow-y-auto z-10",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Add Payment Details"}),(0,b.jsx)("button",{onClick:()=>A(!1),className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:(0,b.jsx)(F.X,{className:"w-5 h-5"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Payment Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Project *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:B,onChange:a=>C(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Client *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:D,onChange:a=>E(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Invoice *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:G,onChange:a=>H(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Amount *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:I,onChange:a=>J(a.target.value),placeholder:"---"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Currency *"}),(0,b.jsxs)("select",{value:K,onChange:a=>L(a.target.value),className:"w-full border rounded px-3 py-2",children:[(0,b.jsx)("option",{value:"USD",children:"USD $"}),(0,b.jsx)("option",{value:"USD",children:"USD ₹"}),(0,b.jsx)("option",{value:"EUR",children:"EUR €"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Transaction Id"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:M,onChange:a=>N(a.target.value)})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Payment Gateway"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("select",{value:O,onChange:a=>P(a.target.value),className:"w-full border rounded px-3 py-2",children:$.length>0?$.map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id)):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("option",{children:"Net Banking"}),(0,b.jsx)("option",{children:"Credit Card"}),(0,b.jsx)("option",{children:"PayPal"})]})}),(0,b.jsx)("button",{className:"px-3 py-2 bg-gray-100 rounded",type:"button",onClick:aj,title:"Add payment gateway",children:"Add"})]})]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-2",children:"Receipt"}),(0,b.jsxs)("div",{onClick:af,className:"border-2 border-dashed rounded-lg h-28 flex items-center justify-center cursor-pointer text-gray-500",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"mb-1",children:"Choose a file"}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:W?W.name:"Drag & drop or click"})]}),(0,b.jsx)("input",{ref:U,type:"file",className:"hidden",onChange:ag})]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-2",children:"Remark"}),(0,b.jsx)("textarea",{rows:4,value:R,onChange:a=>T(a.target.value),className:"w-full p-3 border rounded",placeholder:"Enter a summary of payment"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,b.jsx)("button",{className:"px-4 py-2 border rounded",onClick:()=>A(!1),children:"Cancel"}),(0,b.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:ah,children:"Save"})]})]})]})]}),s&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[10000] flex items-start justify-center pt-8 px-4 overflow-y-auto",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>u(!1)}),(0,b.jsxs)("div",{className:"relative w-full max-w-4xl bg-white rounded-xl shadow-2xl overflow-y-auto z-10",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Edit Payment Details"}),(0,b.jsx)("button",{onClick:()=>u(!1),className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:(0,b.jsx)(F.X,{className:"w-5 h-5"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Payment Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Project *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:B,onChange:a=>C(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Client *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:D,onChange:a=>E(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Invoice *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:G,onChange:a=>H(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Amount *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:I,onChange:a=>J(a.target.value),placeholder:"---"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Currency *"}),(0,b.jsxs)("select",{value:K,onChange:a=>L(a.target.value),className:"w-full border rounded px-3 py-2",children:[(0,b.jsx)("option",{value:"USD",children:"USD $"}),(0,b.jsx)("option",{value:"USD",children:"USD ₹"}),(0,b.jsx)("option",{value:"EUR",children:"EUR €"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Transaction Id"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:M,onChange:a=>N(a.target.value)})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Payment Gateway"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("select",{value:O,onChange:a=>P(a.target.value),className:"w-full border rounded px-3 py-2",children:$.length>0?$.map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id)):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("option",{children:"Net Banking"}),(0,b.jsx)("option",{children:"Credit Card"}),(0,b.jsx)("option",{children:"PayPal"})]})}),(0,b.jsx)("button",{className:"px-3 py-2 bg-gray-100 rounded",type:"button",onClick:aj,title:"Add payment gateway",children:"Add"})]})]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-2",children:"Receipt"}),(0,b.jsxs)("div",{onClick:af,className:"border-2 border-dashed rounded-lg h-28 flex items-center justify-center cursor-pointer text-gray-500",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"mb-1",children:"Choose a file"}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:W?W.name:"Drag & drop or click"})]}),(0,b.jsx)("input",{ref:U,type:"file",className:"hidden",onChange:ag})]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-2",children:"Remark"}),(0,b.jsx)("textarea",{rows:4,value:R,onChange:a=>T(a.target.value),className:"w-full p-3 border rounded",placeholder:"Enter a summary of payment"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,b.jsx)("button",{className:"px-4 py-2 border rounded",onClick:()=>A(!1),children:"Cancel"}),(0,b.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:ah,children:"Save"})]})]})]})]}),Y&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[11000] flex items-start justify-center pt-12 px-4 overflow-y-auto",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>Z(!1)}),(0,b.jsxs)("div",{className:"relative w-full max-w-3xl bg-white rounded-xl shadow-2xl overflow-y-auto z-20",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Add Payment Gateway"}),(0,b.jsx)("button",{onClick:()=>Z(!1),className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:(0,b.jsx)(F.X,{className:"w-5 h-5"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{className:"rounded border overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-[#e8f3ff] px-4 py-2 flex text-sm text-gray-700 font-medium",children:[(0,b.jsx)("div",{className:"w-1/12",children:"#"}),(0,b.jsx)("div",{className:"w-11/12",children:"Gateway"}),(0,b.jsx)("div",{className:"w-12 text-center",children:"Action"})]}),(0,b.jsx)("div",{className:"px-4 py-2",children:0===$.length?(0,b.jsx)("div",{className:"text-sm text-gray-500 p-2",children:"No gateways"}):$.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center py-2 border-b last:border-b-0",children:[(0,b.jsx)("div",{className:"w-1/12 text-sm",children:c+1}),(0,b.jsx)("div",{className:"w-11/12 text-sm",children:a.name}),(0,b.jsx)("div",{className:"w-12 text-center",children:(0,b.jsx)("button",{onClick:()=>al(a.id),className:"inline-flex items-center justify-center p-1 rounded hover:bg-red-50 text-red-600",title:"Delete gateway",children:(0,b.jsx)(Q.Trash2,{size:16})})})]},a.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Payment Gateway Name *"}),(0,b.jsx)("input",{value:aa,onChange:a=>ab(a.target.value),placeholder:"--",className:"w-full border rounded px-3 py-2 mt-2"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3 pt-2",children:[(0,b.jsx)("button",{className:"px-4 py-2 border rounded",onClick:()=>Z(!1),children:"Cancel"}),(0,b.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:ak,children:"Save"})]})]})]})]}),q&&v&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[12000] flex justify-center items-start pt-10",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>r(!1)}),(0,b.jsxs)("div",{className:"relative bg-white w-full max-w-3xl rounded-xl shadow-xl p-6 z-10",children:[(0,b.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Payment Details"}),(0,b.jsx)("button",{onClick:()=>r(!1),children:(0,b.jsx)(F.X,{})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-y-4 text-sm",children:[(0,b.jsx)("div",{children:"Amount"}),(0,b.jsx)("div",{children:ae(v.amount,v.currency)}),(0,b.jsx)("div",{children:"Payment On"}),(0,b.jsx)("div",{children:ad(v.paidOn)}),(0,b.jsx)("div",{children:"Invoice"}),(0,b.jsx)("div",{children:v.invoice??"--"}),(0,b.jsx)("div",{children:"Project"}),(0,b.jsx)("div",{children:v.project??"--"}),(0,b.jsx)("div",{children:"Gateway"}),(0,b.jsx)("div",{children:v.paymentGateway??"--"}),(0,b.jsx)("div",{children:"Status"}),(0,b.jsx)("div",{children:v.status??"--"}),(0,b.jsx)("div",{children:"Receipt"}),(0,b.jsx)("div",{children:v.receiptFileUrl??"--"}),(0,b.jsx)("div",{children:"Remark"}),(0,b.jsx)("div",{children:"--"})]})]})]})]})}let X="https://6jnqmj85-80.inc1.devtunnels.ms";function Y({clientId:a,documents:d,onUpload:e,onDelete:f,onAction:g,authToken:h,extraHeaders:i,includeCredentials:j=!1,fileFieldName:k="file",onUnauthorized:l}){let m=(0,c.useRef)(null),[n,o]=(0,c.useState)(d||[]),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(!1),[u,v]=(0,c.useState)({}),[w,x]=(0,c.useState)(null);(0,c.useEffect)(()=>{null!=d&&o(d)},[d]);let y=a=>{let b={Accept:"application/json",...i||{},...a.headers||{}};return h&&(b.Authorization=`Bearer ${h}`),{method:a.method??"GET",headers:b,body:a.body??void 0,credentials:j?"include":"same-origin"}};(0,c.useEffect)(()=>{if(null!=d||!a)return;let b=!0;return async function(){s(!0),x(null);try{let c=a.id,d=await fetch(`${X}/clients/${c}/documents`,y({method:"GET"}));if(401===d.status){x("Unauthorized: provide a valid token or enable credentials."),l&&l();return}if(!d.ok){let a=await d.text();throw Error(`Failed to fetch documents: ${d.status} ${a}`)}let e=await d.json(),f=(Array.isArray(e)?e:[]).map(a=>({id:a.id,name:a.filename??a.name??null,fileUrl:a.url??a.fileUrl??null,mimeType:a.mimeType??a.type??null,createdAt:a.uploadedAt??a.createdAt??null,size:a.size??null,uploadedBy:a.uploadedBy??null}));b&&o(f)}catch(a){console.error(a),b&&x(a?.message??"Unable to load documents")}finally{b&&s(!1)}}(),()=>{b=!1}},[a,d,h,j,JSON.stringify(i)]);let z=async b=>{let c=b.target.files?.[0];if(!c)return;e&&e(c);let d=c.type.startsWith("image/")?URL.createObjectURL(c):void 0,f=`local-${Date.now()}`,g={id:f,name:c.name,fileUrl:d??null,mimeType:c.type,createdAt:new Date().toISOString()};o(a=>[g,...a]);try{v(a=>({...a,[f]:!0}));let b=new FormData;b.append(k,c);let e=a.id,g=await fetch(`${X}/clients/${e}/documents`,y({method:"POST",body:b}));if(401===g.status){o(a=>a.filter(a=>a.id!==f)),x("Unauthorized (401). Provide valid auth."),l&&l();return}if(!g.ok){o(a=>a.filter(a=>a.id!==f));let a=await g.text();throw Error(`Upload failed: ${g.status} ${a}`)}let h=await g.json(),i={id:h.id,name:h.filename??c.name,fileUrl:h.url??h.fileUrl??d??null,mimeType:h.mimeType??c.type,createdAt:h.uploadedAt??new Date().toISOString(),size:h.size??null,uploadedBy:h.uploadedBy??null};o(a=>[i,...a.filter(a=>a.id!==f)])}catch(a){console.error("Upload error:",a),x(a?.message??"Upload failed")}finally{v(a=>{let b={...a};return delete b[f],b}),m.current&&(m.current.value="")}},A=async b=>{o(a=>a.filter(a=>a.id!==b)),f&&f(b);try{let c=a.id,d=await fetch(`${X}/clients/${c}/documents/${b}`,y({method:"DELETE"}));if(401===d.status){x("Unauthorized (401). Provide valid auth."),l&&l();return}if(!d.ok){let a=await d.text();throw Error(`Delete failed: ${d.status} ${a}`)}}catch(a){console.error(a),x(a?.message??"Failed to delete document")}};return(0,b.jsx)("div",{className:"w-full",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg border p-5",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Upload file"}),(0,b.jsxs)("div",{onClick:()=>m.current?.click(),role:"button",className:"border-2 border-dashed rounded-lg h-28 flex items-center justify-center cursor-pointer text-gray-500",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",fill:"#bdbdbd",viewBox:"0 0 24 24",className:"mx-auto mb-2",children:(0,b.jsx)("path",{d:"M12 16a1 1 0 0 1-1-1v-4.586l-1.293 1.293a1 1 0 1 1-1.414-1.414l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.414L13 10.414V15a1 1 0 0 1-1 1Zm7-1a5 5 0 0 0-4.546-4.978A7 7 0 0 0 5.062 9.2 5 5 0 0 0 6 19h13a4 4 0 0 0 0-8Z"})}),(0,b.jsx)("div",{className:"text-sm font-medium",children:"Choose a file"})]}),(0,b.jsx)("input",{ref:m,type:"file",className:"hidden",onChange:z})]}),r&&(0,b.jsx)("div",{className:"mt-3 text-sm text-gray-500",children:"Loading documents…"}),w&&(0,b.jsxs)("div",{className:"mt-3 text-sm text-red-600",children:["Error: ",w]}),(0,b.jsx)("div",{className:"mt-6 space-y-4",children:0===n.length?(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"No documents uploaded yet."}):(0,b.jsx)("div",{className:"grid grid-cols-6 gap-4",children:n.map(a=>(0,b.jsxs)("div",{className:"col-span-1",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"bg-gray-50 w-full h-20 rounded overflow-hidden flex items-center justify-center border",children:a.fileUrl?a.mimeType?.startsWith?.("image/")?(0,b.jsx)(S.default,{src:a.fileUrl,alt:a.name??"document",fill:!0,sizes:"160px",style:{objectFit:"cover"},unoptimized:!0}):(0,b.jsx)("div",{className:"text-gray-400 text-xs",children:"File"}):(0,b.jsx)("div",{className:"text-gray-400 text-xs",children:"No Preview"})}),(0,b.jsxs)("div",{className:"absolute top-1 right-1",children:[(0,b.jsx)("button",{onClick:()=>q(p===a.id?null:a.id),className:"p-1 rounded hover:bg-white/60","aria-label":"Open actions",children:(0,b.jsx)(t.MoreHorizontal,{size:16})}),p===a.id&&(0,b.jsxs)("div",{className:"absolute right-0 mt-8 w-36 bg-white border rounded shadow-lg z-30",children:[(0,b.jsx)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50 text-sm",onClick:()=>{if(q(null),g&&g(a,"download"),a.fileUrl){let b=document.createElement("a");b.href=a.fileUrl,b.download=a.name??"file",b.target="_blank",document.body.appendChild(b),b.click(),b.remove()}},children:"Download"}),(0,b.jsx)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50 text-sm",onClick:()=>{q(null);if(g&&g(a,"view"),a.fileUrl){let b=document.createElement("a");b.href=a.fileUrl,b.target="_blank",document.body.appendChild(b),b.click(),b.remove()}},children:"View"}),(0,b.jsx)("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50 text-sm text-red-600",onClick:()=>{q(null),A(a.id)},children:"Delete"})]})]})]}),(0,b.jsxs)("div",{className:"mt-2 text-sm",children:[(0,b.jsxs)("div",{className:"text-sm font-medium flex items-center gap-2",children:[a.name||"Untitled",u[String(a.id)]&&(0,b.jsx)("span",{className:"text-xs text-gray-400",children:" · uploading…"})]}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():""})]})]},String(a.id)))})})]})})}var Z=a.i(244494),$=a.i(943108),_=a.i(824569);let aa="https://6jnqmj85-80.inc1.devtunnels.ms";function ab(a){if("number"==typeof a)return a;let b=String(a??"").trim();if(/^\d+$/.test(b))return parseInt(b,10);let c=b.replace(/\D+/g,"");return c.length>0?parseInt(c,10):null}function ac({clientId:a,authToken:d,extraHeaders:e,includeCredentials:f=!1,onView:g,onEdit:h,onDelete:i}){let[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(!1),[t,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)("PUBLIC"),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(null),[M,O]=(0,c.useState)(""),[P,R]=(0,c.useState)(""),[S,T]=(0,c.useState)("PUBLIC"),[U,V]=(0,c.useState)(!1),W=a=>{let b={Accept:"application/json","Content-Type":"application/json",...e||{},...a.headers||{}};return d&&(b.Authorization=`Bearer ${d}`),{method:a.method??"GET",headers:b,body:a.body??void 0,credentials:f?"include":"same-origin"}};(0,c.useEffect)(()=>{let b=!0;return async function(){m(!0),o(null);let c=ab(a);if(null===c){m(!1),o(`Invalid clientId: "${String(a)}". Cannot convert to numeric ID.`);return}try{let a=await fetch(`https://6jnqmj85-80.inc1.devtunnels.ms/clients/${c}/notes`,W({method:"GET"}));if(!a.ok){let b=await a.text();throw Error(`Failed to load notes: ${a.status} ${b}`)}let d=await a.json(),e=Array.isArray(d)?d.map(a=>({id:a.id,clientId:a.clientId,title:a.title??"Untitled",content:a.detail??null,type:a.type??"PRIVATE",createdBy:a.createdBy,createdAt:a.createdAt})):[];b&&k(e)}catch(a){console.error(a),b&&o(a?.message??"Unable to load notes")}finally{b&&m(!1)}}(),()=>{b=!1}},[a]);let X=async b=>{k(a=>a.filter(a=>a.id!==b.id)),i&&i(b);let c=ab(a);if(null===c)return void o("Invalid clientId while deleting note.");try{let a=await fetch(`https://6jnqmj85-80.inc1.devtunnels.ms/clients/${c}/notes/${b.id}`,W({method:"DELETE"}));if(!a.ok){let b=await a.text();throw Error(`Delete failed: ${a.status} ${b}`)}}catch(a){console.error(a),o("Failed to delete note")}},Y=()=>{s(!1),C(!1)},ac=async()=>{if(!t.trim())return void o("Please enter a note title.");o(null),C(!0);let b=ab(a);if(null===b){o("Invalid clientId while saving note."),C(!1);return}try{let a={title:t,detail:w,type:y},c=await fetch(`${aa}/clients/${b}/notes`,W({method:"POST",body:JSON.stringify(a)}));if(!c.ok){let a=await c.text();throw Error(`Failed to save note: ${c.status} ${a}`)}let d=await c.json(),e={id:d?.id??Date.now(),clientId:d?.clientId??b,title:d?.title??a.title,content:d?.detail??a.detail,type:d?.type??a.type,createdBy:d?.createdBy??void 0,createdAt:d?.createdAt??new Date().toISOString()};k(a=>[e,...a]),Y()}catch(a){console.error(a),o(a?.message??"Failed to save note"),C(!1)}},ad=()=>{E(!1),H(null)},ae=()=>{J(!1),V(!1),L(null)},af=async()=>{if(!M.trim())return void o("Please enter a note title.");o(null),V(!0);let b=ab(a);if(null===b||null===K){o("Invalid clientId or note id while updating."),V(!1);return}try{let a={title:M,detail:P,type:S},c=await fetch(`${aa}/clients/${b}/notes/${K}`,W({method:"PUT",body:JSON.stringify(a)}));if(!c.ok){let a=await c.text();throw Error(`Failed to update note: ${c.status} ${a}`)}let d=await c.json(),e={id:d?.id??K,clientId:d?.clientId??b,title:d?.title??a.title,content:d?.detail??a.detail,type:d?.type??a.type,createdBy:d?.createdBy??void 0,createdAt:d?.createdAt??void 0};k(a=>a.map(a=>a.id===e.id?e:a)),ae()}catch(a){console.error(a),o(a?.message??"Failed to update note"),V(!1)}};return(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("div",{className:"bg-white rounded shadow-sm border",children:[(0,b.jsx)("div",{className:"p-4 flex items-center justify-between border-b",children:(0,b.jsxs)("button",{type:"button",className:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white text-sm px-3 py-2 rounded",onClick:()=>{v(""),x(""),z("PUBLIC"),s(!0),h?.({id:0,title:"",type:"PRIVATE",content:""})},children:[(0,b.jsx)(u.Plus,{size:16})," Add Note"]})}),(0,b.jsxs)("div",{className:"p-4",children:[l&&(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Loading notes…"}),n&&(0,b.jsxs)("div",{className:"text-sm text-red-600 mb-2",children:["Error: ",n]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-blue-50 text-left rounded-t-md",children:[(0,b.jsx)("th",{className:"px-4 py-3 w-1/2 rounded-tl-md",children:"Note Title"}),(0,b.jsx)("th",{className:"px-4 py-3 w-1/4",children:"Note Type"}),(0,b.jsx)("th",{className:"px-4 py-3 w-1/6 text-right rounded-tr-md",children:"Action"})]})}),(0,b.jsx)("tbody",{children:0!==j.length||l?j.map(a=>(0,b.jsxs)("tr",{className:"border-t",children:[(0,b.jsx)("td",{className:"px-4 py-4",children:a.title}),(0,b.jsx)("td",{className:"px-4 py-4",children:(0,b.jsx)("div",{className:"flex items-center gap-2 text-gray-600",children:"PUBLIC"===a.type?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Z.Globe,{size:14})," ",(0,b.jsx)("span",{className:"text-xs",children:"Public"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)($.Lock,{size:14})," ",(0,b.jsx)("span",{className:"text-xs",children:"Private"})]})})}),(0,b.jsxs)("td",{className:"px-4 py-4 text-right relative",children:[(0,b.jsx)("button",{onClick:()=>q(p===a.id?null:a.id),className:"p-1 rounded hover:bg-gray-100",children:(0,b.jsx)(N.MoreVertical,{size:18})}),p===a.id&&(0,b.jsxs)("div",{className:"absolute right-2 mt-2 w-44 bg-white border rounded shadow-lg z-30",children:[(0,b.jsxs)("button",{className:"w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{q(null),H(a),E(!0),g?.(a)},children:[(0,b.jsx)(A.Eye,{size:14})," View"]}),(0,b.jsxs)("button",{className:"w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{q(null),L(a.id),O(a.title??""),R(a.content??""),T("PUBLIC"===a.type?"PUBLIC":"PRIVATE"),J(!0),h?.(a)},children:[(0,b.jsx)(_.Edit,{size:14})," Edit"]}),(0,b.jsxs)("button",{className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-gray-50",onClick:()=>{q(null),X(a)},children:[(0,b.jsx)(Q.Trash2,{size:14})," Delete"]})]})]})]},a.id)):(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:3,className:"px-4 py-6 text-center text-gray-500",children:"No notes found."})})})]})})]})]}),r&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:()=>!B&&Y()}),(0,b.jsxs)("div",{className:"relative z-10 w-[900px] max-w-[95%] bg-white rounded-lg shadow-xl border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h4",{className:"text-lg font-medium",children:"Add Project Note"}),(0,b.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>!B&&Y(),children:(0,b.jsx)(F.X,{size:18})})]}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsxs)("div",{className:"rounded-lg border p-6",children:[(0,b.jsx)("h5",{className:"text-sm font-medium mb-4",children:"Client Note Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-4",children:[(0,b.jsxs)("div",{className:"col-span-12 md:col-span-6",children:[(0,b.jsxs)("label",{className:"block text-xs text-gray-600 mb-2",children:["Note Title ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{value:t,onChange:a=>v(a.target.value),className:"w-full border rounded px-3 py-2 text-sm",placeholder:"--"})]}),(0,b.jsxs)("div",{className:"col-span-12 md:col-span-6 flex items-center gap-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{id:"note-public",type:"radio",name:"noteType",checked:"PUBLIC"===y,onChange:()=>z("PUBLIC")}),(0,b.jsx)("label",{htmlFor:"note-public",className:"text-sm text-gray-700",children:"Public"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{id:"note-private",type:"radio",name:"noteType",checked:"PRIVATE"===y,onChange:()=>z("PRIVATE")}),(0,b.jsx)("label",{htmlFor:"note-private",className:"text-sm text-gray-700",children:"Private"})]})]}),(0,b.jsxs)("div",{className:"col-span-12",children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 mb-2",children:"Note Detail"}),(0,b.jsx)("textarea",{value:w,onChange:a=>x(a.target.value),className:"w-full border rounded px-3 py-3 text-sm min-h-[120px]",placeholder:"--"})]})]})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-4 p-6 border-t",children:[(0,b.jsx)("button",{className:"px-6 py-2 text-sm border rounded hover:bg-gray-50",onClick:()=>!B&&Y(),children:"Cancel"}),(0,b.jsx)("button",{className:"px-6 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed",onClick:ac,disabled:B,children:B?"Saving…":"Save"})]})]})]}),D&&G&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:()=>ad()}),(0,b.jsxs)("div",{className:"relative z-10 w-[900px] max-w-[95%] bg-white rounded-lg shadow-xl border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h4",{className:"text-lg font-medium",children:G.title??"My Note"}),(0,b.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>ad(),children:(0,b.jsx)(F.X,{size:18})})]}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsxs)("div",{className:"rounded-lg border p-6",children:[(0,b.jsx)("h5",{className:"text-sm font-medium mb-4",children:"Project Note Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-6 text-sm text-gray-700",children:[(0,b.jsxs)("div",{className:"col-span-12 md:col-span-4",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Note Title"}),(0,b.jsx)("div",{className:"mt-2",children:G.title??"---"})]}),(0,b.jsxs)("div",{className:"col-span-12 md:col-span-4",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Note Type"}),(0,b.jsx)("div",{className:"mt-2",children:"PUBLIC"===G.type?"Public":"Private"})]}),(0,b.jsxs)("div",{className:"col-span-12 md:col-span-4",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Note Detail"}),(0,b.jsx)("div",{className:"mt-2 whitespace-pre-wrap",children:G.content??"---"})]})]})]})}),(0,b.jsx)("div",{className:"flex items-center justify-center gap-4 p-6 border-t",children:(0,b.jsx)("button",{className:"px-6 py-2 text-sm border rounded hover:bg-gray-50",onClick:()=>ad(),children:"Close"})})]})]}),I&&null!==K&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:()=>!U&&ae()}),(0,b.jsxs)("div",{className:"relative z-10 w-[900px] max-w-[95%] bg-white rounded-lg shadow-xl border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h4",{className:"text-lg font-medium",children:"Update Project Note"}),(0,b.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>!U&&ae(),children:(0,b.jsx)(F.X,{size:18})})]}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsxs)("div",{className:"rounded-lg border p-6",children:[(0,b.jsx)("h5",{className:"text-sm font-medium mb-4",children:"Project Note Details"}),(0,b.jsxs)("div",{className:"grid grid-row-12 gap-4",children:[(0,b.jsxs)("div",{className:"col-span-12 md:row-span-6",children:[(0,b.jsxs)("label",{className:"block text-xs text-gray-600 mb-2",children:["Note Title ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{value:M,onChange:a=>O(a.target.value),className:"w-full border rounded px-3 py-2 text-sm",placeholder:"--"})]}),(0,b.jsxs)("div",{className:"col-span-12 md:col-span-6 flex items-center gap-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{id:"edit-note-public",type:"radio",name:"editNoteType",checked:"PUBLIC"===S,onChange:()=>T("PUBLIC")}),(0,b.jsx)("label",{htmlFor:"edit-note-public",className:"text-sm text-gray-700",children:"Public"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{id:"edit-note-private",type:"radio",name:"editNoteType",checked:"PRIVATE"===S,onChange:()=>T("PRIVATE")}),(0,b.jsx)("label",{htmlFor:"edit-note-private",className:"text-sm text-gray-700",children:"Private"})]})]}),(0,b.jsxs)("div",{className:"col-span-12",children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 mb-2",children:"Note Detail"}),(0,b.jsx)("textarea",{value:P,onChange:a=>R(a.target.value),className:"w-full border rounded px-3 py-3 text-sm min-h-[120px]",placeholder:"--"})]})]})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-4 p-6 border-t",children:[(0,b.jsx)("button",{className:"px-6 py-2 text-sm border rounded hover:bg-gray-50",onClick:()=>!U&&ae(),children:"Cancel"}),(0,b.jsx)("button",{className:"px-6 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed",onClick:af,disabled:U,children:U?"Updating…":"Update"})]})]})]})]})}let ad="https://6jnqmj85-80.inc1.devtunnels.ms",ae=a=>{if(!a)return null;try{return JSON.parse(a)}catch{try{let b=a.trim();if(b.startsWith('"')&&b.endsWith('"')||b.startsWith("'")&&b.endsWith("'"))return JSON.parse(b.slice(1,-1))}catch{}return null}},af=["IN_PROGRESS","NOT_STARTED","ON_HOLD","CANCELLED","FINISHED"];function ag(){let{id:a}=(0,d.useParams)(),e=(0,d.useRouter)(),[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(!0),[k,m]=(0,c.useState)(null),[n,p]=(0,c.useState)(null),[r,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),[y,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(!1),[E,G]=(0,c.useState)(null),[H,I]=(0,c.useState)([]),[S,T]=(0,c.useState)(!1),[V,X]=(0,c.useState)(null),[Z,$]=(0,c.useState)([]),[_,aa]=(0,c.useState)(!1),[ab,ag]=(0,c.useState)([]),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)([]),[al,am]=(0,c.useState)(!1),[an,ao]=(0,c.useState)("profile"),ap=localStorage.getItem("accessToken"),aq=(0,c.useCallback)(async()=>{j(!0),m(null);try{let b=await fetch(`${ad}/clients/${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}});if(!b.ok)throw Error(`Failed to fetch client (${b.status})`);let c=await b.json();h(function(a){if(!a)return a;let b=a.company,c="";return c=b?"string"==typeof b?b:"object"==typeof b?b.companyName??b.name??b.company??JSON.stringify(b):String(b):"",{...a,company:c}}(c))}catch(a){m(a?.message??"An error occurred"),h(null)}finally{j(!1)}},[a]),ar=(0,c.useCallback)(async()=>{aa(!0);try{let a=await fetch(`${ad}/api/projects/category`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}});if(!a.ok){$([]),aa(!1);return}let b=await a.json();Array.isArray(b)?b.length>0&&"string"==typeof b[0]?$(b.map((a,b)=>({id:b+1,name:String(a)}))):$(b.map(a=>({id:a.id??a.name??Math.random(),name:a.name??String(a)}))):$([])}catch(a){console.error("loadCategories",a),$([])}finally{aa(!1)}},[]),as=(0,c.useCallback)(async()=>{ai(!0);try{let a=await fetch(`${ad}/clients`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}});if(!a.ok){ag([]),ai(!1);return}let b=await a.json();Array.isArray(b)?ag(b):Array.isArray(b.items)?ag(b.items):ag([])}catch(a){console.error("loadClients",a),ag([])}finally{ai(!1)}},[]),at=(0,c.useCallback)(async()=>{am(!0);try{let a=await fetch(`${ad}/admin/departments`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}});if(!a.ok){ak([]),am(!1);return}let b=await a.json();Array.isArray(b)?ak(b):Array.isArray(b.items)?ak(b.items):ak([])}catch(a){console.error("loadDepartments",a),ak([])}finally{am(!1)}},[]);async function au(a){let b={Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`};try{let c=await fetch(`${ad}/api/projects/client/${a}/stats`,{headers:b}),d=await c.text(),e=ae(d)??(c.ok?JSON.parse(d||"{}"):null),f=e&&"object"==typeof e&&(void 0!==e.projectCount||void 0!==e.totalEarning)?e:e&&"object"==typeof e&&e["Response Body"]?ae(e["Response Body"]):e;p(Number(f?.projectCount??0)),t(Number(f?.totalEarning??0))}catch{p(0),t(0)}try{let c=await fetch(`${ad}/api/invoices/client/${a}/stats/unpaid`,{headers:b}),d=await c.text(),e=ae(d)??(c.ok?JSON.parse(d||"{}"):null),f=e&&"object"==typeof e&&(void 0!==e.unpaidInvoiceCount||void 0!==e.totalUnpaidAmount)?e:e&&"object"==typeof e&&e["Response Body"]?ae(e["Response Body"]):e;v(Number(f?.unpaidInvoiceCount??0)),x(Number(f?.totalUnpaidAmount??0))}catch{v(0),x(0)}}async function av(a){D(!0),G(null);try{let b=await fetch(`${ad}/api/projects/client/${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),c=await b.text(),d=ae(c)??(b.ok?JSON.parse(c||"[]"):null),e=[];if(Array.isArray(d))e=d;else if(d&&Array.isArray(d.projects))e=d.projects;else if(d&&Array.isArray(d.data))e=d.data;else if(d&&d.ResponseBody){let a=ae(d.ResponseBody);Array.isArray(a)&&(e=a)}let f=e.map(a=>({id:a.id??a.projectId??a._id??String(Math.random()),shortCode:a.shortCode??a.code??a.projectCode??a.project_code??a.id,name:a.name??a.projectName??a.title??"Project Name",members:Array.isArray(a.assignedEmployees)&&a.assignedEmployees.length?a.assignedEmployees.map(a=>({id:a.employeeId??a.id,name:a.name??a.fullName,avatarUrl:a.profileUrl??a.profilePictureUrl})):Array.isArray(a.members)?a.members:[],startDate:a.startDate??a.start_date??a.start,deadline:a.deadline??a.endDate??a.end_date,client:a.client??(a.clientId?{clientId:a.clientId,name:g?.name,profilePictureUrl:g?.profilePictureUrl}:void 0),progressPercent:"number"==typeof a.progressPercent?a.progressPercent:"number"==typeof a.progress?a.progress:a.progress??0,projectStatus:a.projectStatus??a.status??"NOT_STARTED",pinned:!!(a.pinned??a.isPinned),archived:!!(a.archived??a.isArchived),noDeadline:!!a.noDeadline}));B(f)}catch(a){G(a?.message??"Failed to fetch projects"),B([])}finally{D(!1)}}async function aw(a){T(!0),X(null);try{let b=await fetch(`${ad}/api/invoices/client/${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),c=await b.text(),d=ae(c)??(b.ok?JSON.parse(c||"[]"):null),e=[];if(Array.isArray(d))e=d;else if(d&&Array.isArray(d.invoices))e=d.invoices;else if(d&&Array.isArray(d.data))e=d.data;else if(d&&d.ResponseBody){let a=ae(d.ResponseBody);Array.isArray(a)&&(e=a)}let f=e.map(a=>({id:a.id??a.invoiceId,invoiceNumber:a.invoiceNumber,invoiceDate:a.invoiceDate,currency:a.currency,project:a.project??{projectName:a.projectName,projectCode:a.projectCode},total:"number"==typeof a.total?a.total:Number(a.total??0),unpaidAmount:"number"==typeof a.unpaidAmount?a.unpaidAmount:Number(a.unpaidAmount??0),status:a.status,createdAt:a.createdAt}));I(f)}catch(a){X(a?.message??"Failed to fetch invoices"),I([])}finally{T(!1)}}let ax=()=>localStorage.getItem("accessToken")||"";async function ay(a,b){let c=y.slice();B(c=>c.map(c=>c.id===a?{...c,projectStatus:b}:c));try{let c=new FormData;c.append("status",b);let d=await fetch(`${ad}/api/projects/${a}/status`,{method:"PATCH",body:c,headers:{Authorization:`Bearer ${ax()}`}});if(!d.ok)throw Error("Status patch failed");try{let a=await d.json();a&&a.id?B(b=>b.map(b=>b.id===a.id?{...b,...a}:b)):g?.clientId&&await av(g.clientId)}catch{g?.clientId&&await av(g.clientId)}}catch(a){console.error("Status update failed",a),B(c),alert("Failed to update project status")}}async function az(a,b){let c=Math.max(0,Math.min(100,Math.round(b))),d=y.slice();B(b=>b.map(b=>b.id===a?{...b,progressPercent:c}:b));try{let b=new FormData;b.append("percent",String(c));let e=await fetch(`${ad}/api/projects/${a}/progress`,{method:"PATCH",body:b,headers:{Authorization:`Bearer ${ax()}`}});if(401===e.status){B(d),localStorage.removeItem("accessToken"),alert("Session expired. Please login again.");return}if(!e.ok){let a=await e.text().catch(()=>"");console.error("patchProgress failed:",e.status,a),B(d),alert("Failed to update progress on server");return}try{if(204!==e.status){let a=await e.json();a&&a.id?B(b=>b.map(b=>b.id===a.id?{...b,...a}:b)):g?.clientId&&await av(g.clientId)}}catch{g?.clientId&&await av(g.clientId)}}catch(a){console.error("Progress update failed:",a),B(d),alert("Failed to update progress on server")}}async function aA(a){let b=y.slice(),c=y.findIndex(b=>b.id===a);if(-1===c)return;let d=!y[c].pinned;B(b=>b.map(b=>b.id===a?{...b,pinned:d}:b));try{let b=await fetch(`${ad}/projects/${a}/pin`,{method:"POST",headers:{Authorization:`Bearer ${ax()}`,"Content-Type":"application/json"},body:JSON.stringify({pinned:d})});if(!b.ok)throw Error("Pin failed");try{let a=await b.json();a&&a.id?B(b=>b.map(b=>b.id===a.id?{...b,...a}:b)):g?.clientId&&await av(g.clientId)}catch{g?.clientId&&await av(g.clientId)}}catch(a){console.error("Pin toggle error",a),B(b),alert("Failed to toggle pin")}}async function aB(a){let b=y.slice(),c=y.findIndex(b=>b.id===a);if(-1===c)return;let d=!y[c].archived;B(b=>b.map(b=>b.id===a?{...b,archived:d}:b));try{let b=await fetch(`${ad}/projects/${a}/archive`,{method:"POST",headers:{Authorization:`Bearer ${ax()}`,"Content-Type":"application/json"},body:JSON.stringify({archived:d})});if(!b.ok)throw Error("Archive toggle failed");try{let a=await b.json();a&&a.id?B(b=>b.map(b=>b.id===a.id?{...b,...a}:b)):g?.clientId&&await av(g.clientId)}catch{g?.clientId&&await av(g.clientId)}}catch(a){console.error("Archive toggle error",a),B(b),alert("Failed to toggle archive state on server")}}let aC=async a=>{if(!confirm("Delete this project?"))return;let b=y.slice();B(b=>b.filter(b=>b.id!==a));try{if(!(await fetch(`${ad}/api/projects/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${ax()}`}})).ok)throw Error("Delete failed")}catch(a){console.error(a),B(b),alert("Failed to delete project")}},[aD,aE]=(0,c.useState)(!1),[aF,aG]=(0,c.useState)(""),[aH,aI]=(0,c.useState)(""),[aJ,aK]=(0,c.useState)(""),[aL,aM]=(0,c.useState)(""),[aN,aO]=(0,c.useState)(!1),[aP,aQ]=(0,c.useState)("none"),[aR,aS]=(0,c.useState)("none"),[aT,aU]=(0,c.useState)("none"),[aV,aW]=(0,c.useState)(""),[aX,aY]=(0,c.useState)(!0),[aZ,a$]=(0,c.useState)(""),[a_,a0]=(0,c.useState)(null),a1=(0,c.useRef)(null),[a2,a3]=(0,c.useState)("USD"),[a4,a5]=(0,c.useState)(""),[a6,a7]=(0,c.useState)(""),[a8,a9]=(0,c.useState)(!1),[ba,bb]=(0,c.useState)("you"),[bc,bd]=(0,c.useState)(!1),be=g?.clientId,bf=g?.id,bg=()=>{aG(""),aI(""),aK(""),aM(""),aO(!1),aQ("none"),aS("none"),aU(g?.clientId?String(g.clientId):"none"),aW(""),aY(!0),a$(""),a0(null),a3("USD"),a5(""),a7(""),a9(!1),bb("you"),bd(!1)},bh=async()=>{if(!aH.trim())return alert("Project Name is required");bd(!0);try{let a=aF.trim();if(!a){let b=aH.toString().normalize("NFKD").replace(/[\u0300-\u036F]/g,"").toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"");a=b?b.toUpperCase().replace(/-/g,"").slice(0,10):`PRJ${Date.now().toString().slice(-6)}`}let b=new FormData;b.append("shortCode",a),b.append("name",aH),b.append("projectName",aH),b.append("startDate",aJ||""),aN?b.append("deadline",""):b.append("deadline",aL||""),b.append("noDeadline",String(!!aN)),b.append("category","none"===aP?"":String(aP)),b.append("department","none"===aR?"":String(aR)),b.append("clientId","none"===aT?g?.clientId??"":String(aT)),b.append("summary",aV||""),b.append("tasksNeedAdminApproval",String(!!aX));let c=Array.isArray(aZ)?aZ:String(aZ||"").split(",").map(a=>a.trim()).filter(Boolean);b.append("assignedEmployeeIds",JSON.stringify(c)),a_&&b.append("companyFile",a_),b.append("currency",a2||""),b.append("budget",""!==a4?String(a4):"0"),b.append("hoursEstimate",""!==a6?String(a6):"0"),b.append("allowManualTimeLogs",String(!!a8)),b.append("addedBy",String(ba||""));let d=await fetch(`${ad}/api/projects`,{method:"POST",body:b,headers:{Authorization:`Bearer ${ax()}`}});if(!d.ok){let a=await d.text().catch(()=>"");console.error("Create project failed",d.status,a);let b=`Failed to create project (status ${d.status})`;try{let c=JSON.parse(a||"{}");c&&c.message&&(b=c.message)}catch{}alert(b),bd(!1);return}try{await d.json()}catch{}g?.clientId&&await av(g.clientId),aE(!1),bg()}catch(a){console.error("Create project error",a),alert("Failed to create project")}finally{bd(!1)}};if((0,c.useEffect)(()=>{a&&aq(),ar(),as(),at()},[a]),(0,c.useEffect)(()=>{g?.clientId&&au(g.clientId)},[g]),(0,c.useEffect)(()=>{g?.clientId&&av(g.clientId)},[g]),(0,c.useEffect)(()=>{"invoices"===an&&g?.clientId&&aw(g.clientId)},[an,g]),i)return(0,b.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading client details..."})]})});if(k||!g)return(0,b.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,b.jsxs)("div",{className:"w-full max-w-md p-6 border rounded",children:[(0,b.jsx)("h3",{className:"text-destructive text-xl mb-2",children:"Error"}),(0,b.jsx)("p",{className:"mb-4",children:k||"Client not found"}),(0,b.jsx)("div",{children:(0,b.jsx)("button",{className:"px-3 py-2 border rounded",onClick:()=>e.push("/clients"),children:"Back to Clients"})})]})});function bi({p:a}){let c=a.startDate?new Date(a.startDate).toLocaleDateString():"-",d=a.noDeadline?"No Deadline":a.deadline?new Date(a.deadline).toLocaleDateString():"-",h=Math.max(0,Math.min(100,Number(a.progressPercent??0)));return(0,b.jsxs)(L.TableRow,{className:"bg-white hover:bg-gray-50",children:[(0,b.jsx)(L.TableCell,{className:"py-4 px-4 align-top w-28",children:(0,b.jsx)("div",{className:"text-sm font-medium",children:a.shortCode??a.id})}),(0,b.jsx)(L.TableCell,{className:"py-4 px-4 align-top",children:(0,b.jsx)("div",{className:"font-medium",children:a.name})}),(0,b.jsx)(L.TableCell,{className:"py-4 px-4 align-top",children:(0,b.jsx)("div",{className:"text-sm",children:Array.isArray(a.members)&&a.members.length?a.members.map(a=>a.name??a).slice(0,3).join(", "):"-"})}),(0,b.jsx)(L.TableCell,{className:"py-4 px-4 align-top text-sm",children:c}),(0,b.jsx)(L.TableCell,{className:"py-4 px-4 align-top text-sm",children:d}),(0,b.jsx)(L.TableCell,{className:"py-4 px-4 align-top",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:a.client?.profilePictureUrl?(0,b.jsx)("img",{src:a.client.profilePictureUrl,alt:a.client?.name,className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"text-xs text-gray-500",children:(a.client?.name||"C").charAt(0)})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:a.client?.name??"Client"}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:a.client?.company??""})]})]})}),(0,b.jsx)(L.TableCell,{className:"py-4 px-4 align-top",children:(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsx)("div",{className:"w-44 cursor-pointer",title:"Click to filter by this progress bucket",children:(0,b.jsxs)("div",{className:"relative bg-gray-200 h-4 rounded-full overflow-hidden",children:[(0,b.jsx)("div",{className:`h-4 rounded-full ${null==h?"bg-gray-300":h<33?"bg-red-500":h<66?"bg-yellow-400":"bg-green-500"}`,style:{width:`${h}%`}}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,b.jsxs)("span",{className:"text-xs font-semibold text-white drop-shadow-sm",children:[h,"%"]})})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-2",children:[(0,b.jsxs)("button",{className:`inline-flex items-center gap-2 px-2 py-1 rounded-full text-xs ${(a=>{switch(a){case"IN_PROGRESS":return"bg-green-600 text-white";case"NOT_STARTED":default:return"bg-gray-400 text-white";case"ON_HOLD":return"bg-yellow-500 text-white";case"CANCELLED":return"bg-red-600 text-white";case"FINISHED":return"bg-blue-600 text-white"}})(a.projectStatus)}`,title:"Status",children:[(0,b.jsx)("span",{className:"w-2 h-2 rounded-full",style:{background:(a=>{switch(a){case"IN_PROGRESS":return"#10B981";case"NOT_STARTED":default:return"#9CA3AF";case"ON_HOLD":return"#F59E0B";case"CANCELLED":return"#EF4444";case"FINISHED":return"#3B82F6"}})(a.projectStatus)}}),(0,b.jsx)("span",{children:a.projectStatus??"N/A"})]}),(0,b.jsxs)(s.DropdownMenu,{children:[(0,b.jsx)(s.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)("button",{className:"inline-flex items-center gap-1 px-2 py-1 border rounded text-sm bg-white hover:bg-gray-50",children:(0,b.jsx)("span",{className:"text-xs text-gray-500",children:"▾"})})}),(0,b.jsxs)(s.DropdownMenuContent,{align:"start",className:"w-64 p-2",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Change status"}),(0,b.jsx)("div",{className:"space-y-1",children:af.map(c=>(0,b.jsx)("button",{onClick:()=>ay(a.id,c),className:`w-full text-left px-3 py-2 rounded text-sm hover:bg-gray-50 ${c===a.projectStatus?"font-medium":""}`,children:c},c))}),(0,b.jsx)(s.DropdownMenuSeparator,{}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-2 mb-1",children:"Adjust progress"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"range",min:0,max:100,value:a.progressPercent??0,onChange:b=>{let c=Number(b.target.value);B(b=>b.map(b=>b.id===a.id?{...b,progressPercent:c}:b))},onMouseUp:async b=>{let c=Number(b.target.value);await az(a.id,c)},onTouchEnd:async b=>{let c=Number(b.target.value);await az(a.id,c)},className:"w-full"}),(0,b.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[(0,b.jsx)("span",{children:"0%"}),(0,b.jsxs)("span",{children:[a.progressPercent??0,"%"]}),(0,b.jsx)("span",{children:"100%"})]})]}),(0,b.jsx)("div",{className:"flex justify-end mt-2",children:(0,b.jsx)(f.Button,{size:"sm",variant:"ghost",onClick:()=>g?.clientId&&av(g.clientId),children:"Refresh"})})]})]})]})]})}),(0,b.jsx)(L.TableCell,{className:"py-4 px-4 align-top text-right",children:(0,b.jsxs)(s.DropdownMenu,{children:[(0,b.jsx)(s.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:(0,b.jsx)(N.MoreVertical,{className:"h-4 w-4"})})}),(0,b.jsxs)(s.DropdownMenuContent,{align:"end",className:"w-56",children:[(0,b.jsxs)(s.DropdownMenuItem,{onClick:()=>e.push(`/work/project/${a.id}`),children:[(0,b.jsx)(A.Eye,{className:"h-4 w-4 mr-2"})," View"]}),(0,b.jsxs)(s.DropdownMenuItem,{onClick:()=>e.push(`/work/project/${a.id}/edit`),children:[(0,b.jsx)(z.Edit2,{className:"h-4 w-4 mr-2"})," Edit"]}),(0,b.jsxs)(s.DropdownMenuItem,{onClick:()=>aA(a.id),children:[(0,b.jsx)(O.Pin,{className:"h-4 w-4 mr-2"})," ",a.pinned?"Unpin":"Pin"," ","Project"]}),(0,b.jsxs)(s.DropdownMenuItem,{onClick:()=>aB(a.id),children:[(0,b.jsx)(P.Archive,{className:"h-4 w-4 mr-2"})," ",a.archived?"Unarchive":"Archive"]}),(0,b.jsx)(s.DropdownMenuSeparator,{}),(0,b.jsxs)(s.DropdownMenuItem,{onClick:()=>aC(a.id),className:"text-red-600",children:[(0,b.jsx)(Q.Trash2,{className:"h-4 w-4 mr-2"})," Delete"]})]})]})})]},a.id)}return(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,b.jsx)(l,{clientName:g.name,clientId:g.clientId,onBack:()=>e.push("/clients"),onOpenTab:a=>ao(a),activeTab:an}),"profile"===an&&(0,b.jsx)(o,{projectCount:n,totalEarning:r,unpaidInvoiceCount:u,totalUnpaidAmount:w}),"creditnotes"===an&&(0,b.jsx)(U,{clientId:g.clientId}),"profile"===an&&(0,b.jsx)(q,{client:g,projects:y}),"projects"===an&&(0,b.jsxs)("div",{className:"mt-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold",children:["Projects for ",g.name]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 border rounded px-2 py-1 bg-white",children:[(0,b.jsx)(R.Search,{className:"w-4 h-4 text-gray-400"}),(0,b.jsx)(K.Input,{placeholder:"Search projects",onChange:()=>{},className:"border-0 bg-transparent focus-visible:ring-0"})]}),(0,b.jsx)(f.Button,{className:"bg-blue-600 text-white",onClick:()=>{aE(!0),aU(g?.clientId?String(g.clientId):"none")},children:"+ Add Project"})]})]}),(0,b.jsx)("div",{className:"bg-white rounded-lg border overflow-hidden",children:(0,b.jsx)("div",{className:"overflow-auto p-4",children:C?(0,b.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Loading projects..."}):0===y.length?(0,b.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No projects found"}):(0,b.jsxs)(L.Table,{children:[(0,b.jsx)(L.TableHeader,{children:(0,b.jsxs)(L.TableRow,{className:"bg-blue-50",children:[(0,b.jsx)(L.TableHead,{className:"px-4 py-3",children:"Code"}),(0,b.jsx)(L.TableHead,{className:"px-4 py-3",children:"Project Name"}),(0,b.jsx)(L.TableHead,{className:"px-4 py-3",children:"Member"}),(0,b.jsx)(L.TableHead,{className:"px-4 py-3",children:"Start Date"}),(0,b.jsx)(L.TableHead,{className:"px-4 py-3",children:"Deadline"}),(0,b.jsx)(L.TableHead,{className:"px-4 py-3",children:"Client"}),(0,b.jsx)(L.TableHead,{className:"px-4 py-3",children:"Status"}),(0,b.jsx)(L.TableHead,{className:"px-4 py-3 text-right",children:"Action"})]})}),(0,b.jsx)(L.TableBody,{children:y.map(a=>(0,b.jsx)(bi,{p:a},a.id))})]})})})]}),"invoices"===an&&(0,b.jsx)(J,{clientId:`${be}`}),("payments"===an||"Payments"===an)&&(0,b.jsx)("div",{className:"mt-6",children:(0,b.jsx)(W,{clientId:g.clientId,onAdd:()=>{},onSearch:a=>{},onAction:a=>{}})}),"notes"===an&&(0,b.jsx)(ac,{clientId:bf,authToken:ap,onView:a=>{},onEdit:a=>{},onDelete:a=>{}}),"documents"===an&&(0,b.jsx)(Y,{clientId:g,authToken:ap}),aD&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[10000] flex items-start justify-center pt-12 px-4 overflow-y-auto",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>{aE(!1),bg()}}),(0,b.jsxs)("div",{className:"relative w-full max-w-4xl bg-white rounded-xl shadow-2xl overflow-y-auto z-10",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Add Project"}),(0,b.jsx)("button",{onClick:()=>{aE(!1),bg()},className:"p-2 rounded hover:bg-gray-100",children:(0,b.jsx)(F.X,{className:"w-5 h-5"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Project Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Short Code *"}),(0,b.jsx)(K.Input,{value:aF,onChange:a=>aG(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Project Name *"}),(0,b.jsx)(K.Input,{value:aH,onChange:a=>aI(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Start Date *"}),(0,b.jsx)(K.Input,{type:"date",value:aJ,onChange:a=>aK(a.target.value)})]}),(0,b.jsx)("div",{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Deadline *"}),(0,b.jsx)(K.Input,{type:"date",value:aL,onChange:a=>aM(a.target.value),disabled:aN})]}),(0,b.jsx)("div",{className:"pt-6",children:(0,b.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm text-gray-600",children:[(0,b.jsx)("input",{type:"checkbox",checked:aN,onChange:a=>aO(a.target.checked)}),(0,b.jsx)("span",{className:"text-xs",children:"There is no project deadline"})]})})]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Project Category *"}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)(M.Select,{value:aP,onValueChange:a=>aQ(a),children:[(0,b.jsx)(M.SelectTrigger,{className:"w-full",children:(0,b.jsx)(M.SelectValue,{placeholder:"--"})}),(0,b.jsxs)(M.SelectContent,{children:[(0,b.jsx)(M.SelectItem,{value:"none",children:"--"}),Z.map(a=>(0,b.jsx)(M.SelectItem,{value:String(a.id),children:a.name},a.id))]})]})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Department *"}),(0,b.jsxs)(M.Select,{value:aR,onValueChange:a=>aS(a),children:[(0,b.jsx)(M.SelectTrigger,{className:"w-full",children:(0,b.jsx)(M.SelectValue,{placeholder:"--"})}),(0,b.jsxs)(M.SelectContent,{children:[(0,b.jsx)(M.SelectItem,{value:"none",children:"--"}),aj.map(a=>(0,b.jsx)(M.SelectItem,{value:String(a.id),children:a.departmentName},a.id))]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Client *"}),(0,b.jsxs)(M.Select,{value:aT,onValueChange:a=>aU(a),children:[(0,b.jsx)(M.SelectTrigger,{className:"w-full",children:(0,b.jsx)(M.SelectValue,{placeholder:"--"})}),(0,b.jsxs)(M.SelectContent,{children:[(0,b.jsx)(M.SelectItem,{value:"none",children:"--"}),ab.map(a=>(0,b.jsx)(M.SelectItem,{value:String(a.clientId??a.id),children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Project Summary"}),(0,b.jsx)("textarea",{rows:4,value:aV,onChange:a=>aW(a.target.value),className:"w-full p-2 border rounded"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Tasks needs approval by Admin"}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)("input",{type:"radio",name:"approval",checked:!0===aX,onChange:()=>aY(!0)}),(0,b.jsx)("span",{className:"text-sm",children:"Yes"})]}),(0,b.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)("input",{type:"radio",name:"approval",checked:!1===aX,onChange:()=>aY(!1)}),(0,b.jsx)("span",{className:"text-sm",children:"No"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Add Project Members *"}),(0,b.jsx)(K.Input,{placeholder:"Comma separated names",value:Array.isArray(aZ)?aZ.join(","):aZ,onChange:a=>a$(a.target.value)})]})]})]}),(0,b.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Company Details"}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 mb-2 block",children:"Add File"}),(0,b.jsxs)("div",{onClick:()=>a1.current?.click(),className:"border-2 border-dashed rounded-lg h-28 flex items-center justify-center cursor-pointer text-gray-500",children:[a_?(0,b.jsx)("div",{children:a_.name}):(0,b.jsx)("div",{children:"Choose File"}),(0,b.jsx)("input",{ref:a1,type:"file",className:"hidden",onChange:a=>a0(a.target.files?.[0]??null)})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Currency"}),(0,b.jsxs)(M.Select,{value:a2,onValueChange:a=>a3(a),children:[(0,b.jsx)(M.SelectTrigger,{className:"w-full",children:(0,b.jsx)(M.SelectValue,{placeholder:"USD"})}),(0,b.jsxs)(M.SelectContent,{children:[(0,b.jsx)(M.SelectItem,{value:"USD",children:"USD $"}),(0,b.jsx)(M.SelectItem,{value:"USD",children:"USD ₹"}),(0,b.jsx)(M.SelectItem,{value:"EUR",children:"EUR €"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Project Budget"}),(0,b.jsx)(K.Input,{value:a4,onChange:a=>a5(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Hours Estimate (In Hours)"}),(0,b.jsx)(K.Input,{value:a6,onChange:a=>a7(a.target.value)})]})]}),(0,b.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:a8,onChange:a=>a9(a.target.checked)}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Allow manual time logs"})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 mr-2",children:"Added by*"}),(0,b.jsxs)(M.Select,{value:ba,onValueChange:a=>bb(a),children:[(0,b.jsx)(M.SelectTrigger,{className:"w-44",children:(0,b.jsx)(M.SelectValue,{placeholder:"You"})}),(0,b.jsx)(M.SelectContent,{children:(0,b.jsx)(M.SelectItem,{value:"you",children:"You"})})]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{aE(!1),bg()},children:"Cancel"}),(0,b.jsx)(f.Button,{className:"bg-blue-600 text-white",onClick:bh,disabled:bc,children:bc?"Saving...":"Save"})]})]})]})]})]})}}];

//# sourceMappingURL=src_app_%28dashboard%29_clients_%5Bid%5D_page_tsx_5c42093f._.js.map