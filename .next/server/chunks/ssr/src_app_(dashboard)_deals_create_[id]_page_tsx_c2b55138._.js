module.exports=[202863,a=>{"use strict";a.s(["default",()=>f]);var b=a.i(187924),c=a.i(572131),d=a.i(238246),e=a.i(50944);function f(){let a=(0,e.useRouter)(),f=(0,e.useParams)(),g=f?.id,[h,i]=(0,c.useState)({title:"",leadId:"",pipeline:"",dealStage:"",dealCategory:"",dealAgent:"",dealWatchers:[],value:"",expectedCloseDate:"",dealContact:""}),[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!0),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=async()=>{try{let a=localStorage.getItem("accessToken");if(!a)return void s("No access token found. Please log in.");let b=await fetch("/api/hr/employee",{headers:{Authorization:`Bearer ${a}`}});if(!b.ok)throw Error("Failed to fetch employees");let c=await b.json();k(c.content||[]);let d=await fetch("/api/deals/stages",{headers:{Authorization:`Bearer ${a}`}});if(!d.ok)throw Error("Failed to fetch deal stages");let e=await d.json();m(e);let f=await fetch(`/api/deals/get/${g}`,{headers:{Authorization:`Bearer ${a}`}});if(!f.ok)throw Error("Failed to fetch deal details");let h=await f.json();i({title:h.title||"",leadId:h.leadId?String(h.leadId):"",pipeline:h.pipeline||"",dealStage:h.dealStage||(e[0]?.name??""),dealCategory:h.dealCategory||"",dealAgent:h.dealAgent||"",dealWatchers:h.dealWatchers||[],value:h.value?String(h.value):"",expectedCloseDate:h.expectedCloseDate?h.expectedCloseDate.split("T")[0]:"",dealContact:h.dealContact||""})}catch(a){console.error(a),s("Failed to load deal data. Please try again later.")}finally{q(!1)}};g&&a()},[g]);let v=a=>{let{name:b,value:c}=a.target;i(a=>({...a,[b]:c}))},w=async b=>{if(b.preventDefault(),o(!0),s(null),u(null),!h.title||!h.pipeline||!h.dealStage||!h.dealCategory||!h.dealAgent||!h.value||!h.expectedCloseDate){s("Please fill all required fields."),o(!1);return}try{let b=localStorage.getItem("accessToken");if(!b)return void s("No access token found. Please log in.");let c={title:h.title,leadId:h.leadId?Number(h.leadId):void 0,pipeline:h.pipeline,dealStage:h.dealStage,dealCategory:h.dealCategory,dealAgent:h.dealAgent,dealWatchers:h.dealWatchers,value:parseFloat(h.value),expectedCloseDate:h.expectedCloseDate,dealContact:h.dealContact};if(!(await fetch(`/api/deals/create/${g}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify(c)})).ok)throw Error("Failed to update deal");u("Deal updated successfully!"),setTimeout(()=>a.push("/deals/get"),2e3)}catch(a){console.error(a),s("Failed to update deal. Please try again.")}finally{o(!1)}};return p?(0,b.jsx)("div",{className:"flex justify-center items-center min-h-screen text-lg font-semibold",children:"Loading deal details..."}):(0,b.jsxs)("div",{className:"p-6 max-w-4xl mx-auto",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Edit Deal"}),(0,b.jsxs)("form",{onSubmit:w,className:"bg-white p-6 border rounded-2xl shadow-sm",children:[r&&(0,b.jsx)("div",{className:"mb-4 text-red-600 text-sm font-semibold",children:r}),t&&(0,b.jsx)("div",{className:"mb-4 text-green-600 text-sm font-semibold",children:t}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,b.jsx)("input",{type:"text",name:"title",value:h.title,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lead ID"}),(0,b.jsx)("input",{type:"number",name:"leadId",value:h.leadId,onChange:v,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pipeline *"}),(0,b.jsx)("input",{type:"text",name:"pipeline",value:h.pipeline,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deal Stage *"}),(0,b.jsx)("select",{name:"dealStage",value:h.dealStage,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600",children:l.map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),(0,b.jsx)("input",{type:"text",name:"dealCategory",value:h.dealCategory,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deal Agent *"}),(0,b.jsxs)("select",{name:"dealAgent",value:h.dealAgent,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600",children:[(0,b.jsx)("option",{value:"",children:"Select Deal Agent"}),j.map(a=>(0,b.jsxs)("option",{value:a.employeeId,children:[a.name," (",a.employeeId,")"]},a.employeeId))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value ($) *"}),(0,b.jsx)("input",{type:"number",name:"value",value:h.value,onChange:v,required:!0,min:"0",step:"0.01",className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Close Date *"}),(0,b.jsx)("input",{type:"date",name:"expectedCloseDate",value:h.expectedCloseDate,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deal Contact"}),(0,b.jsx)("input",{type:"text",name:"dealContact",value:h.dealContact,onChange:v,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deal Watchers"}),(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:j.map(a=>(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:h.dealWatchers.includes(a.employeeId),onChange:b=>{var c,d;return c=a.employeeId,d=b.target.checked,void i(a=>{let b=a.dealWatchers||[],e=d?[...b,c]:b.filter(a=>a!==c);return{...a,dealWatchers:e}})}}),a.name," (",a.employeeId,")"]},a.employeeId))})]}),(0,b.jsxs)("div",{className:"mt-6 flex gap-4",children:[(0,b.jsx)("button",{type:"submit",disabled:n,className:`px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition ${n?"opacity-50 cursor-not-allowed":""}`,children:n?"Updating...":"Update Deal"}),(0,b.jsx)(d.default,{href:"/deals/get",className:"px-4 py-2 text-blue-600 hover:underline",children:"Cancel"})]})]})]})}}];

//# sourceMappingURL=src_app_%28dashboard%29_deals_create_%5Bid%5D_page_tsx_c2b55138._.js.map