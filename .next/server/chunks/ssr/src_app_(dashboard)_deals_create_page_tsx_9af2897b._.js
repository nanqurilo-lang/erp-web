module.exports=[93612,a=>{"use strict";a.s(["default",()=>e]);var b=a.i(187924),c=a.i(572131),d=a.i(50944);function e(){let a=(0,d.useRouter)(),[e,f]=(0,c.useState)({title:"",leadId:"",pipeline:"",dealStage:"",dealCategory:"",dealAgent:"",dealWatchers:[],value:"",expectedCloseDate:"",dealContact:""}),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(["General","Corporate","Retail"]),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)("");(0,c.useEffect)(()=>{(async()=>{try{let a=localStorage.getItem("accessToken");if(!a)return void r("No access token found. Please log in.");let b=await fetch("/api/hr/employee",{headers:{Authorization:`Bearer ${a}`}});if(!b.ok)throw Error("Failed to fetch employees");let c=await b.json();h(c.content||[]);let d=await fetch("/api/deals/stages",{headers:{Authorization:`Bearer ${a}`}});if(!d.ok)throw Error("Failed to fetch deal stages");let e=await d.json();j(e),e.length>0&&f(a=>({...a,dealStage:e[0].name}));let g=await fetch("https://6jnqmj85-80.inc1.devtunnels.ms/leads",{headers:{Authorization:`Bearer ${a}`}});if(g.ok){let a=await g.json();l(Array.isArray(a)?a:[])}else console.warn("Failed to fetch leads for dropdown"),l([])}catch(a){console.error(a),r("Failed to load data. Please try again later.")}finally{p(!1)}})()},[]);let A=a=>{let{name:b,value:c}=a.target;f(a=>({...a,[b]:c}))},B=async b=>{if(b.preventDefault(),n(!0),r(null),t(null),!e.title||!e.pipeline||!e.dealStage||!e.dealCategory||!e.dealAgent||!e.value||!e.expectedCloseDate){r("Please fill all required fields."),n(!1);return}try{let b=localStorage.getItem("accessToken");if(!b){r("No access token found. Please log in."),n(!1);return}let c={title:e.title,leadId:e.leadId?Number(e.leadId):void 0,pipeline:e.pipeline,dealStage:e.dealStage,dealCategory:e.dealCategory,dealAgent:e.dealAgent,dealWatchers:e.dealWatchers,value:parseFloat(e.value),expectedCloseDate:e.expectedCloseDate,dealContact:e.dealContact};if(!(await fetch("/api/deals/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify(c)})).ok)throw Error("Failed to create deal");t("Deal created successfully!"),setTimeout(()=>a.push("/deals/get"),1e3)}catch(a){console.error(a),r("Failed to create deal. Please try again.")}finally{n(!1)}};if(o)return(0,b.jsx)("div",{className:"flex justify-center items-center min-h-screen text-lg font-semibold",children:"Loading form..."});let C=()=>{x(!1),z("")};return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50 flex items-start justify-center py-10 px-4",children:[(0,b.jsxs)("div",{className:"w-full max-w-4xl",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"Add Deal Information"}),(0,b.jsx)("button",{onClick:()=>a.back(),"aria-label":"Close",className:"text-gray-400 hover:text-gray-600",children:(0,b.jsx)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,b.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsxs)("form",{onSubmit:B,className:"bg-white border rounded-2xl shadow-sm",children:[(0,b.jsxs)("div",{className:"rounded-lg border mx-6 my-6 p-6",children:[(0,b.jsx)("h3",{className:"text-base font-medium mb-4",children:"Deal Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Lead Contact *"}),(0,b.jsxs)("select",{name:"leadId",value:e.leadId,onChange:A,className:"w-full p-2 border rounded-md bg-white",children:[(0,b.jsx)("option",{value:"",children:"--"}),k.map(a=>(0,b.jsxs)("option",{value:String(a.id),children:[a.name||`#${a.id}`,a.companyName?` â€” ${a.companyName}`:""]},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Name *"}),(0,b.jsx)("input",{type:"text",name:"title",value:e.title,onChange:A,className:"w-full p-2 border rounded-md",placeholder:"--"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Pipeline *"}),(0,b.jsxs)("select",{name:"pipeline",value:e.pipeline,onChange:A,className:"w-full p-2 border rounded-md bg-white",children:[(0,b.jsx)("option",{value:"",children:"--"}),(0,b.jsx)("option",{value:"Default Pipeline",children:"Default Pipeline"}),(0,b.jsx)("option",{value:"Sales",children:"Sales"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Stages *"}),(0,b.jsx)("select",{name:"dealStage",value:e.dealStage,onChange:A,className:"w-full p-2 border rounded-md bg-white",children:i.map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id))})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Category"}),(0,b.jsxs)("select",{name:"dealCategory",value:e.dealCategory,onChange:A,className:"w-full p-2 border rounded-md bg-white",children:[(0,b.jsx)("option",{value:"",children:"--"}),u.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]}),(0,b.jsx)("button",{type:"button",className:"px-3 py-2 bg-gray-200 rounded-md text-sm",onClick:()=>{z(""),x(!0)},children:"Add"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Agent"}),(0,b.jsxs)("select",{name:"dealAgent",value:e.dealAgent,onChange:A,className:"w-full p-2 border rounded-md bg-white",children:[(0,b.jsx)("option",{value:"",children:"--"}),g.map(a=>(0,b.jsx)("option",{value:a.employeeId,children:a.name},a.employeeId))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Value"}),(0,b.jsxs)("div",{className:"flex",children:[(0,b.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border bg-gray-100 text-sm",children:"USD $"}),(0,b.jsx)("input",{type:"number",name:"value",value:e.value,onChange:A,className:"w-full p-2 border rounded-r-md",placeholder:"",min:"0",step:"0.01"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Close Date *"}),(0,b.jsx)("input",{type:"date",name:"expectedCloseDate",value:e.expectedCloseDate,onChange:A,className:"w-full p-2 border rounded-md"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Watcher"}),(0,b.jsxs)("select",{name:"dealWatchers",value:e.dealWatchers[0]??"",onChange:a=>f(b=>({...b,dealWatchers:a.target.value?[a.target.value]:[]})),className:"w-full p-2 border rounded-md bg-white",children:[(0,b.jsx)("option",{value:"",children:"--"}),g.map(a=>(0,b.jsx)("option",{value:a.employeeId,children:a.name},a.employeeId))]})]})]})]}),(0,b.jsxs)("div",{className:"mx-6 mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deal Watchers"}),(0,b.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:g.map(a=>(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:e.dealWatchers.includes(a.employeeId),onChange:b=>{var c,d;return c=a.employeeId,d=b.target.checked,void f(a=>{let b=a.dealWatchers||[],e=d?[...b,c]:b.filter(a=>a!==c);return{...a,dealWatchers:e}})}}),(0,b.jsx)("span",{className:"text-xs",children:a.name})]},a.employeeId))})]}),(0,b.jsxs)("div",{className:"px-6 pb-8 flex items-center justify-center gap-4",children:[(0,b.jsx)("button",{type:"button",onClick:()=>a.back(),className:"px-6 py-2 border rounded-full text-blue-600 hover:bg-blue-50",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",disabled:m,className:`px-6 py-2 rounded-full text-white ${m?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:m?"Creating...":"Update"})]})]}),(0,b.jsxs)("div",{className:"mt-4 text-center",children:[q&&(0,b.jsx)("div",{className:"text-sm text-red-600 font-medium",children:q}),s&&(0,b.jsx)("div",{className:"text-sm text-green-600 font-medium",children:s})]})]}),w&&(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-20 bg-black/30",children:(0,b.jsxs)("div",{className:"w-full max-w-2xl bg-white rounded-lg shadow-lg border border-slate-200",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[(0,b.jsx)("h4",{className:"font-medium",children:"Deal Category"}),(0,b.jsx)("button",{onClick:C,className:"text-slate-500",children:(0,b.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,b.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("table",{className:"w-full table-auto border-collapse",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-blue-50 text-left",children:[(0,b.jsx)("th",{className:"p-3 text-sm",children:"#"}),(0,b.jsx)("th",{className:"p-3 text-sm",children:"Category Name"}),(0,b.jsx)("th",{className:"p-3 text-sm",children:"Action"})]})}),(0,b.jsxs)("tbody",{children:[0===u.length&&(0,b.jsx)("tr",{className:"border-t",children:(0,b.jsx)("td",{className:"p-3 text-sm",colSpan:3,children:"No categories"})}),u.map((a,c)=>(0,b.jsxs)("tr",{className:"border-t",children:[(0,b.jsx)("td",{className:"p-3 text-sm",children:c+1}),(0,b.jsx)("td",{className:"p-3 text-sm cursor-pointer",onClick:()=>{f(b=>({...b,dealCategory:a})),x(!1)},children:a}),(0,b.jsx)("td",{className:"p-3 text-sm text-center",children:(0,b.jsx)("button",{onClick:()=>{confirm(`Delete category "${a}"?`)&&(v(b=>b.filter(b=>b!==a)),f(b=>b.dealCategory===a?{...b,dealCategory:""}:b))},className:"text-red-600",children:"ðŸ—‘"})})]},a))]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("label",{className:"text-sm block mb-1",children:"Deal Category Name *"}),(0,b.jsx)("input",{className:"w-full px-3 py-2 rounded-md border border-slate-200",value:y,onChange:a=>z(a.target.value),placeholder:"--"})]}),(0,b.jsxs)("div",{className:"mt-4 flex justify-end gap-3",children:[(0,b.jsx)("button",{onClick:C,className:"px-4 py-2 border rounded-md",children:"Cancel"}),(0,b.jsx)("button",{onClick:()=>{let a=y.trim();a&&(u.includes(a)?f(b=>({...b,dealCategory:a})):(v(b=>[...b,a]),f(b=>({...b,dealCategory:a}))),C())},className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"Save"})]})]})]})})]})}}];

//# sourceMappingURL=src_app_%28dashboard%29_deals_create_page_tsx_9af2897b._.js.map