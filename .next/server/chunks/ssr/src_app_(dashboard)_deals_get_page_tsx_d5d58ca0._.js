module.exports=[932704,a=>{"use strict";a.s(["default",()=>r]);var b=a.i(187924),c=a.i(572131),d=a.i(972596),e=a.i(238246),f=a.i(866718),g=a.i(580701),h=a.i(699570),i=a.i(206015),j=a.i(335732),k=a.i(875083),l=a.i(957064),m=a.i(197396),n=a.i(879360),o=a.i(172162),p=a.i(587532);let q="https://6jnqmj85-80.inc1.devtunnels.ms";function r(){let[a,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)("all"),[w,x]=(0,c.useState)("all"),[y,z]=(0,c.useState)("");(0,c.useEffect)(()=>{r(null)},[]);let A=async b=>{if(!a)throw Error("No access token found. Please log in.");let c=await fetch(b,{headers:{Authorization:`Bearer ${a}`}});if(!c.ok){let a=await c.text().catch(()=>"");throw Error(`Failed to fetch ${b}: ${c.status} ${a}`)}return c.json()},{data:B=[],error:C,isLoading:D,mutate:E}=(0,d.default)(a?"/api/deals/get":null,A),{data:F=[]}=(0,d.default)(a?`${q}/deals/admin/priorities`:null,A),G=(0,c.useMemo)(()=>{let a=new Map;for(let b of F||[])b.status&&a.set(String(b.status).toLowerCase(),b);return a},[F]),H=(0,c.useMemo)(()=>{let a=new Map;for(let b of F||[])a.set(b.id,b);return a},[F]),I=(0,c.useMemo)(()=>{let a=new Set;for(let b of B)b.dealStage&&a.add(b.dealStage);return Array.from(a.values()).sort()},[B]),J=(0,c.useMemo)(()=>{let a=new Set;for(let b of B)b.pipeline&&a.add(b.pipeline);return Array.from(a.values()).sort()},[B]),K=(0,c.useMemo)(()=>{let a=s.trim().toLowerCase();return B.filter(b=>{let c="all"===u||String(b.dealStage||"").toLowerCase()===u.toLowerCase(),d=[b.title,b.dealAgentMeta?.name,b.dealAgent,b.dealCategory,b.pipeline,String(b.id),b.leadName,b.leadEmail,b.leadMobile].filter(Boolean).join(" ").toLowerCase(),e=0===a.length||d.includes(a);return c&&e})},[B,s,u]);if(D)return(0,b.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center text-lg font-semibold",children:"Loading deals..."});if(C)return(0,b.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center text-lg font-semibold text-destructive",children:C.message||"Failed to load deals. Please try again later."});let L=async(b,c)=>{if(a)try{let d=Number(c),e=Number.isNaN(d)?null:d;if(null===e){let a=G.get(String(c).toLowerCase());a&&(e=a.id)}if(null===e)return void console.error("Could not resolve priorityId for:",c);let f=`${q}/deals/${b}/priority/assign`,g=await fetch(f,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({priorityId:e})});if(!g.ok){let a=await g.text().catch(()=>"");console.error("Failed to assign priority:",g.status,a);return}await E()}catch(a){console.error("Error assigning priority:",a)}},M=async(b,c)=>{if(a)try{let d=`${q}/deals/${b}/stage?stage=${encodeURIComponent(c)}`,e=await fetch(d,{method:"PUT",headers:{Authorization:`Bearer ${a}`}});if(!e.ok){let a=await e.text().catch(()=>"");console.error("Failed to update stage:",e.status,a);return}await E()}catch(a){console.error("Error updating stage:",a)}};return(0,b.jsx)("main",{className:"container mx-auto max-w-6xl px-4 py-8",children:(0,b.jsxs)("div",{className:"p-0 ",children:[(0,b.jsxs)("div",{className:"mb-4 rounded-md border bg-white py-2 px-4 flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Duration"}),(0,b.jsx)(f.Input,{value:y,onChange:a=>z(a.target.value),placeholder:"Start Date to End Date",className:"w-[300px] text-sm"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Pipeline"}),(0,b.jsxs)(g.Select,{value:w,onValueChange:x,children:[(0,b.jsx)(g.SelectTrigger,{className:"w-36 text-sm py-1",children:(0,b.jsx)(g.SelectValue,{placeholder:"All pipelines"})}),(0,b.jsxs)(g.SelectContent,{children:[(0,b.jsx)(g.SelectItem,{value:"all",children:"All"}),J.length?J.map(a=>(0,b.jsx)(g.SelectItem,{value:a,children:a},a)):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.SelectItem,{value:"Sales",children:"Sales"}),(0,b.jsx)(g.SelectItem,{value:"Marketing",children:"Marketing"}),(0,b.jsx)(g.SelectItem,{value:"Partnerships",children:"Partnerships"})]})]})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",className:"px-2",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(o.SlidersHorizontal,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm",children:"Filters"})]})})})]}),(0,b.jsxs)("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsx)(h.Button,{asChild:!0,children:(0,b.jsx)(e.default,{href:"/deals/create",children:"+ Add Deal"})})}),(0,b.jsx)("div",{className:"flex w-full items-center gap-3 md:max-w-2xl md:justify-end",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(f.Input,{value:s,onChange:a=>t(a.target.value),placeholder:"Search deals","aria-label":"Search deals",className:"pr-10"}),(0,b.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:(0,b.jsx)(p.Search,{className:"h-4 w-4 text-muted-foreground"})})]}),(0,b.jsx)(k.Tabs,{className:"w-auto",defaultValue:"table",children:(0,b.jsxs)(k.TabsList,{children:[(0,b.jsx)(k.TabsTrigger,{value:"table",asChild:!0,children:(0,b.jsx)(e.default,{href:"/deals/get",className:"flex items-center gap-2 px-2",children:(0,b.jsx)(m.TableIcon,{className:"h-4 w-4"})})}),(0,b.jsx)(k.TabsTrigger,{value:"kanban",asChild:!0,children:(0,b.jsx)(e.default,{href:"/deals/stages",className:"flex items-center gap-2 px-2",children:(0,b.jsx)(l.LayoutGrid,{className:"h-4 w-4"})})})]})})]})})]}),(0,b.jsx)("div",{className:"overflow-x-auto rounded-xl border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"min-w-[200px]",children:"Deal Name"}),(0,b.jsx)(i.TableHead,{children:"Lead Name"}),(0,b.jsx)(i.TableHead,{children:"Contact Details"}),(0,b.jsx)(i.TableHead,{children:"Value"}),(0,b.jsx)(i.TableHead,{children:"Close Date"}),(0,b.jsx)(i.TableHead,{children:"Next Follow Up"}),(0,b.jsx)(i.TableHead,{children:"Deal Agent"}),(0,b.jsx)(i.TableHead,{children:"Deal Watcher"}),(0,b.jsx)(i.TableHead,{children:"Stage"}),(0,b.jsx)(i.TableHead,{children:"Priority Status"}),(0,b.jsx)(i.TableHead,{children:"Tags"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Action"})]})}),(0,b.jsxs)(i.TableBody,{children:[K.map(a=>{let c,d=(a=>{if(!a||0===a.length)return null;let b=a.filter(a=>a&&a.nextDate).slice();return 0===b.length?null:(b.sort((a,b)=>new Date(a.nextDate).getTime()-new Date(b.nextDate).getTime()),b[0].nextDate||null)})(a.followups),f=d?new Date(d).toLocaleDateString():"—",k=a.dealWatchersMeta&&a.dealWatchersMeta.length>0?a.dealWatchersMeta.map(a=>a.name).filter(Boolean).join(", "):(a.dealWatchers||[]).join(", ")||"—";if(null===a.priority||void 0===a.priority){let a=F?.find(a=>"low"===String(a.status).toLowerCase())||F?.[0];c=a?String(a.id):"Low"}else if("object"==typeof a.priority&&"id"in a.priority)c=String(a.priority.id);else if("number"==typeof a.priority)c=String(a.priority);else{let b=G.get(String(a.priority).toLowerCase());c=b?String(b.id):String(a.priority)}let l=(a=>{if(a&&"object"==typeof a&&"color"in a&&a.color)return a.color;if("number"==typeof a){let b=H.get(a);if(b?.color)return b.color}let b=(a=>{if(null==a)return"low";if("string"==typeof a)return a.toLowerCase();if("number"==typeof a){let b=H.get(a);return b?.status?String(b.status).toLowerCase():"low"}try{if(a&&a.status)return String(a.status).toLowerCase();return String(a).toLowerCase()}catch{return"low"}})(a),c=G.get(b);if(c?.color)return c.color;switch(b){case"high":return"#ef4444";case"medium":return"#f59e0b";default:return"#10b981"}})(a.priority);return(0,b.jsxs)(i.TableRow,{className:"align-top",children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-slate-100 flex-shrink-0",children:(0,b.jsx)("img",{src:a.dealAgentMeta?.profileUrl||"/mnt/data/Screenshot 2025-11-21 122016.png",alt:a.dealAgentMeta?.name||a.dealAgent||"agent",className:"w-full h-full object-cover"})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)(e.default,{href:`/deals/get/${a.id}`,className:"line-clamp-1 font-medium hover:underline",children:a.title||"—"}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["ID: ",a.id]})]})]})}),(0,b.jsx)(i.TableCell,{children:a.leadName||"—"}),(0,b.jsxs)(i.TableCell,{className:"text-sm text-muted-foreground",children:[(0,b.jsx)("div",{children:a.leadEmail||"—"}),(0,b.jsx)("div",{children:a.leadMobile||"—"})]}),(0,b.jsx)(i.TableCell,{className:"whitespace-nowrap",children:"number"==typeof a.value?`$${a.value.toLocaleString()}`:"—"}),(0,b.jsx)(i.TableCell,{children:a.expectedCloseDate?new Date(a.expectedCloseDate).toLocaleDateString():"—"}),(0,b.jsx)(i.TableCell,{children:f}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-slate-100 flex-shrink-0",children:(0,b.jsx)("img",{src:a.dealAgentMeta?.profileUrl||"/mnt/data/Screenshot 2025-11-21 122307.png",alt:a.dealAgentMeta?.name||a.dealAgent||"agent",className:"w-full h-full object-cover"})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-sm",children:a.dealAgentMeta?.name||a.dealAgent||"—"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Team Lead"})]})]})}),(0,b.jsx)(i.TableCell,{className:"text-sm",children:k}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(g.Select,{value:a.dealStage||"Qualified",onValueChange:b=>{M(a.id,b)},children:[(0,b.jsx)(g.SelectTrigger,{className:"w-36","aria-label":"Deal stage",children:(0,b.jsx)(g.SelectValue,{placeholder:a.dealStage||"Stage"})}),(0,b.jsx)(g.SelectContent,{children:I.length?I.map(a=>(0,b.jsx)(g.SelectItem,{value:a,children:a},a)):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.SelectItem,{value:"Qualified",children:"Qualified"}),(0,b.jsx)(g.SelectItem,{value:"Win",children:"Win"}),(0,b.jsx)(g.SelectItem,{value:"Lost",children:"Lost"})]})})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:"inline-block w-3 h-3 rounded-full",style:{backgroundColor:l}}),(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)(g.Select,{value:c,onValueChange:b=>{let c=Number(b),d=Number.isNaN(c)?(()=>{let a=G.get(String(b).toLowerCase());return a?a.id:null})():c;null!==d&&L(a.id,d)},children:[(0,b.jsx)(g.SelectTrigger,{className:"w-32 text-sm py-1","aria-label":"Priority status",children:(0,b.jsx)(g.SelectValue,{placeholder:"Priority"})}),(0,b.jsx)(g.SelectContent,{children:(F&&F.length>0?F:[{id:3,status:"Low",color:"#10b981"},{id:4,status:"Medium",color:"#f59e0b"},{id:1,status:"High",color:"#ef4444"}]).map(a=>(0,b.jsx)(g.SelectItem,{value:String(a.id),children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:a.color}}),(0,b.jsx)("span",{children:a.status})]})},a.id))})]})})]})}),(0,b.jsx)(i.TableCell,{className:"text-sm text-muted-foreground",children:a.tags&&a.tags.length>0&&a.tags.join(", ")||"—"}),(0,b.jsx)(i.TableCell,{className:"text-right",children:(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(j.DropdownMenu,{children:[(0,b.jsx)(j.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",className:"p-2",children:(0,b.jsx)(n.MoreVertical,{className:"h-4 w-4"})})}),(0,b.jsxs)(j.DropdownMenuContent,{align:"end",children:[(0,b.jsx)(j.DropdownMenuItem,{asChild:!0,children:(0,b.jsx)(e.default,{href:`/deals/get/${a.id}`,children:"View"})}),(0,b.jsx)(j.DropdownMenuItem,{asChild:!0,children:(0,b.jsx)(e.default,{href:`/deals/create/${a.id}`,children:"Edit"})}),(0,b.jsx)(j.DropdownMenuItem,{onClick:()=>{},children:"Delete"})]})]})})})]},String(a.id))}),0===K.length&&(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:12,className:"py-10 text-center text-sm text-muted-foreground",children:"No deals found. Adjust your filters or search terms."})})]})]})}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(e.default,{href:"/",className:"underline",children:"Back to Home"})})]})})}}];

//# sourceMappingURL=src_app_%28dashboard%29_deals_get_page_tsx_d5d58ca0._.js.map