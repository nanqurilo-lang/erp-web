module.exports=[642975,a=>{"use strict";a.s(["default",()=>v],642975);var b=a.i(187924),c=a.i(572131),d=a.i(238246),e=a.i(972596);function f({onCreated:a,getToken:d}){let[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(""),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null);async function m(b){b&&b.preventDefault(),l(null);let c=d();if(!c)return void l("No access token found. Please log in.");try{j(!0);let b=await fetch("/api/deals/stages",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({name:g})});if(!b.ok){let a=await b.text().catch(()=>"");throw Error(a||"Failed to create stage")}h(""),f(!1),await a?.()}catch(a){l(a?.message??"Failed to create stage")}finally{j(!1)}}return(0,b.jsxs)("div",{className:"relative",children:[e?null:(0,b.jsx)("button",{onClick:()=>f(!0),className:"rounded-md bg-blue-600 px-3 py-2 text-white hover:opacity-95",children:"+ Add Stage"}),e&&(0,b.jsxs)("div",{"aria-modal":"true",role:"dialog",className:"fixed inset-0 z-50 flex items-start justify-center",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{i||(f(!1),l(null),h(""))}}),(0,b.jsxs)("div",{className:"relative mt-8 w-[820px] max-w-[95%] rounded-lg bg-white shadow-xl ring-1 ring-black/5",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"Add New Deal Stage"}),(0,b.jsx)("button",{"aria-label":"Close",onClick:()=>{i||(f(!1),l(null),h(""))},className:"text-slate-400 hover:text-slate-600 rounded-md p-1",children:(0,b.jsx)("span",{style:{fontSize:20,lineHeight:1},children:"×"})})]}),(0,b.jsxs)("form",{onSubmit:m,className:"px-6 py-6",children:[(0,b.jsxs)("div",{className:"rounded-md border border-gray-200 p-4 bg-gray-50",children:[(0,b.jsxs)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:["Deal Stage ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)("input",{value:g,onChange:a=>h(a.target.value),placeholder:"--",className:"w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-slate-800 outline-none focus:ring-2 focus:ring-blue-300"})]}),k&&(0,b.jsx)("div",{className:"mt-3 text-sm text-red-600",children:k}),(0,b.jsxs)("div",{className:"mt-8 flex items-center justify-center gap-4",children:[(0,b.jsx)("button",{type:"button",onClick:()=>{i||(f(!1),h(""),l(null))},className:"rounded-md border border-blue-500 px-6 py-2 text-blue-600 hover:bg-blue-50",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",disabled:!g||i,className:"rounded-md bg-blue-600 px-6 py-2 text-white disabled:opacity-50",children:i?"Saving...":"Save"})]})]})]})]})]})}var g=a.i(941675),h=a.i(963519),i=a.i(417755),j=a.i(781560);let k="https://6jnqmj85-80.inc1.devtunnels.ms",l=`${k}/deals/admin/priorities`,m=`${k}/employee/all`;function n({stages:a,deals:d,search:e,filters:f}){let g=e.trim().toLowerCase(),[h,m]=(0,c.useState)(a);(0,c.useEffect)(()=>{m(a)},[a]);let n=d.filter(a=>(!f.pipeline||a.pipeline===f.pipeline)&&(!f.category||a.dealCategory===f.category)&&(!g||!!`${a.title} ${a.id} ${a.dealCategory??""} ${a.pipeline??""} ${a.dealAgentMeta?.name??a.dealAgent??""}`.toLowerCase().includes(g))&&!0),[o,p]=(0,c.useState)(null);(0,c.useEffect)(()=>{},[]);let[r,s]=(0,c.useState)(()=>[{id:-1,name:"Medium",color:"#FBBF24"},{id:-2,name:"High",color:"#F97316"},{id:-3,name:"Low",color:"#15803D"}]),[t,u]=(0,c.useState)(!0),v=a=>{let b=new Map;for(let c of a){let a=c.name.trim().toLowerCase(),d=b.get(a);if(d){let e=!d.id&&c.id||c.id&&d.id&&c.id!==d.id?{id:c.id??d.id,name:c.name,color:c.color}:{id:d.id??c.id,name:d.name,color:d.color??c.color};b.set(a,e)}else b.set(a,c)}return Array.from(b.values())};(0,c.useEffect)(()=>{let a=!0;if(null!==o)return(async()=>{u(!0);try{let b={"Content-Type":"application/json"};o&&(b.Authorization=`Bearer ${o}`);let c=await fetch(l,{headers:b});if(!c.ok)throw Error(`Failed to load priorities: ${c.status}`);let d=await c.json();if(!a)return;let e=Array.isArray(d)?d.map(a=>({id:a.id,name:String(a.status??a.status),color:a.color??"#2563EB"})):[];e.length>0&&s(a=>v([...a,...e]))}catch(a){console.error("Error loading priorities:",a)}finally{a&&u(!1)}})(),()=>{a=!1}},[o]);let w=async(a,b)=>{let c={"Content-Type":"application/json"};o&&(c.Authorization=`Bearer ${o}`);let d=await fetch(l,{method:"POST",headers:c,body:JSON.stringify({status:a,color:b,isGlobal:!0})});if(!d.ok){let a=await z(d);throw Error(`Failed to create global priority: ${d.status} ${a}`)}let e=await d.json();return{id:e.id,name:e.status??a,color:e.color??b}},x=async(a,b)=>{let c={"Content-Type":"application/json"};o&&(c.Authorization=`Bearer ${o}`);let d=await fetch(`${k}/deals/${a}/priority/assign`,{method:"POST",headers:c,body:JSON.stringify({priorityId:b})});if(!d.ok){let a=await z(d);throw Error(`Failed to assign priority: ${d.status} ${a}`)}let e=await d.json();return{id:e.id,name:e.status??String(e.status??b),color:e.color??"#2563EB",dealId:e.dealId??a}},y=async(a,b)=>{let c={"Content-Type":"application/json"};o&&(c.Authorization=`Bearer ${o}`);let d=await fetch(`${k}/deals/${a}/priority`,{method:"PUT",headers:c,body:JSON.stringify({priorityId:b})});if(!d.ok){let a=await z(d);throw Error(`Failed fallback PUT update: ${d.status} ${a}`)}let e=await d.json();return{id:e.id,name:e.status??String(e.status??b),color:e.color??"#2563EB",dealId:e.dealId??a}};async function z(a){try{if(!(a.headers.get("content-type")||"").includes("application/json"))return await a.text();{let b=await a.json();return JSON.stringify(b)}}catch(a){return"<could not read response body>"}}let A=async(a,b,c,d)=>{if(d)try{let a=await x(c,d);return s(b=>v([...b,{id:a.id,name:a.name,color:a.color}])),a}catch(a){console.error("Assign failed, attempting fallback. Assign error:",a);try{let a=await y(c,d);return s(b=>v([...b,{id:a.id,name:a.name,color:a.color}])),a}catch(a){throw console.error("Fallback PUT failed:",a),a}}try{let d=await w(a,b);s(a=>v([...a,d]));try{let a=await x(c,d.id);return s(b=>v([...b,{id:a.id,name:a.name,color:a.color}])),a}catch(a){console.error("Assign after create failed, attempting fallback. Assign error:",a);try{let a=await y(c,d.id);return s(b=>v([...b,{id:a.id,name:a.name,color:a.color}])),a}catch(a){throw console.error("Fallback PUT failed after create:",a),a}}}catch(a){throw console.error("Create global priority failed:",a),a}},[B,C]=(0,c.useState)(null),D=async a=>{try{let b={"Content-Type":"application/json"};o&&(b.Authorization=`Bearer ${o}`);let c=await fetch(`${k}/stages/${a}`,{method:"DELETE",headers:b});if(!c.ok){let a=await z(c);throw Error(`Failed to delete stage: ${c.status} ${a}`)}m(b=>b.filter(b=>String(b.id)!==String(a))),C(null)}catch(a){console.error("Delete stage failed:",a),C(null)}};return(0,b.jsx)("div",{className:"relative w-full",children:(0,b.jsx)("div",{className:"flex gap-6 overflow-x-auto pb-4 px-1",children:h.map(a=>{let c=n.filter(b=>b.dealStage===a.name);return(0,b.jsxs)("div",{className:"min-w-[340px] max-w-[380px] flex-shrink-0 flex flex-col",children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-2 w-2 rounded-full bg-primary"}),(0,b.jsx)("h2",{className:"text-sm font-semibold text-foreground",children:a.name})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"inline-flex items-center justify-center h-6 w-6 rounded-full bg-muted text-xs font-medium text-muted-foreground",children:c.length}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("button",{type:"button",className:"h-8 w-8 rounded-full flex items-center justify-center text-muted-foreground hover:bg-muted/10",onClick:()=>C(b=>b===a.id?null:a.id),"aria-expanded":B===a.id,"aria-label":"Stage menu",children:(0,b.jsx)(i.MoreHorizontal,{className:"w-4 h-4"})}),B===a.id&&(0,b.jsx)("div",{className:"absolute right-0 mt-2 w-36 bg-white border border-border shadow-lg rounded-md z-40",children:(0,b.jsxs)("button",{type:"button",onClick:()=>D(a.id),className:"w-full text-left px-4 py-3 flex items-center gap-3 hover:bg-red-50 rounded-md",children:[(0,b.jsx)(j.Trash2,{className:"w-4 h-4 text-red-600"}),(0,b.jsx)("span",{className:"text-sm text-red-600 font-medium",children:"Delete"})]})})]})]})]}),(0,b.jsx)("div",{className:"flex flex-col gap-3 flex-1 bg-muted/30 rounded-xl p-3 min-h-[400px]",children:0===c.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No deals in this stage"})}):c.map(a=>(0,b.jsx)(q,{deal:a,palette:r,paletteLoading:t,addPriorityAndAssignFlow:A,token:o},a.id))})]},a.id)})})})}function o(a){return a.split(" ").map(a=>a?a[0]:"").join("").slice(0,2).toUpperCase()}function p(a){try{let b=new Date(a);return isNaN(b.getTime())?null:b}catch{return null}}function q({deal:a,palette:d,paletteLoading:e,addPriorityAndAssignFlow:f,token:i}){let j=a.leadName||a.contactName||a.dealAgentMeta?.name||a.dealAgent||"Unknown",l=a.title??"Deal",n=Array.isArray(a.tags)?a.tags:a.tags?String(a.tags).split(",").map(a=>a.trim()):[],q=a.comments??a.dealComments??a.commentsMeta??a.latestComments??a.recentComments??null,r=a=>{if(!a)return[];if(Array.isArray(a))return a.map(a=>a?"string"==typeof a?a:"object"==typeof a?String(a.commentText??a.comment??a.text??a.body??""):String(a):"").map(a=>a.trim()).filter(Boolean);if("object"==typeof a){let b=String(a.commentText??a.comment??a.text??a.body??"");return b?[b]:[]}return[String(a)]},s=r(q),t=a.followups??a.followUps??a.followupHistory??a.followupsMeta??a.followupList??a.followups_data??a.followupsArray??null,u=a=>{if(!a)return[];if(Array.isArray(a))return a.map(a=>{if(!a)return"";let b=a.createdAt??a.created_at??a.createdDate??a.createdDateTime??a.created??a.dateCreated??a.date;return b?String(b):"string"==typeof a||"number"==typeof a?String(a):""}).map(a=>a.trim()).filter(Boolean);if("object"==typeof a){let b=a.createdAt??a.created_at??a.createdDate??a.created??a.dateCreated??a.date;return b?[String(b)]:[]}return[String(a)]},v=u(t),w=a.nextFollowupDate??a.nextFollowup??a.next_followup,x=w?p(String(w)):null,y=a.contactPhone||a.phone||a.contact||a.mobile||a.contact_number||"",z=Array.isArray(a.watchers)?a.watchers:Array.isArray(a.dealWatchers)?a.dealWatchers:a.dealWatchersMeta?a.dealWatchersMeta:a.assignedEmployeesMeta?a.assignedEmployeesMeta:a.assignedEmployees?a.assignedEmployees:[],A=a.priority,[B,C]=(0,c.useState)(A?Array.isArray(A)?A.map(a=>"string"==typeof a?{name:a,color:void 0}:{name:a?.name??String(a),color:a?.color}):"object"==typeof A?[{name:A.name??String(A),color:A.color}]:[{name:String(A),color:void 0}]:[]),[D,E]=(0,c.useState)(!1),F=(0,c.useRef)(null),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)("#000000"),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)([]),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)([]),[W,X]=(0,c.useState)(""),[Y,Z]=(0,c.useState)(""),[$,_]=(0,c.useState)([]),[aa,ab]=(0,c.useState)({}),[ac,ad]=(0,c.useState)(!1),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)(n),[ai,aj]=(0,c.useState)(z),[ak,al]=(0,c.useState)(s),[am,an]=(0,c.useState)(v);(0,c.useEffect)(()=>{ah(Array.isArray(a.tags)?a.tags:a.tags?String(a.tags).split(",").map(a=>a.trim()):[]);let b=a.assignedEmployeesMeta??a.dealWatchersMeta??a.dealWatchers??a.assignedEmployees??a.watchers??[];aj(Array.isArray(b)?b:[]),al(r(a.comments??a.dealComments??a.commentsMeta??a.latestComments??a.recentComments??null)),an(u(a.followups??a.followUps??a.followupHistory??a.followupsMeta??a.followupList??null))},[a]),(0,c.useEffect)(()=>{let a=a=>{D&&F.current&&!F.current.contains(a.target)&&E(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[D]),(0,c.useEffect)(()=>{let a=!0;if(null!==i)return(async()=>{ad(!0);try{let b={"Content-Type":"application/json"};i&&(b.Authorization=`Bearer ${i}`);let c=await fetch(m,{headers:b});if(!c.ok)throw Error(`Failed to fetch employees: ${c.status}`);let d=await c.json();if(!a)return;_(Array.isArray(d)?d:[]);let e={};(Array.isArray(d)?d:[]).forEach(a=>{a?.employeeId&&(e[String(a.employeeId)]=a)}),ab(e)}catch(a){console.error("Error fetching employees:",a)}finally{a&&ad(!1)}})(),()=>{a=!1}},[i]);let ao=async b=>{C([{name:b.name,color:b.color}]);try{let c=await f(b.name,b.color,a.id,b.id);C([{name:c.name,color:c.color}])}catch(a){console.error("Failed to persist selected priority:",a)}},ap=async()=>{if(I.trim()){N(!0);try{let b=await f(I.trim(),K||"#000000",a.id);C([{name:b.name,color:b.color}]),H(!1),E(!1)}catch(a){console.error("Could not save/assign priority",a)}finally{N(!1)}}},aq=()=>{H(!1)},ar=$.filter(a=>{if(!W)return!0;let b=W.toLowerCase();return String(a.employeeId||"").toLowerCase().includes(b)||String(a.name||"").toLowerCase().includes(b)}).slice(0,8),as=async()=>{let b=Array.from(new Set([...ag.map(a=>String(a).trim()).filter(Boolean),...Q.map(a=>String(a).trim()).filter(Boolean)])),c=[];for(let a of ai)a&&("string"==typeof a?c.push(a):a.employeeId?c.push(String(a.employeeId)):void 0===a.employeeId&&a.name&&a.name);let d=Array.from(new Set([...c,...U.map(a=>String(a).trim()).filter(Boolean)])),e={};if(b.length>0&&(e.tags=b),d.length>0&&(e.employeeIds=d),Y&&Y.trim()&&(e.comments=[{commentText:Y.trim()}]),!e.tags&&!e.employeeIds&&!e.comments)return void P(!1);try{let b,c={"Content-Type":"application/json"};i&&(c.Authorization=`Bearer ${i}`);let d=await fetch((b=a.id,`${k}/deals/${b}/bulk`),{method:"POST",headers:c,body:JSON.stringify(e)});if(!d.ok){let a=await safeReadResponseText(d);throw Error(`Bulk update failed: ${d.status} ${a}`)}let f=await d.json();if(Array.isArray(f.tags)?ah(f.tags):e.tags&&ah(e.tags),Array.isArray(f.assignedEmployeesMeta)&&f.assignedEmployeesMeta.length>0)aj(f.assignedEmployeesMeta);else if(Array.isArray(f.dealWatchersMeta)&&f.dealWatchersMeta.length>0)aj(f.dealWatchersMeta);else if(e.employeeIds&&e.employeeIds.length>0){let a=e.employeeIds.map(a=>{let b=aa[a];return b?{employeeId:a,name:b.name,profilePictureUrl:b.profilePictureUrl}:{employeeId:a,name:a}});aj(a)}if(Array.isArray(f.comments)&&f.comments.length>0){let a=r(f.comments);al(a)}else if(e.comments&&e.comments.length>0){let a=String(e.comments[0].commentText??"").trim();a&&al(b=>[a,...b].slice(0,6))}let g=f.followups??f.followUps??f.followupHistory??f.followupsMeta??f.followupList??null;if(g){let a=u(g);Array.isArray(a)&&a.length>0&&an(a)}P(!1)}catch(a){console.error("Failed to save Add modal data:",a),P(!1)}},at=(a=>{let b=null;for(let c of a){let a=p(c);a&&(!b||a.getTime()>b.getTime())&&(b=a)}return b})([...am,...v]),au=x??at;return(0,b.jsxs)("div",{className:"group rounded-lg border border-border bg-card hover:border-primary/50 hover:shadow-md transition-all duration-200 cursor-default",children:[(0,b.jsxs)("div",{className:"p-4 flex flex-col gap-3 relative",children:[(0,b.jsxs)("div",{className:"absolute right-3 top-3",children:[(0,b.jsx)("div",{children:0===B.length?(0,b.jsx)("button",{type:"button",onClick:()=>E(a=>!a),className:"inline-flex items-center gap-2 px-2 py-1 rounded-full text-sm font-medium","aria-expanded":D,"aria-label":"Toggle priority popover",children:(0,b.jsxs)("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-border text-sm font-medium text-blue-600 bg-white/60",children:[(0,b.jsx)("span",{className:"text-[14px]",children:"＋"}),(0,b.jsx)("span",{className:"text-xs",children:"Add priority"})]})}):(0,b.jsx)("button",{type:"button",onClick:()=>E(!0),className:"h-6 w-6 rounded-full flex items-center justify-center","aria-label":"Open priority list",title:B.map(a=>a.name).join(", "),children:(0,b.jsx)("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:B[0].color??"rgba(59,130,246,0.9)"}})})}),D&&(0,b.jsxs)("div",{ref:F,className:"mt-2 w-44 rounded-lg bg-white border border-border shadow-lg p-3 text-sm z-50",role:"dialog","aria-modal":"false",children:[(0,b.jsx)("div",{className:"flex flex-col gap-2",children:e?(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Loading..."}):d.map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>ao(a),className:"flex items-center gap-3 px-2 py-2 rounded-md hover:bg-muted/20 text-left",children:[(0,b.jsx)("span",{className:"h-3 w-3 rounded-full",style:{backgroundColor:a.color}}),(0,b.jsx)("span",{className:"font-medium",style:{color:a.color},children:a.name})]},a.id??a.name))}),(0,b.jsx)("div",{className:"border-t border-border/60 my-2"}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,b.jsx)("button",{type:"button",onClick:()=>{H(!0)},className:"h-8 w-8 rounded-full flex items-center justify-center bg-blue-600 text-white",title:"Add",children:"＋"}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Add"})]})})]})]}),(0,b.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-foreground truncate",children:j}),(0,b.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,b.jsx)("div",{className:"text-xs text-muted-foreground truncate",children:l})}),ak&&ak.length>0&&(0,b.jsx)("div",{className:"flex gap-2 flex-wrap mt-2",children:ak.slice(0,3).map((a,c)=>(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-muted/20 text-muted-foreground max-w-[200px] truncate",children:a},c))})]})}),ag.length>0&&(0,b.jsx)("div",{className:"flex gap-2 flex-wrap",children:ag.slice(0,3).map((a,c)=>(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-md bg-muted/60 text-muted-foreground",children:a},c))}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"flex items-center gap-3 text-sm",children:y?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(h.Phone,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:y})]}):(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(h.Phone,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"—"})]})}),(0,b.jsx)("div",{className:"flex items-center gap-3",children:au?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)(g.Calendar,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{children:function(a){try{return a.toLocaleDateString()}catch{return String(a)}}(au)})]}):(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)(g.Calendar,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{children:"No follow-up"})]})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsxs)("div",{className:"flex -space-x-2",children:[ai&&ai.length>0?ai.slice(0,4).map((a,c)=>{let d=a?.profilePictureUrl||a?.profileUrl||a?.avatar||a?.avatarUrl,e=a?.name||a?.displayName||a?.employeeId||String(a);return d?(0,b.jsx)("img",{src:d,alt:e,title:e,className:"h-7 w-7 rounded-full border-2 border-white shadow-sm"},c):(0,b.jsx)("div",{title:e,className:"h-7 w-7 rounded-full bg-muted flex items-center justify-center text-xs font-medium border-2 border-white shadow-sm",children:o(e)},c)}):(0,b.jsx)("div",{className:"h-7 w-7 rounded-full bg-muted flex items-center justify-center text-xs font-medium border-2 border-white shadow-sm",children:o(j)}),ai&&ai.length>4&&(0,b.jsxs)("div",{className:"h-7 w-7 rounded-full bg-muted/80 flex items-center justify-center text-xs font-medium border-2 border-white shadow-sm",children:["+",ai.length-4]})]})}),(0,b.jsx)("div",{children:(0,b.jsx)("button",{type:"button",onClick:()=>{P(!0)},className:"h-8 w-8 rounded-full border border-border flex items-center justify-center bg-white text-blue-600 shadow-sm",title:"Add watcher",children:"＋"})})]})]}),G&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center",role:"dialog","aria-modal":"true","aria-label":"Priority modal",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:aq}),(0,b.jsxs)("div",{className:"relative z-10 w-[380px] bg-white rounded-lg shadow-lg border border-border p-5",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Add"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Priority Status *"}),(0,b.jsx)("input",{type:"text",value:I,onChange:a=>J(a.target.value),className:"w-full px-4 py-3 rounded-xl border border-border text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Color Code *"}),(0,b.jsx)("input",{type:"text",value:K,onChange:a=>L(a.target.value),placeholder:"eg #000000",className:"w-full px-4 py-3 rounded-xl border border-border text-sm"})]})]}),(0,b.jsxs)("div",{className:"mt-6 flex items-center justify-between gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:aq,className:"w-1/2 px-6 py-3 rounded-full border border-blue-600 text-blue-600 text-sm font-medium",children:"Cancel"}),(0,b.jsx)("button",{type:"button",onClick:ap,className:"w-1/2 px-6 py-3 rounded-full bg-blue-600 text-white text-sm font-medium",disabled:M,children:M?"Saving...":"Save"})]})]})]}),O&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[70] flex items-center justify-center",role:"dialog","aria-modal":"true","aria-label":"Add modal",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>P(!1)}),(0,b.jsxs)("div",{className:"relative z-20 w-[380px] bg-white rounded-lg shadow-lg border border-border p-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"Add"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-muted-foreground mb-1",children:"Tags"}),(0,b.jsxs)("div",{className:"min-h-[40px] border border-border rounded-md px-2 py-2 flex items-center gap-2 flex-wrap",children:[Q.map(a=>(0,b.jsxs)("div",{className:"inline-flex items-center gap-1 bg-blue-100 text-blue-700 rounded-full px-2 py-1 text-xs",children:[(0,b.jsx)("span",{children:a}),(0,b.jsx)("button",{type:"button",onClick:()=>R(b=>b.filter(b=>b!==a)),className:"text-[12px] leading-none px-1",children:"✕"})]},a)),(0,b.jsx)("input",{value:S,onChange:a=>T(a.target.value),onKeyDown:a=>{if("Enter"===a.key||","===a.key){a.preventDefault();let b=S.trim();b&&!Q.includes(b)&&R(a=>[...a,b]),T("")}else"Backspace"===a.key&&""===S&&R(a=>a.slice(0,-1))},placeholder:"Add a tag and press Enter",className:"flex-1 min-w-[80px] text-sm outline-none"})]})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-muted-foreground mb-1",children:"People"}),(0,b.jsxs)("div",{className:"min-h-[40px] border border-border rounded-md px-2 py-2 flex items-center gap-2 flex-wrap",children:[U.map(a=>{let c=aa[a],d=c?c.name:a;return(0,b.jsxs)("div",{className:"inline-flex items-center gap-1 bg-muted/20 text-muted-foreground rounded-full px-2 py-1 text-xs",children:[(0,b.jsx)("span",{children:d}),(0,b.jsx)("button",{type:"button",onClick:()=>V(b=>b.filter(b=>b!==a)),className:"text-[12px] leading-none px-1",children:"✕"})]},a)}),(0,b.jsx)("input",{value:W,onChange:a=>{X(a.target.value),af(!0)},onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=W.trim();if(!b)return;let c=$.find(a=>a.employeeId===b||a.name?.toLowerCase()===b.toLowerCase()),d=c?String(c.employeeId):b;d&&!U.includes(d)&&V(a=>[...a,d]),X(""),af(!1)}else"Backspace"===a.key&&""===W?V(a=>a.slice(0,-1)):af(!0)},placeholder:"Add people and press Enter (e.g. EMP-002)",className:"flex-1 min-w-[80px] text-sm outline-none",onFocus:()=>af(!0)})]}),ae&&ar.length>0&&(0,b.jsxs)("div",{className:"absolute left-0 right-0 mt-1 bg-white border border-border shadow z-30 rounded-md max-h-56 overflow-auto",children:[ac?(0,b.jsx)("div",{className:"p-2 text-xs text-muted-foreground",children:"Loading..."}):ar.map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>(a=>{if(!a||!a.employeeId)return;let b=String(a.employeeId);U.includes(b)||V(a=>[...a,b]),X(""),af(!1)})(a),className:"w-full text-left px-3 py-2 hover:bg-muted/20 flex items-center gap-3",children:[a.profilePictureUrl?(0,b.jsx)("img",{src:a.profilePictureUrl,alt:a.name,className:"h-6 w-6 rounded-full object-cover"}):(0,b.jsx)("div",{className:"h-6 w-6 rounded-full bg-muted flex items-center justify-center text-xs font-medium",children:o(a.name||a.employeeId)}),(0,b.jsxs)("div",{className:"flex-1 text-sm",children:[(0,b.jsx)("div",{className:"font-medium text-foreground",children:a.name}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.employeeId})]})]},a.employeeId)),0===ar.length&&(0,b.jsx)("div",{className:"p-2 text-xs text-muted-foreground",children:"No employees found"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-muted-foreground mb-1",children:"Comment"}),(0,b.jsx)("textarea",{value:Y,onChange:a=>Z(a.target.value),className:"w-full min-h-[100px] rounded-md border border-border p-2 text-sm"})]})]}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-between gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>P(!1),className:"w-1/2 px-4 py-2 rounded-md border border-blue-600 text-blue-600 text-sm font-medium",children:"Cancel"}),(0,b.jsx)("button",{type:"button",onClick:as,className:"w-1/2 px-4 py-2 rounded-md bg-blue-600 text-white text-sm font-medium",children:"Save"})]})]})]})]})}var r=a.i(699570),s=a.i(875083),t=a.i(957064),u=a.i(197396);function v(){let[a,g]=(0,c.useState)(null),[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(null);(0,c.useEffect)(()=>{g(null)},[]);let o=async b=>{if(!a)throw Error("No access token found. Please log in.");let c=await fetch(b,{headers:{Authorization:`Bearer ${a}`}});if(!c.ok)throw Error(`Failed to fetch ${b}`);return c.json()},{data:p=[],isLoading:q,error:v,mutate:w}=(0,e.default)(a?"/api/deals/stages":null,o),{data:x=[],isLoading:y,error:z,mutate:A}=(0,e.default)(a?"/api/deals/get":null,o),B=v?.message||z?.message||null;(0,c.useMemo)(()=>p.map(a=>({...a,deals:x.filter(b=>b.dealStage===a.name)})),[p,x]);let C=(0,c.useMemo)(()=>({pipeline:j||void 0,category:l||void 0}),[j,l]);return q||y?(0,b.jsx)("div",{className:"flex justify-center items-center min-h-screen text-lg font-semibold",children:"Loading stages and deals..."}):B?(0,b.jsx)("div",{className:"flex justify-center items-center min-h-screen text-lg font-semibold text-red-600",children:B}):(0,b.jsx)("main",{className:"container mx-auto max-w-6xl px-4 py-8",children:(0,b.jsx)("div",{className:"flex flex-col min-h-screen  overflow-x-hidden",children:(0,b.jsxs)("div",{className:"p-6 max-w-[1400px] mx-auto w-full",children:[(0,b.jsxs)("header",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)(f,{onCreated:async()=>{await w()},getToken:()=>a}),(0,b.jsx)(r.Button,{asChild:!0,children:(0,b.jsx)(d.default,{href:"/deals/create",children:"Add Deals"})})]}),(0,b.jsx)("div",{className:"mb-4 flex justify-end",children:(0,b.jsx)(s.Tabs,{className:"w-auto",defaultValue:"table",children:(0,b.jsxs)(s.TabsList,{children:[(0,b.jsx)(s.TabsTrigger,{value:"table",asChild:!0,children:(0,b.jsx)(d.default,{href:"/deals/get",className:"flex items-center gap-2",children:(0,b.jsx)(u.TableIcon,{className:"h-4 w-4"})})}),(0,b.jsx)(s.TabsTrigger,{value:"kanban",asChild:!0,children:(0,b.jsx)(d.default,{href:"/deals/stages",className:"flex items-center gap-2",children:(0,b.jsx)(t.LayoutGrid,{className:"h-4 w-4"})})})]})})})]}),(0,b.jsx)("main",{className:"flex-1 overflow-x-auto",children:(0,b.jsx)(n,{stages:p,deals:x,search:h,filters:C})}),(0,b.jsx)("footer",{className:"mt-6",children:(0,b.jsx)(d.default,{href:"/",className:"text-blue-600 hover:underline",children:"Back to Home"})})]})})})}}];

//# sourceMappingURL=src_app_%28dashboard%29_deals_stages_page_tsx_084cb28f._.js.map