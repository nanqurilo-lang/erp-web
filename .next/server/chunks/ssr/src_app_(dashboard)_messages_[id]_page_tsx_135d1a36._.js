module.exports=[514025,a=>{"use strict";a.s(["default",()=>i],514025);var b=a.i(187924),c=a.i(572131),d=a.i(571987),e=a.i(972596);function f({chatRoomId:a,senderId:e,receiverId:f,onMessageSent:g}){let[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(!1),p=(0,c.useRef)(null),q=a=>!!a&&/\.(png|jpe?g|gif|webp|svg|bmp|tiff)$/i.test(a);(0,c.useEffect)(()=>{if(!j){l&&(URL.revokeObjectURL(l),m(null));return}if(q(j.name)){let a=URL.createObjectURL(j);return m(a),()=>{URL.revokeObjectURL(a)}}l&&(URL.revokeObjectURL(l),m(null))},[j]);let r=()=>{if(l){try{URL.revokeObjectURL(l)}catch{}m(null)}k(null),p.current&&(p.current.value="")},s=async b=>{if(b.preventDefault(),h||j)try{let b;o(!0);let c=new FormData;c.append("chatRoomId",a),c.append("senderId",e),c.append("receiverId",f),h&&h.trim().length>0?c.append("content",h.trim()):c.append("content","");let d=j?q(j.name)?"IMAGE":"FILE":"TEXT";c.append("messageType",d),c.append("status","SENT"),j&&c.append("file",j,j.name);let k=await fetch("https://6jnqmj85-80.inc1.devtunnels.ms/api/chat/send",{method:"POST",headers:void 0,body:c}),l=await k.text();try{b=l?JSON.parse(l):null}catch{b=l}if(!k.ok){console.error("Send message error details:",b);let a="object"==typeof b&&null!==b?b.error||b.message:String(b||"");throw Error(a||`Failed to send (${k.status})`)}g?.(b),i(""),r()}catch(a){console.error("Send message failed:",a)}finally{o(!1)}};return(0,b.jsxs)("form",{onSubmit:s,className:"flex flex-col gap-3 px-6 py-4 border-t border-gray-200 bg-white",children:[j&&(0,b.jsx)("div",{className:"flex items-start gap-3",children:q(j.name)&&l?(0,b.jsx)("div",{className:"relative w-30 h-20 rounded-md overflow-hidden border",children:(0,b.jsx)(d.default,{src:l,alt:j.name,fill:!0,style:{objectFit:"cover"},unoptimized:!0})}):(0,b.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md border w-full",children:[(0,b.jsx)("div",{className:"flex-none w-10 h-10 rounded-md flex items-center justify-center bg-muted",children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 text-gray-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,b.jsx)("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M21.44 11.05l-9.19 9.19a5.5 5.5 0 01-7.78-7.78l9.19-9.19a3.5 3.5 0 014.95 4.95L9.9 17.36a1.5 1.5 0 01-2.12-2.12l8.49-8.49"})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"font-medium truncate",children:j.name}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(j.size/1024).toFixed(1)," KB"]})]}),(0,b.jsx)("button",{type:"button",className:"text-sm text-destructive px-2",onClick:r,children:"Remove"})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("input",{ref:p,type:"file",onChange:a=>{k(a.target.files?.[0]||null)},className:"hidden",id:"chat-file-input",accept:"image/*,application/pdf,application/msword,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.zip,.txt"}),(0,b.jsxs)("label",{htmlFor:"chat-file-input",className:"inline-flex items-center gap-2 rounded-md px-3 py-2 border border-primary text-primary hover:bg-primary/5 cursor-pointer select-none",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M15.172 7l-6.172 6.172a4 4 0 105.656 5.656L21 13.828a6 6 0 10-8.485-8.486L9.172 8.686"})}),(0,b.jsx)("span",{className:"text-sm",children:"Upload File"})]}),j?(0,b.jsx)("span",{className:"text-xs text-gray-500 truncate max-w-[120px]",children:j.name}):null]}),(0,b.jsx)("input",{type:"text",value:h,onChange:a=>i(a.target.value),onKeyDown:a=>{if("Enter"===a.key&&!a.shiftKey&&(a.preventDefault(),h&&h.trim()||j)){let b=a.target.closest("form");b&&b.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}},placeholder:"Write your message here",className:"flex-1 rounded-md border border-gray-200 px-4 py-3 text-sm outline-none focus-visible:ring-2 focus-visible:ring-primary"}),(0,b.jsx)("button",{type:"submit",disabled:n,className:"ml-auto inline-flex items-center justify-center px-5 py-2 rounded-md bg-primary text-white text-sm disabled:opacity-60 hover:brightness-95",children:n?"Sending...":"Send"})]})]})}a.i(365936);let g=async a=>{try{let b=await fetch(a,{headers:{},cache:"no-store"});if(!b.ok){let a=(b.headers.get("content-type")||"").includes("application/json")?await b.json().catch(()=>({})):await b.text().catch(()=>""),c=a&&"object"==typeof a&&(a.error||a.message)||a||`Failed to fetch (${b.status})`;throw Error(c)}return b.json()}catch(a){if(a instanceof Error)throw a;throw Error(String(a))}};function h({chatRoomId:a,employeeid:h,receiverId:i}){let[j,k]=(0,c.useState)(h||""),l=(0,c.useRef)(null),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!1);(0,c.useEffect)(()=>{h&&k(h)},[h]);let s=i?`/api/chats/history/${encodeURIComponent(i)}`:null,{data:t,error:u,isLoading:v,mutate:w}=(0,e.default)(s,g,{revalidateOnFocus:!0}),x=t||[],y=x.length>0&&(x.find(a=>a.receiverDetails?.employeeId===i)?.receiverDetails||x[0]?.senderDetails)||null;(0,c.useEffect)(()=>{l.current?.scrollIntoView({behavior:"smooth"})},[x.length]),(0,c.useRef)(null),(0,c.useEffect)(()=>{},[i,a,w]);let z=async a=>{r(!0),w(b=>b?b.map(b=>b.id===a?{...b,deletedForCurrentUser:!0}:b):b,!1);try{let b=`https://6jnqmj85-80.inc1.devtunnels.ms/api/chat/message/${encodeURIComponent(String(a))}`,c=await fetch(b,{method:"DELETE",headers:void 0});if(!c.ok){await w();let a=await c.text().catch(()=>"");throw Error(a||`Failed to delete message (${c.status})`)}await w()}catch(a){console.error("Delete message error:",a),await w()}finally{r(!1),n(null),p(null)}},A=({attachment:a,isMine:c})=>a?B(a.fileName)?(0,b.jsx)("a",{href:a.fileUrl,download:a.fileName,target:"_blank",rel:"noopener noreferrer",className:"block relative w-30  mt-2 rounded-md overflow-hidden border border-border",children:(0,b.jsx)("div",{className:"relative w-full h-48",children:(0,b.jsx)(d.default,{src:a.fileUrl,alt:a.fileName,fill:!0,sizes:"(max-width: 768px) 100vw, 50vw",style:{objectFit:"cover"},unoptimized:!0})})}):(0,b.jsxs)("div",{className:`mt-2 flex items-center gap-3 p-3 rounded-md border ${c?"bg-primary/5 border-primary/40":"bg-white border-border"}`,children:[(0,b.jsx)("div",{className:"flex-none w-10 h-10 rounded-md flex items-center justify-center bg-muted",children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 text-gray-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,b.jsx)("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M21.44 11.05l-9.19 9.19a5.5 5.5 0 01-7.78-7.78l9.19-9.19a3.5 3.5 0 014.95 4.95L9.9 17.36a1.5 1.5 0 01-2.12-2.12l8.49-8.49"})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("a",{href:a.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"block truncate font-medium",children:a.fileName}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:"Click to download / open"})]})]}):null,B=a=>!!a&&/\.(png|jpe?g|gif|webp|svg|bmp|tiff)$/i.test(a);return(0,b.jsxs)("div",{className:"flex flex-col h-full border border-border rounded-lg overflow-hidden bg-white",children:[y&&(0,b.jsxs)("div",{className:"flex items-center gap-4 px-6 py-4 bg-white border-b border-border",children:[(0,b.jsx)("div",{className:"w-14 h-14 rounded-xl overflow-hidden flex-shrink-0 shadow-sm",children:(0,b.jsx)(d.default,{src:y?.profileUrl??"/placeholder.svg?height=64&width=64&query=User%20avatar",alt:y?.name??"User",width:56,height:56,className:"object-cover w-full h-full",unoptimized:!0})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-foreground leading-tight",children:y?.name??"Unknown"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:y?.designation||"No designation"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:y?.department||"No department"})]})]}),(0,b.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto space-y-4 bg-[rgba(250,250,250,0.8)]",children:[x.map(a=>{let c=a.senderId===j;if(a.deletedForCurrentUser)return(0,b.jsxs)("div",{className:`flex items-start gap-3 ${c?"justify-end":"justify-start"}`,children:[!c&&(0,b.jsx)(d.default,{src:a.senderDetails?.profileUrl??"/placeholder.svg?height=32&width=32&query=User%20avatar",alt:a.senderDetails?.name??"Unknown",width:32,height:32,className:"rounded-full",unoptimized:!0}),(0,b.jsx)("div",{className:"px-3 py-2 rounded-xl max-w-xs bg-muted italic text-muted-foreground",children:"This message was deleted"})]},a.id);let e=c?"bg-primary text-primary-foreground":"bg-white border border-border text-foreground";return(0,b.jsxs)("div",{className:`relative flex items-start gap-3 ${c?"justify-end":"justify-start"}`,children:[!c&&(0,b.jsx)(d.default,{src:a.senderDetails?.profileUrl??"/placeholder.svg?height=32&width=32&query=User%20avatar",alt:a.senderDetails?.name??"Unknown",width:32,height:32,className:"rounded-full",unoptimized:!0}),(0,b.jsxs)("div",{className:`px-4 py-3 rounded-2xl max-w-[75%] break-words ${e}`,onClick:()=>{var b;return b=a.id,void(n(a=>a===b?null:b),p(null))},children:[a.content&&(0,b.jsx)("p",{className:"whitespace-pre-wrap",children:a.content}),a.fileAttachment&&(0,b.jsx)(A,{attachment:a.fileAttachment,isMine:c}),(0,b.jsx)("div",{className:`text-[11px] mt-1 ${c?"text-primary-foreground/80":"text-muted-foreground"}`,children:(0,b.jsx)("span",{children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})})]}),m===a.id&&(0,b.jsx)("div",{className:"absolute top-0 transform -translate-y-full right-0 z-20",children:(0,b.jsx)("div",{className:"bg-white border border-border rounded-md shadow-sm py-2 w-36",children:o===a.id?(0,b.jsxs)("div",{className:"px-3",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Are you sure?"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{className:"flex-1 px-2 py-1 rounded-md border text-sm",onClick:a=>{a.stopPropagation(),p(null),n(null)},children:"Cancel"}),(0,b.jsx)("button",{className:"flex-1 px-2 py-1 rounded-md bg-destructive text-white text-sm disabled:opacity-60",disabled:q,onClick:async b=>{b.stopPropagation(),await z(a.id)},children:q?"Deleting...":"Delete"})]})]}):(0,b.jsx)("div",{className:"px-2",children:(0,b.jsx)("button",{className:"w-full text-left px-2 py-2 text-sm hover:bg-muted rounded-md",onClick:b=>{b.stopPropagation(),p(a.id)},children:"Delete"})})})})]},a.id)}),(0,b.jsx)("div",{ref:l})]}),(0,b.jsx)(f,{chatRoomId:a,senderId:j,receiverId:i,onMessageSent:a=>{w(b=>b?[...b,a]:[a],!1),setTimeout(()=>{l.current?.scrollIntoView({behavior:"smooth"})},100)}})]})}function i({params:a}){let{id:d}=(0,c.use)(a),[e,f]=(0,c.useState)(null),[g,i]=(0,c.useState)(!0),[j,k]=(0,c.useState)(null);if((0,c.useEffect)(()=>{(async()=>{try{let a=localStorage.getItem("accessToken");if(!a)throw Error("No access token found");let b=await fetch("/api/profile",{headers:{Authorization:`Bearer ${a}`}});if(!b.ok)throw Error("Failed to fetch profile");let c=await b.json();f({employeeId:c.employeeId})}catch(a){console.error(a),k(a.message||"An error occurred")}finally{i(!1)}})()},[]),g)return(0,b.jsx)("p",{className:"text-center mt-8 text-muted-foreground",children:"Loading chat..."});if(j||!e)return(0,b.jsx)("p",{className:"text-center mt-8 text-destructive",children:"Failed to load user profile."});let l=[e.employeeId,d].sort().join("_");return(0,b.jsx)("div",{className:"flex-1 min-h-0 h-[calc(100vh-4rem)] flex items-start justify-center bg-[rgba(245,245,246,0.9)] p-6",children:(0,b.jsx)("div",{className:"w-full max-w-4xl h-full flex flex-col rounded-xl overflow-hidden bg-white shadow-sm border border-border",children:(0,b.jsx)(h,{chatRoomId:l,employeeid:e.employeeId,receiverId:d})})})}}];

//# sourceMappingURL=src_app_%28dashboard%29_messages_%5Bid%5D_page_tsx_135d1a36._.js.map