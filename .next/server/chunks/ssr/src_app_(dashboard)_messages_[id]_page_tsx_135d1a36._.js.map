{"version":3,"sources":["turbopack:///[project]/src/app/(dashboard)/messages/[id]/page.tsx","turbopack:///[project]/src/app/(dashboard)/messages/_components/ChatWindow.tsx","turbopack:///[project]/src/app/(dashboard)/messages/_components/ChatInput.tsx"],"sourcesContent":["// messages/[id]/page.tsx\n\n\"use client\"\n\nimport { use, useEffect, useState } from \"react\"\nimport ChatWindow from \"../_components/ChatWindow\"\n\ninterface CurrentUser {\n  employeeId: string\n}\n\nexport default function ChatPage({\n  params,\n}: {\n  params: Promise<{ id: string }>\n}) {\n  // Unwrap promised params (Next.js App Router recent change)\n  const { id: receiverId } = use(params)\n\n  const [currentUser, setCurrentUser] = useState<CurrentUser | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    const fetchProfile = async () => {\n      try {\n        const token = localStorage.getItem(\"accessToken\")\n        if (!token) {\n          throw new Error(\"No access token found\")\n        }\n\n        const res = await fetch(\"/api/profile\", {\n          headers: { Authorization: `Bearer ${token}` },\n        })\n\n        if (!res.ok) {\n          throw new Error(\"Failed to fetch profile\")\n        }\n\n        const data = await res.json()\n        setCurrentUser({ employeeId: data.employeeId })\n      } catch (err: any) {\n        console.error(err)\n        setError(err.message || \"An error occurred\")\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchProfile()\n  }, [])\n\n  if (loading) {\n    return <p className=\"text-center mt-8 text-muted-foreground\">Loading chat...</p>\n  }\n\n  if (error || !currentUser) {\n    return <p className=\"text-center mt-8 text-destructive\">Failed to load user profile.</p>\n  }\n\n  // Build chatRoomId dynamically (consistent naming)\n  const chatRoomId = [currentUser.employeeId, receiverId].sort().join(\"_\")\n\n  return (\n    // Outer container styled to match screenshot: subtle top spacing, rounded white chat card area\n    <div className=\"flex-1 min-h-0 h-[calc(100vh-4rem)] flex items-start justify-center bg-[rgba(245,245,246,0.9)] p-6\">\n      <div className=\"w-full max-w-4xl h-full flex flex-col rounded-xl overflow-hidden bg-white shadow-sm border border-border\">\n        {/* ChatWindow occupies full area and retains all behaviour */}\n        <ChatWindow\n          chatRoomId={chatRoomId}\n          employeeid={currentUser.employeeId}\n          receiverId={receiverId}\n        />\n      </div>\n    </div>\n  )\n}\n","\n\n// components/ChatWindow.tsx\n\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport Image from \"next/image\";\nimport useSWR from \"swr\";\nimport ChatInput from \"./ChatInput\";\n\n// STOMP + SockJS imports (if you used STOMP version)\n// If you are using plain WebSocket version, omit these imports and related logic\nimport SockJS from \"sockjs-client\";\nimport { Client, Frame, IMessage } from \"@stomp/stompjs\";\n\ninterface Message {\n  id: number;\n  chatRoomId: string;\n  senderId: string;\n  receiverId: string;\n  content: string;\n  messageType: \"TEXT\" | \"FILE\";\n  fileAttachment: { fileName: string; fileUrl: string } | null;\n  status: string;\n  createdAt: string;\n  deletedForCurrentUser: boolean;\n  senderDetails?: {\n    employeeId: string;\n    name?: string | null;\n    profileUrl?: string | null;\n    designation?: string | null;\n    department?: string | null;\n  } | null;\n  receiverDetails?: {\n    employeeId: string;\n    name?: string | null;\n    profileUrl?: string | null;\n    designation?: string | null;\n    department?: string | null;\n  } | null;\n}\n\ninterface ChatWindowProps {\n  chatRoomId: string;\n  employeeid: string;\n  receiverId: string;\n}\n\n// === Update this constant if the base URL changes ===\nconst BASE_URL =  `${process.env.NEXT_PUBLIC_MAIN}`;\n\nconst fetcher = async (url: string) => {\n  try {\n    const token = typeof window !== \"undefined\" ? localStorage.getItem(\"accessToken\") : null;\n    const headers: HeadersInit = token ? { Authorization: `Bearer ${token}` } : {};\n    const res = await fetch(url, { headers, cache: \"no-store\" });\n    if (!res.ok) {\n      const contentType = res.headers.get(\"content-type\") || \"\";\n      const errBody = contentType.includes(\"application/json\") ? await res.json().catch(() => ({})) : await res.text().catch(() => \"\");\n      const message = (errBody && typeof errBody === \"object\" && (errBody.error || errBody.message)) || errBody || `Failed to fetch (${res.status})`;\n      throw new Error(message);\n    }\n    return res.json();\n  } catch (err) {\n    // normalize error\n    if (err instanceof Error) throw err;\n    throw new Error(String(err));\n  }\n};\n\nexport default function ChatWindow({ chatRoomId, employeeid, receiverId }: ChatWindowProps) {\n  const [currentUserId, setCurrentUserId] = useState(employeeid || \"\");\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // message action menu state (which message id has menu open)\n  const [openMenuId, setOpenMenuId] = useState<number | null>(null);\n  const [confirmDeleteId, setConfirmDeleteId] = useState<number | null>(null);\n  const [deleting, setDeleting] = useState(false);\n\n  useEffect(() => {\n    if (!employeeid && typeof window !== \"undefined\") {\n      const fromLS = localStorage.getItem(\"employeeId\");\n      if (fromLS) setCurrentUserId(fromLS);\n    } else if (employeeid) {\n      setCurrentUserId(employeeid);\n    }\n  }, [employeeid]);\n\n  const historyUrl = receiverId ? `/api/chats/history/${encodeURIComponent(receiverId)}` : null;\n\n  const { data, error, isLoading, mutate } = useSWR<Message[]>(\n    historyUrl,\n    fetcher,\n    { revalidateOnFocus: true }\n  );\n\n  const messages = data || [];\n\n  // receiver details: prefer explicit receiver info from messages, fallback to first message sender\n  const receiverDetails =\n    messages.length > 0\n      ? messages.find((m) => m.receiverDetails?.employeeId === receiverId)?.receiverDetails ||\n        messages[0]?.senderDetails ||\n        null\n      : null;\n\n  // Auto-scroll on new messages (including when STOMP pushes new items)\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages.length]);\n\n  // Optimistic update when new message sent\n  const handleMessageSent = (newMessage: Message) => {\n    mutate((prev) => (prev ? [...prev, newMessage] : [newMessage]), false);\n    setTimeout(() => {\n      messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, 100);\n  };\n\n  // -------------------------\n  // STOMP over SockJS section (kept if you are using it)\n  // -------------------------\n  const stompClientRef = useRef<Client | null>(null);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\" || !receiverId) return;\n\n    const wsUrl = `${BASE_URL.replace(/\\/$/, \"\")}/ws-chat`;\n    const token = localStorage.getItem(\"accessToken\") || \"\";\n\n    const client = new Client({\n      webSocketFactory: () => new SockJS(wsUrl),\n      reconnectDelay: 5000,\n      heartbeatIncoming: 0,\n      heartbeatOutgoing: 20000,\n      connectHeaders: {\n        Authorization: token ? `Bearer ${token}` : \"\",\n        roomId: chatRoomId,\n        receiverId: receiverId,\n      },\n      onConnect: (frame: Frame) => {\n        try {\n          client.subscribe(`/topic/chat.${chatRoomId}`, (msg: IMessage) => {\n            try {\n              const body = msg.body;\n              if (!body) return;\n              const payload = JSON.parse(body);\n              if (payload && payload.type === \"message\" && payload.data) {\n                const incoming: Message = payload.data;\n                mutate((prev) => {\n                  const already = prev && prev.some((m) => m.id === incoming.id);\n                  return already ? prev : prev ? [...prev, incoming] : [incoming];\n                }, false);\n              } else if (payload && payload.id) {\n                const incoming: Message = payload;\n                mutate((prev) => (prev && prev.some((m) => m.id === incoming.id) ? prev : prev ? [...prev, incoming] : [incoming]), false);\n              }\n            } catch (e) {\n              console.error(\"Error parsing topic message\", e);\n            }\n          });\n        } catch (e) {}\n\n        try {\n          client.subscribe(`/user/queue/messages`, (msg: IMessage) => {\n            try {\n              const payload = JSON.parse(msg.body);\n              if (!payload) return;\n              if (payload.type === \"message\" && payload.data) {\n                const incoming: Message = payload.data;\n                mutate((prev) => {\n                  const already = prev && prev.some((m) => m.id === incoming.id);\n                  return already ? prev : prev ? [...prev, incoming] : [incoming];\n                }, false);\n              } else if (payload.id) {\n                const incoming: Message = payload;\n                mutate((prev) => (prev && prev.some((m) => m.id === incoming.id) ? prev : prev ? [...prev, incoming] : [incoming]), false);\n              }\n            } catch (e) {\n              console.error(\"Error parsing user queue message\", e);\n            }\n          });\n        } catch (e) {}\n\n        try {\n          client.subscribe(`/topic/chat.${chatRoomId}.deleted`, (msg: IMessage) => {\n            try {\n              const payload = JSON.parse(msg.body);\n              const messageId = payload?.messageId ?? payload?.id;\n              if (messageId != null) {\n                mutate((prev) => (prev ? prev.map((m) => (m.id === messageId ? { ...m, deletedForCurrentUser: true } : m)) : prev), false);\n              }\n            } catch (e) {\n              console.error(\"Error parsing deleted event\", e);\n            }\n          });\n        } catch (e) {}\n      },\n      onStompError: (frame) => {\n        console.error(\"Broker reported error: \" + frame.headers[\"message\"]);\n        console.error(\"Additional details: \" + frame.body);\n      },\n    });\n\n    client.activate();\n    stompClientRef.current = client;\n\n    return () => {\n      try {\n        if (stompClientRef.current) {\n          stompClientRef.current.deactivate();\n          stompClientRef.current = null;\n        }\n      } catch (e) {}\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [receiverId, chatRoomId, mutate]);\n\n  // Delete flow: mark deletedForCurrentUser true on success\n  const deleteMessage = async (messageId: number) => {\n    const token = typeof window !== \"undefined\" ? localStorage.getItem(\"accessToken\") : null;\n    setDeleting(true);\n\n    // optimistic update: mark deletedForCurrentUser for this user\n    mutate(\n      (prev) =>\n        prev\n          ? prev.map((m) =>\n              m.id === messageId ? { ...m, deletedForCurrentUser: true } : m\n            )\n          : prev,\n      false\n    );\n\n    try {\n      const url = `${BASE_URL}/api/chat/message/${encodeURIComponent(String(messageId))}`; \n      \n      const res = await fetch(url, {\n        method: \"DELETE\",\n        headers: token ? { Authorization: `Bearer ${token}` } : undefined,\n      });\n\n      if (!res.ok) {\n        // revert optimistic update on failure by revalidating\n        await mutate();\n        const text = await res.text().catch(() => \"\");\n        throw new Error(text || `Failed to delete message (${res.status})`);\n      }\n\n      // revalidate to get canonical state from server\n      await mutate();\n    } catch (err) {\n      console.error(\"Delete message error:\", err);\n      // revalidate to get latest server state (revert optimistic)\n      await mutate();\n    } finally {\n      setDeleting(false);\n      setOpenMenuId(null);\n      setConfirmDeleteId(null);\n    }\n  };\n\n  // Click handler for message bubble -> toggles action menu\n  const handleBubbleClick = (messageId: number) => {\n    // toggle open/close\n    setOpenMenuId((prev) => (prev === messageId ? null : messageId));\n    // reset any pending confirm\n    setConfirmDeleteId(null);\n  };\n\n  // Render file attachment UI (image thumbnail or file card)\n  const Attachment = ({ attachment, isMine }: { attachment: { fileName: string; fileUrl: string } | null; isMine: boolean }) => {\n    if (!attachment) return null;\n    const image = isImageFilename(attachment.fileName);\n\n    if (image) {\n      return (\n        <a\n          href={attachment.fileUrl } download={attachment.fileName}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"block relative w-30  mt-2 rounded-md overflow-hidden border border-border\"\n          \n        >\n          {/* next/image requires width/height; using fixed height and letting width auto via css */}\n          <div className=\"relative w-full h-48\">\n            <Image\n              src={attachment.fileUrl}\n              alt={attachment.fileName}\n              fill\n              sizes=\"(max-width: 768px) 100vw, 50vw\"\n              style={{ objectFit: \"cover\" }}\n              unoptimized\n            />\n          </div>\n        </a>\n      );\n    }\n\n    // non-image file card\n    return (\n      <div\n        className={`mt-2 flex items-center gap-3 p-3 rounded-md border ${\n          isMine ? \"bg-primary/5 border-primary/40\" : \"bg-white border-border\"\n        }`}\n      >\n        <div className=\"flex-none w-10 h-10 rounded-md flex items-center justify-center bg-muted\">\n          {/* simple paperclip/file icon */}\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"w-5 h-5 text-gray-600\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n            <path strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M21.44 11.05l-9.19 9.19a5.5 5.5 0 01-7.78-7.78l9.19-9.19a3.5 3.5 0 014.95 4.95L9.9 17.36a1.5 1.5 0 01-2.12-2.12l8.49-8.49\" />\n          </svg>\n        </div>\n\n        <div className=\"flex-1 min-w-0\">\n          <a href={attachment.fileUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"block truncate font-medium\">\n            {attachment.fileName}\n          </a>\n          <p className=\"text-xs text-muted-foreground mt-1 truncate\">Click to download / open</p>\n        </div>\n      </div>\n    );\n  };\n\n  const isImageFilename = (filename?: string | null) => {\n    if (!filename) return false;\n    return /\\.(png|jpe?g|gif|webp|svg|bmp|tiff)$/i.test(filename);\n  };\n\n  const formatTime = (iso: string) =>\n    new Date(iso).toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\n\n  return (\n    <div className=\"flex flex-col h-full border border-border rounded-lg overflow-hidden bg-white\">\n      {/* Header: rounded card-like, avatar as rounded square, name + two small lines */}\n      {receiverDetails && (\n        <div className=\"flex items-center gap-4 px-6 py-4 bg-white border-b border-border\">\n          <div className=\"w-14 h-14 rounded-xl overflow-hidden flex-shrink-0 shadow-sm\">\n            <Image\n              src={receiverDetails?.profileUrl ?? \"/placeholder.svg?height=64&width=64&query=User%20avatar\"}\n              alt={receiverDetails?.name ?? \"User\"}\n              width={56}\n              height={56}\n              className=\"object-cover w-full h-full\"\n              unoptimized\n            />\n          </div>\n\n          <div>\n            <h2 className=\"text-lg font-semibold text-foreground leading-tight\">{receiverDetails?.name ?? \"Unknown\"}</h2>\n            <p className=\"text-sm text-muted-foreground mt-1\">{receiverDetails?.designation || \"No designation\"}</p>\n            <p className=\"text-sm text-muted-foreground\">{receiverDetails?.department || \"No department\"}</p>\n          </div>\n        </div>\n      )}\n\n      {/* Messages list */}\n      <div className=\"flex-1 p-6 overflow-y-auto space-y-4 bg-[rgba(250,250,250,0.8)]\">\n        {messages.map((msg) => {\n          const isMine = msg.senderId === currentUserId;\n\n          if (msg.deletedForCurrentUser) {\n            // Deleted placeholder\n            return (\n              <div key={msg.id} className={`flex items-start gap-3 ${isMine ? \"justify-end\" : \"justify-start\"}`}>\n                {!isMine && (\n                  <Image\n                    src={msg.senderDetails?.profileUrl ?? \"/placeholder.svg?height=32&width=32&query=User%20avatar\"}\n                    alt={msg.senderDetails?.name ?? \"Unknown\"}\n                    width={32}\n                    height={32}\n                    className=\"rounded-full\"\n                    unoptimized\n                  />\n                )}\n                <div className=\"px-3 py-2 rounded-xl max-w-xs bg-muted italic text-muted-foreground\">\n                  This message was deleted\n                </div>\n              </div>\n            );\n          }\n\n          const bubbleClasses = isMine\n            ? \"bg-primary text-primary-foreground\"\n            : \"bg-white border border-border text-foreground\";\n\n          return (\n            <div key={msg.id} className={`relative flex items-start gap-3 ${isMine ? \"justify-end\" : \"justify-start\"}`}>\n              {!isMine && (\n                <Image\n                  src={msg.senderDetails?.profileUrl ?? \"/placeholder.svg?height=32&width=32&query=User%20avatar\"}\n                  alt={msg.senderDetails?.name ?? \"Unknown\"}\n                  width={32}\n                  height={32}\n                  className=\"rounded-full\"\n                  unoptimized\n                />\n              )}\n\n              <div className={`px-4 py-3 rounded-2xl max-w-[75%] break-words ${bubbleClasses}`} onClick={() => handleBubbleClick(msg.id)}>\n                {/* Message text */}\n                {msg.content && <p className=\"whitespace-pre-wrap\">{msg.content}</p>}\n\n                {/* Attachment preview */}\n                {msg.fileAttachment && (\n                  <Attachment attachment={msg.fileAttachment} isMine={isMine} />\n                )}\n\n                <div className={`text-[11px] mt-1 ${isMine ? \"text-primary-foreground/80\" : \"text-muted-foreground\"}`}>\n                  <span>{formatTime(msg.createdAt)}</span>\n                </div>\n              </div>\n\n              {/* Action menu */}\n              {openMenuId === msg.id && (\n                <div className=\"absolute top-0 transform -translate-y-full right-0 z-20\">\n                  <div className=\"bg-white border border-border rounded-md shadow-sm py-2 w-36\">\n                    {/* Confirm step */}\n                    {confirmDeleteId === msg.id ? (\n                      <div className=\"px-3\">\n                        <p className=\"text-sm text-muted-foreground mb-2\">Are you sure?</p>\n                        <div className=\"flex gap-2\">\n                          <button\n                            className=\"flex-1 px-2 py-1 rounded-md border text-sm\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              setConfirmDeleteId(null);\n                              setOpenMenuId(null);\n                            }}\n                          >\n                            Cancel\n                          </button>\n                          <button\n                            className=\"flex-1 px-2 py-1 rounded-md bg-destructive text-white text-sm disabled:opacity-60\"\n                            disabled={deleting}\n                            onClick={async (e) => {\n                              e.stopPropagation();\n                              await deleteMessage(msg.id);\n                            }}\n                          >\n                            {deleting ? \"Deleting...\" : \"Delete\"}\n                          </button>\n                        </div>\n                      </div>\n                    ) : (\n                      <div className=\"px-2\">\n                        {/* Delete option available to both sender and receiver */}\n                        <button\n                          className=\"w-full text-left px-2 py-2 text-sm hover:bg-muted rounded-md\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            setConfirmDeleteId(msg.id);\n                          }}\n                        >\n                          Delete\n                        </button>\n                        {/* Future actions can be added here (Reply, Forward, etc.) */}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          );\n        })}\n\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Input (kept identical in behavior) */}\n      <ChatInput chatRoomId={chatRoomId} senderId={currentUserId} receiverId={receiverId} onMessageSent={handleMessageSent} />\n    </div>\n  );\n}\n\n\n\n\n","\n\"use client\"\n\nimport type React from \"react\"\nimport { useEffect, useRef, useState } from \"react\"\nimport Image from \"next/image\"\n\nexport default function ChatInput({\n  chatRoomId,\n  senderId,\n  receiverId,\n  onMessageSent,\n}: {\n  chatRoomId: string\n  senderId: string\n  receiverId: string\n  onMessageSent?: (message: any) => void\n}) {\n  const [message, setMessage] = useState(\"\")\n  const [file, setFile] = useState<File | null>(null)\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null)\n  const [loading, setLoading] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement | null>(null)\n\n  // BASE_URL for file uploads (from your message)\n  const BASE_URL =  `${process.env.NEXT_PUBLIC_MAIN}`\n\n  // Helper: detect images\n  const isImageFilename = (name?: string | null) => {\n    if (!name) return false\n    return /\\.(png|jpe?g|gif|webp|svg|bmp|tiff)$/i.test(name)\n  }\n\n  // When file selected, store and create preview if image\n  useEffect(() => {\n    if (!file) {\n      if (previewUrl) {\n        URL.revokeObjectURL(previewUrl)\n        setPreviewUrl(null)\n      }\n      return\n    }\n\n    // create preview for images\n    if (isImageFilename(file.name)) {\n      const url = URL.createObjectURL(file)\n      setPreviewUrl(url)\n      return () => {\n        URL.revokeObjectURL(url)\n      }\n    } else {\n      // non-image -> no preview image, but we can show filename\n      if (previewUrl) {\n        URL.revokeObjectURL(previewUrl)\n        setPreviewUrl(null)\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [file])\n\n  const clearFile = () => {\n    if (previewUrl) {\n      try {\n        URL.revokeObjectURL(previewUrl)\n      } catch {}\n      setPreviewUrl(null)\n    }\n    setFile(null)\n    if (fileInputRef.current) fileInputRef.current.value = \"\"\n  }\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const f = e.target.files?.[0] || null\n    setFile(f)\n  }\n\n  const handleSendMessage = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!message && !file) return\n\n    try {\n      setLoading(true)\n\n      const token = typeof window !== \"undefined\" ? localStorage.getItem(\"accessToken\") : null\n\n      // Build multipart/form-data so backend gets fileAttachment inside the message\n      const form = new FormData()\n      form.append(\"chatRoomId\", chatRoomId)\n      form.append(\"senderId\", senderId)\n      form.append(\"receiverId\", receiverId)\n\n      // content: send empty string if none (server often treats missing vs empty differently)\n      if (message && message.trim().length > 0) {\n        form.append(\"content\", message.trim())\n      } else {\n        // you can choose to omit this if your server expects null — keeping empty string is safe in many setups\n        form.append(\"content\", \"\")\n      }\n\n      // messageType: IMAGE for images, FILE for other files, TEXT if no file\n      const messageType = file ? (isImageFilename(file.name) ? \"IMAGE\" : \"FILE\") : \"TEXT\"\n      form.append(\"messageType\", messageType)\n\n      // optional status field (your previous code used 'SENT')\n      form.append(\"status\", \"SENT\")\n\n      // Append file if present. Field name is \"file\" — change if your backend expects a different name.\n      if (file) {\n        form.append(\"file\", file, file.name)\n      }\n\n      const res = await fetch(`${BASE_URL}/api/chat/send`, {\n        method: \"POST\",\n        headers: token ? { Authorization: `Bearer ${token}` } : undefined,\n        body: form, // browser will set correct multipart boundary\n      })\n\n      // parse response robustly\n      const rawText = await res.text()\n      let data: any\n      try {\n        data = rawText ? JSON.parse(rawText) : null\n      } catch {\n        data = rawText\n      }\n\n      if (!res.ok) {\n        console.error(\"Send message error details:\", data)\n        const messageFromServer =\n          typeof data === \"object\" && data !== null ? data.error || data.message : String(data || \"\")\n        throw new Error(messageFromServer || `Failed to send (${res.status})`)\n      }\n\n      // success: notify parent (ChatWindow) so it will mutate/sync\n      onMessageSent?.(data)\n\n      // reset UI (keep everything else same)\n      setMessage(\"\")\n      clearFile()\n    } catch (err) {\n      console.error(\"Send message failed:\", err)\n      // you can add UI toast here if desired\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Enter to send (Shift+Enter for newline) — optional behavior for text input\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault()\n      if ((message && message.trim()) || file) {\n        // trigger form submit\n        const form = (e.target as HTMLElement).closest(\"form\")\n        if (form) form.dispatchEvent(new Event(\"submit\", { cancelable: true, bubbles: true }))\n      }\n    }\n  }\n\n  return (\n    <form\n      onSubmit={handleSendMessage}\n      className=\"flex flex-col gap-3 px-6 py-4 border-t border-gray-200 bg-white\"\n    >\n      {/* Preview: WhatsApp-like */}\n      {file && (\n        <div className=\"flex items-start gap-3\">\n          {isImageFilename(file.name) && previewUrl ? (\n            <div className=\"relative w-30 h-20 rounded-md overflow-hidden border\">\n              {/* use next/image with object URL (unoptimized) */}\n              <Image src={previewUrl} alt={file.name} fill style={{ objectFit: \"cover\" }} unoptimized />\n            </div>\n          ) : (\n            <div className=\"flex items-center gap-3 p-2 rounded-md border w-full\">\n              <div className=\"flex-none w-10 h-10 rounded-md flex items-center justify-center bg-muted\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"w-5 h-5 text-gray-600\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n                  <path strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M21.44 11.05l-9.19 9.19a5.5 5.5 0 01-7.78-7.78l9.19-9.19a3.5 3.5 0 014.95 4.95L9.9 17.36a1.5 1.5 0 01-2.12-2.12l8.49-8.49\" />\n                </svg>\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"font-medium truncate\">{file.name}</div>\n                <div className=\"text-xs text-muted-foreground\">{(file.size / 1024).toFixed(1)} KB</div>\n              </div>\n              <button type=\"button\" className=\"text-sm text-destructive px-2\" onClick={clearFile}>Remove</button>\n            </div>\n          )}\n        </div>\n      )}\n\n      <div className=\"flex items-center gap-4\">\n        {/* Upload file button */}\n        <div className=\"flex items-center gap-3\">\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            onChange={handleFileChange}\n            className=\"hidden\"\n            id=\"chat-file-input\"\n            accept=\"image/*,application/pdf,application/msword,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.zip,.txt\"\n          />\n          <label\n            htmlFor=\"chat-file-input\"\n            className=\"inline-flex items-center gap-2 rounded-md px-3 py-2 border border-primary text-primary hover:bg-primary/5 cursor-pointer select-none\"\n          >\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15.172 7l-6.172 6.172a4 4 0 105.656 5.656L21 13.828a6 6 0 10-8.485-8.486L9.172 8.686\" />\n            </svg>\n            <span className=\"text-sm\">Upload File</span>\n          </label>\n          {/* show selected file name (small) */}\n          {file ? <span className=\"text-xs text-gray-500 truncate max-w-[120px]\">{file.name}</span> : null}\n        </div>\n\n        {/* Message input */}\n        <input\n          type=\"text\"\n          value={message}\n          onChange={(e) => setMessage(e.target.value)}\n          onKeyDown={handleKeyDown}\n          placeholder=\"Write your message here\"\n          className=\"flex-1 rounded-md border border-gray-200 px-4 py-3 text-sm outline-none focus-visible:ring-2 focus-visible:ring-primary\"\n        />\n\n        {/* Send button */}\n        <button\n          type=\"submit\"\n          disabled={loading}\n          className=\"ml-auto inline-flex items-center justify-center px-5 py-2 rounded-md bg-primary text-white text-sm disabled:opacity-60 hover:brightness-95\"\n        >\n          {loading ? \"Sending...\" : \"Send\"}\n        </button>\n      </div>\n    </form>\n  )\n}\n\n\n"],"names":[],"mappings":"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"}