module.exports=[53207,a=>{"use strict";a.s(["default",()=>h],53207);var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(571987),f=a.i(238246);function g({employees:a,loading:g,error:h,search:i}){let[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(!0),[p,q]=(0,c.useState)(null),r=(0,d.usePathname)(),s=r?.split("/").pop()??"",t=void 0!==h?h:p,u=(i??"").trim();(0,c.useEffect)(()=>{(async()=>{o(!0),q(null);try{let a={},[b,c]=await Promise.all([fetch("/api/profile",{headers:a}),fetch("/api/chats/rooms",{headers:a,cache:"no-store"})]);if(!b.ok)throw Error(`Failed to fetch profile (${b.status})`);if(!c.ok)throw Error(`Failed to fetch chat rooms (${c.status})`);let d=await b.json();m({employeeId:d.employeeId});let e=await c.json();k(Array.isArray(e)?e:[])}catch(a){q(a?.message||"An error occurred while loading chats")}finally{o(!1)}})()},[]);let v=(0,c.useMemo)(()=>{if(!a||!u)return[];let b=u.toLowerCase();return a.filter(a=>`${a.name??""} ${a.email??""} ${a.employeeId??""}`.toLowerCase().includes(b))},[a,u]),w=({employeeId:a,name:c,profileUrl:d,smallText:g,isSelected:h})=>(0,b.jsx)(f.default,{href:`/messages/${a}`,className:"block","aria-label":`Open chat with ${c}`,children:(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-2xl border "+(h?"bg-blue-100 border-blue-200 shadow-sm":"bg-white border-gray-200 hover:shadow-sm"),children:[(0,b.jsx)("div",{className:"flex-none",children:(0,b.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-white shadow-sm",children:(0,b.jsx)(e.default,{src:d||"/placeholder.svg?height=48&width=48&query=User%20avatar",alt:c,width:48,height:48,className:"object-cover rounded-full"})})}),(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-gray-800 truncate",children:c}),g?(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2 truncate",children:g}):null]}),(0,b.jsx)("div",{className:"flex flex-col items-end ml-3",children:(0,b.jsx)("span",{className:"text-xs text-gray-400"})})]})})]})},a);return("boolean"==typeof g?g:n)?(0,b.jsx)("p",{className:"text-center text-muted-foreground",children:"Loading chats..."}):t?(0,b.jsx)("p",{className:"text-center text-destructive",children:t}):l||0!==j.length||a?(0,b.jsx)("aside",{className:"w-full max-w-[340px] p-4",children:u&&a?(0,b.jsx)("div",{className:"space-y-3",children:0===v.length?(0,b.jsxs)("p",{className:"text-center text-sm text-gray-500",children:["No employees match â€œ",u,"â€."]}):v.map(a=>(0,b.jsx)(w,{employeeId:a.employeeId,name:a.name,profileUrl:a.profilePictureUrl??void 0,smallText:a.designationName??a.departmentName??a.email??"",isSelected:a.employeeId===s},a.employeeId))}):(0,b.jsx)("div",{className:"space-y-3",children:j.map(a=>{let c=a.participant1Details.employeeId===l?.employeeId?a.participant2Details:a.participant1Details,d=c.employeeId===s,g=a.lastMessage?.messageType==="FILE"?`ðŸ“Ž ${a.lastMessage.fileAttachment?.fileName??"Attachment"}`:a.lastMessage?.content??"No messages yet";return(0,b.jsx)(f.default,{href:`/messages/${c.employeeId}`,className:"block","aria-label":`Open chat with ${c.name}`,children:(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-2xl border "+(d?"bg-blue-100 border-blue-200 shadow-sm":"bg-white border-gray-200 hover:shadow-sm"),children:[(0,b.jsx)("div",{className:"flex-none",children:(0,b.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-white shadow-sm",children:(0,b.jsx)(e.default,{src:c.profileUrl||"/placeholder.svg?height=48&width=48&query=User%20avatar",alt:c.name,width:48,height:48,className:"object-cover rounded-full"})})}),(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-gray-800 truncate",children:c.name}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2 truncate",children:g})]}),(0,b.jsx)("div",{className:"flex flex-col items-end ml-3",children:(0,b.jsx)("span",{className:"text-xs text-gray-400",children:(a=>{if(!a)return"";let b=new Date(a),c=Math.floor((Date.now()-b.getTime())/6e4),d=Math.floor(c/60),e=Math.floor(d/24);return e>=1?`${e}d ago`:d>=1?`${d}h ago`:c>=1?`${c}m ago`:"just now"})(a.lastMessage?.createdAt)})})]})})]})},a.id)})})}):(0,b.jsx)("p",{className:"text-center text-muted-foreground",children:"Unable to load user profile."})}function h({children:a}){let e=(0,d.useRouter)(),[f,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!0),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)("");return(0,c.useEffect)(()=>{let a=new AbortController;return(async()=>{j(!0),l(null);let b=function(a){if("undefined"==typeof document)return null;let b=document.cookie.match(RegExp("(^| )"+a+"=([^;]+)"));return b?decodeURIComponent(b[2]):null}("token")||null,c={Accept:"application/json"};b&&(c.Authorization=`Bearer ${b}`);try{let b=await fetch("https://6jnqmj85-80.inc1.devtunnels.ms/employee/all",{method:"GET",headers:c,signal:a.signal});if(401===b.status){h([]),l("Unauthorized: You need to be logged in to fetch employees. (401)"),j(!1),e.push("/login");return}if(!b.ok){let a=await b.text().catch(()=>"");h([]),l(`Failed to load employees: ${b.status} ${b.statusText}${a?` â€” ${a}`:""}`),j(!1);return}let d=await b.json();Array.isArray(d)?h(d):d&&Array.isArray(d.content)?h(d.content):h([])}catch(a){if(a?.name==="AbortError")return;h([]),l(a?.message||"Failed to fetch employees")}finally{j(!1)}})(),()=>{a.abort()}},[]),(0,b.jsxs)("div",{className:"h-screen md:h-[calc(100vh-0rem)] flex flex-col md:flex-row",children:[(0,b.jsxs)("aside",{className:"w-full md:w-80 border-b md:border-b-0 md:border-r border-border bg-card",children:[(0,b.jsx)("div",{className:"p-4 border-b border-border",children:(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsx)("label",{htmlFor:"chat-search",className:"sr-only",children:"Search a contact"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":!0,children:(0,b.jsx)("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-4.35-4.35M16.65 16.65A7.5 7.5 0 1116.65 2a7.5 7.5 0 010 14.65z"})}),(0,b.jsx)("input",{id:"chat-search",type:"text",placeholder:"Search a contact",value:m,onChange:a=>n(a.target.value),className:"w-full rounded-full border border-gray-200 px-10 py-2 text-sm bg-white placeholder:text-gray-400 focus:outline-none focus:ring-0","aria-label":"Search a contact"})]})]})}),(0,b.jsx)("div",{className:"h-[calc(100vh-4rem)] md:h-screen overflow-y-auto",children:(0,b.jsx)(g,{employees:f.map(a=>({employeeId:a.employeeId,name:a.name,email:a.email??null,profilePictureUrl:a.profilePictureUrl??null,designationName:a.designationName??null,departmentName:a.departmentName??null})),loading:i,error:k,search:m})})]}),(0,b.jsx)("main",{className:"flex-1 min-w-0 bg-background",children:a})]})}}];

//# sourceMappingURL=src_app_%28dashboard%29_messages_layout_tsx_e990f32b._.js.map