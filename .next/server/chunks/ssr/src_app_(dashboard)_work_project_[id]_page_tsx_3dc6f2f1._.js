module.exports=[595426,a=>{"use strict";a.s(["default",()=>au],595426);var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(83490),f=a.i(886330),g=a.i(782066),h=a.i(6080);let i="https://6jnqmj85-80.inc1.devtunnels.ms";function j({projectId:a}){let[d,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(!0),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(null),E={title:"",category:"",startDate:"",dueDate:"",noDueDate:!1,taskStageId:"",assignedEmployeeIds:[],description:"",labelIds:[],milestoneId:"",priority:"LOW",isPrivate:!1,timeEstimateMinutes:"",isDependent:!1,projectId:a,taskFile:null},[F,G]=(0,c.useState)(E),H=a=>`${i}${a}`,I=async()=>{try{let a=`${i}/status`,b=localStorage.getItem("accessToken"),c=await e.default.get(a,{headers:{Authorization:b?`Bearer ${b}`:""}});Array.isArray(c.data)?p(c.data):p([])}catch(a){console.warn("Failed to fetch statuses:",a),p([])}},J=async()=>{l(!0),n(null);try{let b=localStorage.getItem("accessToken"),c=`${i}/projects/${a}/tasks`,d=await e.default.get(c,{headers:{"Content-Type":"application/json",Authorization:b?`Bearer ${b}`:""}});j(Array.isArray(d.data)?d.data:[])}catch(a){n(a?.response?.data?.message||a?.message||"Failed to load tasks")}finally{l(!1)}};(0,c.useEffect)(()=>{I(),J()},[a]);let K=a=>G(b=>({...b,...a})),L=async b=>{b.preventDefault();try{let b=new FormData;b.append("title",F.title),b.append("category",F.category||""),b.append("startDate",F.startDate||""),b.append("dueDate",F.dueDate||""),b.append("noDueDate",String(F.noDueDate)),b.append("taskStageId",F.taskStageId||""),b.append("assignedEmployeeIds",JSON.stringify(F.assignedEmployeeIds)),b.append("description",F.description||""),b.append("labelIds",JSON.stringify(F.labelIds)),b.append("milestoneId",F.milestoneId||""),b.append("priority",F.priority||""),b.append("isPrivate",String(F.isPrivate)),b.append("timeEstimateMinutes",String(F.timeEstimateMinutes||"")),b.append("isDependent",String(F.isDependent)),b.append("projectId",String(a)),F.taskFile&&b.append("taskFile",F.taskFile),await (0,g.postAPI)(H("/api/projects/tasks"),b,{headers:{"Content-Type":"multipart/form-data"}}),r(!1),G(E),await J()}catch(a){alert("Create task failed: "+(a?.response?.data?.message||a?.message||"unknown"))}},M=async b=>{if(b.preventDefault(),u)try{let b=new FormData;b.append("title",F.title),b.append("category",F.category||""),b.append("noDueDate",String(F.noDueDate)),b.append("description",F.description||""),b.append("labelIds",JSON.stringify(F.labelIds)),b.append("priority",F.priority||""),b.append("isPrivate",String(F.isPrivate)),b.append("timeEstimateMinutes",String(F.timeEstimateMinutes||"")),b.append("isDependent",String(F.isDependent)),b.append("projectId",String(a)),b.append("assignedEmployeeIds",JSON.stringify(F.assignedEmployeeIds)),F.taskFile&&b.append("taskFile",F.taskFile),await (0,g.putAPI)(H(`/api/projects/tasks/${u.id}`),b,{headers:{"Content-Type":"multipart/form-data"}}),t(!1),v(null),G(E),await J()}catch(a){alert("Update task failed: "+(a?.response?.data?.message||a?.message||"unknown"))}},N=async b=>{if(confirm("Are you sure to delete this task?"))try{await (0,g.deleteAPI)(H(`/api/projects/${a}/tasks/${b}`)),B(null),await J()}catch(a){alert("Delete failed: "+(a?.response?.data?.message||a?.message||"unknown"))}},O=a=>{switch(("string"==typeof a?a:a?.name??"").toLowerCase()){case"complete":case"completed":case"complete":case"complete":return"bg-green-600";case"to-do":case"to do":case"todo":return"bg-yellow-500";case"doing":return"bg-blue-600";case"incomplete":return"bg-red-600";case"waiting":case"waiting for approval":return"bg-gray-600";default:return"bg-gray-400"}},P=async(a,b)=>{j(c=>c.map(c=>c.id===a.id?{...c,taskStage:{id:b.id,name:b.name},taskStageId:b.id}:c));let c=localStorage.getItem("accessToken");try{let d=`${i}/api/projects/tasks/${a.id}/status?statusId=${b.id}`;await e.default.patch(d,{},{headers:{"Content-Type":"application/json",Authorization:c?`Bearer ${c}`:""}}),D(null)}catch(a){console.error("Failed to update status:",a),alert("Failed to update status on server. Refreshing tasks."),await J(),D(null)}},Q=a=>{if(!a&&0!==a)return"--";let b=Math.floor((a||0)/60),c=(a||0)%60;return b&&c?`${b}h ${c}m`:b?`${b}h`:`${c}m`};return(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Tasks"}),(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsx)("button",{onClick:()=>{G({...E,projectId:a}),r(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded shadow-sm hover:bg-blue-700",children:"+ Add Task"})}),(0,b.jsx)("div",{className:"flex items-center gap-3",children:(0,b.jsx)("input",{type:"search",placeholder:"Search",onChange:a=>{let b=a.target.value.toLowerCase();b?j(a=>a.filter(a=>(a.title||"").toLowerCase().includes(b)||(a.projectName||"").toLowerCase().includes(b))):J()},className:"border px-3 py-2 rounded-md text-sm"})})]}),k?(0,b.jsx)("div",{className:"py-6 text-center text-gray-500",children:"Loading tasks..."}):m?(0,b.jsx)("div",{className:"py-6 text-center text-red-500",children:m}):(0,b.jsxs)("div",{className:"overflow-x-auto",children:[(0,b.jsxs)("table",{className:"min-w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-blue-50 text-left text-gray-600",children:[(0,b.jsx)("th",{className:"px-4 py-3",children:"Code"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Task"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Completed On"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Start Date"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Due Date"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Hours Logged"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Estimated Time"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Milestones"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Assigned to"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Status"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Action"})]})}),(0,b.jsx)("tbody",{children:0===d.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:11,className:"py-6 text-center text-gray-500",children:"No tasks found"})}):d.map(a=>{let c=a.dueDate&&!a.noDueDate&&new Date(a.dueDate)<new Date,d=(a=>{if(a.taskStage&&a.taskStage.name)return a.taskStage;if(a.taskStageId){let b=o.find(b=>b.id===a.taskStageId);if(b)return b}return(a=>{if(o&&o.length)return o.find(b=>String(b.name).toLowerCase().includes(String(a).toLowerCase()))})(String(a.taskStage?.name||""))??{id:a.taskStageId??0,name:a.taskStage?.name??"Doing"}})(a),e=d?.name??"Doing";return(0,b.jsxs)("tr",{className:"border-b last:border-b-0 bg-white hover:bg-gray-50",children:[(0,b.jsxs)("td",{className:"px-4 py-4 align-top",children:["RTA-",String(a.id).padStart(2,"0")]}),(0,b.jsxs)("td",{className:"px-4 py-4 align-top",children:[(0,b.jsx)("div",{className:"font-medium",children:a.title}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:a.projectName??`Project ${a.projectId}`})]}),(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:"--"}),(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:a.startDate?new Date(a.startDate).toLocaleDateString():"--"}),(0,b.jsx)("td",{className:`px-4 py-4 align-top ${c?"text-red-600":""}`,children:a.noDueDate?"--":a.dueDate?new Date(a.dueDate).toLocaleDateString():"--"}),(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:Q(a.hoursLoggedMinutes??null)}),(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:Q(a.timeEstimateMinutes??null)}),(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:a.milestone?.title??"--"}),(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:(0,b.jsx)("div",{className:"flex -space-x-2",children:(a.assignedEmployees||[]).slice(0,3).map(a=>(0,b.jsx)("div",{className:"w-8 h-8 rounded-full border-2 border-white overflow-hidden bg-gray-100",children:a.profileUrl?(0,b.jsx)("img",{src:a.profileUrl,alt:a.name,className:"w-full h-full object-cover"}):(0,b.jsx)(f.UserIcon,{className:"w-full h-full text-gray-400 p-1"})},a.employeeId))})}),(0,b.jsx)("td",{className:"px-4 py-4 align-top relative",children:(0,b.jsxs)("div",{className:"relative inline-block",children:[(0,b.jsxs)("button",{onClick:b=>{b.stopPropagation(),B(null),D(b=>b===a.id?null:a.id)},className:"inline-flex items-center gap-2 px-3 py-1 rounded-full border text-xs bg-white hover:bg-gray-50",title:"Change status",children:[d&&d.labelColor?(0,b.jsx)("span",{style:{width:8,height:8,borderRadius:9999,display:"inline-block",background:`#${String(d.labelColor).replace(/[^0-9a-fA-F]/g,"").slice(0,6)}`}}):(0,b.jsx)("span",{className:`w-2 h-2 rounded-full ${O(d?.name??"Doing")}`}),(0,b.jsx)("span",{children:String(e)}),(0,b.jsx)("span",{className:"text-xs",children:"▾"})]}),C===a.id&&(0,b.jsx)("div",{onClick:a=>a.stopPropagation(),className:"absolute right-0 mt-2 z-30 w-44 bg-white border rounded-md shadow-lg text-sm",children:o.length>0?o.map(c=>(0,b.jsxs)("button",{onClick:()=>P(a,c),className:`w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center gap-2 ${c.id===d?.id?"font-medium":""}`,children:[c.labelColor?(0,b.jsx)("span",{style:{width:8,height:8,borderRadius:9999,background:`#${String(c.labelColor).replace(/[^0-9a-fA-F]/g,"").slice(0,6)}`}}):(0,b.jsx)("span",{className:`w-2 h-2 rounded-full ${O(c.name)}`}),(0,b.jsx)("span",{children:c.name})]},c.id)):["To Do","Doing","Completed","Incomplete","Waiting for Approval"].map(c=>(0,b.jsxs)("button",{onClick:()=>{P(a,{id:0,name:c})},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:[(0,b.jsx)("span",{className:`w-2 h-2 rounded-full ${O(c)}`})," ",(0,b.jsx)("span",{children:c})]},c))})]})}),(0,b.jsxs)("td",{className:"px-4 py-4 align-top relative",children:[(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),D(null),B(b=>b===a.id?null:a.id)},className:"p-1 rounded hover:bg-gray-100","aria-haspopup":"true","aria-expanded":A===a.id,title:"More",children:"⋮"}),A===a.id&&(0,b.jsxs)("div",{onClick:a=>a.stopPropagation(),className:"absolute right-2 top-10 z-20 w-48 bg-white border rounded-md shadow-md",children:[(0,b.jsx)("button",{onClick:()=>{z(a),x(!0),B(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"View"}),(0,b.jsx)("button",{onClick:()=>{v(a),G({title:a.title||"",category:a.categoryId?.id?String(a.categoryId.id):"",startDate:a.startDate?a.startDate:"",dueDate:a.dueDate?a.dueDate:"",noDueDate:!!a.noDueDate,taskStageId:a.taskStageId?String(a.taskStageId):"",assignedEmployeeIds:a.assignedEmployeeIds||[],description:a.description||"",labelIds:(a.labels||[]).map(a=>String(a.id)),milestoneId:a.milestoneId?String(a.milestoneId):"",priority:a.priority||"LOW",isPrivate:!!a.isPrivate,timeEstimateMinutes:a.timeEstimateMinutes?String(a.timeEstimateMinutes):"",isDependent:!!a.isDependent,projectId:a.projectId,taskFile:null}),t(!0),B(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Edit"}),(0,b.jsx)("button",{onClick:()=>{B(null),N(a.id)},className:"w-full text-left px-4 py-2 text-red-600 hover:bg-gray-50",children:"Delete"})]})]})]},a.id)})})]}),(0,b.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between text-sm text-gray-600 rounded-b-md mt-4",children:[(0,b.jsxs)("div",{children:["Result per page - ",d.length?d.length:0]}),(0,b.jsx)("div",{children:"Page 1 of 1"})]})]}),q&&(0,b.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4",children:(0,b.jsxs)("form",{onSubmit:L,className:"bg-white w-full max-w-3xl rounded-lg p-6 shadow-lg overflow-auto max-h-[90vh]",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Add Task"}),(0,b.jsx)("button",{type:"button",onClick:()=>r(!1),className:"text-gray-500",children:"Close"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Title"}),(0,b.jsx)("input",{required:!0,value:F.title,onChange:a=>K({title:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Category (id)"}),(0,b.jsx)("input",{value:F.category,onChange:a=>K({category:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Start Date"}),(0,b.jsx)("input",{type:"date",value:F.startDate,onChange:a=>K({startDate:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Due Date"}),(0,b.jsx)("input",{type:"date",value:F.dueDate,onChange:a=>K({dueDate:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:F.noDueDate,onChange:a=>K({noDueDate:a.target.checked})}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"No Due Date"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Task Stage ID"}),(0,b.jsx)("input",{value:F.taskStageId,onChange:a=>K({taskStageId:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col md:col-span-2",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Description"}),(0,b.jsx)("textarea",{value:F.description,onChange:a=>K({description:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Assigned Employee IDs (comma separated)"}),(0,b.jsx)("input",{value:F.assignedEmployeeIds.join(","),onChange:a=>K({assignedEmployeeIds:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Label IDs (comma separated)"}),(0,b.jsx)("input",{value:F.labelIds.join(","),onChange:a=>K({labelIds:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Milestone ID"}),(0,b.jsx)("input",{value:F.milestoneId,onChange:a=>K({milestoneId:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Priority"}),(0,b.jsxs)("select",{value:F.priority,onChange:a=>K({priority:a.target.value}),className:"border px-3 py-2 rounded",children:[(0,b.jsx)("option",{value:"LOW",children:"LOW"}),(0,b.jsx)("option",{value:"MEDIUM",children:"MEDIUM"}),(0,b.jsx)("option",{value:"HIGH",children:"HIGH"}),(0,b.jsx)("option",{value:"URGENT",children:"URGENT"})]})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Time Estimate (minutes)"}),(0,b.jsx)("input",{type:"number",value:F.timeEstimateMinutes,onChange:a=>K({timeEstimateMinutes:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:F.isPrivate,onChange:a=>K({isPrivate:a.target.checked})}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Private"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:F.isDependent,onChange:a=>K({isDependent:a.target.checked})}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Is Dependent"})]}),(0,b.jsxs)("label",{className:"flex flex-col md:col-span-2",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Attach file (optional)"}),(0,b.jsx)("input",{type:"file",onChange:a=>K({taskFile:a.target.files?.[0]||null})})]})]}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>r(!1),className:"px-4 py-2 rounded border",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-600 text-white",children:"Save"})]})]})}),s&&u&&(0,b.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4",children:(0,b.jsxs)("form",{onSubmit:M,className:"bg-white w-full max-w-3xl rounded-lg p-6 shadow-lg overflow-auto max-h-[90vh]",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Edit Task"}),(0,b.jsx)("button",{type:"button",onClick:()=>{t(!1),v(null)},className:"text-gray-500",children:"Close"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Title"}),(0,b.jsx)("input",{required:!0,value:F.title,onChange:a=>K({title:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Category (id)"}),(0,b.jsx)("input",{value:F.category,onChange:a=>K({category:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col md:col-span-2",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Description"}),(0,b.jsx)("textarea",{value:F.description,onChange:a=>K({description:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Assigned Employee IDs (comma separated)"}),(0,b.jsx)("input",{value:F.assignedEmployeeIds.join(","),onChange:a=>K({assignedEmployeeIds:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Label IDs (comma separated)"}),(0,b.jsx)("input",{value:F.labelIds.join(","),onChange:a=>K({labelIds:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Priority"}),(0,b.jsxs)("select",{value:F.priority,onChange:a=>K({priority:a.target.value}),className:"border px-3 py-2 rounded",children:[(0,b.jsx)("option",{value:"LOW",children:"LOW"}),(0,b.jsx)("option",{value:"MEDIUM",children:"MEDIUM"}),(0,b.jsx)("option",{value:"HIGH",children:"HIGH"}),(0,b.jsx)("option",{value:"URGENT",children:"URGENT"})]})]}),(0,b.jsxs)("label",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Time Estimate (minutes)"}),(0,b.jsx)("input",{type:"number",value:F.timeEstimateMinutes,onChange:a=>K({timeEstimateMinutes:a.target.value}),className:"border px-3 py-2 rounded"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:F.isPrivate,onChange:a=>K({isPrivate:a.target.checked})}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Private"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:F.isDependent,onChange:a=>K({isDependent:a.target.checked})}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Is Dependent"})]}),(0,b.jsxs)("label",{className:"flex flex-col md:col-span-2",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Attach file (optional)"}),(0,b.jsx)("input",{type:"file",onChange:a=>K({taskFile:a.target.files?.[0]||null})})]})]}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>{t(!1),v(null)},className:"px-4 py-2 rounded border",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-600 text-white",children:"Update"})]})]})}),(0,b.jsx)(h.default,{open:w,task:y,onClose:()=>{x(!1),z(null)}})]})}let k="https://6jnqmj85-80.inc1.devtunnels.ms",l=e.default.create({baseURL:k||"/",timeout:15e3});function m({projectId:a}){let[d,e]=(0,c.useState)(null),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!1),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(null),w=async()=>{try{j(!0),n(null);let b=`${k}/api/projects/${a}`,c=await l.get(b);e(c),h(c?.assignedEmployees??[])}catch(a){n(a.message),e(null),h([])}finally{j(!1)}};(0,c.useEffect)(()=>{w()},[a]);let x=async()=>{let b=q.trim();if(!b)return alert("Enter employee IDs");let c=b.split(",").map(a=>a.trim());try{j(!0),n(null);let b=`${k}/api/projects/${a}/assign`;await l.post(b,{employeeIds:c}),p(!1),r(""),w()}catch(a){n(a.message)}finally{j(!1)}},y=async b=>{if(confirm(`Remove ${b}   from project?`))try{v(b),n(null);let c=`${k}/api/projects/${a}/assign/${b}`;await l.delete(c),d?.projectAdminId===b&&await l.patch(`${k}/api/projects/${a}`,{projectAdminId:null}),w()}catch(a){n(a.message)}finally{v(null)}},z=async b=>{if(confirm(`Make ${b} Project Admin?`))try{v(b),n(null);let c=`${k}/projects/${a}/admin?userId=${b}`;await l.post(c),w()}catch(a){n(a.message)}finally{v(null)}},A=async()=>{if(confirm("Remove Project Admin?"))try{v("admin"),n(null);let b=`${k}/projects/${a}/admin`;await l.delete(b),w()}catch(a){n(a.message)}finally{v(null)}},B=g.filter(a=>{let b=s.toLowerCase();return a.name?.toLowerCase().includes(b)||a.employeeId.toLowerCase().includes(b)||a.designation?.toLowerCase().includes(b)});return(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Member"}),(0,b.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,b.jsx)("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"+ Add Project Members"}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("input",{type:"search",placeholder:"Search",className:"border px-3 py-2 rounded",value:s,onChange:a=>t(a.target.value)}),(0,b.jsx)("button",{onClick:w,className:"bg-gray-100 px-3 py-2 rounded",children:"Refresh"})]})]}),i&&(0,b.jsx)("div",{className:"text-center py-5",children:"Loading…"}),m&&(0,b.jsx)("div",{className:"p-3 bg-red-50 text-red-600 rounded mb-3",children:m}),!i&&(0,b.jsxs)("table",{className:"min-w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-blue-50",children:[(0,b.jsx)("th",{className:"px-4 py-3",children:"Name"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"User Role"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Action"})]})}),(0,b.jsxs)("tbody",{children:[B.map(a=>(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsxs)("td",{className:"px-4 py-4 flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden",children:a.profileUrl?(0,b.jsx)("img",{src:a.profileUrl,className:"w-full h-full object-cover"}):(0,b.jsx)(f.UserIcon,{className:"w-6 h-6 text-gray-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.designation??a.department})]})]}),(0,b.jsxs)("td",{className:"px-4 py-4",children:[(0,b.jsx)("input",{type:"radio",checked:d?.projectAdminId===a.employeeId,onChange:()=>z(a.employeeId)}),(0,b.jsx)("span",{className:"ml-1",children:"Project Admin"}),d?.projectAdminId===a.employeeId&&(0,b.jsx)("button",{onClick:()=>A(),disabled:u,className:"ml-3 px-3 py-1 border rounded text-sm bg-white",children:u?"Removing...":"Remove Admin"})]}),(0,b.jsx)("td",{className:"px-4 py-4",children:(0,b.jsx)("button",{onClick:()=>y(a.employeeId),disabled:u===a.employeeId,className:"text-red-600",children:u===a.employeeId?"Removing…":"Delete"})})]},a.employeeId)),0===B.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:3,className:"py-6 text-center text-gray-500",children:"No members found"})})]})]}),o&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white p-6 rounded w-full max-w-md",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Add Project Members"}),(0,b.jsx)("input",{className:"border px-3 py-2 w-full rounded",placeholder:"EMP-015, EMP-010",value:q,onChange:a=>r(a.target.value)}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Example: EMP-015, EMP-010"}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,b.jsx)("button",{className:"px-4 py-2 border rounded",onClick:()=>p(!1),children:"Cancel"}),(0,b.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:x,children:"Add"})]})]})})]})}l.interceptors.request.use(a=>{let b=localStorage.getItem("accessToken");return b&&(a.headers.Authorization=`Bearer ${b}`),a}),l.interceptors.response.use(a=>a.data,a=>Promise.reject(Error(a?.response?.data?.message||a?.response?.statusText||a.message||"Request failed")));var n=a.i(89329);function o({gatewayPath:a="/timesheets",mainBase:d,authToken:e=null}){let g=(d||"https://6jnqmj85-80.inc1.devtunnels.ms").replace(/\/$/,""),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),[o,p]=(0,c.useState)(0),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)("All"),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)({projectId:"",taskId:"",employeeId:"",startDate:"",startTime:"",endDate:"",endTime:"",memo:""}),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(!1),M=a=>{let b=String(a||"");return b.startsWith("http://")||b.startsWith("https://")?b:b.startsWith("/")?`${g}${b}`:`${g}/${b}`},N=(a={})=>{let b={...a};return e&&(b.Authorization=`Bearer ${e}`),b},O=async(a,b={},c=15e3)=>{let d=new AbortController,e=setTimeout(()=>d.abort(),c);try{let c={...b,signal:d.signal},f=await fetch(a,c);clearTimeout(e);let g=f.headers.get("content-type")||"",h=await f.text().catch(()=>"");if(!f.ok){if(g.includes("application/json"))try{let a=JSON.parse(h||"{}"),b=a?.message||JSON.stringify(a);throw Error(`HTTP ${f.status} ${f.statusText} — ${b}`)}catch{throw Error(`HTTP ${f.status} ${f.statusText} — ${h.slice(0,300)}`)}if(g.includes("text/html")||h.trim().startsWith("<!DOCTYPE html"))throw Error(`HTTP ${f.status} ${f.statusText} — server returned HTML (likely auth).`);throw Error(`HTTP ${f.status} ${f.statusText} ${h?"- "+h.slice(0,300):""}`)}if(g.includes("application/json"))return JSON.parse(h||"[]");return h}catch(a){if("AbortError"===a.name)throw Error("Request timed out");if("Failed to fetch"===a.message)throw Error("Network Error - check CORS / server availability");throw a}finally{clearTimeout(e)}},P=async()=>{k(!0),m(null);try{let b=M(a),c=await O(b,{method:"GET",headers:N({"Content-Type":"application/json"}),credentials:"same-origin"});Array.isArray(c)?i(c):c?.data&&Array.isArray(c.data)?i(c.data):(console.warn("Unexpected timesheets response:",c),i([]),m("Unexpected response shape from server. See console."))}catch(a){console.error("fetchTimesheets error:",a),i([]),m(a?.message||"Failed to load timesheets")}finally{k(!1)}};(0,c.useEffect)(()=>{P()},[o]);let Q=(0,c.useMemo)(()=>{let a=new Map;return h.forEach(b=>{let c=b.employees&&b.employees[0];c&&c.employeeId?a.set(c.employeeId,c):b.employeeId&&a.set(b.employeeId,{employeeId:b.employeeId})}),Array.from(a.values())},[h]),R=h.filter(a=>{if("All"!==s&&a.employeeId!==s)return!1;if(!q)return!0;let b=q.toLowerCase(),c=a.employees&&a.employees[0];return String(a.employeeId||"").toLowerCase().includes(b)||String(a.projectId||"").toLowerCase().includes(b)||String(a.taskId||"").toLowerCase().includes(b)||String(a.memo||"").toLowerCase().includes(b)||String(c?.name||"").toLowerCase().includes(b)}),S=a=>a<10?`0${a}`:`${a}`,T=(a,b)=>((a,b)=>{if(!a)return"-";try{let[c,d,e]=a.split("-").map(Number),f=0,g=0;if(b){let a=b.split(":").map(Number);f=a[0]??0,g=a[1]??0}let h=new Date(c,d-1,e,f,g),i=S(h.getDate()),j=S(h.getMonth()+1),k=h.getFullYear(),l=h.getHours(),m=S(h.getMinutes()),n=l>=12?"PM":"AM";l=l%12||12;let o=S(l);return`${i}/${j}/${k} ${o}:${m} ${n}`}catch{return a+(b?` ${b}`:"")}})(a,b),U=(a,b,c,d)=>{if(!a||!c)return 0;try{let e=a.split("-").map(Number),f=c.split("-").map(Number),g=0,h=0,i=0,j=0;b&&([g,h]=b.split(":").map(a=>Number(a))),d&&([i,j]=d.split(":").map(a=>Number(a)));let k=new Date(e[0],e[1]-1,e[2],g,h),l=new Date(f[0],f[1]-1,f[2],i,j).getTime()-k.getTime();if(isNaN(l)||l<=0)return 0;return Math.round(l/36e5)}catch{return 0}},V=U(C.startDate,C.startTime,C.endDate,C.endTime),W=a=>{a?(B(a.id),D({projectId:String(a.projectId??""),taskId:String(a.taskId??""),employeeId:a.employeeId??"",startDate:a.startDate??"",startTime:a.startTime??"",endDate:a.endDate??"",endTime:a.endTime??"",memo:a.memo??""})):(B(null),D({projectId:"",taskId:"",employeeId:"",startDate:"",startTime:"",endDate:"",endTime:"",memo:""})),z(null),v(!0)},X=async()=>{if(I){x(!0),z(null);try{let b=M(`${a}/${I.id}`);await O(b,{method:"DELETE",headers:N({"Content-Type":"application/json"}),credentials:"same-origin"}),L(!1),J(null),p(a=>a+1)}catch(a){console.error("deleteTimesheet error:",a),z(a?.message||"Failed to delete timesheet")}finally{x(!1)}}},Y=async()=>{x(!0),z(null);try{if(!C.projectId||!C.taskId||!C.employeeId||!C.startDate||!C.startTime||!C.endDate||!C.endTime||!C.memo){z("Please fill all required fields."),x(!1);return}let b={projectId:Number(C.projectId),taskId:Number(C.taskId),employeeId:C.employeeId,startDate:C.startDate,startTime:C.startTime,endDate:C.endDate,endTime:C.endTime,memo:C.memo,durationHours:U(C.startDate,C.startTime,C.endDate,C.endTime)},c=M(a)+(A?`/${A}`:"");await O(c,{method:A?"PUT":"POST",headers:N({"Content-Type":"application/json"}),credentials:"same-origin",body:JSON.stringify(b)}),v(!1),p(a=>a+1)}catch(a){console.error("saveEntry error:",a),z(a?.message||"Failed to save entry")}finally{x(!1)}};return(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Timesheet"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("label",{className:"text-sm",children:"Employee"}),(0,b.jsxs)("select",{value:s,onChange:a=>t(a.target.value),className:"border rounded px-3 py-2 text-sm",children:[(0,b.jsx)("option",{value:"All",children:"All"}),Q.map(a=>(0,b.jsx)("option",{value:a.employeeId,children:a.name?`${a.name} (${a.employeeId})`:a.employeeId},a.employeeId))]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("div",{children:(0,b.jsx)("button",{onClick:()=>W(),className:"bg-blue-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-blue-700",children:"+ Log Time"})}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{onClick:()=>p(a=>a+1),className:"bg-gray-100 px-3 py-2 rounded text-sm border hover:bg-gray-200",children:"Refresh"}),(0,b.jsx)("input",{type:"search",placeholder:"Search employee, memo, project...",value:q,onChange:a=>r(a.target.value),className:"border px-3 py-2 rounded-md text-sm"})]})]}),j?(0,b.jsx)("div",{className:"py-6 text-center text-gray-500",children:"Loading timesheets..."}):(0,b.jsxs)(b.Fragment,{children:[l&&(0,b.jsxs)("div",{className:"mb-4 p-3 rounded bg-red-50 text-red-700",children:[(0,b.jsx)("strong",{children:"Error:"})," ",l]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-blue-50 text-left text-gray-600",children:[(0,b.jsx)("th",{className:"px-4 py-3",children:"Code"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Task"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Employee"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Start Time"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"End Time"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Total Hours"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Action"})]})}),(0,b.jsx)("tbody",{children:0===R.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:7,className:"py-6 text-center text-gray-500",children:"No timesheets found"})}):R.map(a=>{let c=a.employees&&a.employees[0],d=`RTA-${String(a.id).padStart(2,"0")}`,e=`Task ${a.taskId??"-"} \xb7 Project ${a.projectId??"-"}`;return(0,b.jsxs)("tr",{className:"border-b last:border-b-0 bg-white hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:d}),(0,b.jsxs)("td",{className:"px-4 py-4 align-top",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:e}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:a.memo??""})]}),(0,b.jsxs)("td",{className:"px-4 py-4 align-top flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:c?.profileUrl?(0,b.jsx)("img",{src:c.profileUrl,alt:c?.name??"",className:"w-full h-full object-cover"}):(0,b.jsx)(f.UserIcon,{className:"w-6 h-6 text-gray-400 p-1"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:c?.name||a.employeeId}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:c?.designation||c?.department||a.employeeId})]})]}),(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:T(a.startDate,a.startTime)}),(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:T(a.endDate,a.endTime)}),(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:"number"==typeof a.durationHours?`${a.durationHours}h`:"-"}),(0,b.jsx)("td",{className:"px-4 py-4 align-top",children:(0,b.jsxs)("div",{className:"relative inline-block text-left",children:[(0,b.jsx)("button",{onClick:()=>F(E===a.id?null:a.id),className:"px-2 py-1 border rounded text-sm","aria-haspopup":"true","aria-expanded":E===a.id,title:"More",children:"⋮"}),E===a.id&&(0,b.jsxs)("div",{className:"absolute right-0 mt-2 z-30 w-40 bg-white border rounded-md shadow-lg text-sm",children:[(0,b.jsx)("button",{onClick:()=>{J(a),H(!0),F(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"View"}),(0,b.jsx)("button",{onClick:()=>{W(a),F(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Edit"}),(0,b.jsx)("button",{onClick:()=>{J(a),L(!0),F(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50 text-red-600",children:"Delete"})]})]})})]},a.id)})})]})})]}),u&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>v(!1)}),(0,b.jsxs)("div",{className:"relative bg-white w-full max-w-4xl rounded-xl shadow-xl overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:A?"Edit TimeLog":"Log Time"}),(0,b.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>v(!1),"aria-label":"Close",children:(0,b.jsx)(n.XMarkIcon,{className:"w-6 h-6 text-gray-500"})})]}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-md border p-6",children:[(0,b.jsx)("h4",{className:"text-md font-medium mb-4",children:"TimeLog Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Project *"}),(0,b.jsx)("input",{value:C.projectId,onChange:a=>D(b=>({...b,projectId:a.target.value})),className:"w-full border rounded px-3 py-2",placeholder:"Project ID",type:"text"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Task *"}),(0,b.jsx)("input",{value:C.taskId,onChange:a=>D(b=>({...b,taskId:a.target.value})),className:"w-full border rounded px-3 py-2",placeholder:"Task ID",type:"text"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Employee *"}),(0,b.jsxs)("select",{value:C.employeeId,onChange:a=>D(b=>({...b,employeeId:a.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,b.jsx)("option",{value:"",children:"--"}),Q.map(a=>(0,b.jsx)("option",{value:a.employeeId,children:a.name?`${a.name} (${a.employeeId})`:a.employeeId},a.employeeId))]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Date *"}),(0,b.jsx)("input",{type:"date",value:C.startDate,onChange:a=>D(b=>({...b,startDate:a.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Time *"}),(0,b.jsx)("input",{type:"time",value:C.startTime,onChange:a=>D(b=>({...b,startTime:a.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Date *"}),(0,b.jsx)("input",{type:"date",value:C.endDate,onChange:a=>D(b=>({...b,endDate:a.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Time *"}),(0,b.jsx)("input",{type:"time",value:C.endTime,onChange:a=>D(b=>({...b,endTime:a.target.value})),className:"w-full border rounded px-3 py-2"})]})]}),(0,b.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4 items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Memo *"}),(0,b.jsx)("input",{type:"text",value:C.memo,onChange:a=>D(b=>({...b,memo:a.target.value})),className:"w-full border rounded px-3 py-2",placeholder:"Memo"})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"Total Hours"}),(0,b.jsxs)("div",{className:"text-2xl font-semibold text-blue-600",children:[V,"h"]})]})]}),y&&(0,b.jsx)("div",{className:"mt-4 text-sm text-red-600",children:y})]}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-8 pb-6",children:[(0,b.jsx)("button",{onClick:()=>v(!1),className:"px-6 py-2 rounded-md border text-blue-600",disabled:w,children:"Cancel"}),(0,b.jsx)("button",{onClick:Y,className:"px-6 py-2 rounded-md bg-blue-600 text-white shadow",disabled:w,children:w?"Saving...":A?"Update":"Save"})]})]})]})]}),G&&I&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-8 px-6",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>H(!1)}),(0,b.jsxs)("div",{className:"relative bg-white w-full max-w-6xl rounded-xl shadow-xl overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,b.jsx)("h3",{className:"text-xl font-semibold",children:"Timesheet"}),(0,b.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>H(!1),"aria-label":"Close",children:(0,b.jsx)(n.XMarkIcon,{className:"w-6 h-6 text-gray-500"})})]}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 relative bg-white rounded-xl border p-6",children:[(0,b.jsx)("div",{className:"absolute top-4 right-4 text-gray-500",children:"⋮"}),(0,b.jsx)("h4",{className:"text-lg font-medium mb-4",children:"TimeLog Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-y-4 gap-x-6 items-center text-sm",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Start Time"}),(0,b.jsx)("div",{className:"col-span-2",children:T(I.startDate,I.startTime)}),(0,b.jsx)("div",{className:"text-gray-500",children:"End Time"}),(0,b.jsx)("div",{className:"col-span-2",children:T(I.endDate,I.endTime)}),(0,b.jsx)("div",{className:"text-gray-500",children:"Total Hours"}),(0,b.jsx)("div",{className:"col-span-2",children:"number"==typeof I.durationHours?`${I.durationHours}h`:"-"}),(0,b.jsx)("div",{className:"text-gray-500",children:"Memo"}),(0,b.jsx)("div",{className:"col-span-2",children:I.memo??"-"}),(0,b.jsx)("div",{className:"text-gray-500",children:"Project"}),(0,b.jsxs)("div",{className:"col-span-2",children:["Project ",I.projectId??"-"]}),(0,b.jsx)("div",{className:"text-gray-500",children:"Task"}),(0,b.jsxs)("div",{className:"col-span-2",children:["Task ",I.taskId??"-"]}),(0,b.jsx)("div",{className:"text-gray-500",children:"Employee"}),(0,b.jsxs)("div",{className:"col-span-2 flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:I.employees&&I.employees[0]?.profileUrl?(0,b.jsx)("img",{src:I.employees[0].profileUrl,alt:I.employees[0].name??"",className:"w-full h-full object-cover"}):(0,b.jsx)(f.UserIcon,{className:"w-6 h-6 text-gray-400 p-1"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:I.employees&&I.employees[0]?.name?I.employees[0].name:I.employeeId}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:I.employees&&I.employees[0]?.designation?I.employees[0].designation:""})]})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl border p-5",children:[(0,b.jsx)("h5",{className:"font-medium mb-3",children:"History"}),(0,b.jsxs)("div",{className:"space-y-4 text-sm text-gray-700",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Start Time"}),(0,b.jsx)("div",{children:T(I.startDate,I.startTime)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Task"}),(0,b.jsxs)("div",{children:["Task ",I.taskId??"-"]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"End Time"}),(0,b.jsx)("div",{children:T(I.endDate,I.endTime)})]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-8 pb-6",children:[(0,b.jsx)("button",{onClick:()=>H(!1),className:"px-6 py-2 rounded-md border text-blue-600",children:"Close"}),(0,b.jsx)("button",{onClick:()=>{W(I),H(!1)},className:"px-6 py-2 rounded-md bg-blue-600 text-white",children:"Edit"})]})]})]})]}),K&&I&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>L(!1)}),(0,b.jsx)("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl overflow-hidden",children:(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Delete TimeLog"}),(0,b.jsxs)("p",{className:"text-sm text-gray-700",children:["Are you sure you want to delete timesheet ",(0,b.jsxs)("strong",{children:["RTA-",String(I.id).padStart(2,"0")]}),"? This action cannot be undone."]}),y&&(0,b.jsx)("div",{className:"mt-4 text-sm text-red-600",children:y}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-4 mt-6",children:[(0,b.jsx)("button",{className:"px-4 py-2 rounded border",onClick:()=>L(!1),disabled:w,children:"Cancel"}),(0,b.jsx)("button",{className:"px-4 py-2 rounded bg-red-600 text-white",onClick:X,disabled:w,children:w?"Deleting...":"Delete"})]})]})})]})]})}function p({projectId:a,gatewayPath:d="/api/projects",authToken:e=null,mainBase:f}){let g=(f||"https://6jnqmj85-80.inc1.devtunnels.ms").replace(/\/$/,""),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),[o,p]=(0,c.useState)(0),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)({title:"",milestoneCost:"",status:"INCOMPLETE",summary:"",startDate:"",endDate:""}),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(null),K=a=>{let b=String(a||"");return b.startsWith("http://")||b.startsWith("https://")?b:b.startsWith("/")?`${g}${b}`:`${g}/${b}`},L=(a={})=>{let b={...a};return e&&(b.Authorization=`Bearer ${e}`),b},M=async(a,b={},c=15e3)=>{let d=new AbortController,e=setTimeout(()=>d.abort(),c);try{let c={...b,signal:d.signal},f=await fetch(a,c);clearTimeout(e);let g=f.headers.get("content-type")||"",h=await f.text().catch(()=>"");if(!f.ok){if(g.includes("text/html")||h.trim().startsWith("<!DOCTYPE html"))throw Error(`HTTP ${f.status} ${f.statusText} — server returned HTML. Snippet: ${h.slice(0,300)}`);if(g.includes("application/json"))try{let a=JSON.parse(h||"{}");throw Error(`HTTP ${f.status} ${f.statusText} — ${JSON.stringify(a)}`)}catch{}throw Error(`HTTP ${f.status} ${f.statusText} ${h?"- "+h.slice(0,300):""}`)}if(g.includes("application/json"))return JSON.parse(h||"[]");return h}catch(a){if("AbortError"===a.name)throw Error("Request timed out");if("Failed to fetch"===a.message)throw Error("Network Error - check CORS / server availability");throw a}finally{clearTimeout(e)}},N=(0,c.useMemo)(()=>{if(null==a)return null;let b=String(a).trim();if(/{{\s*projectId\s*}}/.test(b))return"__INVALID_PLACEHOLDER__";let c=Number(b);return Number.isNaN(c)?"__INVALID_NUMBER__":c},[a]),O=async()=>{k(!0),m(null);try{if(null===N){m("projectId is required."),i([]),k(!1);return}if("__INVALID_PLACEHOLDER__"===N){m('projectId looks like a template placeholder ("{{projectId}}"). Pass a real numeric id.'),i([]),k(!1);return}if("__INVALID_NUMBER__"===N){m(`projectId "${a}" is not a valid number.`),i([]),k(!1);return}let b=K(`${d}/${N}/milestones`);console.info("[milestones] GET",b,"AuthPresent:",!!e);let c=await M(b,{method:"GET",headers:L({"Content-Type":"application/json"}),credentials:"same-origin"});Array.isArray(c)?i(c):c?.data&&Array.isArray(c.data)?i(c.data):c?.milestones&&Array.isArray(c.milestones)?i(c.milestones):(console.warn("Unexpected milestones response:",c),i([]),m("Unexpected response shape from server. See console."))}catch(a){console.error("fetchMilestones error:",a),i([]),m(a?.message||"Failed to load milestones")}finally{k(!1)}};(0,c.useEffect)(()=>{O()},[a,o]);let P=a=>"number"!=typeof a?"-":`$${a.toFixed(2)}`,Q=async()=>{B(!0),D(null);try{if(!E.title?.trim()){D("Title is required."),B(!1);return}if("number"!=typeof N){D("Invalid projectId."),B(!1);return}let a={title:E.title.trim(),milestoneCost:Number(E.milestoneCost||0),status:(E.status||"INCOMPLETE").toUpperCase(),summary:E.summary?.trim()||"",startDate:E.startDate?new Date(E.startDate).toISOString():null,endDate:E.endDate?new Date(E.endDate).toISOString():null},b=K(`${d}/${N}/milestones`);await M(b,{method:"POST",headers:L({"Content-Type":"application/json"}),credentials:"same-origin",body:JSON.stringify(a)}),r(!1),F({title:"",milestoneCost:"",status:"INCOMPLETE",summary:"",startDate:"",endDate:""}),p(a=>a+1)}catch(a){console.error("createMilestone error:",a),D(a?.message||"Failed to create milestone")}finally{B(!1)}},R=async()=>{B(!0),D(null);try{if(!y?.id){D("No milestone selected for update."),B(!1);return}if(!E.title?.trim()){D("Title is required."),B(!1);return}let a={title:E.title.trim(),milestoneCost:Number(E.milestoneCost||0),status:(E.status||"INCOMPLETE").toUpperCase(),summary:E.summary?.trim()||"",startDate:E.startDate?new Date(E.startDate).toISOString():null,endDate:E.endDate?new Date(E.endDate).toISOString():null},b=K(`${d}/${N}/milestones/${y.id}`);await M(b,{method:"PUT",headers:L({"Content-Type":"application/json"}),credentials:"same-origin",body:JSON.stringify(a)}),v(!1),z(null),p(a=>a+1)}catch(a){console.error("updateMilestone error:",a),D(a?.message||"Failed to update milestone")}finally{B(!1)}},S=async()=>{B(!0),D(null);try{if(!y?.id){D("No milestone selected for delete."),B(!1);return}let a=K(`${d}/${N}/milestones/${y.id}`);await M(a,{method:"DELETE",headers:L({"Content-Type":"application/json"}),credentials:"same-origin"}),x(!1),z(null),p(a=>a+1)}catch(a){console.error("deleteMilestone error:",a),D(a?.message||"Failed to delete milestone")}finally{B(!1)}},T=async(a,b)=>{B(!0),D(null);try{if(!a?.id){D("Invalid milestone"),B(!1);return}let c=K(`${d}/${N}/milestones/${a.id}/status`),e=new FormData;e.append("status",String(b).toUpperCase()),await M(c,{method:"PATCH",headers:L(),credentials:"same-origin",body:e}),J(null),H(null),p(a=>a+1)}catch(a){console.error("changeStatus error:",a),D(a?.message||"Failed to change status")}finally{B(!1)}},U=a=>{let b=String(a||"").toLowerCase();return"complete"===b||"completed"===b};return(0,b.jsxs)("div",{className:"p-6 bg-white rounded shadow-sm border border-gray-200",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Milestones"}),(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("div",{children:(0,b.jsx)("button",{onClick:()=>{F({title:"",milestoneCost:"",status:"INCOMPLETE",summary:"",startDate:"",endDate:""}),D(null),r(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"+ Create Milestone"})}),(0,b.jsx)("div",{className:"flex items-center gap-3",children:(0,b.jsx)("button",{onClick:()=>p(a=>a+1),className:"bg-gray-100 px-3 py-2 rounded text-sm border hover:bg-gray-200",title:"Refresh",children:"Refresh"})})]}),(0,b.jsxs)("div",{className:"rounded-md border overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-blue-50 text-gray-700 text-sm",children:(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-0 items-center px-4 py-3",children:[(0,b.jsx)("div",{className:"col-span-4 font-medium",children:"Title"}),(0,b.jsx)("div",{className:"col-span-2 font-medium",children:"Milestone Cost"}),(0,b.jsx)("div",{className:"col-span-2 font-medium",children:"Task Count"}),(0,b.jsx)("div",{className:"col-span-2 font-medium",children:"Status"}),(0,b.jsx)("div",{className:"col-span-2 font-medium text-right",children:"Action"})]})}),j?(0,b.jsx)("div",{className:"p-6 text-center text-gray-500",children:"Loading milestones..."}):l?(0,b.jsx)("div",{className:"p-6 text-center text-red-600",children:l}):0===h.length?(0,b.jsx)("div",{className:"p-6 text-center text-gray-500",children:"No milestones found"}):(0,b.jsx)("div",{children:h.map(a=>(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-0 items-center px-4 py-4 border-t",children:[(0,b.jsx)("div",{className:"col-span-4 text-sm",children:a.title}),(0,b.jsx)("div",{className:"col-span-2 text-sm",children:P(a.milestoneCost)}),(0,b.jsx)("div",{className:"col-span-2 text-sm",children:String(a.taskCount??"00").padStart(2,"0")}),(0,b.jsx)("div",{className:"col-span-2 text-sm",children:(0,b.jsxs)("div",{className:"relative inline-block",children:[(0,b.jsxs)("button",{onClick:()=>J(I===a.id?null:a.id??null),className:`inline-flex items-center justify-between w-full gap-2 px-3 py-1 rounded-md border text-sm bg-white ${U(a.status)?"border-green-200":"border-gray-200"}`,title:"Change status","aria-haspopup":"true","aria-expanded":I===a.id,children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:`w-2 h-2 rounded-full ${(a=>{let b=String(a||"").toLowerCase();return"complete"===b||"completed"===b||"COMPLETED"===String(a)?"bg-green-600":"bg-red-600"})(a.status)}`}),(0,b.jsx)("span",{className:"uppercase",children:String(a.status||"INCOMPLETE").toUpperCase()})]}),(0,b.jsx)("svg",{className:"w-3 h-3 shrink-0 text-gray-500",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:(0,b.jsx)("path",{d:"M6 8l4 4 4-4",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})})]}),I===a.id&&(0,b.jsxs)("div",{className:"absolute mt-2 right-0 z-20 w-44 bg-white border rounded-md shadow-lg",children:[(0,b.jsxs)("button",{onClick:()=>T(a,"COMPLETED"),className:`w-full text-left px-4 py-2 hover:bg-gray-50 text-sm flex items-center justify-between ${U(a.status)?"font-semibold":""}`,children:[(0,b.jsx)("span",{children:"COMPLETED"}),U(a.status)&&(0,b.jsx)("svg",{className:"w-4 h-4 text-green-600",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,b.jsx)("path",{d:"M5 10l3 3 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),(0,b.jsxs)("button",{onClick:()=>T(a,"INCOMPLETE"),className:`w-full text-left px-4 py-2 hover:bg-gray-50 text-sm flex items-center justify-between ${!U(a.status)?"font-semibold":""}`,children:[(0,b.jsx)("span",{children:"INCOMPLETE"}),!U(a.status)&&(0,b.jsx)("svg",{className:"w-4 h-4 text-gray-600",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,b.jsx)("path",{d:"M5 10l3 3 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})]})}),(0,b.jsxs)("div",{className:"col-span-2 text-right relative",children:[(0,b.jsx)("button",{onClick:()=>H(G===a.id?null:a.id??null),className:"px-3 py-1 rounded text-sm border hover:bg-gray-50","aria-haspopup":"true","aria-expanded":G===a.id,title:"Actions",children:"⋮"}),G===a.id&&(0,b.jsxs)("div",{className:"absolute right-0 mt-2 z-30 w-44 bg-white border rounded-md shadow-lg text-sm",children:[(0,b.jsx)("button",{onClick:()=>{z(a),t(!0),H(null),H(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"View"}),(0,b.jsx)("button",{onClick:()=>{z(a),F({title:a.title||"",milestoneCost:String(a.milestoneCost??""),status:(a.status||"INCOMPLETE").toUpperCase(),summary:a.summary??"",startDate:a.startDate?String(a.startDate).slice(0,10):"",endDate:a.endDate?String(a.endDate).slice(0,10):""}),D(null),v(!0),H(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Edit"}),(0,b.jsx)("button",{onClick:()=>{z(a),x(!0),H(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50 text-red-600",children:"Delete"})]})]})]},a.id??Math.random()))}),(0,b.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between text-sm text-gray-600",children:[(0,b.jsxs)("div",{children:["Result per page - ",h.length?h.length:0]}),(0,b.jsx)("div",{children:"Page 1 of 1"})]})]}),q&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>r(!1)}),(0,b.jsxs)("div",{className:"relative bg-white w-full max-w-3xl rounded-lg shadow-xl overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Create Milestone"}),(0,b.jsx)("button",{onClick:()=>r(!1),className:"p-2 rounded hover:bg-gray-100",children:(0,b.jsx)(n.XMarkIcon,{className:"w-6 h-6 text-gray-500"})})]}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"md:col-span-1",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Title *"}),(0,b.jsx)("input",{type:"text",value:E.title,onChange:a=>F(b=>({...b,title:a.target.value})),className:"w-full border rounded px-3 py-2",placeholder:"Project Closure"})]}),(0,b.jsxs)("div",{className:"md:col-span-1",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Cost"}),(0,b.jsx)("input",{type:"number",value:E.milestoneCost,onChange:a=>F(b=>({...b,milestoneCost:a.target.value})),className:"w-full border rounded px-3 py-2",placeholder:"0.00",min:0})]}),(0,b.jsxs)("div",{className:"md:col-span-1",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Status"}),(0,b.jsxs)("select",{value:E.status,onChange:a=>F(b=>({...b,status:a.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,b.jsx)("option",{value:"INCOMPLETE",children:"INCOMPLETE"}),(0,b.jsx)("option",{value:"COMPLETED",children:"COMPLETED"})]})]}),(0,b.jsxs)("div",{className:"md:col-span-3",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Summary *"}),(0,b.jsx)("textarea",{value:E.summary,onChange:a=>F(b=>({...b,summary:a.target.value})),className:"w-full border rounded px-3 py-2 min-h-[100px]",placeholder:"Conduct a project review to evaluate overall success and lessons learned..."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Date"}),(0,b.jsx)("input",{type:"date",value:E.startDate,onChange:a=>F(b=>({...b,startDate:a.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Date"}),(0,b.jsx)("input",{type:"date",value:E.endDate,onChange:a=>F(b=>({...b,endDate:a.target.value})),className:"w-full border rounded px-3 py-2"})]})]}),C&&(0,b.jsx)("div",{className:"mt-4 text-sm text-red-600",children:C}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-6 pb-6",children:[(0,b.jsx)("button",{onClick:()=>r(!1),className:"px-6 py-2 rounded-md border text-blue-600",disabled:A,children:"Cancel"}),(0,b.jsx)("button",{onClick:Q,className:"px-6 py-2 rounded-md bg-blue-600 text-white",disabled:A,children:A?"Saving...":"Save"})]})]})]})]}),s&&y&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>t(!1)}),(0,b.jsxs)("div",{className:"relative bg-white w-full max-w-2xl rounded-lg shadow-xl overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Milestone Details"}),(0,b.jsx)("button",{onClick:()=>t(!1),className:"p-2 rounded hover:bg-gray-100",children:(0,b.jsx)(n.XMarkIcon,{className:"w-6 h-6 text-gray-500"})})]}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Title:"})," ",y.title]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Milestone Cost:"})," ",P(y.milestoneCost)]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Task Count:"})," ",y.taskCount??0]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Status:"})," ",String(y.status??"INCOMPLETE").toUpperCase()]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Summary:"}),(0,b.jsx)("div",{className:"mt-1 p-2 bg-gray-50 rounded text-sm",children:y.summary??"-"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Start Date:"})," ",y.startDate?new Date(y.startDate).toLocaleDateString():"-"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"End Date:"})," ",y.endDate?new Date(y.endDate).toLocaleDateString():"-"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Created At:"})," ",y.createdAt?new Date(y.createdAt).toLocaleString():"-"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Raw:"})," ",(0,b.jsx)("pre",{className:"text-xs bg-gray-50 p-2 rounded",children:JSON.stringify(y,null,2)})]})]}),(0,b.jsx)("div",{className:"flex items-center justify-center gap-6 mt-6 pb-6",children:(0,b.jsx)("button",{onClick:()=>t(!1),className:"px-6 py-2 rounded-md border text-blue-600",children:"Close"})})]})]})]}),u&&y&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>v(!1)}),(0,b.jsxs)("div",{className:"relative bg-white w-full max-w-3xl rounded-lg shadow-xl overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Edit Milestone"}),(0,b.jsx)("button",{onClick:()=>v(!1),className:"p-2 rounded hover:bg-gray-100",children:(0,b.jsx)(n.XMarkIcon,{className:"w-6 h-6 text-gray-500"})})]}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"md:col-span-1",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Title *"}),(0,b.jsx)("input",{type:"text",value:E.title,onChange:a=>F(b=>({...b,title:a.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,b.jsxs)("div",{className:"md:col-span-1",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Cost"}),(0,b.jsx)("input",{type:"number",value:E.milestoneCost,onChange:a=>F(b=>({...b,milestoneCost:a.target.value})),className:"w-full border rounded px-3 py-2",min:0})]}),(0,b.jsxs)("div",{className:"md:col-span-1",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Status"}),(0,b.jsxs)("select",{value:E.status,onChange:a=>F(b=>({...b,status:a.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,b.jsx)("option",{value:"INCOMPLETE",children:"INCOMPLETE"}),(0,b.jsx)("option",{value:"COMPLETED",children:"COMPLETED"})]})]}),(0,b.jsxs)("div",{className:"md:col-span-3",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Summary *"}),(0,b.jsx)("textarea",{value:E.summary,onChange:a=>F(b=>({...b,summary:a.target.value})),className:"w-full border rounded px-3 py-2 min-h-[100px]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Date"}),(0,b.jsx)("input",{type:"date",value:E.startDate,onChange:a=>F(b=>({...b,startDate:a.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Date"}),(0,b.jsx)("input",{type:"date",value:E.endDate,onChange:a=>F(b=>({...b,endDate:a.target.value})),className:"w-full border rounded px-3 py-2"})]})]}),C&&(0,b.jsx)("div",{className:"mt-4 text-sm text-red-600",children:C}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-6 pb-6",children:[(0,b.jsx)("button",{onClick:()=>v(!1),className:"px-6 py-2 rounded-md border text-blue-600",disabled:A,children:"Cancel"}),(0,b.jsx)("button",{onClick:R,className:"px-6 py-2 rounded-md bg-blue-600 text-white",disabled:A,children:A?"Saving...":"Save"})]})]})]})]}),w&&y&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>x(!1)}),(0,b.jsx)("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl overflow-hidden",children:(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Delete Milestone"}),(0,b.jsxs)("p",{className:"text-sm text-gray-700",children:["Are you sure you want to delete milestone ",(0,b.jsx)("strong",{children:y.title})," ? This action cannot be undone."]}),C&&(0,b.jsx)("div",{className:"mt-4 text-sm text-red-600",children:C}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-4 mt-6",children:[(0,b.jsx)("button",{className:"px-4 py-2 rounded border",onClick:()=>x(!1),disabled:A,children:"Cancel"}),(0,b.jsx)("button",{className:"px-4 py-2 rounded bg-red-600 text-white",onClick:S,disabled:A,children:A?"Deleting...":"Delete"})]})]})})]})]})}let q="https://6jnqmj85-80.inc1.devtunnels.ms",r=a=>{if(!a)return null;let b=String(a).replace(/[^0-9a-fA-F]/g,"");return b.length>=6?`#${b.slice(0,6)}`:null},s=a=>{let b=a.toLowerCase();return b.includes("complete")||b.includes("complete")?"#10b981":b.includes("to-do")||b.includes("todo")||b.includes("to do")?"#f59e0b":b.includes("doing")?"#2563eb":b.includes("incomplete")?"#ef4444":b.includes("wait")||b.includes("waiting")?"#9ca3af":"#6b7280"},t=(a,b,c,d)=>{let e=(d-90)*Math.PI/180;return{x:a+c*Math.cos(e),y:b+c*Math.sin(e)}};function u({projectId:a}){let[d,f]=(0,c.useState)([]),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!0),[k,l]=(0,c.useState)(null),m=localStorage.getItem("accessToken")||"";(0,c.useEffect)(()=>{let b=!0;return(async()=>{j(!0),l(null);try{let c=`${q}/status`,[d,g]=await Promise.all([e.default.get(c,{headers:{Authorization:m?`Bearer ${m}`:""}}),e.default.get(`${q}/projects/${a}/tasks`,{headers:{Authorization:m?`Bearer ${m}`:""}})]);b&&(f(Array.isArray(d.data)?d.data:[]),h(Array.isArray(g.data)?g.data:[]))}catch(a){console.error("Failed to load task statistics:",a?.response?.data??a?.message??a),b&&(l("Failed to load task statistics"),f([]),h([]))}finally{b&&j(!1)}})(),()=>{b=!1}},[a,m]);let n=(0,c.useMemo)(()=>{let a=new Map;return d.forEach(b=>a.set(b.id,{status:b,count:0})),g.forEach(b=>{let c=b.taskStageId??b.taskStage?.id??null;if(null!=c){let b=Array.from(a.keys()).find(a=>a===c);if(void 0!==b){let c=a.get(b);c.count+=1,a.set(b,c);return}}let e=b.taskStage?.name??"",f=d.find(a=>e&&String(a.name).toLowerCase().includes(e.toLowerCase()));if(f){let b=a.get(f.id)??{status:f,count:0};b.count+=1,a.set(f.id,b);return}let g="unknown";a.has(g)||a.set(g,{status:{id:0,name:"Other",labelColor:null},count:0});let h=a.get(g);h.count+=1,a.set(g,h)}),Array.from(a.values())},[d,g]),o=n.reduce((a,b)=>a+b.count,0)||0,p=0,u=n.filter(a=>a.count>0).map(a=>{let b=0===o?0:a.count/o,c=p;p+=360*b;let d=r(a.status.labelColor)||s(a.status.name);return{...a,start:c,end:p,color:d}});return(0,b.jsx)("div",{children:i?(0,b.jsx)("div",{className:"py-6 text-center text-gray-500",children:"Loading task statistics..."}):k?(0,b.jsx)("div",{className:"py-6 text-center text-red-500",children:k}):(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsxs)("svg",{viewBox:"0 0 100 100",width:"180",height:"180",className:"flex-shrink-0",children:[0===u.length&&(0,b.jsx)("circle",{cx:"50",cy:"50",r:"40",fill:"#e5e7eb"}),u.map((a,c)=>(0,b.jsx)("path",{d:((a,b,c,d,e)=>{let f=t(50,50,40,e),g=t(50,50,40,d),h=e-d<=180?"0":"1";return`M ${a} ${b} L ${f.x} ${f.y} A ${c} ${c} 0 ${h} 0 ${g.x} ${g.y} Z`})(50,50,40,a.start,a.end),fill:a.color,stroke:"#ffffff",strokeWidth:"0.5"},c))]})}),(0,b.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,b.jsx)("ul",{className:"space-y-3 text-sm",children:n.map((a,c)=>{let d=r(a.status.labelColor)||s(a.status.name);return(0,b.jsxs)("li",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{style:{width:18,height:12,background:d},className:"rounded-sm inline-block"}),(0,b.jsx)("span",{className:"flex-1",children:a.status.name}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:a.count})]},c)})}),(0,b.jsxs)("div",{className:"mt-4 text-xs text-gray-500",children:["Total tasks: ",o]})]})]})})}function v(){let{id:a}=(0,d.useParams)()||{},[e,g]=(0,c.useState)(null),[h,i]=(0,c.useState)(!0),[k,l]=(0,c.useState)("overview"),n=async b=>{try{let c=await fetch(`/api/work/project/${a}`,{headers:b?{Authorization:`Bearer ${b}`}:void 0});if(!c.ok)throw Error("Failed to fetch");let d=await c.json();g(Array.isArray(d)?d[0]:d)}catch(b){g({id:Number(a||1),shortCode:"PRJ-001",name:"Project Name",category:"Website",startDate:"2025-08-02",deadline:"2025-09-12",client:{name:"John Doe",profilePictureUrl:"https://i.pravatar.cc/80?img=5"},summary:"Short description of the project and goals.",currency:"$",budget:0,hoursEstimate:40,assignedEmployees:[{employeeId:"1",name:"Aman Sharma",designation:"Developer",department:"Engineering"},{employeeId:"2",name:"Riya Singh",designation:"Designer",department:"Design"}],progressPercent:76,totalTimeLoggedMinutes:300,createdBy:"Admin",createdAt:new Date().toISOString(),pinned:!1,archived:!1})}finally{i(!1)}};if((0,c.useEffect)(()=>{n(localStorage.getItem("accessToken")||"")},[a]),h)return(0,b.jsx)("p",{className:"p-8 text-center",children:"Loading project..."});if(!e)return(0,b.jsx)("p",{className:"p-8 text-center text-red-600",children:"Project not found"});let q=e.totalTimeLoggedMinutes?Math.floor(e.totalTimeLoggedMinutes/60):0;return(0,b.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,b.jsxs)("div",{className:"px-6 py-6",children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsx)("h1",{className:"text-3xl font-semibold text-gray-800",children:e.name})}),(0,b.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-2 bg-white rounded-xl border border-gray-200 p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsx)("div",{className:"w-36 h-20",children:(0,b.jsxs)("svg",{viewBox:"0 0 100 50",className:"w-full h-full",children:[(0,b.jsx)("path",{d:"M5 50 A45 45 0 0 1 95 50",fill:"none",stroke:"#e6e6e6",strokeWidth:"10",strokeLinecap:"round"}),(0,b.jsx)("path",{d:"M5 50 A45 45 0 0 1 75 18",fill:"none",stroke:"#f5c518",strokeWidth:"10",strokeLinecap:"round"}),(0,b.jsxs)("text",{x:"50",y:"40",fontSize:"8",textAnchor:"middle",fill:"#374151",children:[e.progressPercent,"%"]})]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Start Date"}),(0,b.jsx)("p",{className:"font-medium",children:new Date(e.startDate).toLocaleDateString()})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"End Date"}),(0,b.jsx)("p",{className:"font-medium",children:e.noDeadline?"No Deadline":e.deadline?new Date(e.deadline).toLocaleDateString():"TBD"})]})]}),(0,b.jsx)("div",{className:"hidden lg:block max-w-xs text-gray-600",children:e.summary?(0,b.jsx)("p",{children:e.summary}):(0,b.jsx)("p",{className:"text-sm text-gray-400",children:"No summary available"})})]})}),(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-4 flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:e.client?.profilePictureUrl?(0,b.jsx)("img",{src:e.client.profilePictureUrl,alt:"client",className:"w-full h-full object-cover"}):(0,b.jsx)(f.UserIcon,{className:"w-8 h-8 text-gray-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Client"}),(0,b.jsx)("p",{className:"font-medium",children:e.client?.name||`Client ID: ${e.client?.name??""}`}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Qurilo Solutions"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-xl border border-gray-200 p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Task Statistics"}),(0,b.jsx)(u,{projectId:e.id})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Project Budget"}),(0,b.jsxs)("div",{className:"text-2xl font-semibold text-blue-600 mt-2",children:[e.currency,e.budget.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Hours Logged"}),(0,b.jsxs)("div",{className:"text-2xl font-semibold text-blue-600 mt-2",children:[q,"hrs 0 min"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-3 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Earnings"}),(0,b.jsxs)("div",{className:"text-lg font-semibold text-blue-600 mt-1",children:[e.currency,"0.00"]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-3 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Expenses"}),(0,b.jsxs)("div",{className:"text-lg font-semibold text-blue-600 mt-1",children:[e.currency,"0.00"]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-3 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Profit"}),(0,b.jsxs)("div",{className:"text-lg font-semibold text-blue-600 mt-1",children:[e.currency,"0.00"]})]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-xl border border-gray-200 p-4",children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsx)("h4",{className:"text-lg font-medium",children:"Assigned Employees"})}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:e.assignedEmployees&&e.assignedEmployees.length?e.assignedEmployees.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden",children:a.profileUrl?(0,b.jsx)("img",{src:a.profileUrl,alt:a.name,className:"w-full h-full object-cover"}):(0,b.jsx)(f.UserIcon,{className:"w-5 h-5 text-gray-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:[a.designation?a.designation+", ":"",a.department]})]})]},a.employeeId)):(0,b.jsx)("p",{className:"text-gray-500 text-center py-6",children:"No employees assigned"})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:[(0,b.jsx)("h4",{className:"text-lg font-medium mb-2",children:"Project Summary"}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 space-y-2",children:[(0,b.jsxs)("div",{children:["Created by: ",e.summary]}),(0,b.jsxs)("div",{children:["Created on: ",new Date(e.createdAt||"").toLocaleDateString()]}),e.pinned&&(0,b.jsxs)("div",{children:["Pinned on: ",new Date(e.pinnedAt||"").toLocaleDateString()]}),e.archived&&(0,b.jsxs)("div",{children:["Archived on: ",new Date(e.archivedAt||"").toLocaleDateString()]})]})]})]})]}),e&&(0,b.jsx)("div",{className:"mt-6",children:(0,b.jsx)(j,{projectId:e.id})}),(0,b.jsxs)("div",{className:"mt-6 grid grid-cols-1 lg:grid-rows-2 gap-2",children:[(0,b.jsx)(m,{projectId:e.id}),(0,b.jsx)(o,{gatewayPath:"https://erp.skavosystem.com/timesheets"}),(0,b.jsx)(p,{projectId:e.id})]})]})})}var w=a.i(699570),x=a.i(915618),y=a.i(505197),z=a.i(401897),A=a.i(630083),B=a.i(841489),C=a.i(471408),D=a.i(802133),E=a.i(478615),F=a.i(100401),G=a.i(414876),H=a.i(172031),I=a.i(433990),J=a.i(707251),K=a.i(859041);function L({projectId:a}){let[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(!0),[h,i]=(0,c.useState)({search:"",project:"All",client:"All",status:"All",startDate:"",endDate:""}),[j,k]=(0,c.useState)({view:!1,edit:!1,upload:!1,payment:!1,create:!1,receipt:!1,viewReceipt:!1,viewPayment:!1,viewCredit:!1,createCredit:!1}),[l,m]=(0,c.useState)(null),n=async()=>{try{g(!0);let b=await fetch(`https://6jnqmj85-80.inc1.devtunnels.ms/api/invoices/project/${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),c=await b.json();e(Array.isArray(c)?c:c.invoices??[])}catch(a){console.error("Failed to load invoices",a)}finally{g(!1)}};return(0,c.useEffect)(()=>{a&&n()},[a]),(0,b.jsxs)("div",{className:"mt-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-medium",children:"Invoices"}),(0,b.jsxs)(w.Button,{onClick:()=>k(a=>({...a,create:!0})),children:[(0,b.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Create Invoice"]})]}),(0,b.jsx)(y.default,{filters:h,setFilters:i,invoices:d}),(0,b.jsx)(z.default,{invoices:d,loading:f,filters:h,setActiveInvoice:m,setModal:k}),(0,b.jsx)(A.default,{open:j.create,onClose:()=>k(a=>({...a,create:!1})),refresh:n,invoices:d}),(0,b.jsx)(B.default,{open:j.view,onClose:()=>k(a=>({...a,view:!1})),invoice:l,setModal:k,refresh:n}),(0,b.jsx)(C.default,{open:j.edit,onClose:()=>k(a=>({...a,edit:!1})),invoice:l,refresh:n}),(0,b.jsx)(D.default,{open:j.upload,onClose:()=>k(a=>({...a,upload:!1})),invoice:l,refresh:n}),(0,b.jsx)(E.default,{open:j.payment,onClose:()=>k(a=>({...a,payment:!1})),invoice:l,refresh:n}),(0,b.jsx)(F.default,{open:j.receipt,onClose:()=>k(a=>({...a,receipt:!1})),invoice:l,refresh:n}),(0,b.jsx)(G.default,{open:j.viewReceipt,onClose:()=>k(a=>({...a,viewReceipt:!1})),invoice:l}),(0,b.jsx)(H.default,{open:j.payment,onClose:()=>k(a=>({...a,payment:!1})),clientId:l?.client?.clientId,onSaved:n}),(0,b.jsx)(I.default,{open:j.viewPayment,onClose:()=>k(a=>({...a,viewPayment:!1})),invoiceNumber:l?.invoiceNumber}),(0,b.jsx)(J.default,{open:j.createCredit,onClose:()=>k(a=>({...a,createCredit:!1})),invoiceNumber:l?.invoiceNumber,onCreated:n}),(0,b.jsx)(K.default,{open:j.viewCredit,onClose:()=>k(a=>({...a,viewCredit:!1})),invoiceNumber:l?.invoiceNumber})]})}var M=a.i(571987),N=a.i(417755),O=a.i(633508),P=a.i(781560);let Q="https://6jnqmj85-80.inc1.devtunnels.ms";function R({projectId:a,onAdd:d,onSearch:e,onAction:f}){let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)("pre filled"),[s,t]=(0,c.useState)(()=>a?String(a):"pre filled"),[u,v]=(0,c.useState)("pre filled"),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)("USD"),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)("Net Banking"),[E,F]=(0,c.useState)(""),G=(0,c.useRef)(null),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(!1),[L,R]=(0,c.useState)([]),[S,T]=(0,c.useState)("");(0,c.useEffect)(()=>{if(!a&&0!==a){h([]),l("No client selected."),j(!1);return}let b=new AbortController;String(a);let c=`${Q}/api/payments/project/${a}`;return j(!0),l(null),fetch(c,{method:"GET",signal:b.signal,headers:{Accept:"application/json",Authorization:""}}).then(async a=>{if(!a.ok){let b=await a.text().catch(()=>"");throw Error(`HTTP ${a.status} ${b}`)}return a.json()}).then(a=>{if(!Array.isArray(a))return void h([]);h(a.map(a=>({id:a.id,code:a.project?.projectCode??void 0,project:a.project?.projectName??void 0,invoice:a.invoice?.invoiceNumber??void 0,client:{clientId:a.client?.clientId,name:a.client?.name??void 0,companyName:a.client?.companyName??void 0,profilePictureUrl:a.client?.profilePictureUrl??void 0},orderNumber:a.orderNumber??void 0,amount:"number"==typeof a.amount?a.amount:a.amount?Number(a.amount):void 0,currency:a.currency??void 0,paidOn:a.paymentDate??void 0,paymentGateway:a.paymentGateway?.name??void 0,status:a.status?"completed"===String(a.status).toLowerCase()?"Complete":a.status:void 0,receiptFileUrl:a.receiptFileUrl??void 0})))}).catch(a=>{"AbortError"!==a.name&&(console.error("Error fetching payments:",a),l("Failed to load payments."),h([]))}).finally(()=>{j(!1)}),()=>b.abort()},[a]);let U=(0,c.useMemo)(()=>{let a=m.trim().toLowerCase();return a?g.filter(b=>String(b.code??"").toLowerCase().includes(a)||String(b.project??"").toLowerCase().includes(a)||String(b.invoice??"").toLowerCase().includes(a)||String(b.client?.name??"").toLowerCase().includes(a)||String(b.client?.companyName??"").toLowerCase().includes(a)||String(b.orderNumber??"").toLowerCase().includes(a)):g},[g,m]),V=async()=>{try{let a=await fetch(`${Q}/api/payment-gateways`,{headers:{Authorization:"Bearer ",Accept:"application/json"}});if(!a.ok){console.error("Failed to fetch gateways",a.status),R([]);return}let b=await a.json();Array.isArray(b)?R(b.map(a=>({id:a.id,name:a.name}))):R([])}catch(a){console.error("fetchGateways error",a),R([])}},W=async()=>{let a=S.trim();if(!a)return void alert("Enter gateway name");try{let b=await fetch(`${Q}/api/payment-gateways`,{method:"POST",headers:{Authorization:"Bearer ",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:a})});if(!b.ok){let a=await b.text().catch(()=>"");console.error("POST gateway failed",b.status,a),alert("Failed to create gateway");return}let c=await b.json();R(a=>[...a,{id:c.id,name:c.name}]),D(c.name),K(!1)}catch(a){console.error("handleSaveGateway error",a),alert("Failed to create gateway")}},X=async a=>{if(confirm("Delete this gateway?"))try{let b=await fetch(`${Q}/api/payment-gateways/${encodeURIComponent(String(a))}`,{method:"DELETE",headers:{Authorization:"Bearer "}});if(!b.ok){console.error("Failed delete gateway",b.status),alert("Failed to delete gateway");return}if(R(b=>b.filter(b=>b.id!==a)),L.find(b=>b.id===a&&b.name===C)){let b=L.filter(b=>b.id!==a);D(b[0]?.name??"")}}catch(a){console.error("handleDeleteGateway error",a),alert("Failed to delete gateway")}};return(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg border p-5",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Payments"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{children:(0,b.jsx)("button",{onClick:()=>{if(d)try{d()}catch{}t(a?String(a):s),p(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"+ Add Payment"})}),(0,b.jsx)("div",{children:(0,b.jsx)("input",{type:"search",placeholder:"Search",value:m,onChange:a=>{n(a.target.value),e&&e(a.target.value)},className:"border rounded px-3 py-2 text-sm w-56"})})]})]}),i?(0,b.jsx)("div",{className:"py-6 text-center text-gray-600",children:"Loading payments..."}):k?(0,b.jsx)("div",{className:"py-6 text-center text-red-600",children:k}):(0,b.jsxs)("div",{className:"rounded-lg border overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-[#e8f3ff] px-4 py-3 flex text-sm text-gray-700 font-medium",children:[(0,b.jsx)("div",{className:"w-1/12",children:"Code"}),(0,b.jsx)("div",{className:"w-2/12",children:"Project"}),(0,b.jsx)("div",{className:"w-1/12",children:"Invoice"}),(0,b.jsx)("div",{className:"w-2/12",children:"Client"}),(0,b.jsx)("div",{className:"w-1/12",children:"Order#"}),(0,b.jsx)("div",{className:"w-1/12",children:"Amount"}),(0,b.jsx)("div",{className:"w-1/12",children:"Paid On"}),(0,b.jsx)("div",{className:"w-1/12",children:"Payment Gateway"}),(0,b.jsx)("div",{className:"w-1/12",children:"Status"}),(0,b.jsx)("div",{className:"w-10 text-center",children:"Action"})]}),(0,b.jsx)("div",{className:"px-4 py-4",children:0===U.length?(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"No payments to display."}):(0,b.jsx)("div",{className:"space-y-3",children:U.map(a=>(0,b.jsxs)("div",{className:"flex items-center rounded-md border px-4 py-3 bg-white",style:{boxShadow:"0 0 0 1px rgba(0,0,0,0.02) inset"},children:[(0,b.jsx)("div",{className:"w-1/12 text-sm",children:a.code??"--"}),(0,b.jsx)("div",{className:"w-2/12 text-sm",children:a.project??"--"}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:a.invoice??"--"}),(0,b.jsxs)("div",{className:"w-2/12 flex items-center gap-3 text-sm",children:[(0,b.jsx)("div",{className:"h-7 w-7 rounded-full overflow-hidden bg-gray-100 relative flex-shrink-0",children:a.client?.profilePictureUrl?(0,b.jsx)(M.default,{src:a.client.profilePictureUrl,alt:a.client?.name??"client",fill:!0,sizes:"28px",style:{objectFit:"cover"},unoptimized:!0}):(0,b.jsx)("div",{className:"flex items-center justify-center h-full text-xs text-gray-500",children:a.client?.name?.charAt(0)??"U"})}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:a.client?.name??"--"}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:a.client?.companyName??""})]})]}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:a.orderNumber??"--"}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:((a,b)=>{if(null==a)return"--";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:b||"USD",maximumFractionDigits:2}).format(Number(a))}catch{return`${b??"$"} ${Number(a).toFixed(2)}`}})(a.amount,a.currency)}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:(a=>{if(!a)return"--";try{let b=new Date(a),c=String(b.getDate()).padStart(2,"0"),d=String(b.getMonth()+1).padStart(2,"0"),e=b.getFullYear();return`${c}/${d}/${e}`}catch{return a}})(a.paidOn)}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:a.paymentGateway??"--"}),(0,b.jsx)("div",{className:"w-1/12 text-sm",children:"Complete"===a.status?(0,b.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-emerald-600 block"}),(0,b.jsx)("span",{children:"Complete"})]}):"Pending"===a.status?(0,b.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-yellow-500 block"}),(0,b.jsx)("span",{children:"Pending"})]}):(0,b.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-red-500 block"}),(0,b.jsx)("span",{children:a.status??"--"})]})}),(0,b.jsx)("div",{className:"w-10 text-center",children:(0,b.jsx)("button",{onClick:()=>f?f(a):void 0,className:"p-2 rounded hover:bg-gray-100 inline-flex items-center justify-center",title:"Actions",children:(0,b.jsx)(N.MoreHorizontal,{size:16})})})]},a.id))})})]})]}),o&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[10000] flex items-start justify-center pt-8 px-4 overflow-y-auto",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>p(!1)}),(0,b.jsxs)("div",{className:"relative w-full max-w-4xl bg-white rounded-xl shadow-2xl overflow-y-auto z-10",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Add Payment Details"}),(0,b.jsx)("button",{onClick:()=>p(!1),className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:(0,b.jsx)(O.X,{className:"w-5 h-5"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:"Payment Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Project *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:q,onChange:a=>r(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Client *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:s,onChange:a=>t(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Invoice *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:u,onChange:a=>v(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Amount *"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:w,onChange:a=>x(a.target.value),placeholder:"---"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Currency *"}),(0,b.jsxs)("select",{value:y,onChange:a=>z(a.target.value),className:"w-full border rounded px-3 py-2",children:[(0,b.jsx)("option",{value:"USD",children:"USD $"}),(0,b.jsx)("option",{value:"USD",children:"USD ₹"}),(0,b.jsx)("option",{value:"EUR",children:"EUR €"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Transaction Id"}),(0,b.jsx)("input",{className:"w-full border rounded px-3 py-2",value:A,onChange:a=>B(a.target.value)})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Payment Gateway"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("select",{value:C,onChange:a=>D(a.target.value),className:"w-full border rounded px-3 py-2",children:L.length>0?L.map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id)):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("option",{children:"Net Banking"}),(0,b.jsx)("option",{children:"Credit Card"}),(0,b.jsx)("option",{children:"PayPal"})]})}),(0,b.jsx)("button",{className:"px-3 py-2 bg-gray-100 rounded",type:"button",onClick:()=>{T(""),K(!0),V()},title:"Add payment gateway",children:"Add"})]})]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-2",children:"Receipt"}),(0,b.jsxs)("div",{onClick:()=>G.current?.click(),className:"border-2 border-dashed rounded-lg h-28 flex items-center justify-center cursor-pointer text-gray-500",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"mb-1",children:"Choose a file"}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:H?H.name:"Drag & drop or click"})]}),(0,b.jsx)("input",{ref:G,type:"file",className:"hidden",onChange:a=>I(a.target.files?.[0]??null)})]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("label",{className:"text-sm text-gray-600 block mb-2",children:"Remark"}),(0,b.jsx)("textarea",{rows:4,value:E,onChange:a=>F(a.target.value),className:"w-full p-3 border rounded",placeholder:"Enter a summary of payment"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,b.jsx)("button",{className:"px-4 py-2 border rounded",onClick:()=>p(!1),children:"Cancel"}),(0,b.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:()=>{H?.name,p(!1)},children:"Save"})]})]})]})]}),J&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[11000] flex items-start justify-center pt-12 px-4 overflow-y-auto",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>K(!1)}),(0,b.jsxs)("div",{className:"relative w-full max-w-3xl bg-white rounded-xl shadow-2xl overflow-y-auto z-20",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Add Payment Gateway"}),(0,b.jsx)("button",{onClick:()=>K(!1),className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:(0,b.jsx)(O.X,{className:"w-5 h-5"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{className:"rounded border overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-[#e8f3ff] px-4 py-2 flex text-sm text-gray-700 font-medium",children:[(0,b.jsx)("div",{className:"w-1/12",children:"#"}),(0,b.jsx)("div",{className:"w-11/12",children:"Gateway"}),(0,b.jsx)("div",{className:"w-12 text-center",children:"Action"})]}),(0,b.jsx)("div",{className:"px-4 py-2",children:0===L.length?(0,b.jsx)("div",{className:"text-sm text-gray-500 p-2",children:"No gateways"}):L.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center py-2 border-b last:border-b-0",children:[(0,b.jsx)("div",{className:"w-1/12 text-sm",children:c+1}),(0,b.jsx)("div",{className:"w-11/12 text-sm",children:a.name}),(0,b.jsx)("div",{className:"w-12 text-center",children:(0,b.jsx)("button",{onClick:()=>X(a.id),className:"inline-flex items-center justify-center p-1 rounded hover:bg-red-50 text-red-600",title:"Delete gateway",children:(0,b.jsx)(P.Trash2,{size:16})})})]},a.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-gray-600",children:"Payment Gateway Name *"}),(0,b.jsx)("input",{value:S,onChange:a=>T(a.target.value),placeholder:"--",className:"w-full border rounded px-3 py-2 mt-2"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3 pt-2",children:[(0,b.jsx)("button",{className:"px-4 py-2 border rounded",onClick:()=>K(!1),children:"Cancel"}),(0,b.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:W,children:"Save"})]})]})]})]})]})}let S="https://6jnqmj85-80.inc1.devtunnels.ms";function T({projectId:a,authToken:d}){let e=(0,c.useRef)(null),[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)({}),[n,o]=(0,c.useState)(null);(0,c.useEffect)(()=>{if(!a)return;let b=!0;return i(!0),o(null),fetch(`${S}/files/projects/${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}).then(a=>a.json()).then(a=>{b&&g((Array.isArray(a)?a:[]).map(a=>({id:a.id,filename:a.filename,url:a.url,mimeType:a.mimeType,size:a.size,uploadedBy:a.uploadedBy,createdAt:a.createdAt})))}).catch(()=>o("Failed to load files")).finally(()=>b&&i(!1)),()=>{b=!1}},[a,d]);let p=async b=>{let c=b.target.files?.[0];if(!c)return;let d=`local-${Date.now()}`,f=c.type.startsWith("image/")?URL.createObjectURL(c):null;g(a=>[{id:d,filename:c.name,url:f,mimeType:c.type},...a]),m(a=>({...a,[d]:!0})),o(null);try{let b=new FormData;b.append("file",c);let e=await fetch(`${S}/files/projects/${a}`,{method:"POST",body:b,headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!e.ok)throw Error("Upload failed");let f=await e.json();g(a=>a.map(a=>a.id===d?{id:f.id,filename:f.filename,url:f.url,mimeType:f.mimeType,size:f.size,uploadedBy:f.uploadedBy,createdAt:f.createdAt}:a))}catch(a){g(a=>a.filter(a=>a.id!==d)),o("Upload failed")}finally{m(a=>{let b={...a};return delete b[d],b}),e.current&&(e.current.value="")}},q=async b=>{g(a=>a.filter(a=>a.id!==b));try{await fetch(`${S}/files/projects/${a}/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})}catch{o("Delete failed")}},r=(a,b,c)=>{if(!a)return;let d=document.createElement("a");d.href=a,d.target="_blank",b&&(d.download=c||"file"),document.body.appendChild(d),d.click(),d.remove()};return(0,b.jsxs)("div",{className:"bg-white rounded-lg border p-5",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Upload file"}),(0,b.jsxs)("div",{onClick:()=>e.current?.click(),className:"border-2 border-dashed rounded-lg h-28 flex items-center justify-center cursor-pointer text-gray-500",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",fill:"#bdbdbd",viewBox:"0 0 24 24",className:"mx-auto mb-2",children:(0,b.jsx)("path",{d:"M12 16a1 1 0 0 1-1-1v-4.586l-1.293 1.293a1 1 0 1 1-1.414-1.414l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.414L13 10.414V15a1 1 0 0 1-1 1Zm7-1a5 5 0 0 0-4.546-4.978A7 7 0 0 0 5.062 9.2 5 5 0 0 0 6 19h13a4 4 0 0 0 0-8Z"})}),(0,b.jsx)("div",{className:"text-sm font-medium",children:"Choose a file"})]}),(0,b.jsx)("input",{ref:e,type:"file",className:"hidden",onChange:p})]}),h&&(0,b.jsx)("p",{className:"text-sm mt-3 text-gray-500",children:"Loading…"}),n&&(0,b.jsx)("p",{className:"text-sm mt-3 text-red-500",children:n}),(0,b.jsx)("div",{className:"mt-6 grid grid-cols-6 gap-4",children:f.map(a=>(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"h-20 border rounded bg-gray-50 flex items-center justify-center overflow-hidden",children:a.url&&a.mimeType?.startsWith("image/")?(0,b.jsx)(M.default,{src:a.url,alt:a.filename||"file",fill:!0,className:"object-cover",unoptimized:!0}):(0,b.jsx)("span",{className:"text-xs text-gray-400",children:"File"})}),(0,b.jsx)("button",{onClick:()=>k(j===a.id?null:a.id),className:"absolute top-1 right-1 p-1 rounded hover:bg-white",children:(0,b.jsx)(N.MoreHorizontal,{size:16})}),j===a.id&&(0,b.jsxs)("div",{className:"absolute right-0 mt-7 w-36 bg-white border rounded shadow z-20",children:[(0,b.jsx)("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>r(a.url,!0,a.filename||void 0),children:"Download"}),(0,b.jsx)("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>r(a.url),children:"View"}),(0,b.jsx)("button",{className:"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-gray-50",onClick:()=>q(a.id),children:"Delete"})]})]}),(0,b.jsx)("div",{className:"mt-2 text-sm",children:(0,b.jsxs)("div",{className:"font-medium truncate",children:[a.filename||"Untitled",l[String(a.id)]&&(0,b.jsxs)("span",{className:"text-xs text-gray-400",children:[" ","· uploading…"]})]})})]},String(a.id)))})]})}var U=a.i(879360),V=a.i(244494),W=a.i(943108),X=a.i(177156),Y=a.i(824569);let Z="https://6jnqmj85-80.inc1.devtunnels.ms";function $({projectId:a,authToken:d}){let[e,f]=(0,c.useState)([]),[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(!1),[w,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(!0),[L,M]=(0,c.useState)(!1),N={Authorization:`Bearer ${d||localStorage.getItem("accessToken")||""}`};(0,c.useEffect)(()=>{a&&(async()=>{h(!0),j(null);try{let b=await fetch(`${Z}/projects/${a}/notes`,{headers:N});if(!b.ok)throw Error("Failed to load notes");let c=await b.json();f(Array.isArray(c)?c.map(a=>({id:a.id,title:a.title??"Untitled",content:a.content??"---",isPublic:!!a.isPublic,createdBy:a.createdBy,createdAt:a.createdAt})):[])}catch(a){j(a.message)}finally{h(!1)}})()},[a]);let O=async()=>{if(!o.trim())return void j("Note title is required");v(!0);try{let b=await fetch(`${Z}/projects/${a}/notes`,{method:"POST",headers:{"Content-Type":"application/json",...N},body:JSON.stringify({title:o,content:q,isPublic:s})});if(!b.ok)throw Error("Failed to save note");let c=await b.json();f(a=>[{id:c.id,title:c.title,content:c.content??"---",isPublic:c.isPublic,createdBy:c.createdBy,createdAt:c.createdAt},...a]),n(!1),p(""),r(""),t(!0)}catch(a){j(a.message)}finally{v(!1)}},Q=async()=>{if(D){M(!0);try{let a=await fetch(`${Z}/notes/project/${D}`,{method:"PUT",headers:{"Content-Type":"application/json",...N},body:JSON.stringify({title:F,content:H,isPublic:J})});if(!a.ok)throw Error("Failed to update note");let b=await a.json();f(a=>a.map(a=>a.id===D?{...a,title:b.title,content:b.content,isPublic:b.isPublic}:a)),C(!1)}catch(a){j(a.message)}finally{M(!1)}}},R=async b=>{f(a=>a.filter(a=>a.id!==b.id));try{await fetch(`${Z}/projects/${a}/notes/${b.id}`,{method:"DELETE",headers:N})}catch{j("Delete failed")}};return(0,b.jsxs)("div",{className:"bg-white rounded border",children:[(0,b.jsx)("div",{className:"p-4 flex justify-end border-b",children:(0,b.jsxs)("button",{onClick:()=>n(!0),className:"bg-blue-600 text-white px-3 py-2 text-sm rounded flex items-center gap-2",children:[(0,b.jsx)(x.Plus,{size:16})," Add Note"]})}),(0,b.jsxs)("div",{className:"p-4",children:[g&&(0,b.jsx)("p",{children:"Loading…"}),i&&(0,b.jsx)("p",{className:"text-red-600",children:i}),(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-blue-50",children:[(0,b.jsx)("th",{className:"px-4 py-3 text-left",children:"Note Title"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Note Type"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right",children:"Action"})]})}),(0,b.jsx)("tbody",{children:e.map(a=>(0,b.jsxs)("tr",{className:"border-t",children:[(0,b.jsx)("td",{className:"px-4 py-3",children:a.title}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("div",{className:"flex gap-2 items-center",children:[a.isPublic?(0,b.jsx)(V.Globe,{size:14}):(0,b.jsx)(W.Lock,{size:14}),a.isPublic?"Public":"Private"]})}),(0,b.jsxs)("td",{className:"px-4 py-3 text-right relative",children:[(0,b.jsx)("button",{onClick:()=>l(k===a.id?null:a.id),children:(0,b.jsx)(U.MoreVertical,{size:18})}),k===a.id&&(0,b.jsxs)("div",{className:"absolute right-0 mt-2 bg-white border rounded shadow w-40 z-20",children:[(0,b.jsxs)("button",{className:"w-full px-3 py-2 flex gap-2 hover:bg-gray-50",onClick:()=>{A(a),y(!0),l(null)},children:[(0,b.jsx)(X.Eye,{size:14})," View"]}),(0,b.jsxs)("button",{className:"w-full px-3 py-2 flex gap-2 hover:bg-gray-50",onClick:()=>{E(a.id),G(a.title),I(a.content??""),K(a.isPublic),C(!0),l(null)},children:[(0,b.jsx)(Y.Edit,{size:14})," Edit"]}),(0,b.jsxs)("button",{className:"w-full px-3 py-2 flex gap-2 text-red-600 hover:bg-gray-50",onClick:()=>R(a),children:[(0,b.jsx)(P.Trash2,{size:14})," Delete"]})]})]})]},a.id))})]})]}),w&&z&&(0,b.jsxs)(_,{onClose:()=>y(!1),children:[(0,b.jsx)(aa,{title:z.title,onClose:()=>y(!1)}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsxs)("div",{className:"border rounded-lg p-6 space-y-4",children:[(0,b.jsx)("h4",{className:"font-medium text-gray-700",children:"Project Note Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,b.jsx)("div",{className:"text-gray-500",children:"Note Title"}),(0,b.jsx)("div",{className:"col-span-2",children:z.title}),(0,b.jsx)("div",{className:"text-gray-500",children:"Note Type"}),(0,b.jsx)("div",{className:"col-span-2",children:z.isPublic?"Public":"Private"}),(0,b.jsx)("div",{className:"text-gray-500",children:"Note Detail"}),(0,b.jsx)("div",{className:"col-span-2 whitespace-pre-wrap",children:z.content||"---"})]})]})})]}),m&&(0,b.jsxs)(_,{onClose:()=>!u&&n(!1),children:[(0,b.jsx)(aa,{title:"Add Project Note",onClose:()=>n(!1)}),(0,b.jsxs)(ab,{children:[(0,b.jsx)(ad,{label:"Note Title *",value:o,onChange:p}),(0,b.jsx)(af,{value:s,onChange:t}),(0,b.jsx)(ae,{label:"Note Detail",value:q,onChange:r})]}),(0,b.jsx)(ac,{loading:u,onCancel:()=>n(!1),onSave:O,saveText:"Save"})]}),B&&(0,b.jsxs)(_,{onClose:()=>!L&&C(!1),children:[(0,b.jsx)(aa,{title:"Update Project Note",onClose:()=>C(!1)}),(0,b.jsxs)(ab,{children:[(0,b.jsx)(ad,{label:"Note Title *",value:F,onChange:G}),(0,b.jsx)(af,{value:J,onChange:K}),(0,b.jsx)(ae,{label:"Note Detail",value:H,onChange:I})]}),(0,b.jsx)(ac,{loading:L,onCancel:()=>C(!1),onSave:Q,saveText:"Update"})]})]})}function _({children:a,onClose:c}){return(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex justify-center pt-12",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:c}),(0,b.jsx)("div",{className:"relative bg-white w-[900px] max-w-[95%] rounded border shadow",children:a})]})}function aa({title:a,onClose:c}){return(0,b.jsxs)("div",{className:"p-4 border-b flex justify-between",children:[(0,b.jsx)("h4",{className:"font-medium",children:a}),(0,b.jsx)("button",{onClick:c,children:(0,b.jsx)(O.X,{size:18})})]})}function ab({children:a}){return(0,b.jsx)("div",{className:"p-6 space-y-4",children:a})}function ac({onCancel:a,onSave:c,loading:d,saveText:e}){return(0,b.jsxs)("div",{className:"p-4 border-t flex justify-center gap-4",children:[(0,b.jsx)("button",{className:"border px-6 py-2 rounded",onClick:a,children:"Cancel"}),(0,b.jsx)("button",{className:"bg-blue-600 text-white px-6 py-2 rounded",disabled:d,onClick:c,children:d?"Saving…":e})]})}function ad({label:a,value:c,onChange:d}){return(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:a}),(0,b.jsx)("input",{className:"w-full border px-3 py-2 rounded",value:c,onChange:a=>d(a.target.value)})]})}function ae({label:a,value:c,onChange:d}){return(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:a}),(0,b.jsx)("textarea",{className:"w-full border px-3 py-2 rounded min-h-[120px]",value:c,onChange:a=>d(a.target.value)})]})}function af({value:a,onChange:c}){return(0,b.jsxs)("div",{className:"flex gap-6",children:[(0,b.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,b.jsx)("input",{type:"radio",checked:a,onChange:()=>c(!0)}),"Public"]}),(0,b.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,b.jsx)("input",{type:"radio",checked:!a,onChange:()=>c(!1)}),"Private"]})]})}function ag({projectId:a}){let[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{a&&(async()=>{try{g(!0),localStorage.getItem("token")||localStorage.getItem("authToken");let b=await fetch(`https://6jnqmj85-80.inc1.devtunnels.ms/projects/${a}/activity`,{cache:"no-store",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),c=await b.text(),d=c?JSON.parse(c):[];e(Array.isArray(d)?d:[])}catch(a){console.error("Failed to load activity",a),e([])}finally{g(!1)}})()},[a]),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Activity"}),(0,b.jsxs)("div",{className:"border rounded-md overflow-hidden",children:[f&&(0,b.jsx)("div",{className:"p-6 text-center text-gray-400",children:"Loading activity…"}),!f&&0===d.length&&(0,b.jsx)("div",{className:"p-6 text-center text-gray-400",children:"No activity found"}),!f&&d.map(a=>{let{day:c,month:d,time:e}=function(a){let b=new Date(a);return{day:b.toLocaleDateString("en-US",{day:"2-digit"}),month:b.toLocaleDateString("en-US",{month:"short"}),time:b.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}}(a.createdAt);return(0,b.jsxs)("div",{className:"flex gap-4 p-4 border-b last:border-b-0",children:[(0,b.jsxs)("div",{className:"w-14 border rounded-md text-center overflow-hidden",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500 border-b py-1",children:d}),(0,b.jsx)("div",{className:"text-lg font-semibold py-2",children:c})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"text-sm text-gray-800",children:function(a){switch(a){case"PROJECT_FILE_UPLOADED":return"New file uploaded to the project.";case"FILE_DELETED":return"File deleted from the project.";case"PROJECT_NOTE_CREATED":return"New note added to the project.";case"PROJECT_NOTE_UPDATED":return"Project note updated.";case"TASK_CREATED":return"New task created.";case"TASK_UPDATED":return"Task updated.";case"TASK_DELETED":return"Task deleted.";case"TASK_STATUS_CHANGED":return"Task status changed.";case"TASK_FILE_UPLOADED":return"File uploaded to a task.";case"TIMELOG_CREATED":return"Time logged on the project.";case"TIMELOG_UPDATED":return"Time log updated.";case"TIMELOG_DELETED":return"Time log deleted.";case"PROJECT_ASSIGNED_EMPLOYEES_ADDED":return"Employee assigned to the project.";case"DISCUSSION_ROOM_CREATED":return"Discussion room created.";case"DISCUSSION_MESSAGE_DELETED":return"Discussion message deleted.";case"PROJECT_CREATED":return"Project created.";default:return a.replaceAll("_"," ").toLowerCase()}}(a.action)}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e})]})]},a.id)})]})]})}var ah=a.i(321161),ai=a.i(773320),aj=a.i(45222),ak=a.i(104720),al=a.i(510448),am=a.i(816201),an=a.i(284505),ao=a.i(365936),ap=a.i(406001);let aq="https://6jnqmj85-80.inc1.devtunnels.ms";function ar({projectId:a,roomId:d,onClose:e}){let[f,g]=(0,c.useState)(null),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),v=(0,c.useRef)(null),w=(0,c.useRef)(null),x=a=>{let b=new Date(a);return`${b.toLocaleDateString("en-GB")} | ${b.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`},y=async()=>{let b=await fetch(`${aq}/api/projects/${a}/discussion-rooms/${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});g(await b.json())},z=async()=>{let a=await fetch(`${aq}/api/projects/discussion-rooms/${d}/messages`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),b=await a.json();b.sort((a,b)=>new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime()),i(b)};(0,c.useEffect)(()=>{y(),z()},[d]),(0,c.useEffect)(()=>{v.current?.scrollIntoView({behavior:"smooth"})},[h]),(0,c.useEffect)(()=>{let a=new ao.default(`${aq}/ws-discussion`),b=new ap.Client({webSocketFactory:()=>a,debug:()=>{},connectHeaders:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},onConnect:()=>{b.subscribe(`/topic/discussion-rooms/${d}`,a=>{let b=JSON.parse(a.body);i(a=>a.some(a=>a.id===b.id)?a:[...a,b])})}});return b.activate(),w.current=b,()=>{b.deactivate()}},[d]);let A=async()=>{if(!j&&!l)return;let a=new FormData;j&&a.append("content",j),l&&a.append("file",l),a.append("parentMessageId",""),await fetch(`${aq}/api/projects/discussion-rooms/${d}/messages`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:a}),k(""),m(null),z()},B=async()=>{n&&(await fetch(`${aq}/api/projects/discussion-rooms/${d}/messages/${n.id}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"text/plain"},body:p}),o(null),q(""))},C=async a=>{s(null),await fetch(`${aq}/api/projects/discussion-rooms/${d}/messages/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})},D=async a=>{s(null);let b=h.find(b=>b.isBestReply&&b.id!==a.id);if(!a.isBestReply&&b)return void alert("Please unmark the current Best Reply first.");let c=a.isBestReply?"unmark-best-reply":"mark-best-reply";await fetch(`${aq}/api/projects/discussion-rooms/${d}/messages/${a.id}/${c}`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})};return f?(0,b.jsxs)("div",{className:"fixed inset-0 bg-white z-50 flex flex-col",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center px-6 py-4 border-b",children:[(0,b.jsx)("h3",{className:"text-lg font-medium",children:"Discussion"}),(0,b.jsx)(O.X,{className:"cursor-pointer",onClick:e})]}),(0,b.jsxs)("div",{className:"px-6 py-4 border-b",children:[(0,b.jsx)("h2",{className:"font-medium text-lg",children:f.title}),(0,b.jsxs)("p",{className:"text-sm text-gray-400",children:["Requested On ",x(f.createdAt)]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[h.map((a,c)=>{let d,e=0===c,f=a.sender?.employeeId===null;return(0,b.jsx)("div",{className:"border rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("img",{src:a.sender?.profileUrl||"/avatar.png",className:"h-9 w-9 rounded-full"}),(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"font-medium",children:a.sender?.name}),a.isBestReply&&(0,b.jsx)("span",{className:"bg-green-100 text-green-700 text-xs font-medium px-3 py-1 rounded-full",children:"Best Reply"})]}),"TEXT"===a.messageType&&(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:a.content}),"FILE"===a.messageType&&a.fileUrl&&(0,b.jsxs)("div",{className:"relative mt-2 border rounded p-2 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(d=a.mimeType,d?.startsWith("image/"))?(0,b.jsx)("img",{src:a.fileUrl,className:"h-16 w-16 rounded object-cover"}):(0,b.jsx)(ak.FileText,{size:32}),(0,b.jsx)("span",{className:"text-sm",children:a.fileName})]}),(0,b.jsx)(U.MoreVertical,{size:16,className:"cursor-pointer",onClick:()=>u(t===a.id?null:a.id)}),t===a.id&&(0,b.jsxs)("div",{className:"absolute right-2 top-10 bg-white border rounded shadow w-40 z-50",children:[(0,b.jsxs)("button",{onClick:()=>{window.open(a.fileUrl,"_blank"),u(null)},className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 w-full",children:[(0,b.jsx)(X.Eye,{size:14}),"View"]}),(0,b.jsxs)("button",{onClick:()=>{((a,b)=>{if(!a)return;let c=document.createElement("a");c.href=a,c.download=b||"",document.body.appendChild(c),c.click(),document.body.removeChild(c)})(a.fileUrl,a.fileName),u(null)},className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 w-full",children:[(0,b.jsx)(an.Download,{size:14}),"Download"]})]})]})]})]}),(0,b.jsxs)("div",{className:"relative flex items-center gap-3 text-xs text-gray-400",children:[x(a.createdAt),e&&f&&(0,b.jsxs)("button",{onClick:()=>{o(a),q(a.content||"")},className:"flex items-center gap-1 border px-3 py-1 rounded",children:[(0,b.jsx)(al.Edit2,{size:14}),"Edit"]}),!e&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(U.MoreVertical,{size:16,className:"cursor-pointer",onClick:()=>s(r===a.id?null:a.id)}),r===a.id&&(0,b.jsxs)("div",{className:"absolute right-0 top-6 bg-white border rounded shadow w-56 z-50",children:[f&&(0,b.jsxs)("button",{onClick:()=>{o(a),q(a.content||""),s(null)},className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 w-full",children:[(0,b.jsx)(al.Edit2,{size:14}),"Edit"]}),(0,b.jsxs)("button",{onClick:()=>D(a),className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 w-full",children:[(0,b.jsx)(am.CheckCircle,{size:14}),a.isBestReply?"Unmark Best Reply":"Mark as Best Reply"]}),(0,b.jsxs)("button",{onClick:()=>C(a.id),className:"flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-gray-100 w-full",children:[(0,b.jsx)(P.Trash2,{size:14}),"Delete"]})]})]})]})]})},a.id)}),(0,b.jsx)("div",{ref:v})]}),(0,b.jsxs)("div",{className:"border-t px-6 py-4",children:[(0,b.jsx)("h1",{children:"Reply *"}),(0,b.jsx)("textarea",{value:j,onChange:a=>k(a.target.value),className:"border rounded px-3 py-2 w-full mb-3 min-h-[80px]"}),(0,b.jsx)("h1",{children:"Add File *"}),(0,b.jsxs)("label",{className:"border border-dashed rounded flex flex-col items-center py-6 cursor-pointer text-gray-400 mb-4",children:[(0,b.jsx)(ai.Upload,{}),(0,b.jsx)("span",{className:"text-sm mt-2",children:l?l.name:"Choose a file"}),(0,b.jsx)("input",{type:"file",hidden:!0,onChange:a=>m(a.target.files?.[0]||null)})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)("button",{onClick:A,className:"bg-blue-600 text-white px-6 py-2 rounded",children:"Reply"})})]}),n&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white w-[500px] rounded p-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsx)("h3",{className:"font-medium",children:"Update Reply"}),(0,b.jsx)(O.X,{className:"cursor-pointer",onClick:()=>o(null)})]}),(0,b.jsx)("textarea",{value:p,onChange:a=>q(a.target.value),className:"border rounded w-full p-3 min-h-[100px]"}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,b.jsx)("button",{onClick:()=>o(null),className:"px-4 py-2 border rounded",children:"Cancel"}),(0,b.jsx)("button",{onClick:B,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Save"})]})]})})]}):null}let as="https://6jnqmj85-80.inc1.devtunnels.ms";function at({projectId:a}){let[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)({categoryName:"",colorCode:""}),[r,s]=(0,c.useState)({categoryId:"",title:"",initialMessage:"",file:null}),t=async()=>{try{let a=await fetch(`${as}/api/projects/discussion-categories`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),b=await a.json();e(Array.isArray(b)?b:[])}catch{e([])}},u=async()=>{try{i(!0);let b=await fetch(`${as}/api/projects/${a}/discussion-rooms`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),c=await b.json();g(Array.isArray(c)?c:[])}catch{g([])}finally{i(!1)}};(0,c.useEffect)(()=>{t(),u()},[]);let v=async()=>{if(!p.categoryName||!p.colorCode)return;let a=await fetch(`${as}/api/projects/discussion-categories`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify(p)}),b=await a.json();e(a=>[...a,b]),q({categoryName:"",colorCode:""}),k(!1)},w=async a=>{await fetch(`${as}/api/projects/discussion-categories/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),t()},y=async()=>{if(!r.categoryId||!r.title||!r.initialMessage)return;let b=new FormData;b.append("title",r.title),b.append("categoryId",r.categoryId),b.append("initialMessage",r.initialMessage),r.file&&b.append("initialFile",r.file),await fetch(`${as}/api/projects/${a}/discussion-rooms`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:b}),s({categoryId:"",title:"",initialMessage:"",file:null}),m(!1),u()},z=async b=>{await fetch(`${as}/api/projects/${a}/discussion-rooms/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),u()};return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-medium",children:"Discussion"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>m(!0),className:"flex items-center gap-2 bg-blue-600 text-white px-3 py-1.5 rounded text-sm",children:[(0,b.jsx)(x.Plus,{size:16}),"New Discussion"]}),(0,b.jsxs)("button",{onClick:()=>k(!0),className:"flex items-center gap-2 border border-blue-500 text-blue-600 px-3 py-1.5 rounded text-sm",children:[(0,b.jsx)(ah.Settings,{size:16}),"Discussion Category"]})]})]}),f.map(a=>{let c=a.lastMessage?.createdAt||a.updatedAt||a.createdAt;return(0,b.jsxs)("div",{onClick:()=>o(a.id),className:"border rounded-md p-4 mb-3 flex justify-between items-center cursor-pointer",children:[(0,b.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,b.jsx)("img",{src:a.createdByUser?.profileUrl||"/avatar.png",className:"h-10 w-10 rounded-full"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.title}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:(a=>{if(!a)return"";let b=new Date(a),c=b.toLocaleDateString("en-GB"),d=b.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return`replied at ${c} | ${d}`})(c)}),a.lastMessage?.messageType==="FILE"&&(0,b.jsx)("img",{src:a.lastMessage.fileUrl,className:"h-16 mt-2 rounded"}),a.lastMessage?.messageType==="TEXT"&&(0,b.jsx)("p",{className:"text-sm text-gray-500",children:a.lastMessage.content})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(aj.MessageCircle,{size:14}),a.messageCount??0]}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full",style:{background:a.category.colorCode}}),a.category.categoryName]}),(0,b.jsx)(P.Trash2,{size:16,className:"text-red-500 cursor-pointer",onClick:b=>{b.stopPropagation(),z(a.id)}})]})]},a.id)}),0===f.length&&(0,b.jsx)("div",{className:"border rounded-md p-4 text-gray-400 text-center",children:"Team discussion will appear here"}),l&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg w-[700px] p-6",children:[(0,b.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,b.jsx)("h4",{className:"font-medium text-lg",children:"New Discussion"}),(0,b.jsx)(O.X,{className:"cursor-pointer",onClick:()=>m(!1)})]}),(0,b.jsxs)("select",{value:r.categoryId,onChange:a=>s({...r,categoryId:a.target.value}),className:"border rounded px-3 py-2 w-full mb-3 text-sm",children:[(0,b.jsx)("option",{value:"",children:"Select category"}),d.map(a=>(0,b.jsx)("option",{value:a.id,children:a.categoryName},a.id))]}),(0,b.jsx)("input",{placeholder:"Title",value:r.title,onChange:a=>s({...r,title:a.target.value}),className:"border rounded px-3 py-2 w-full mb-3 text-sm"}),(0,b.jsx)("textarea",{placeholder:"Reply",value:r.initialMessage,onChange:a=>s({...r,initialMessage:a.target.value}),className:"border rounded px-3 py-2 w-full mb-4 text-sm min-h-[100px]"}),(0,b.jsxs)("label",{className:"border border-dashed rounded flex flex-col items-center justify-center py-6 cursor-pointer text-gray-400 mb-4",children:[(0,b.jsx)(ai.Upload,{}),(0,b.jsx)("span",{className:"text-sm mt-2",children:"Choose a file"}),(0,b.jsx)("input",{type:"file",hidden:!0,onChange:a=>s({...r,file:a.target.files?.[0]||null})})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,b.jsx)("button",{onClick:()=>m(!1),className:"border px-6 py-2 rounded text-sm",children:"Cancel"}),(0,b.jsx)("button",{onClick:y,className:"bg-blue-600 text-white px-6 py-2 rounded text-sm",children:"Save"})]})]})}),j&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg w-[600px] p-5",children:[(0,b.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,b.jsx)("h4",{className:"font-medium",children:"Discussion Category"}),(0,b.jsx)(O.X,{className:"cursor-pointer",onClick:()=>k(!1)})]}),d.map(a=>(0,b.jsxs)("div",{className:"flex justify-between items-center border-b py-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full",style:{background:a.colorCode}}),a.categoryName]}),(0,b.jsx)(P.Trash2,{size:14,className:"text-red-500 cursor-pointer",onClick:()=>w(a.id)})]},a.id)),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[(0,b.jsx)("input",{placeholder:"Category Name",value:p.categoryName,onChange:a=>q({...p,categoryName:a.target.value}),className:"border rounded px-3 py-2 text-sm"}),(0,b.jsx)("input",{placeholder:"#3498db",value:p.colorCode,onChange:a=>q({...p,colorCode:a.target.value}),className:"border rounded px-3 py-2 text-sm"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,b.jsx)("button",{onClick:()=>k(!1),className:"border px-4 py-2 rounded text-sm",children:"Cancel"}),(0,b.jsx)("button",{onClick:v,className:"bg-blue-600 text-white px-4 py-2 rounded text-sm",children:"Save"})]})]})}),n&&(0,b.jsx)(ar,{projectId:a,roomId:n,onClose:()=>o(null)})]})}function au(){let a=(0,d.useParams)(),f=a?.id,[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(!0),[m,n]=(0,c.useState)("overview");return((0,c.useEffect)(()=>{if(!f)return;let a=localStorage.getItem("accessToken")||"";(async()=>{try{let[b,c]=await Promise.all([e.default.get(`/api/work/project/${f}`,{headers:{Authorization:`Bearer ${a}`}}),e.default.get(`https://6jnqmj85-80.inc1.devtunnels.ms/projects/${f}/metrics`,{headers:{Authorization:`Bearer ${a}`}})]);h(Array.isArray(b.data)?b.data[0]:b.data),j(c.data)}catch(a){console.error(a)}finally{l(!1)}})()},[f]),k)?(0,b.jsx)("div",{className:"p-8 text-center",children:"Loading project..."}):g?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-6",children:[(0,b.jsx)("h1",{className:"text-3xl font-semibold text-gray-800 mb-4",children:g.name}),(0,b.jsx)("div",{className:"bg-white rounded-t-xl border",children:(0,b.jsx)("nav",{className:"flex gap-6 px-6 h-14 items-center",children:[{key:"overview",label:"Overview"},{key:"invoices",label:"Invoices"},{key:"payments",label:"Payments"},{key:"files",label:"Files"},{key:"notes",label:"Notes"},{key:"activity",label:"Activity"},{key:"discussion",label:"Discussion"}].map(a=>{let c=m===a.key;return(0,b.jsxs)("button",{onClick:()=>n(a.key),className:`relative text-sm font-medium py-3 ${c?"text-blue-600":"text-gray-600"}`,children:[a.label,c&&(0,b.jsx)("span",{className:"absolute -bottom-3 left-0 w-full h-0.5 bg-blue-500 rounded"})]},a.key)})})}),(0,b.jsxs)("div",{className:"bg-white rounded-b-xl border border-t-0 p-6",children:["overview"===m&&(0,b.jsx)(v,{project:g,metrics:i}),"invoices"===m&&(0,b.jsx)(L,{projectId:g.id}),"payments"===m&&(0,b.jsx)(R,{projectId:g.id}),"files"===m&&(0,b.jsx)(T,{projectId:g.id}),"notes"===m&&(0,b.jsx)($,{projectId:g.id}),"activity"===m&&(0,b.jsx)(ag,{projectId:g.id}),"discussion"===m&&(0,b.jsx)(at,{projectId:g.id})]})]})}):(0,b.jsx)("div",{className:"p-8 text-center text-red-500",children:"Project not found"})}}];

//# sourceMappingURL=src_app_%28dashboard%29_work_project_%5Bid%5D_page_tsx_3dc6f2f1._.js.map