(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,945255,e=>{"use strict";e.s(["default",()=>s]);var a=e.i(843476),l=e.i(271645),t=e.i(618566);function s(){var e;let s=(0,t.useRouter)(),[r,d]=(0,l.useState)({title:"",leadId:"",pipeline:"",dealStage:"",dealCategory:"",dealAgent:"",dealWatchers:[],value:"",expectedCloseDate:"",dealContact:""}),[n,c]=(0,l.useState)([]),[i,o]=(0,l.useState)([]),[m,x]=(0,l.useState)([]),[h,u]=(0,l.useState)(!1),[p,g]=(0,l.useState)(!0),[b,j]=(0,l.useState)(null),[f,y]=(0,l.useState)(null),[N,v]=(0,l.useState)(["General","Corporate","Retail"]),[C,w]=(0,l.useState)(!1),[k,S]=(0,l.useState)(""),D="".concat("https://6jnqmj85-80.inc1.devtunnels.ms");(0,l.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("accessToken");if(!e)return void j("No access token found. Please log in.");let a=await fetch("/api/hr/employee",{headers:{Authorization:"Bearer ".concat(e)}});if(!a.ok)throw Error("Failed to fetch employees");let l=await a.json();c(l.content||[]);let t=await fetch("/api/deals/stages",{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("Failed to fetch deal stages");let s=await t.json();o(s),s.length>0&&d(e=>({...e,dealStage:s[0].name}));let r=await fetch("".concat(D,"/leads"),{headers:{Authorization:"Bearer ".concat(e)}});if(r.ok){let e=await r.json();x(Array.isArray(e)?e:[])}else console.warn("Failed to fetch leads for dropdown"),x([])}catch(e){console.error(e),j("Failed to load data. Please try again later.")}finally{g(!1)}})()},[]);let A=e=>{let{name:a,value:l}=e.target;d(e=>({...e,[a]:l}))},I=async e=>{if(e.preventDefault(),u(!0),j(null),y(null),!r.title||!r.pipeline||!r.dealStage||!r.dealCategory||!r.dealAgent||!r.value||!r.expectedCloseDate){j("Please fill all required fields."),u(!1);return}try{let e=localStorage.getItem("accessToken");if(!e){j("No access token found. Please log in."),u(!1);return}let a={title:r.title,leadId:r.leadId?Number(r.leadId):void 0,pipeline:r.pipeline,dealStage:r.dealStage,dealCategory:r.dealCategory,dealAgent:r.dealAgent,dealWatchers:r.dealWatchers,value:parseFloat(r.value),expectedCloseDate:r.expectedCloseDate,dealContact:r.dealContact};if(!(await fetch("/api/deals/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(a)})).ok)throw Error("Failed to create deal");y("Deal created successfully!"),setTimeout(()=>s.push("/deals/get"),1e3)}catch(e){console.error(e),j("Failed to create deal. Please try again.")}finally{u(!1)}};if(p)return(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen text-lg font-semibold",children:"Loading form..."});let W=()=>{w(!1),S("")};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex items-start justify-center py-10 px-4",children:[(0,a.jsxs)("div",{className:"w-full max-w-4xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Add Deal Information"}),(0,a.jsx)("button",{onClick:()=>s.back(),"aria-label":"Close",className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,a.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("form",{onSubmit:I,className:"bg-white border rounded-2xl shadow-sm",children:[(0,a.jsxs)("div",{className:"rounded-lg border mx-6 my-6 p-6",children:[(0,a.jsx)("h3",{className:"text-base font-medium mb-4",children:"Deal Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Lead Contact *"}),(0,a.jsxs)("select",{name:"leadId",value:r.leadId,onChange:A,className:"w-full p-2 border rounded-md bg-white",children:[(0,a.jsx)("option",{value:"",children:"--"}),m.map(e=>(0,a.jsxs)("option",{value:String(e.id),children:[e.name||"#".concat(e.id),e.companyName?" â€” ".concat(e.companyName):""]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Name *"}),(0,a.jsx)("input",{type:"text",name:"title",value:r.title,onChange:A,className:"w-full p-2 border rounded-md",placeholder:"--"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Pipeline *"}),(0,a.jsxs)("select",{name:"pipeline",value:r.pipeline,onChange:A,className:"w-full p-2 border rounded-md bg-white",children:[(0,a.jsx)("option",{value:"",children:"--"}),(0,a.jsx)("option",{value:"Default Pipeline",children:"Default Pipeline"}),(0,a.jsx)("option",{value:"Sales",children:"Sales"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Stages *"}),(0,a.jsx)("select",{name:"dealStage",value:r.dealStage,onChange:A,className:"w-full p-2 border rounded-md bg-white",children:i.map(e=>(0,a.jsx)("option",{value:e.name,children:e.name},e.id))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Category"}),(0,a.jsxs)("select",{name:"dealCategory",value:r.dealCategory,onChange:A,className:"w-full p-2 border rounded-md bg-white",children:[(0,a.jsx)("option",{value:"",children:"--"}),N.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsx)("button",{type:"button",className:"px-3 py-2 bg-gray-200 rounded-md text-sm",onClick:()=>{S(""),w(!0)},children:"Add"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Agent"}),(0,a.jsxs)("select",{name:"dealAgent",value:r.dealAgent,onChange:A,className:"w-full p-2 border rounded-md bg-white",children:[(0,a.jsx)("option",{value:"",children:"--"}),n.map(e=>(0,a.jsx)("option",{value:e.employeeId,children:e.name},e.employeeId))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Value"}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border bg-gray-100 text-sm",children:"USD $"}),(0,a.jsx)("input",{type:"number",name:"value",value:r.value,onChange:A,className:"w-full p-2 border rounded-r-md",placeholder:"",min:"0",step:"0.01"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Close Date *"}),(0,a.jsx)("input",{type:"date",name:"expectedCloseDate",value:r.expectedCloseDate,onChange:A,className:"w-full p-2 border rounded-md"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-2",children:"Deal Watcher"}),(0,a.jsxs)("select",{name:"dealWatchers",value:null!=(e=r.dealWatchers[0])?e:"",onChange:e=>d(a=>({...a,dealWatchers:e.target.value?[e.target.value]:[]})),className:"w-full p-2 border rounded-md bg-white",children:[(0,a.jsx)("option",{value:"",children:"--"}),n.map(e=>(0,a.jsx)("option",{value:e.employeeId,children:e.name},e.employeeId))]})]})]})]}),(0,a.jsxs)("div",{className:"mx-6 mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deal Watchers"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:n.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:r.dealWatchers.includes(e.employeeId),onChange:a=>{var l,t;return l=e.employeeId,t=a.target.checked,void d(e=>{let a=e.dealWatchers||[],s=t?[...a,l]:a.filter(e=>e!==l);return{...e,dealWatchers:s}})}}),(0,a.jsx)("span",{className:"text-xs",children:e.name})]},e.employeeId))})]}),(0,a.jsxs)("div",{className:"px-6 pb-8 flex items-center justify-center gap-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>s.back(),className:"px-6 py-2 border rounded-full text-blue-600 hover:bg-blue-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:h,className:"px-6 py-2 rounded-full text-white ".concat(h?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:h?"Creating...":"Update"})]})]}),(0,a.jsxs)("div",{className:"mt-4 text-center",children:[b&&(0,a.jsx)("div",{className:"text-sm text-red-600 font-medium",children:b}),f&&(0,a.jsx)("div",{className:"text-sm text-green-600 font-medium",children:f})]})]}),C&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-20 bg-black/30",children:(0,a.jsxs)("div",{className:"w-full max-w-2xl bg-white rounded-lg shadow-lg border border-slate-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Deal Category"}),(0,a.jsx)("button",{onClick:W,className:"text-slate-500",children:(0,a.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,a.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("table",{className:"w-full table-auto border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-blue-50 text-left",children:[(0,a.jsx)("th",{className:"p-3 text-sm",children:"#"}),(0,a.jsx)("th",{className:"p-3 text-sm",children:"Category Name"}),(0,a.jsx)("th",{className:"p-3 text-sm",children:"Action"})]})}),(0,a.jsxs)("tbody",{children:[0===N.length&&(0,a.jsx)("tr",{className:"border-t",children:(0,a.jsx)("td",{className:"p-3 text-sm",colSpan:3,children:"No categories"})}),N.map((e,l)=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"p-3 text-sm",children:l+1}),(0,a.jsx)("td",{className:"p-3 text-sm cursor-pointer",onClick:()=>{d(a=>({...a,dealCategory:e})),w(!1)},children:e}),(0,a.jsx)("td",{className:"p-3 text-sm text-center",children:(0,a.jsx)("button",{onClick:()=>{confirm('Delete category "'.concat(e,'"?'))&&(v(a=>a.filter(a=>a!==e)),d(a=>a.dealCategory===e?{...a,dealCategory:""}:a))},className:"text-red-600",children:"ðŸ—‘"})})]},e))]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"text-sm block mb-1",children:"Deal Category Name *"}),(0,a.jsx)("input",{className:"w-full px-3 py-2 rounded-md border border-slate-200",value:k,onChange:e=>S(e.target.value),placeholder:"--"})]}),(0,a.jsxs)("div",{className:"mt-4 flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:W,className:"px-4 py-2 border rounded-md",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{let e=k.trim();e&&(N.includes(e)?d(a=>({...a,dealCategory:e})):(v(a=>[...a,e]),d(a=>({...a,dealCategory:e}))),W())},className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"Save"})]})]})]})})]})}}]);