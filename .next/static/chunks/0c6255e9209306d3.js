(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,769419,e=>{"use strict";e.s(["default",()=>w],769419);var t=e.i(843476),l=e.i(271645),a=e.i(522016),r=e.i(283599);function s(e){let{onCreated:a,getToken:r}=e,[s,n]=(0,l.useState)(!1),[i,o]=(0,l.useState)(""),[d,c]=(0,l.useState)(!1),[u,m]=(0,l.useState)(null);async function x(e){e&&e.preventDefault(),m(null);let t=r();if(!t)return void m("No access token found. Please log in.");try{c(!0);let e=await fetch("/api/deals/stages",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({name:i})});if(!e.ok){let t=await e.text().catch(()=>"");throw Error(t||"Failed to create stage")}o(""),n(!1),await (null==a?void 0:a())}catch(e){var l;m(null!=(l=null==e?void 0:e.message)?l:"Failed to create stage")}finally{c(!1)}}return(0,t.jsxs)("div",{className:"relative",children:[s?null:(0,t.jsx)("button",{onClick:()=>n(!0),className:"rounded-md bg-blue-600 px-3 py-2 text-white hover:opacity-95",children:"+ Add Stage"}),s&&(0,t.jsxs)("div",{"aria-modal":"true",role:"dialog",className:"fixed inset-0 z-50 flex items-start justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{d||(n(!1),m(null),o(""))}}),(0,t.jsxs)("div",{className:"relative mt-8 w-[820px] max-w-[95%] rounded-lg bg-white shadow-xl ring-1 ring-black/5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"Add New Deal Stage"}),(0,t.jsx)("button",{"aria-label":"Close",onClick:()=>{d||(n(!1),m(null),o(""))},className:"text-slate-400 hover:text-slate-600 rounded-md p-1",children:(0,t.jsx)("span",{style:{fontSize:20,lineHeight:1},children:"×"})})]}),(0,t.jsxs)("form",{onSubmit:x,className:"px-6 py-6",children:[(0,t.jsxs)("div",{className:"rounded-md border border-gray-200 p-4 bg-gray-50",children:[(0,t.jsxs)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:["Deal Stage ",(0,t.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,t.jsx)("input",{value:i,onChange:e=>o(e.target.value),placeholder:"--",className:"w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-slate-800 outline-none focus:ring-2 focus:ring-blue-300"})]}),u&&(0,t.jsx)("div",{className:"mt-3 text-sm text-red-600",children:u}),(0,t.jsxs)("div",{className:"mt-8 flex items-center justify-center gap-4",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{d||(n(!1),o(""),m(null))},className:"rounded-md border border-blue-500 px-6 py-2 text-blue-600 hover:bg-blue-50",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:!i||d,className:"rounded-md bg-blue-600 px-6 py-2 text-white disabled:opacity-50",children:d?"Saving...":"Save"})]})]})]})]})]})}e.i(247167);var n=e.i(87316),i=e.i(343432),o=e.i(541071),d=e.i(727612);let c="".concat("https://6jnqmj85-80.inc1.devtunnels.ms"),u="".concat(c,"/deals/admin/priorities"),m="".concat(c,"/employee/all");function x(e){let{stages:a,deals:r,search:s,filters:n}=e,i=s.trim().toLowerCase(),[m,x]=(0,l.useState)(a);(0,l.useEffect)(()=>{x(a)},[a]);let f=r.filter(e=>{if(n.pipeline&&e.pipeline!==n.pipeline||n.category&&e.dealCategory!==n.category)return!1;if(i){var t,l,a,r,s;if(!"".concat(e.title," ").concat(e.id," ").concat(null!=(l=e.dealCategory)?l:""," ").concat(null!=(a=e.pipeline)?a:""," ").concat(null!=(s=null!=(r=null==(t=e.dealAgentMeta)?void 0:t.name)?r:e.dealAgent)?s:"").toLowerCase().includes(i))return!1}return!0}),[p,g]=(0,l.useState)(null);(0,l.useEffect)(()=>{g(localStorage.getItem("accessToken"))},[]);let[b,y]=(0,l.useState)(()=>[{id:-1,name:"Medium",color:"#FBBF24"},{id:-2,name:"High",color:"#F97316"},{id:-3,name:"Low",color:"#15803D"}]),[j,w]=(0,l.useState)(!0),v=e=>{let t=new Map;for(let s of e){let e=s.name.trim().toLowerCase(),n=t.get(e);if(n){var l,a,r;let i=!n.id&&s.id||s.id&&n.id&&s.id!==n.id?{id:null!=(l=s.id)?l:n.id,name:s.name,color:s.color}:{id:null!=(a=n.id)?a:s.id,name:n.name,color:null!=(r=n.color)?r:s.color};t.set(e,i)}else t.set(e,s)}return Array.from(t.values())};(0,l.useEffect)(()=>{let e=!0;if(null!==p)return(async()=>{w(!0);try{let t={"Content-Type":"application/json"};p&&(t.Authorization="Bearer ".concat(p));let l=await fetch(u,{headers:t});if(!l.ok)throw Error("Failed to load priorities: ".concat(l.status));let a=await l.json();if(!e)return;let r=Array.isArray(a)?a.map(e=>{var t,l;return{id:e.id,name:String(null!=(t=e.status)?t:e.status),color:null!=(l=e.color)?l:"#2563EB"}}):[];r.length>0&&y(e=>v([...e,...r]))}catch(e){console.error("Error loading priorities:",e)}finally{e&&w(!1)}})(),()=>{e=!1}},[p]);let N=async(e,t)=>{var l,a;let r={"Content-Type":"application/json"};p&&(r.Authorization="Bearer ".concat(p));let s=await fetch(u,{method:"POST",headers:r,body:JSON.stringify({status:e,color:t,isGlobal:!0})});if(!s.ok){let e=await C(s);throw Error("Failed to create global priority: ".concat(s.status," ").concat(e))}let n=await s.json();return{id:n.id,name:null!=(l=n.status)?l:e,color:null!=(a=n.color)?a:t}},S=async(e,t)=>{var l,a,r,s;let n={"Content-Type":"application/json"};p&&(n.Authorization="Bearer ".concat(p));let i=await fetch("".concat(c,"/deals/").concat(e,"/priority/assign"),{method:"POST",headers:n,body:JSON.stringify({priorityId:t})});if(!i.ok){let e=await C(i);throw Error("Failed to assign priority: ".concat(i.status," ").concat(e))}let o=await i.json();return{id:o.id,name:null!=(a=o.status)?a:String(null!=(l=o.status)?l:t),color:null!=(r=o.color)?r:"#2563EB",dealId:null!=(s=o.dealId)?s:e}},A=async(e,t)=>{var l,a,r,s;let n={"Content-Type":"application/json"};p&&(n.Authorization="Bearer ".concat(p));let i=await fetch("".concat(c,"/deals/").concat(e,"/priority"),{method:"PUT",headers:n,body:JSON.stringify({priorityId:t})});if(!i.ok){let e=await C(i);throw Error("Failed fallback PUT update: ".concat(i.status," ").concat(e))}let o=await i.json();return{id:o.id,name:null!=(a=o.status)?a:String(null!=(l=o.status)?l:t),color:null!=(r=o.color)?r:"#2563EB",dealId:null!=(s=o.dealId)?s:e}};async function C(e){try{if(!(e.headers.get("content-type")||"").includes("application/json"))return await e.text();{let t=await e.json();return JSON.stringify(t)}}catch(e){return"<could not read response body>"}}let k=async(e,t,l,a)=>{if(a)try{let e=await S(l,a);return y(t=>v([...t,{id:e.id,name:e.name,color:e.color}])),e}catch(e){console.error("Assign failed, attempting fallback. Assign error:",e);try{let e=await A(l,a);return y(t=>v([...t,{id:e.id,name:e.name,color:e.color}])),e}catch(e){throw console.error("Fallback PUT failed:",e),e}}try{let a=await N(e,t);y(e=>v([...e,a]));try{let e=await S(l,a.id);return y(t=>v([...t,{id:e.id,name:e.name,color:e.color}])),e}catch(e){console.error("Assign after create failed, attempting fallback. Assign error:",e);try{let e=await A(l,a.id);return y(t=>v([...t,{id:e.id,name:e.name,color:e.color}])),e}catch(e){throw console.error("Fallback PUT failed after create:",e),e}}}catch(e){throw console.error("Create global priority failed:",e),e}},[E,T]=(0,l.useState)(null),I=async e=>{try{let t={"Content-Type":"application/json"};p&&(t.Authorization="Bearer ".concat(p));let l=await fetch("".concat(c,"/stages/").concat(e),{method:"DELETE",headers:t});if(!l.ok){let e=await C(l);throw Error("Failed to delete stage: ".concat(l.status," ").concat(e))}x(t=>t.filter(t=>String(t.id)!==String(e))),T(null)}catch(e){console.error("Delete stage failed:",e),T(null)}};return(0,t.jsx)("div",{className:"relative w-full",children:(0,t.jsx)("div",{className:"flex gap-6 overflow-x-auto pb-4 px-1",children:m.map(e=>{let l=f.filter(t=>t.dealStage===e.name);return(0,t.jsxs)("div",{className:"min-w-[340px] max-w-[380px] flex-shrink-0 flex flex-col",children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-2 w-2 rounded-full bg-primary"}),(0,t.jsx)("h2",{className:"text-sm font-semibold text-foreground",children:e.name})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"inline-flex items-center justify-center h-6 w-6 rounded-full bg-muted text-xs font-medium text-muted-foreground",children:l.length}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("button",{type:"button",className:"h-8 w-8 rounded-full flex items-center justify-center text-muted-foreground hover:bg-muted/10",onClick:()=>T(t=>t===e.id?null:e.id),"aria-expanded":E===e.id,"aria-label":"Stage menu",children:(0,t.jsx)(o.MoreHorizontal,{className:"w-4 h-4"})}),E===e.id&&(0,t.jsx)("div",{className:"absolute right-0 mt-2 w-36 bg-white border border-border shadow-lg rounded-md z-40",children:(0,t.jsxs)("button",{type:"button",onClick:()=>I(e.id),className:"w-full text-left px-4 py-3 flex items-center gap-3 hover:bg-red-50 rounded-md",children:[(0,t.jsx)(d.Trash2,{className:"w-4 h-4 text-red-600"}),(0,t.jsx)("span",{className:"text-sm text-red-600 font-medium",children:"Delete"})]})})]})]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-3 flex-1 bg-muted/30 rounded-xl p-3 min-h-[400px]",children:0===l.length?(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No deals in this stage"})}):l.map(e=>(0,t.jsx)(h,{deal:e,palette:b,paletteLoading:j,addPriorityAndAssignFlow:k,token:p},e.id))})]},e.id)})})})}function f(e){return e.split(" ").map(e=>e?e[0]:"").join("").slice(0,2).toUpperCase()}function p(e){try{let t=new Date(e);return isNaN(t.getTime())?null:t}catch(e){return null}}function h(e){var a,r,s,o,d,u,x,h,g,b,y,j,w,v,N,S,A;let{deal:C,palette:k,paletteLoading:E,addPriorityAndAssignFlow:T,token:I}=e,B=C.leadName||C.contactName||(null==(a=C.dealAgentMeta)?void 0:a.name)||C.dealAgent||"Unknown",M=null!=(r=C.title)?r:"Deal",P=Array.isArray(C.tags)?C.tags:C.tags?String(C.tags).split(",").map(e=>e.trim()):[],L=null!=(x=null!=(u=null!=(d=null!=(o=null!=(s=C.comments)?s:C.dealComments)?o:C.commentsMeta)?d:C.latestComments)?u:C.recentComments)?x:null,F=e=>{if(!e)return[];if(Array.isArray(e))return e.map(e=>{var t,l,a,r;return e?"string"==typeof e?e:"object"==typeof e?String(null!=(r=null!=(a=null!=(l=null!=(t=e.commentText)?t:e.comment)?l:e.text)?a:e.body)?r:""):String(e):""}).map(e=>e.trim()).filter(Boolean);if("object"==typeof e){var t,l,a,r;let s=String(null!=(r=null!=(a=null!=(l=null!=(t=e.commentText)?t:e.comment)?l:e.text)?a:e.body)?r:"");return s?[s]:[]}return[String(e)]},z=F(L),D=null!=(v=null!=(w=null!=(j=null!=(y=null!=(b=null!=(g=null!=(h=C.followups)?h:C.followUps)?g:C.followupHistory)?b:C.followupsMeta)?y:C.followupList)?j:C.followups_data)?w:C.followupsArray)?v:null,U=e=>{if(!e)return[];if(Array.isArray(e))return e.map(e=>{var t,l,a,r,s,n;if(!e)return"";let i=null!=(n=null!=(s=null!=(r=null!=(a=null!=(l=null!=(t=e.createdAt)?t:e.created_at)?l:e.createdDate)?a:e.createdDateTime)?r:e.created)?s:e.dateCreated)?n:e.date;return i?String(i):"string"==typeof e||"number"==typeof e?String(e):""}).map(e=>e.trim()).filter(Boolean);if("object"==typeof e){var t,l,a,r,s;let n=null!=(s=null!=(r=null!=(a=null!=(l=null!=(t=e.createdAt)?t:e.created_at)?l:e.createdDate)?a:e.created)?r:e.dateCreated)?s:e.date;return n?[String(n)]:[]}return[String(e)]},O=U(D),W=null!=(S=null!=(N=C.nextFollowupDate)?N:C.nextFollowup)?S:C.next_followup,H=W?p(String(W)):null,J=C.contactPhone||C.phone||C.contact||C.mobile||C.contact_number||"",R=Array.isArray(C.watchers)?C.watchers:Array.isArray(C.dealWatchers)?C.dealWatchers:C.dealWatchersMeta?C.dealWatchersMeta:C.assignedEmployeesMeta?C.assignedEmployeesMeta:C.assignedEmployees?C.assignedEmployees:[],_=C.priority,[K,G]=(0,l.useState)((e=>{if(!e)return[];if(Array.isArray(e))return e.map(e=>{var t;return"string"==typeof e?{name:e,color:void 0}:{name:null!=(t=null==e?void 0:e.name)?t:String(e),color:null==e?void 0:e.color}});if("object"==typeof e){var t;return[{name:null!=(t=e.name)?t:String(e),color:e.color}]}return[{name:String(e),color:void 0}]})(_)),[q,V]=(0,l.useState)(!1),Q=(0,l.useRef)(null),[X,Y]=(0,l.useState)(!1),[Z,$]=(0,l.useState)(""),[ee,et]=(0,l.useState)("#000000"),[el,ea]=(0,l.useState)(!1),[er,es]=(0,l.useState)(!1),[en,ei]=(0,l.useState)([]),[eo,ed]=(0,l.useState)(""),[ec,eu]=(0,l.useState)([]),[em,ex]=(0,l.useState)(""),[ef,ep]=(0,l.useState)(""),[eh,eg]=(0,l.useState)([]),[eb,ey]=(0,l.useState)({}),[ej,ew]=(0,l.useState)(!1),[ev,eN]=(0,l.useState)(!1),[eS,eA]=(0,l.useState)(P),[eC,ek]=(0,l.useState)(R),[eE,eT]=(0,l.useState)(z),[eI,eB]=(0,l.useState)(O);(0,l.useEffect)(()=>{var e,t,l,a,r,s,n,i,o,d,c,u,m,x,f;eA(Array.isArray(C.tags)?C.tags:C.tags?String(C.tags).split(",").map(e=>e.trim()):[]);let p=null!=(r=null!=(a=null!=(l=null!=(t=null!=(e=C.assignedEmployeesMeta)?e:C.dealWatchersMeta)?t:C.dealWatchers)?l:C.assignedEmployees)?a:C.watchers)?r:[];ek(Array.isArray(p)?p:[]),eT(F(null!=(d=null!=(o=null!=(i=null!=(n=null!=(s=C.comments)?s:C.dealComments)?n:C.commentsMeta)?i:C.latestComments)?o:C.recentComments)?d:null)),eB(U(null!=(f=null!=(x=null!=(m=null!=(u=null!=(c=C.followups)?c:C.followUps)?u:C.followupHistory)?m:C.followupsMeta)?x:C.followupList)?f:null))},[C]),(0,l.useEffect)(()=>{let e=e=>{q&&Q.current&&!Q.current.contains(e.target)&&V(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[q]),(0,l.useEffect)(()=>{let e=!0;if(null!==I)return(async()=>{ew(!0);try{let t={"Content-Type":"application/json"};I&&(t.Authorization="Bearer ".concat(I));let l=await fetch(m,{headers:t});if(!l.ok)throw Error("Failed to fetch employees: ".concat(l.status));let a=await l.json();if(!e)return;eg(Array.isArray(a)?a:[]);let r={};(Array.isArray(a)?a:[]).forEach(e=>{(null==e?void 0:e.employeeId)&&(r[String(e.employeeId)]=e)}),ey(r)}catch(e){console.error("Error fetching employees:",e)}finally{e&&ew(!1)}})(),()=>{e=!1}},[I]);let eM=async e=>{G([{name:e.name,color:e.color}]);try{let t=await T(e.name,e.color,C.id,e.id);G([{name:t.name,color:t.color}])}catch(e){console.error("Failed to persist selected priority:",e)}},eP=async()=>{if(Z.trim()){ea(!0);try{let e=await T(Z.trim(),ee||"#000000",C.id);G([{name:e.name,color:e.color}]),Y(!1),V(!1)}catch(e){console.error("Could not save/assign priority",e)}finally{ea(!1)}}},eL=()=>{Y(!1)},eF=eh.filter(e=>{if(!em)return!0;let t=em.toLowerCase();return String(e.employeeId||"").toLowerCase().includes(t)||String(e.name||"").toLowerCase().includes(t)}).slice(0,8),ez=async()=>{let e=Array.from(new Set([...eS.map(e=>String(e).trim()).filter(Boolean),...en.map(e=>String(e).trim()).filter(Boolean)])),t=[];for(let e of eC)e&&("string"==typeof e?t.push(e):e.employeeId?t.push(String(e.employeeId)):void 0===e.employeeId&&e.name&&e.name);let l=Array.from(new Set([...t,...ec.map(e=>String(e).trim()).filter(Boolean)])),a={};if(e.length>0&&(a.tags=e),l.length>0&&(a.employeeIds=l),ef&&ef.trim()&&(a.comments=[{commentText:ef.trim()}]),!a.tags&&!a.employeeIds&&!a.comments)return void es(!1);try{var r,s,n,i,o,d;let e,t={"Content-Type":"application/json"};I&&(t.Authorization="Bearer ".concat(I));let l=await fetch((e=C.id,"".concat(c,"/deals/").concat(e,"/bulk")),{method:"POST",headers:t,body:JSON.stringify(a)});if(!l.ok){let e=await safeReadResponseText(l);throw Error("Bulk update failed: ".concat(l.status," ").concat(e))}let u=await l.json();if(Array.isArray(u.tags)?eA(u.tags):a.tags&&eA(a.tags),Array.isArray(u.assignedEmployeesMeta)&&u.assignedEmployeesMeta.length>0)ek(u.assignedEmployeesMeta);else if(Array.isArray(u.dealWatchersMeta)&&u.dealWatchersMeta.length>0)ek(u.dealWatchersMeta);else if(a.employeeIds&&a.employeeIds.length>0){let e=a.employeeIds.map(e=>{let t=eb[e];return t?{employeeId:e,name:t.name,profilePictureUrl:t.profilePictureUrl}:{employeeId:e,name:e}});ek(e)}if(Array.isArray(u.comments)&&u.comments.length>0){let e=F(u.comments);eT(e)}else if(a.comments&&a.comments.length>0){let e=String(null!=(r=a.comments[0].commentText)?r:"").trim();e&&eT(t=>[e,...t].slice(0,6))}let m=null!=(d=null!=(o=null!=(i=null!=(n=null!=(s=u.followups)?s:u.followUps)?n:u.followupHistory)?i:u.followupsMeta)?o:u.followupList)?d:null;if(m){let e=U(m);Array.isArray(e)&&e.length>0&&eB(e)}es(!1)}catch(e){console.error("Failed to save Add modal data:",e),es(!1)}},eD=(e=>{let t=null;for(let l of e){let e=p(l);e&&(!t||e.getTime()>t.getTime())&&(t=e)}return t})([...eI,...O]),eU=null!=H?H:eD;return(0,t.jsxs)("div",{className:"group rounded-lg border border-border bg-card hover:border-primary/50 hover:shadow-md transition-all duration-200 cursor-default",children:[(0,t.jsxs)("div",{className:"p-4 flex flex-col gap-3 relative",children:[(0,t.jsxs)("div",{className:"absolute right-3 top-3",children:[(0,t.jsx)("div",{children:0===K.length?(0,t.jsx)("button",{type:"button",onClick:()=>V(e=>!e),className:"inline-flex items-center gap-2 px-2 py-1 rounded-full text-sm font-medium","aria-expanded":q,"aria-label":"Toggle priority popover",children:(0,t.jsxs)("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-border text-sm font-medium text-blue-600 bg-white/60",children:[(0,t.jsx)("span",{className:"text-[14px]",children:"＋"}),(0,t.jsx)("span",{className:"text-xs",children:"Add priority"})]})}):(0,t.jsx)("button",{type:"button",onClick:()=>V(!0),className:"h-6 w-6 rounded-full flex items-center justify-center","aria-label":"Open priority list",title:K.map(e=>e.name).join(", "),children:(0,t.jsx)("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:null!=(A=K[0].color)?A:"rgba(59,130,246,0.9)"}})})}),q&&(0,t.jsxs)("div",{ref:Q,className:"mt-2 w-44 rounded-lg bg-white border border-border shadow-lg p-3 text-sm z-50",role:"dialog","aria-modal":"false",children:[(0,t.jsx)("div",{className:"flex flex-col gap-2",children:E?(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Loading..."}):k.map(e=>{var l;return(0,t.jsxs)("button",{type:"button",onClick:()=>eM(e),className:"flex items-center gap-3 px-2 py-2 rounded-md hover:bg-muted/20 text-left",children:[(0,t.jsx)("span",{className:"h-3 w-3 rounded-full",style:{backgroundColor:e.color}}),(0,t.jsx)("span",{className:"font-medium",style:{color:e.color},children:e.name})]},null!=(l=e.id)?l:e.name)})}),(0,t.jsx)("div",{className:"border-t border-border/60 my-2"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{Y(!0)},className:"h-8 w-8 rounded-full flex items-center justify-center bg-blue-600 text-white",title:"Add",children:"＋"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Add"})]})})]})]}),(0,t.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-foreground truncate",children:B}),(0,t.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,t.jsx)("div",{className:"text-xs text-muted-foreground truncate",children:M})}),eE&&eE.length>0&&(0,t.jsx)("div",{className:"flex gap-2 flex-wrap mt-2",children:eE.slice(0,3).map((e,l)=>(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-muted/20 text-muted-foreground max-w-[200px] truncate",children:e},l))})]})}),eS.length>0&&(0,t.jsx)("div",{className:"flex gap-2 flex-wrap",children:eS.slice(0,3).map((e,l)=>(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-md bg-muted/60 text-muted-foreground",children:e},l))}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("div",{className:"flex items-center gap-3 text-sm",children:J?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(i.Phone,{className:"w-4 h-4 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:J})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(i.Phone,{className:"w-4 h-4 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:"—"})]})}),(0,t.jsx)("div",{className:"flex items-center gap-3",children:eU?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)(n.Calendar,{className:"w-4 h-4 flex-shrink-0"}),(0,t.jsx)("span",{children:function(e){try{return e.toLocaleDateString()}catch(t){return String(e)}}(eU)})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)(n.Calendar,{className:"w-4 h-4 flex-shrink-0"}),(0,t.jsx)("span",{children:"No follow-up"})]})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsxs)("div",{className:"flex -space-x-2",children:[eC&&eC.length>0?eC.slice(0,4).map((e,l)=>{let a=(null==e?void 0:e.profilePictureUrl)||(null==e?void 0:e.profileUrl)||(null==e?void 0:e.avatar)||(null==e?void 0:e.avatarUrl),r=(null==e?void 0:e.name)||(null==e?void 0:e.displayName)||(null==e?void 0:e.employeeId)||String(e);return a?(0,t.jsx)("img",{src:a,alt:r,title:r,className:"h-7 w-7 rounded-full border-2 border-white shadow-sm"},l):(0,t.jsx)("div",{title:r,className:"h-7 w-7 rounded-full bg-muted flex items-center justify-center text-xs font-medium border-2 border-white shadow-sm",children:f(r)},l)}):(0,t.jsx)("div",{className:"h-7 w-7 rounded-full bg-muted flex items-center justify-center text-xs font-medium border-2 border-white shadow-sm",children:f(B)}),eC&&eC.length>4&&(0,t.jsxs)("div",{className:"h-7 w-7 rounded-full bg-muted/80 flex items-center justify-center text-xs font-medium border-2 border-white shadow-sm",children:["+",eC.length-4]})]})}),(0,t.jsx)("div",{children:(0,t.jsx)("button",{type:"button",onClick:()=>{es(!0)},className:"h-8 w-8 rounded-full border border-border flex items-center justify-center bg-white text-blue-600 shadow-sm",title:"Add watcher",children:"＋"})})]})]}),X&&(0,t.jsxs)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center",role:"dialog","aria-modal":"true","aria-label":"Priority modal",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:eL}),(0,t.jsxs)("div",{className:"relative z-10 w-[380px] bg-white rounded-lg shadow-lg border border-border p-5",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Add"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Priority Status *"}),(0,t.jsx)("input",{type:"text",value:Z,onChange:e=>$(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-border text-sm"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Color Code *"}),(0,t.jsx)("input",{type:"text",value:ee,onChange:e=>et(e.target.value),placeholder:"eg #000000",className:"w-full px-4 py-3 rounded-xl border border-border text-sm"})]})]}),(0,t.jsxs)("div",{className:"mt-6 flex items-center justify-between gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:eL,className:"w-1/2 px-6 py-3 rounded-full border border-blue-600 text-blue-600 text-sm font-medium",children:"Cancel"}),(0,t.jsx)("button",{type:"button",onClick:eP,className:"w-1/2 px-6 py-3 rounded-full bg-blue-600 text-white text-sm font-medium",disabled:el,children:el?"Saving...":"Save"})]})]})]}),er&&(0,t.jsxs)("div",{className:"fixed inset-0 z-[70] flex items-center justify-center",role:"dialog","aria-modal":"true","aria-label":"Add modal",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>es(!1)}),(0,t.jsxs)("div",{className:"relative z-20 w-[380px] bg-white rounded-lg shadow-lg border border-border p-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"Add"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-muted-foreground mb-1",children:"Tags"}),(0,t.jsxs)("div",{className:"min-h-[40px] border border-border rounded-md px-2 py-2 flex items-center gap-2 flex-wrap",children:[en.map(e=>(0,t.jsxs)("div",{className:"inline-flex items-center gap-1 bg-blue-100 text-blue-700 rounded-full px-2 py-1 text-xs",children:[(0,t.jsx)("span",{children:e}),(0,t.jsx)("button",{type:"button",onClick:()=>ei(t=>t.filter(t=>t!==e)),className:"text-[12px] leading-none px-1",children:"✕"})]},e)),(0,t.jsx)("input",{value:eo,onChange:e=>ed(e.target.value),onKeyDown:e=>{if("Enter"===e.key||","===e.key){e.preventDefault();let t=eo.trim();t&&!en.includes(t)&&ei(e=>[...e,t]),ed("")}else"Backspace"===e.key&&""===eo&&ei(e=>e.slice(0,-1))},placeholder:"Add a tag and press Enter",className:"flex-1 min-w-[80px] text-sm outline-none"})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-muted-foreground mb-1",children:"People"}),(0,t.jsxs)("div",{className:"min-h-[40px] border border-border rounded-md px-2 py-2 flex items-center gap-2 flex-wrap",children:[ec.map(e=>{let l=eb[e],a=l?l.name:e;return(0,t.jsxs)("div",{className:"inline-flex items-center gap-1 bg-muted/20 text-muted-foreground rounded-full px-2 py-1 text-xs",children:[(0,t.jsx)("span",{children:a}),(0,t.jsx)("button",{type:"button",onClick:()=>eu(t=>t.filter(t=>t!==e)),className:"text-[12px] leading-none px-1",children:"✕"})]},e)}),(0,t.jsx)("input",{value:em,onChange:e=>{ex(e.target.value),eN(!0)},onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let t=em.trim();if(!t)return;let l=eh.find(e=>{var l;return e.employeeId===t||(null==(l=e.name)?void 0:l.toLowerCase())===t.toLowerCase()}),a=l?String(l.employeeId):t;a&&!ec.includes(a)&&eu(e=>[...e,a]),ex(""),eN(!1)}else"Backspace"===e.key&&""===em?eu(e=>e.slice(0,-1)):eN(!0)},placeholder:"Add people and press Enter (e.g. EMP-002)",className:"flex-1 min-w-[80px] text-sm outline-none",onFocus:()=>eN(!0)})]}),ev&&eF.length>0&&(0,t.jsxs)("div",{className:"absolute left-0 right-0 mt-1 bg-white border border-border shadow z-30 rounded-md max-h-56 overflow-auto",children:[ej?(0,t.jsx)("div",{className:"p-2 text-xs text-muted-foreground",children:"Loading..."}):eF.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>(e=>{if(!e||!e.employeeId)return;let t=String(e.employeeId);ec.includes(t)||eu(e=>[...e,t]),ex(""),eN(!1)})(e),className:"w-full text-left px-3 py-2 hover:bg-muted/20 flex items-center gap-3",children:[e.profilePictureUrl?(0,t.jsx)("img",{src:e.profilePictureUrl,alt:e.name,className:"h-6 w-6 rounded-full object-cover"}):(0,t.jsx)("div",{className:"h-6 w-6 rounded-full bg-muted flex items-center justify-center text-xs font-medium",children:f(e.name||e.employeeId)}),(0,t.jsxs)("div",{className:"flex-1 text-sm",children:[(0,t.jsx)("div",{className:"font-medium text-foreground",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.employeeId})]})]},e.employeeId)),0===eF.length&&(0,t.jsx)("div",{className:"p-2 text-xs text-muted-foreground",children:"No employees found"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-muted-foreground mb-1",children:"Comment"}),(0,t.jsx)("textarea",{value:ef,onChange:e=>ep(e.target.value),className:"w-full min-h-[100px] rounded-md border border-border p-2 text-sm"})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-between gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>es(!1),className:"w-1/2 px-4 py-2 rounded-md border border-blue-600 text-blue-600 text-sm font-medium",children:"Cancel"}),(0,t.jsx)("button",{type:"button",onClick:ez,className:"w-1/2 px-4 py-2 rounded-md bg-blue-600 text-white text-sm font-medium",children:"Save"})]})]})]})]})}var g=e.i(519455),b=e.i(677572),y=e.i(373264),j=e.i(614135);function w(){let[e,n]=(0,l.useState)(null),[i,o]=(0,l.useState)(""),[d,c]=(0,l.useState)(null),[u,m]=(0,l.useState)(null);(0,l.useEffect)(()=>{n(localStorage.getItem("accessToken"))},[]);let f=async t=>{if(!e)throw Error("No access token found. Please log in.");let l=await fetch(t,{headers:{Authorization:"Bearer ".concat(e)}});if(!l.ok)throw Error("Failed to fetch ".concat(t));return l.json()},{data:p=[],isLoading:h,error:w,mutate:v}=(0,r.default)(e?"/api/deals/stages":null,f),{data:N=[],isLoading:S,error:A,mutate:C}=(0,r.default)(e?"/api/deals/get":null,f),k=(null==w?void 0:w.message)||(null==A?void 0:A.message)||null;(0,l.useMemo)(()=>p.map(e=>({...e,deals:N.filter(t=>t.dealStage===e.name)})),[p,N]);let E=(0,l.useMemo)(()=>({pipeline:d||void 0,category:u||void 0}),[d,u]);return h||S?(0,t.jsx)("div",{className:"flex justify-center items-center min-h-screen text-lg font-semibold",children:"Loading stages and deals..."}):k?(0,t.jsx)("div",{className:"flex justify-center items-center min-h-screen text-lg font-semibold text-red-600",children:k}):(0,t.jsx)("main",{className:"container mx-auto max-w-6xl px-4 py-8",children:(0,t.jsx)("div",{className:"flex flex-col min-h-screen  overflow-x-hidden",children:(0,t.jsxs)("div",{className:"p-6 max-w-[1400px] mx-auto w-full",children:[(0,t.jsxs)("header",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,t.jsx)(s,{onCreated:async()=>{await v()},getToken:()=>e}),(0,t.jsx)(g.Button,{asChild:!0,children:(0,t.jsx)(a.default,{href:"/deals/create",children:"Add Deals"})})]}),(0,t.jsx)("div",{className:"mb-4 flex justify-end",children:(0,t.jsx)(b.Tabs,{className:"w-auto",defaultValue:"table",children:(0,t.jsxs)(b.TabsList,{children:[(0,t.jsx)(b.TabsTrigger,{value:"table",asChild:!0,children:(0,t.jsx)(a.default,{href:"/deals/get",className:"flex items-center gap-2",children:(0,t.jsx)(j.TableIcon,{className:"h-4 w-4"})})}),(0,t.jsx)(b.TabsTrigger,{value:"kanban",asChild:!0,children:(0,t.jsx)(a.default,{href:"/deals/stages",className:"flex items-center gap-2",children:(0,t.jsx)(y.LayoutGrid,{className:"h-4 w-4"})})})]})})})]}),(0,t.jsx)("main",{className:"flex-1 overflow-x-auto",children:(0,t.jsx)(x,{stages:p,deals:N,search:i,filters:E})}),(0,t.jsx)("footer",{className:"mt-6",children:(0,t.jsx)(a.default,{href:"/",className:"text-blue-600 hover:underline",children:"Back to Home"})})]})})})}}]);