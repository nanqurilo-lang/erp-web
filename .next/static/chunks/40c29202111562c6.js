(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,755838,(e,t,r)=>{"use strict";var n=e.r(271645),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},l=n.useState,i=n.useEffect,o=n.useLayoutEffect,s=n.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!a(e,r)}catch(e){return!0}}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),n=l({inst:{value:r,getSnapshot:t}}),a=n[0].inst,d=n[1];return o(function(){a.value=r,a.getSnapshot=t,c(a)&&d({inst:a})},[e,r,t]),i(function(){return c(a)&&d({inst:a}),e(function(){c(a)&&d({inst:a})})},[e]),s(r),r};r.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:d},802239,(e,t,r)=>{"use strict";t.exports=e.r(755838)},283599,20353,e=>{"use strict";let t;e.s(["default",()=>ea],283599);var r=e.i(271645),n=e.i(802239);e.s(["B",()=>g,"I",()=>O,"O",()=>f,"S",()=>G,"U",()=>u,"a",()=>h,"b",()=>c,"c",()=>q,"d",()=>J,"e",()=>m,"f",()=>K,"g",()=>H,"i",()=>w,"j",()=>$,"m",()=>p,"n",()=>z,"o",()=>P,"r",()=>T,"s",()=>F,"t",()=>L,"u",()=>I,"z",()=>E],20353),e.s(["ERROR_REVALIDATE_EVENT",()=>o,"FOCUS_EVENT",()=>a,"MUTATE_EVENT",()=>i,"RECONNECT_EVENT",()=>l],211671);let a=0,l=1,i=2,o=3;var s=Object.prototype.hasOwnProperty;let c=new WeakMap,d=()=>{},u=d(),f=Object,m=e=>e===u,h=e=>"function"==typeof e,p=(e,t)=>({...e,...t}),g=e=>h(e.then),v={},x={},b="undefined",w=typeof window!=b,y=typeof document!=b,j=w&&"Deno"in window,E=(e,t)=>{let r=c.get(e);return[()=>!m(t)&&e.get(t)||v,n=>{if(!m(t)){let a=e.get(t);t in x||(x[t]=a),r[5](t,p(a,n),a||v)}},r[6],()=>!m(t)&&t in x?x[t]:!m(t)&&e.get(t)||v]},N=!0,[S,k]=w&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[d,d],R={initFocus:e=>(y&&document.addEventListener("visibilitychange",e),S("focus",e),()=>{y&&document.removeEventListener("visibilitychange",e),k("focus",e)}),initReconnect:e=>{let t=()=>{N=!0,e()},r=()=>{N=!1};return S("online",t),S("offline",r),()=>{k("online",t),k("offline",r)}}},O=!r.default.useId,T=!w||j,L=e=>w&&typeof window.requestAnimationFrame!=b?window.requestAnimationFrame(e):setTimeout(e,1),I=T?r.useEffect:r.useLayoutEffect,_="undefined"!=typeof navigator&&navigator.connection,C=!T&&_&&(["slow-2g","2g"].includes(_.effectiveType)||_.saveData),U=new WeakMap,D=(e,t)=>e==="[object ".concat(t,"]"),A=0,V=e=>{let t,r,n=typeof e,a=f.prototype.toString.call(e),l=D(a,"Date"),i=D(a,"RegExp"),o=D(a,"Object");if(f(e)!==e||l||i)t=l?e.toJSON():"symbol"==n?e.toString():"string"==n?JSON.stringify(e):""+e;else{if(t=U.get(e))return t;if(t=++A+"~",U.set(e,t),Array.isArray(e)){for(r=0,t="@";r<e.length;r++)t+=V(e[r])+",";U.set(e,t)}if(o){t="#";let n=f.keys(e).sort();for(;!m(r=n.pop());)m(e[r])||(t+=r+":"+V(e[r])+",");U.set(e,t)}}return t},F=e=>{if(h(e))try{e=e()}catch(t){e=""}let t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?V(e):"",t]},M=0,P=()=>++M;async function z(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[n,a,l,o]=t,s=p({populateCache:!0,throwOnError:!0},"boolean"==typeof o?{revalidate:o}:o||{}),d=s.populateCache,f=s.rollbackOnError,v=s.optimisticData,x=s.throwOnError;if(h(a)){let e=[];for(let t of n.keys())!/^\$(inf|sub)\$/.test(t)&&a(n.get(t)._k)&&e.push(t);return Promise.all(e.map(b))}return b(a);async function b(e){let r,[a]=F(e);if(!a)return;let[o,p]=E(n,a),[b,w,y,j]=c.get(n),N=()=>{let t=b[a];return(h(s.revalidate)?s.revalidate(o().data,e):!1!==s.revalidate)&&(delete y[a],delete j[a],t&&t[0])?t[0](i).then(()=>o().data):o().data};if(t.length<3)return N();let S=l,k=!1,R=P();w[a]=[R,0];let O=!m(v),T=o(),L=T.data,I=T._c,_=m(I)?L:I;if(O&&p({data:v=h(v)?v(_,L):v,_c:_}),h(S))try{S=S(_)}catch(e){r=e,k=!0}if(S&&g(S)){let e;if(S=await S.catch(e=>{r=e,k=!0}),R!==w[a][0]){if(k)throw r;return S}k&&O&&(e=r,"function"==typeof f?f(e):!1!==f)&&(d=!0,p({data:_,_c:u}))}if(d&&!k&&(h(d)?p({data:d(S,_),error:u,_c:u}):p({data:S,error:u,_c:u})),w[a][1]=P(),Promise.resolve(N()).then(()=>{p({_c:u})}),k){if(x)throw r;return}return S}}let B=(e,t)=>{for(let r in e)e[r][0]&&e[r][0](t)},W=(e,t)=>{if(!c.has(e)){let r=p(R,t),n=Object.create(null),i=z.bind(u,e),o=d,s=Object.create(null),f=(e,t)=>{let r=s[e]||[];return s[e]=r,r.push(t),()=>r.splice(r.indexOf(t),1)},m=(t,r,n)=>{e.set(t,r);let a=s[t];if(a)for(let e of a)e(r,n)},h=()=>{if(!c.has(e)&&(c.set(e,[n,Object.create(null),Object.create(null),Object.create(null),i,m,f]),!T)){let t=r.initFocus(setTimeout.bind(u,B.bind(u,n,a))),i=r.initReconnect(setTimeout.bind(u,B.bind(u,n,l)));o=()=>{t&&t(),i&&i(),c.delete(e)}}};return h(),[e,i,h,o]}return[e,c.get(e)[4]]},[q,$]=W(new Map),J=p({onLoadingSlow:d,onSuccess:d,onError:d,onErrorRetry:(e,t,r,n,a)=>{let l=r.errorRetryCount,i=a.retryCount,o=~~((Math.random()+.5)*(1<<(i<8?i:8)))*r.errorRetryInterval;(m(l)||!(i>l))&&setTimeout(n,o,a)},onDiscarded:d,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:C?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:C?5e3:3e3,compare:function e(t,r){var n,a;if(t===r)return!0;if(t&&r&&(n=t.constructor)===r.constructor){if(n===Date)return t.getTime()===r.getTime();if(n===RegExp)return t.toString()===r.toString();if(n===Array){if((a=t.length)===r.length)for(;a--&&e(t[a],r[a]););return -1===a}if(!n||"object"==typeof t){for(n in a=0,t)if(s.call(t,n)&&++a&&!s.call(r,n)||!(n in r)||!e(t[n],r[n]))return!1;return Object.keys(r).length===a}}return t!=t&&r!=r},isPaused:()=>!1,cache:q,mutate:$,fallback:{}},{isOnline:()=>N,isVisible:()=>{let e=y&&document.visibilityState;return m(e)||"hidden"!==e}}),K=(e,t)=>{let r=p(e,t);if(t){let{use:n,fallback:a}=e,{use:l,fallback:i}=t;n&&l&&(r.use=n.concat(l)),a&&i&&(r.fallback=p(a,i))}return r},G=(0,r.createContext)({}),H=e=>{let{value:t}=e,n=(0,r.useContext)(G),a=h(t),l=(0,r.useMemo)(()=>a?t(n):t,[a,n,t]),i=(0,r.useMemo)(()=>a?l:K(n,l),[a,n,l]),o=l&&l.provider,s=(0,r.useRef)(u);o&&!s.current&&(s.current=W(o(i.cache||q),l));let c=s.current;return c&&(i.cache=c[0],i.mutate=c[1]),I(()=>{if(c)return c[2]&&c[2](),c[3]},[]),(0,r.createElement)(G.Provider,p(e,{value:i}))};var X=e.i(211671);let Q=w&&window.__SWR_DEVTOOLS_USE__,Y=(Q?window.__SWR_DEVTOOLS_USE__:[]).concat(e=>(t,r,n)=>{let a=r&&function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];let[l]=F(t),[,,,i]=c.get(q);if(l.startsWith("$inf$"))return r(...n);let o=i[l];return m(o)?r(...n):(delete i[l],o)};return e(t,a,n)});Q&&(window.__SWR_DEVTOOLS_REACT__=r.default);let Z=()=>{},ee=Z();new WeakMap;let et=r.default.use||(e=>{switch(e.status){case"pending":throw e;case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}}),er={dedupe:!0},en=Promise.resolve(u);f.defineProperty(H,"defaultValue",{value:J});let ea=(t=(e,t,a)=>{let{cache:l,compare:i,suspense:o,fallbackData:s,revalidateOnMount:d,revalidateIfStale:f,refreshInterval:v,refreshWhenHidden:x,refreshWhenOffline:b,keepPreviousData:w}=a,[y,j,N,S]=c.get(l),[k,R]=F(e),_=(0,r.useRef)(!1),C=(0,r.useRef)(!1),U=(0,r.useRef)(k),D=(0,r.useRef)(t),A=(0,r.useRef)(a),V=()=>A.current.isVisible()&&A.current.isOnline(),[M,B,W,q]=E(l,k),$=(0,r.useRef)({}).current,J=m(s)?m(a.fallback)?u:a.fallback[k]:s,K=(e,t)=>{for(let r in $)if("data"===r){if(!i(e[r],t[r])&&(!m(e[r])||!i(ei,t[r])))return!1}else if(t[r]!==e[r])return!1;return!0},G=(0,r.useMemo)(()=>{let e=!!k&&!!t&&(m(d)?!A.current.isPaused()&&!o&&!1!==f:d),r=t=>{let r=p(t);return(delete r._k,e)?{isValidating:!0,isLoading:!0,...r}:r},n=M(),a=q(),l=r(n),i=n===a?l:r(a),s=l;return[()=>{let e=r(M());return K(e,s)?(s.data=e.data,s.isLoading=e.isLoading,s.isValidating=e.isValidating,s.error=e.error,s):(s=e,e)},()=>i]},[l,k]),H=(0,n.useSyncExternalStore)((0,r.useCallback)(e=>W(k,(t,r)=>{K(r,t)||e()}),[l,k]),G[0],G[1]),Q=!_.current,Y=y[k]&&y[k].length>0,Z=H.data,ee=m(Z)?J&&g(J)?et(J):J:Z,ea=H.error,el=(0,r.useRef)(ee),ei=w?m(Z)?m(el.current)?ee:el.current:Z:ee,eo=(!Y||!!m(ea))&&(Q&&!m(d)?d:!A.current.isPaused()&&(o?!m(ee)&&f:m(ee)||f)),es=!!(k&&t&&Q&&eo),ec=m(H.isValidating)?es:H.isValidating,ed=m(H.isLoading)?es:H.isLoading,eu=(0,r.useCallback)(async e=>{let t,r,n=D.current;if(!k||!n||C.current||A.current.isPaused())return!1;let l=!0,o=e||{},s=!N[k]||!o.dedupe,c=()=>O?!C.current&&k===U.current&&_.current:k===U.current,d={isValidating:!1,isLoading:!1},f=()=>{B(d)},p=()=>{let e=N[k];e&&e[1]===r&&delete N[k]},g={isValidating:!0};m(M().data)&&(g.isLoading=!0);try{if(s&&(B(g),a.loadingTimeout&&m(M().data)&&setTimeout(()=>{l&&c()&&A.current.onLoadingSlow(k,a)},a.loadingTimeout),N[k]=[n(R),P()]),[t,r]=N[k],t=await t,s&&setTimeout(p,a.dedupingInterval),!N[k]||N[k][1]!==r)return s&&c()&&A.current.onDiscarded(k),!1;d.error=u;let e=j[k];if(!m(e)&&(r<=e[0]||r<=e[1]||0===e[1]))return f(),s&&c()&&A.current.onDiscarded(k),!1;let o=M().data;d.data=i(o,t)?o:t,s&&c()&&A.current.onSuccess(t,k,a)}catch(r){p();let e=A.current,{shouldRetryOnError:t}=e;!e.isPaused()&&(d.error=r,s&&c()&&(e.onError(r,k,e),(!0===t||h(t)&&t(r))&&(!A.current.revalidateOnFocus||!A.current.revalidateOnReconnect||V())&&e.onErrorRetry(r,k,e,e=>{let t=y[k];t&&t[0]&&t[0](X.ERROR_REVALIDATE_EVENT,e)},{retryCount:(o.retryCount||0)+1,dedupe:!0})))}return l=!1,f(),!0},[k,l]),ef=(0,r.useCallback)(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return z(l,U.current,...t)},[]);if(I(()=>{D.current=t,A.current=a,m(Z)||(el.current=Z)}),I(()=>{if(!k)return;let e=eu.bind(u,er),t=0;A.current.revalidateOnFocus&&(t=Date.now()+A.current.focusThrottleInterval);let r=((e,t,r)=>{let n=t[e]||(t[e]=[]);return n.push(r),()=>{let e=n.indexOf(r);e>=0&&(n[e]=n[n.length-1],n.pop())}})(k,y,function(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r==X.FOCUS_EVENT){let r=Date.now();A.current.revalidateOnFocus&&r>t&&V()&&(t=r+A.current.focusThrottleInterval,e())}else if(r==X.RECONNECT_EVENT)A.current.revalidateOnReconnect&&V()&&e();else if(r==X.MUTATE_EVENT)return eu();else if(r==X.ERROR_REVALIDATE_EVENT)return eu(n)});return C.current=!1,U.current=k,_.current=!0,B({_k:R}),eo&&!N[k]&&(m(ee)||T?e():L(e)),()=>{C.current=!0,r()}},[k]),I(()=>{let e;function t(){let t=h(v)?v(M().data):v;t&&-1!==e&&(e=setTimeout(r,t))}function r(){!M().error&&(x||A.current.isVisible())&&(b||A.current.isOnline())?eu(er).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[v,x,b,k]),(0,r.useDebugValue)(ei),o){let e=k&&m(ee);if(!O&&T&&e)throw Error("Fallback data is required when using Suspense in SSR.");e&&(D.current=t,A.current=a,C.current=!1);let r=S[k];if(et(!m(r)&&e?ef(r):en),!m(ea)&&e)throw ea;let n=e?eu(er):en;!m(ei)&&e&&(n.status="fulfilled",n.value=!0),et(n)}return{mutate:ef,get data(){return $.data=!0,ei},get error(){return $.error=!0,ea},get isValidating(){return $.isValidating=!0,ec},get isLoading(){return $.isLoading=!0,ed}}},function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];let l=(()=>{let e=(0,r.useContext)(G);return(0,r.useMemo)(()=>p(J,e),[e])})(),[i,o,s]=h(n[1])?[n[0],n[1],n[2]||{}]:[n[0],null,(null===n[1]?n[2]:n[1])||{}],c=K(l,s),d=t,{use:u}=c,f=(u||[]).concat(Y);for(let e=f.length;e--;)d=f[e](d);return d(i,o||c.fetcher||null,c)})},874673,e=>{"use strict";e.s(["default",()=>u],874673);var t=e.i(843476),r=e.i(271645);e.i(247167);var n=e.i(657688),a=e.i(283599);function l(e){let{chatRoomId:a,senderId:l,receiverId:i,onMessageSent:o}=e,[s,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(null),[f,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(!1),g=(0,r.useRef)(null),v="".concat("https://6jnqmj85-80.inc1.devtunnels.ms"),x=e=>!!e&&/\.(png|jpe?g|gif|webp|svg|bmp|tiff)$/i.test(e);(0,r.useEffect)(()=>{if(!d){f&&(URL.revokeObjectURL(f),m(null));return}if(x(d.name)){let e=URL.createObjectURL(d);return m(e),()=>{URL.revokeObjectURL(e)}}f&&(URL.revokeObjectURL(f),m(null))},[d]);let b=()=>{if(f){try{URL.revokeObjectURL(f)}catch(e){}m(null)}u(null),g.current&&(g.current.value="")},w=async e=>{if(e.preventDefault(),s||d)try{let e;p(!0);let t=localStorage.getItem("accessToken"),r=new FormData;r.append("chatRoomId",a),r.append("senderId",l),r.append("receiverId",i),s&&s.trim().length>0?r.append("content",s.trim()):r.append("content","");let n=d?x(d.name)?"IMAGE":"FILE":"TEXT";r.append("messageType",n),r.append("status","SENT"),d&&r.append("file",d,d.name);let u=await fetch("".concat(v,"/api/chat/send"),{method:"POST",headers:t?{Authorization:"Bearer ".concat(t)}:void 0,body:r}),f=await u.text();try{e=f?JSON.parse(f):null}catch(t){e=f}if(!u.ok){console.error("Send message error details:",e);let t="object"==typeof e&&null!==e?e.error||e.message:String(e||"");throw Error(t||"Failed to send (".concat(u.status,")"))}null==o||o(e),c(""),b()}catch(e){console.error("Send message failed:",e)}finally{p(!1)}};return(0,t.jsxs)("form",{onSubmit:w,className:"flex flex-col gap-3 px-6 py-4 border-t border-gray-200 bg-white",children:[d&&(0,t.jsx)("div",{className:"flex items-start gap-3",children:x(d.name)&&f?(0,t.jsx)("div",{className:"relative w-30 h-20 rounded-md overflow-hidden border",children:(0,t.jsx)(n.default,{src:f,alt:d.name,fill:!0,style:{objectFit:"cover"},unoptimized:!0})}):(0,t.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md border w-full",children:[(0,t.jsx)("div",{className:"flex-none w-10 h-10 rounded-md flex items-center justify-center bg-muted",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 text-gray-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M21.44 11.05l-9.19 9.19a5.5 5.5 0 01-7.78-7.78l9.19-9.19a3.5 3.5 0 014.95 4.95L9.9 17.36a1.5 1.5 0 01-2.12-2.12l8.49-8.49"})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"font-medium truncate",children:d.name}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(d.size/1024).toFixed(1)," KB"]})]}),(0,t.jsx)("button",{type:"button",className:"text-sm text-destructive px-2",onClick:b,children:"Remove"})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{ref:g,type:"file",onChange:e=>{var t;u((null==(t=e.target.files)?void 0:t[0])||null)},className:"hidden",id:"chat-file-input",accept:"image/*,application/pdf,application/msword,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.zip,.txt"}),(0,t.jsxs)("label",{htmlFor:"chat-file-input",className:"inline-flex items-center gap-2 rounded-md px-3 py-2 border border-primary text-primary hover:bg-primary/5 cursor-pointer select-none",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M15.172 7l-6.172 6.172a4 4 0 105.656 5.656L21 13.828a6 6 0 10-8.485-8.486L9.172 8.686"})}),(0,t.jsx)("span",{className:"text-sm",children:"Upload File"})]}),d?(0,t.jsx)("span",{className:"text-xs text-gray-500 truncate max-w-[120px]",children:d.name}):null]}),(0,t.jsx)("input",{type:"text",value:s,onChange:e=>c(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),s&&s.trim()||d)){let t=e.target.closest("form");t&&t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}},placeholder:"Write your message here",className:"flex-1 rounded-md border border-gray-200 px-4 py-3 text-sm outline-none focus-visible:ring-2 focus-visible:ring-primary"}),(0,t.jsx)("button",{type:"submit",disabled:h,className:"ml-auto inline-flex items-center justify-center px-5 py-2 rounded-md bg-primary text-white text-sm disabled:opacity-60 hover:brightness-95",children:h?"Sending...":"Send"})]})]})}var i=e.i(31592),o=e.i(315636);let s="".concat("https://6jnqmj85-80.inc1.devtunnels.ms"),c=async e=>{try{let t=localStorage.getItem("accessToken"),r=await fetch(e,{headers:t?{Authorization:"Bearer ".concat(t)}:{},cache:"no-store"});if(!r.ok){let e=(r.headers.get("content-type")||"").includes("application/json")?await r.json().catch(()=>({})):await r.text().catch(()=>""),t=e&&"object"==typeof e&&(e.error||e.message)||e||"Failed to fetch (".concat(r.status,")");throw Error(t)}return r.json()}catch(e){if(e instanceof Error)throw e;throw Error(String(e))}};function d(e){var d,u,f,m,h;let{chatRoomId:p,employeeid:g,receiverId:v}=e,[x,b]=(0,r.useState)(g||""),w=(0,r.useRef)(null),[y,j]=(0,r.useState)(null),[E,N]=(0,r.useState)(null),[S,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(g)g&&b(g);else{let e=localStorage.getItem("employeeId");e&&b(e)}},[g]);let R=v?"/api/chats/history/".concat(encodeURIComponent(v)):null,{data:O,error:T,isLoading:L,mutate:I}=(0,a.default)(R,c,{revalidateOnFocus:!0}),_=O||[],C=_.length>0&&((null==(d=_.find(e=>{var t;return(null==(t=e.receiverDetails)?void 0:t.employeeId)===v}))?void 0:d.receiverDetails)||(null==(u=_[0])?void 0:u.senderDetails))||null;(0,r.useEffect)(()=>{var e;null==(e=w.current)||e.scrollIntoView({behavior:"smooth"})},[_.length]);let U=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(!v)return;let e="".concat(s.replace(/\/$/,""),"/ws-chat"),t=localStorage.getItem("accessToken")||"",r=new o.Client({webSocketFactory:()=>new i.default(e),reconnectDelay:5e3,heartbeatIncoming:0,heartbeatOutgoing:2e4,connectHeaders:{Authorization:t?"Bearer ".concat(t):"",roomId:p,receiverId:v},onConnect:e=>{try{r.subscribe("/topic/chat.".concat(p),e=>{try{let t=e.body;if(!t)return;let r=JSON.parse(t);if(r&&"message"===r.type&&r.data){let e=r.data;I(t=>t&&t.some(t=>t.id===e.id)?t:t?[...t,e]:[e],!1)}else r&&r.id&&I(e=>e&&e.some(e=>e.id===r.id)?e:e?[...e,r]:[r],!1)}catch(e){console.error("Error parsing topic message",e)}})}catch(e){}try{r.subscribe("/user/queue/messages",e=>{try{let t=JSON.parse(e.body);if(!t)return;if("message"===t.type&&t.data){let e=t.data;I(t=>t&&t.some(t=>t.id===e.id)?t:t?[...t,e]:[e],!1)}else t.id&&I(e=>e&&e.some(e=>e.id===t.id)?e:e?[...e,t]:[t],!1)}catch(e){console.error("Error parsing user queue message",e)}})}catch(e){}try{r.subscribe("/topic/chat.".concat(p,".deleted"),e=>{try{var t;let r=JSON.parse(e.body),n=null!=(t=null==r?void 0:r.messageId)?t:null==r?void 0:r.id;null!=n&&I(e=>e?e.map(e=>e.id===n?{...e,deletedForCurrentUser:!0}:e):e,!1)}catch(e){console.error("Error parsing deleted event",e)}})}catch(e){}},onStompError:e=>{console.error("Broker reported error: "+e.headers.message),console.error("Additional details: "+e.body)}});return r.activate(),U.current=r,()=>{try{U.current&&(U.current.deactivate(),U.current=null)}catch(e){}}},[v,p,I]);let D=async e=>{let t=localStorage.getItem("accessToken");k(!0),I(t=>t?t.map(t=>t.id===e?{...t,deletedForCurrentUser:!0}:t):t,!1);try{let r="".concat(s,"/api/chat/message/").concat(encodeURIComponent(String(e))),n=await fetch(r,{method:"DELETE",headers:t?{Authorization:"Bearer ".concat(t)}:void 0});if(!n.ok){await I();let e=await n.text().catch(()=>"");throw Error(e||"Failed to delete message (".concat(n.status,")"))}await I()}catch(e){console.error("Delete message error:",e),await I()}finally{k(!1),j(null),N(null)}},A=e=>{let{attachment:r,isMine:a}=e;return r?V(r.fileName)?(0,t.jsx)("a",{href:r.fileUrl,download:r.fileName,target:"_blank",rel:"noopener noreferrer",className:"block relative w-30  mt-2 rounded-md overflow-hidden border border-border",children:(0,t.jsx)("div",{className:"relative w-full h-48",children:(0,t.jsx)(n.default,{src:r.fileUrl,alt:r.fileName,fill:!0,sizes:"(max-width: 768px) 100vw, 50vw",style:{objectFit:"cover"},unoptimized:!0})})}):(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-3 p-3 rounded-md border ".concat(a?"bg-primary/5 border-primary/40":"bg-white border-border"),children:[(0,t.jsx)("div",{className:"flex-none w-10 h-10 rounded-md flex items-center justify-center bg-muted",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 text-gray-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M21.44 11.05l-9.19 9.19a5.5 5.5 0 01-7.78-7.78l9.19-9.19a3.5 3.5 0 014.95 4.95L9.9 17.36a1.5 1.5 0 01-2.12-2.12l8.49-8.49"})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("a",{href:r.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"block truncate font-medium",children:r.fileName}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:"Click to download / open"})]})]}):null},V=e=>!!e&&/\.(png|jpe?g|gif|webp|svg|bmp|tiff)$/i.test(e);return(0,t.jsxs)("div",{className:"flex flex-col h-full border border-border rounded-lg overflow-hidden bg-white",children:[C&&(0,t.jsxs)("div",{className:"flex items-center gap-4 px-6 py-4 bg-white border-b border-border",children:[(0,t.jsx)("div",{className:"w-14 h-14 rounded-xl overflow-hidden flex-shrink-0 shadow-sm",children:(0,t.jsx)(n.default,{src:null!=(f=null==C?void 0:C.profileUrl)?f:"/placeholder.svg?height=64&width=64&query=User%20avatar",alt:null!=(m=null==C?void 0:C.name)?m:"User",width:56,height:56,className:"object-cover w-full h-full",unoptimized:!0})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-foreground leading-tight",children:null!=(h=null==C?void 0:C.name)?h:"Unknown"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:(null==C?void 0:C.designation)||"No designation"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==C?void 0:C.department)||"No department"})]})]}),(0,t.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto space-y-4 bg-[rgba(250,250,250,0.8)]",children:[_.map(e=>{var r,a,l,i,o,s,c,d;let u=e.senderId===x;if(e.deletedForCurrentUser)return(0,t.jsxs)("div",{className:"flex items-start gap-3 ".concat(u?"justify-end":"justify-start"),children:[!u&&(0,t.jsx)(n.default,{src:null!=(o=null==(l=e.senderDetails)?void 0:l.profileUrl)?o:"/placeholder.svg?height=32&width=32&query=User%20avatar",alt:null!=(s=null==(i=e.senderDetails)?void 0:i.name)?s:"Unknown",width:32,height:32,className:"rounded-full",unoptimized:!0}),(0,t.jsx)("div",{className:"px-3 py-2 rounded-xl max-w-xs bg-muted italic text-muted-foreground",children:"This message was deleted"})]},e.id);let f=u?"bg-primary text-primary-foreground":"bg-white border border-border text-foreground";return(0,t.jsxs)("div",{className:"relative flex items-start gap-3 ".concat(u?"justify-end":"justify-start"),children:[!u&&(0,t.jsx)(n.default,{src:null!=(c=null==(r=e.senderDetails)?void 0:r.profileUrl)?c:"/placeholder.svg?height=32&width=32&query=User%20avatar",alt:null!=(d=null==(a=e.senderDetails)?void 0:a.name)?d:"Unknown",width:32,height:32,className:"rounded-full",unoptimized:!0}),(0,t.jsxs)("div",{className:"px-4 py-3 rounded-2xl max-w-[75%] break-words ".concat(f),onClick:()=>{var t;return t=e.id,void(j(e=>e===t?null:t),N(null))},children:[e.content&&(0,t.jsx)("p",{className:"whitespace-pre-wrap",children:e.content}),e.fileAttachment&&(0,t.jsx)(A,{attachment:e.fileAttachment,isMine:u}),(0,t.jsx)("div",{className:"text-[11px] mt-1 ".concat(u?"text-primary-foreground/80":"text-muted-foreground"),children:(0,t.jsx)("span",{children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})})]}),y===e.id&&(0,t.jsx)("div",{className:"absolute top-0 transform -translate-y-full right-0 z-20",children:(0,t.jsx)("div",{className:"bg-white border border-border rounded-md shadow-sm py-2 w-36",children:E===e.id?(0,t.jsxs)("div",{className:"px-3",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Are you sure?"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"flex-1 px-2 py-1 rounded-md border text-sm",onClick:e=>{e.stopPropagation(),N(null),j(null)},children:"Cancel"}),(0,t.jsx)("button",{className:"flex-1 px-2 py-1 rounded-md bg-destructive text-white text-sm disabled:opacity-60",disabled:S,onClick:async t=>{t.stopPropagation(),await D(e.id)},children:S?"Deleting...":"Delete"})]})]}):(0,t.jsx)("div",{className:"px-2",children:(0,t.jsx)("button",{className:"w-full text-left px-2 py-2 text-sm hover:bg-muted rounded-md",onClick:t=>{t.stopPropagation(),N(e.id)},children:"Delete"})})})})]},e.id)}),(0,t.jsx)("div",{ref:w})]}),(0,t.jsx)(l,{chatRoomId:p,senderId:x,receiverId:v,onMessageSent:e=>{I(t=>t?[...t,e]:[e],!1),setTimeout(()=>{var e;null==(e=w.current)||e.scrollIntoView({behavior:"smooth"})},100)}})]})}function u(e){let{params:n}=e,{id:a}=(0,r.use)(n),[l,i]=(0,r.useState)(null),[o,s]=(0,r.useState)(!0),[c,u]=(0,r.useState)(null);if((0,r.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("accessToken");if(!e)throw Error("No access token found");let t=await fetch("/api/profile",{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("Failed to fetch profile");let r=await t.json();i({employeeId:r.employeeId})}catch(e){console.error(e),u(e.message||"An error occurred")}finally{s(!1)}})()},[]),o)return(0,t.jsx)("p",{className:"text-center mt-8 text-muted-foreground",children:"Loading chat..."});if(c||!l)return(0,t.jsx)("p",{className:"text-center mt-8 text-destructive",children:"Failed to load user profile."});let f=[l.employeeId,a].sort().join("_");return(0,t.jsx)("div",{className:"flex-1 min-h-0 h-[calc(100vh-4rem)] flex items-start justify-center bg-[rgba(245,245,246,0.9)] p-6",children:(0,t.jsx)("div",{className:"w-full max-w-4xl h-full flex flex-col rounded-xl overflow-hidden bg-white shadow-sm border border-border",children:(0,t.jsx)(d,{chatRoomId:f,employeeid:l.employeeId,receiverId:a})})})}}]);