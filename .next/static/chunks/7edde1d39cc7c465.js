(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,452692,e=>{"use strict";e.s(["default",()=>H],452692);var t=e.i(247167),s=e.i(843476),l=e.i(271645),a=e.i(519455),r=e.i(967489),n=e.i(373375),i=e.i(463059),d=e.i(555436),c=e.i(37727),o=e.i(793479);let m=e=>{let{employeeFilter:t,setEmployeeFilter:l,employeeOptions:a,getEmployeeLabel:n,onOpenFiltersDrawer:i}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-lg border p-3 mb-4 flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Duration"}),(0,s.jsx)(o.Input,{placeholder:"Start Date to End Date",className:"w-64"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Employee"}),(0,s.jsxs)(r.Select,{value:t,onValueChange:e=>l(e),children:[(0,s.jsx)(r.SelectTrigger,{className:"w-40",children:(0,s.jsx)(r.SelectValue,{placeholder:"All"})}),(0,s.jsxs)(r.SelectContent,{children:[(0,s.jsx)(r.SelectItem,{value:"All",children:"All"}),a.slice(1).map(e=>(0,s.jsx)(r.SelectItem,{value:e,children:n(e)},e))]})]})]}),(0,s.jsx)("div",{className:"ml-auto flex items-center gap-4",children:(0,s.jsxs)("button",{onClick:i,className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800",children:[(0,s.jsx)(d.Search,{className:"w-4 h-4"})," Filters"]})})]})};var x=e.i(370956),u=e.i(87316),h=e.i(284614);let p=e=>{let{searchInput:t,setSearchInput:l,setSearchQuery:r,setCurrentPage:n,viewMode:i,setViewMode:c,showCalendarModal:m,setShowCalendarModal:p,openLogForm:g}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:["weekly"===i?(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Weekly Timesheet"}):(0,s.jsx)("div",{children:(0,s.jsx)(a.Button,{className:"bg-blue-600 text-white",onClick:g,children:"+ Log Time"})}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 border rounded px-2 py-1 bg-white",children:[(0,s.jsx)(d.Search,{className:"w-4 h-4 text-gray-400"}),(0,s.jsx)(o.Input,{placeholder:"Search",value:t,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(r(t),n(()=>1))},className:"border-0 bg-transparent focus-visible:ring-0"})]}),(0,s.jsxs)("div",{className:"flex items-center bg-white border rounded-lg overflow-hidden",children:[(0,s.jsx)("button",{onClick:()=>{let e=document.querySelector('input[placeholder="Search"]');e&&e.focus()},className:"px-3 py-2 hover:bg-gray-50",title:"Search",children:(0,s.jsx)(d.Search,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>c("list"),className:"px-3 py-2 hover:bg-gray-50 ".concat("list"===i?"bg-gray-100":""),title:"List view",children:(0,s.jsx)(x.List,{className:"w-4 h-4"})}),(0,s.jsxs)("button",{onClick:()=>{c("weekly")},"aria-pressed":"weekly"===i,title:"Weekly calendar",className:"relative px-3 py-2 hover:bg-gray-50 ".concat("weekly"===i?"bg-violet-600 text-white":""),children:[(0,s.jsx)(u.Calendar,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center text-xs font-semibold leading-none\n                ".concat("weekly"===i?"bg-white text-violet-600":"bg-violet-600 text-white"),"aria-hidden":"true",children:"7"})]}),(0,s.jsx)("button",{onClick:()=>p(!0),className:"px-3 py-2 hover:bg-gray-50 ".concat(m?"ring-2 ring-indigo-300":""),title:"Open calendar view",children:(0,s.jsx)(u.Calendar,{className:"w-4 h-4 text-gray-600"})}),(0,s.jsx)("button",{onClick:()=>c("TimesheetSummary"),className:"px-3 py-2 hover:bg-gray-50 ".concat("TimesheetSummary"===i?"bg-violet-600 text-white":""),title:"User",children:(0,s.jsx)(h.User,{className:"w-4 h-4 text-gray-600"})})]})]})]})};var g=e.i(286536),j=e.i(592930),v=e.i(727612),y=e.i(323585);let b=e=>{var t,l,a,r,n,i,d,c,o,m;let{t:x,openMenuId:u,onToggleMenu:h,onCloseMenu:p,onView:b,onEdit:f,onDelete:N,fmtDateTime:w}=e,k=x.employees&&x.employees.length>0?x.employees[0]:void 0,T=null!=(t=null==k?void 0:k.profileUrl)?t:"/_next/static/media/avatar-placeholder.7b9f2b3a.jpg";return(0,s.jsxs)("tr",{className:"even:bg-white odd:bg-white border-t",children:[(0,s.jsx)("td",{className:"py-4 px-4 text-sm text-gray-700 border-r align-top",children:null!=(l=x.projectShortCode)?l:"—"}),(0,s.jsxs)("td",{className:"py-4 px-4 border-r align-top",children:[(0,s.jsxs)("div",{className:"text-sm font-medium",children:["Task ",null!=(a=x.taskId)?a:"—"]}),(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:null!=(r=x.memo)?r:""})]}),(0,s.jsx)("td",{className:"py-4 px-4 w-48 border-r align-top",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden",children:(0,s.jsx)("img",{src:T,alt:null!=(n=null==k?void 0:k.name)?n:"employee",className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-800",children:null!=(d=null!=(i=null==k?void 0:k.name)?i:x.employeeId)?d:"—"}),(0,s.jsx)("div",{className:"text-xs text-gray-400",children:null!=(o=null!=(c=null==k?void 0:k.designation)?c:null==k?void 0:k.department)?o:""})]})]})}),(0,s.jsx)("td",{className:"py-4 px-4 border-r align-top text-sm text-gray-600",children:w(x.startDate,x.startTime)}),(0,s.jsx)("td",{className:"py-4 px-4 border-r align-top text-sm text-gray-600",children:w(x.endDate,x.endTime)}),(0,s.jsxs)("td",{className:"py-4 px-4 border-r align-top text-sm text-gray-700",children:[null!=(m=x.durationHours)?m:0,"h"]}),(0,s.jsx)("td",{className:"py-4 px-4 align-top text-right",children:(0,s.jsxs)("div",{className:"inline-flex items-center relative",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),"number"==typeof x.id&&h(x.id)},className:"p-2 rounded hover:bg-gray-100",title:"Actions","aria-expanded":u===x.id,children:(0,s.jsx)(y.MoreVertical,{className:"h-5 w-5 text-gray-600"})}),u===x.id&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{onClick:p,className:"fixed inset-0 z-[10005]"}),(0,s.jsx)("div",{className:"absolute right-0 top-8 z-[10010] w-44 bg-white rounded-md border shadow-lg",children:(0,s.jsxs)("div",{className:"p-2",children:[(0,s.jsxs)("button",{onClick:()=>b(x),className:"w-full flex items-center gap-3 px-3 py-2 rounded hover:bg-gray-50 text-sm text-gray-700",children:[(0,s.jsx)(g.Eye,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"View"})]}),(0,s.jsxs)("button",{onClick:()=>f(x),className:"w-full flex items-center gap-3 px-3 py-2 rounded hover:bg-gray-50 text-sm text-gray-700",children:[(0,s.jsx)(j.Edit2,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Edit"})]}),(0,s.jsxs)("button",{onClick:()=>N(x),className:"w-full flex items-center gap-3 px-3 py-2 rounded hover:bg-gray-50 text-sm text-red-600",children:[(0,s.jsx)(v.Trash2,{className:"w-4 h-4 text-red-600"}),(0,s.jsx)("span",{children:"Delete"})]})]})})]})]})})]},x.id)},f="".concat("https://6jnqmj85-80.inc1.devtunnels.ms"),N=["Mon","Tue","Wed","Thurs","Fri","Sat","Sun"],w=["January","February","March","April","May","June","July","August","September","October","November","December"],k=e=>{let{open:t,onClose:a,apiBaseUrl:r=f,authToken:d=null}=e,c=(0,l.useRef)(null),[o,m]=(0,l.useState)([{id:"r-0",taskId:"",taskLabel:"",hours:Array(7).fill(0)}]),x=C(new Date),[u,h]=(0,l.useState)(D(x)),[p,g]=(0,l.useState)(I(x)),[j,v]=(0,l.useState)(!1),[y,b]=(0,l.useState)(null),[N,w]=(0,l.useState)([]),[k,T]=(0,l.useState)(!1);function S(){try{let e=localStorage.getItem("accessToken");if(e&&""!==e.trim())return e.trim()}catch(e){}return null!=d?d:null}async function E(){T(!0);let e=S();try{let t=await fetch("".concat(r,"/me/tasks"),{headers:e?{Authorization:"Bearer ".concat(e)}:{}});if(!t.ok)throw Error("Failed to fetch tasks");let s=await t.json();w(s.map(e=>({id:e.id,title:e.title,projectShortCode:e.projectShortCode})))}catch(e){}finally{T(!1)}}async function A(){v(!0),b("");let e=S(),t={"Content-Type":"application/json"};e&&(t.Authorization="Bearer ".concat(e));try{for(let e of o){if(!e.taskId)continue;let s={taskId:Number(e.taskId),days:u.map((t,s)=>({date:t.iso,hours:Number(e.hours[s]||0)})).filter(e=>e.hours>0)};0!==s.days.length&&await fetch("".concat(r).concat("/timesheets/weekly"),{method:"POST",headers:t,body:JSON.stringify(s)})}b("Saved successfully.")}catch(e){b("Save failed.")}finally{v(!1)}}return(0,l.useEffect)(()=>{E()},[]),(0,s.jsxs)("div",{className:"w-full bg-white border rounded-md shadow-sm p-6",children:[(0,s.jsx)("input",{type:"date",ref:c,className:"hidden",onChange:function(e){let t=new Date(e.target.value);if(isNaN(t.getTime()))return;let s=C(t);h(D(s)),g(I(s))}}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,s.jsx)("span",{className:"w-16 text-sm",children:"Week"}),(0,s.jsxs)("div",{onClick:function(){var e,t;null==(t=c.current)||null==(e=t.showPicker)||e.call(t)},className:"flex items-center border rounded-md bg-white cursor-pointer",children:[(0,s.jsx)("button",{className:"h-9 px-3 border-r",children:(0,s.jsx)(n.ChevronLeft,{className:"w-4 h-4"})}),(0,s.jsx)("div",{className:"px-4 text-sm min-w-[160px] text-center",children:p}),(0,s.jsx)("button",{className:"h-9 px-3 border-l",children:(0,s.jsx)(i.ChevronRight,{className:"w-4 h-4"})})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-md border shadow-sm",children:[(0,s.jsx)("div",{className:"bg-[#e8f0ff] border-b",children:(0,s.jsxs)("div",{className:"grid grid-cols-[180px_repeat(7,1fr)]",children:[(0,s.jsx)("div",{className:"px-4 py-3 text-xs font-medium",children:"Task"}),u.map(e=>(0,s.jsxs)("div",{className:"px-2 py-2 text-center border-l",children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:e.date}),(0,s.jsx)("div",{className:"text-[10px]",children:e.month}),(0,s.jsx)("div",{className:"text-[10px] text-gray-500",children:e.label})]},e.iso))]})}),o.map((e,t)=>(0,s.jsx)("div",{className:"border-b",children:(0,s.jsxs)("div",{className:"grid grid-cols-[180px_repeat(7,1fr)]",children:[(0,s.jsx)("div",{className:"px-4 py-3 border-r",children:(0,s.jsxs)("select",{className:"w-full border rounded-md px-3 py-2 text-sm",value:e.taskId,onChange:e=>(function(e,t){let s=N.find(e=>String(e.id)===t),l=s?"".concat(s.title," (").concat(s.projectShortCode||"PRJ",")"):"";m(s=>s.map((s,a)=>a===e?{...s,taskId:t,taskLabel:l}:s))})(t,e.target.value),children:[(0,s.jsx)("option",{value:"",children:k?"Loading…":"Select Task"}),N.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id))]})}),u.map((l,a)=>(0,s.jsx)("div",{className:"px-2 py-3 border-l flex justify-center",children:(0,s.jsx)("input",{type:"number",min:0,step:"0.25",className:"w-14 text-center border rounded-md text-sm",value:e.hours[a],onChange:e=>{var s;return s=e.target.value,void m(e=>e.map((e,l)=>l===t?{...e,hours:e.hours.map((e,t)=>t===a?function(e){let t=Number(e);return isNaN(t)||t<0?0:t}(s):e)}:e))}})},a))]})},e.id)),(0,s.jsx)("div",{className:"border-t bg-white",children:(0,s.jsxs)("div",{className:"grid grid-cols-[180px_repeat(7,1fr)]",children:[(0,s.jsx)("div",{className:"px-4 py-3 border-r text-sm",children:"Total"}),u.map((e,t)=>(0,s.jsxs)("div",{className:"px-2 py-3 border-l text-center text-sm",children:[o.reduce((e,s)=>e+(Number(s.hours[t])||0),0)," hrs"]},t))]})})]}),(0,s.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{onClick:function(){m(e=>[...e,{id:"r-".concat(Date.now()),taskId:"",taskLabel:"",hours:Array(7).fill(0)}])},className:"px-4 py-2 border border-blue-500 text-blue-600 rounded-md bg-white",children:"+ Add More"}),y&&(0,s.jsx)("div",{className:"mt-3 text-sm whitespace-pre-line",children:y})]}),(0,s.jsx)("button",{onClick:A,disabled:j,className:"px-6 py-2 bg-blue-600 text-white rounded-md",children:j?"Saving…":"Save"})]})]})};function T(e){return String(e).padStart(2,"0")}function S(e){return w[e.getMonth()].slice(0,3)}function I(e){let t="".concat(T(e.getDate())," ").concat(S(e)),s=new Date(e);return s.setDate(e.getDate()+6),"".concat(t," - ").concat(T(s.getDate())," ").concat(S(s))}function C(e){let t=new Date(e);return t.setDate(t.getDate()-(t.getDay()+6)%7),t}function D(e){return Array.from({length:7}).map((t,s)=>{let l=new Date(e);return l.setDate(e.getDate()+s),{date:"".concat(l.getDate()),month:S(l),label:N[s],iso:"".concat(l.getFullYear(),"-").concat(String(l.getMonth()+1).padStart(2,"0"),"-").concat(String(l.getDate()).padStart(2,"0"))}})}let E=e=>{let{events:t,onEventClick:a}=e,[r,d]=(0,l.useState)(()=>{let e=new Date;return new Date(e.getFullYear(),e.getMonth(),1)}),c=(0,l.useMemo)(()=>{let e=new Map;return t.forEach(t=>{var s;if(!t.startDate)return;let l=null!=(s=t.startDate)?s:"";e.has(l)||e.set(l,[]),e.get(l).push(t)}),e},[t]),o=(0,l.useMemo)(()=>{let e=r.getFullYear(),t=r.getMonth(),s=(new Date(e,t,1).getDay()+6)%7,l=new Date(e,t+1,0).getDate(),a=[];for(let e=0;e<s;e++)a.push({date:null});for(let s=1;s<=l;s++)a.push({date:new Date(e,t,s)});for(;a.length%7!=0;)a.push({date:null});return a},[r]),m=r.toLocaleDateString(void 0,{month:"long",year:"numeric"});function x(e){d(t=>new Date(t.getFullYear(),t.getMonth()+e,1))}return(0,s.jsxs)("div",{className:"w-full bg-white rounded-xl shadow-lg overflow-hidden border",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b  bg-gradient-to-r from-indigo-50 to-blue-50",children:[(0,s.jsx)("button",{onClick:()=>x(-1),className:"p-2 hover:bg-white rounded-full shadow-sm",children:(0,s.jsx)(n.ChevronLeft,{className:"w-5 h-5 text-gray-700"})}),(0,s.jsx)("div",{className:"text-lg font-semibold text-gray-700",children:m}),(0,s.jsx)("button",{onClick:()=>x(1),className:"p-2 hover:bg-white rounded-full shadow-sm",children:(0,s.jsx)(i.ChevronRight,{className:"w-5 h-5 text-gray-700"})})]}),(0,s.jsx)("div",{className:"grid grid-cols-7 text-xs text-center border-b bg-gray-100",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(e=>(0,s.jsx)("div",{className:"py-3 font-semibold text-gray-700 tracking-wide",children:e},e))}),(0,s.jsx)("div",{className:"grid grid-cols-7 gap-[1px] bg-gray-200",children:o.map((e,t)=>{var l;if(!e.date)return(0,s.jsx)("div",{className:"bg-gray-50 h-[120px]"},t);let r=function(e){return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0"))}(e.date),n=null!=(l=c.get(r))?l:[];return(0,s.jsxs)("div",{className:"bg-white h-[120px] p-2 flex flex-col border border-gray-100 hover:bg-gray-50 transition group",children:[(0,s.jsx)("div",{className:"text-[12px] font-semibold text-gray-800 mb-1 group-hover:text-blue-600",children:e.date.getDate()}),(0,s.jsxs)("div",{className:"flex flex-col gap-1 overflow-hidden",children:[n.slice(0,4).map(e=>{var t,l;return(0,s.jsxs)("button",{onClick:()=>a(e),className:"text-left rounded-md bg-blue-50 hover:bg-blue-100 transition px-2 py-1 text-[11px] truncate shadow-sm",children:[(0,s.jsxs)("span",{className:"font-medium text-blue-700",children:["Task ",null!=(t=e.taskId)?t:e.id]}),(0,s.jsxs)("span",{className:"text-gray-500",children:[" • ",null!=(l=e.durationHours)?l:0,"h "]})]},e.id)}),n.length>4&&(0,s.jsxs)("div",{className:"text-[10px] text-gray-500",children:["+",n.length-4," more…"]})]})]},t)})})]})},A=void 0!==t.default&&"https://6jnqmj85-80.inc1.devtunnels.ms"||void 0!==t.default&&t.default.env.NEXT_PUBLIC_GATEWAY||"http://localhost:3000",M=()=>"".concat(A.replace(/\/$/,""),"/timesheets/summary");function L(e){if(null==e||isNaN(Number(e)))return"0h";let t=Number(e);return 0===t?"0h":"".concat(t%1==0?t.toFixed(0):t.toFixed(2),"h")}function F(e,t){if(!e)return"-";let s=new Date(t?"".concat(e,"T").concat(t):e);return isNaN(s.getTime())?"".concat(e).concat(t?" "+t:""):s.toLocaleString(void 0,{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function z(e,t,s,l){if(!e||!s)return 0;try{var a,r,n,i;let d=e.split("-").map(Number),c=s.split("-").map(Number),o=0,m=0,x=0,u=0;if(t){let e=t.split(":").map(e=>Number(e));o=null!=(a=e[0])?a:0,m=null!=(r=e[1])?r:0}if(l){let e=l.split(":").map(e=>Number(e));x=null!=(n=e[0])?n:0,u=null!=(i=e[1])?i:0}let h=new Date(d[0],d[1]-1,d[2],o,m),p=new Date(c[0],c[1]-1,c[2],x,u).getTime()-h.getTime();if(isNaN(p)||p<=0)return 0;return Math.round(p/36e5)}catch(e){return 0}}function P(){var e,t,a,r,n,i,d,c,o,m,x,u;let[h,p]=(0,l.useState)(null),[g,j]=(0,l.useState)(!1),[v,y]=(0,l.useState)(null),[b,f]=(0,l.useState)({}),[N,w]=(0,l.useState)(null),[k,T]=(0,l.useState)(!1),[S,I]=(0,l.useState)(null),[C,D]=(0,l.useState)(!1),[E,P]=(0,l.useState)(null),[B,H]=(0,l.useState)({projectId:"",taskId:"",employeeId:"",startDate:"",startTime:"",endDate:"",endTime:"",memo:""}),[U,R]=(0,l.useState)(!1),[O,V]=(0,l.useState)(null),[W,_]=(0,l.useState)(!1),[J,Y]=(0,l.useState)([]),[q,G]=(0,l.useState)(!1),[$,X]=(0,l.useState)(null),[K,Q]=(0,l.useState)([]),[Z,ee]=(0,l.useState)([]);(0,l.useEffect)(()=>{let e=!0;return async function(){j(!0),y(null);try{let t=localStorage.getItem("accessToken"),s={"Content-Type":"application/json"};t&&(s.Authorization="Bearer ".concat(t));let l=await fetch(M(),{headers:s,cache:"no-store"});if(401===l.status){try{localStorage.removeItem("accessToken")}catch(e){}throw Error("401: Unauthorized — please login.")}if(!l.ok){let e=await l.text().catch(()=>"");throw Error("Failed to fetch: ".concat(l.status," ").concat(e))}let a=await l.json();e&&p(a)}catch(t){e&&y((null==t?void 0:t.message)||"Unknown error")}finally{e&&j(!1)}}(),()=>{e=!1}},[]);let et=async e=>{G(!0),X(null);try{let t=e||localStorage.getItem("accessToken"),s="".concat(A.replace(/\/$/,""),"/projects/AllProject"),l=await fetch(s,{method:"GET",headers:t?{Authorization:"Bearer ".concat(t),Accept:"application/json"}:{Accept:"application/json"},cache:"no-store"});if(401===l.status){try{localStorage.removeItem("accessToken")}catch(e){}Y([]),G(!1);return}if(!l.ok){let e=await l.text().catch(()=>"");throw console.error("projects fetch failed",l.status,e),Error("Failed to load projects (".concat(l.status,")"))}let a=await l.json();if(Array.isArray(a)){let e=[];a.forEach(t=>{var s,l,a,r,n;let i=(null!=(s=null==t?void 0:t.shortCode)?s:"").toString().trim(),d=null!=(r=null!=(a=null!=(l=null==t?void 0:t.id)?l:null==t?void 0:t.projectId)?a:null==t?void 0:t._id)?r:null,c=(null!=(n=null==t?void 0:t.name)?n:"").toString().trim(),o=Array.isArray(null==t?void 0:t.assignedEmployees)?t.assignedEmployees:[];null!=d&&i&&e.push({id:d,shortCode:i,name:c,assignedEmployees:o})});let t=new Set,s=[];e.forEach(e=>{t.has(String(e.id))||(t.add(String(e.id)),s.push(e))}),Y(s)}else console.warn("unexpected projects response",a),Y([])}catch(e){var t;console.error("loadProjects error",e),X(String(null!=(t=null==e?void 0:e.message)?t:e)),Y([])}finally{G(!1)}},es=async(e,t)=>{if(!e){Q([]),ee([]);return}let s=Number(e);if(!s||Number.isNaN(s)){Q([]),ee([]);return}try{let e=localStorage.getItem("accessToken"),a="".concat(A.replace(/\/$/,""),"/projects/").concat(s,"/tasks"),r=await fetch(a,{method:"GET",headers:e?{Authorization:"Bearer ".concat(e),Accept:"application/json"}:{Accept:"application/json"},cache:"no-store"});if(!r.ok){let e=await r.text().catch(()=>"");console.error("project tasks fetch failed",r.status,e),Q([]),ee([]);return}let n=await r.json(),i=Array.isArray(n)?n:[];if(Q(i),null!=t&&i.length>0){var l;let e=i.find(e=>e.id===t);ee(null!=(l=null==e?void 0:e.assignedEmployees)?l:[])}else ee([])}catch(e){console.error("fetchProjectTasks error",e),Q([]),ee([])}},el=e=>{if(Q([]),ee([]),V(null),e){var t,s,l,a,r,n,i;P(e.id),H({projectId:void 0!==e.projectId&&null!==e.projectId?String(e.projectId):"",taskId:void 0!==e.taskId&&null!==e.taskId?String(e.taskId):"",employeeId:null!=(l=null!=(s=e.employeeId)?s:e.employees&&(null==(t=e.employees[0])?void 0:t.employeeId))?l:"",startDate:null!=(a=e.startDate)?a:"",startTime:e.startTime?e.startTime.slice(0,5):"",endDate:null!=(r=e.endDate)?r:"",endTime:e.endTime?e.endTime.slice(0,5):"",memo:null!=(n=e.memo)?n:""}),e.projectId&&es(e.projectId,null!=(i=e.taskId)?i:null)}else P(null),H({projectId:"",taskId:"",employeeId:"",startDate:"",startTime:"",endDate:"",endTime:"",memo:""});et(),D(!0),w(null)},ea=async()=>{R(!0),V(null);try{if(!B.projectId||!B.taskId||!B.employeeId||!B.startDate||!B.startTime||!B.endDate||!B.endTime||!B.memo){V("Please fill all required fields."),R(!1);return}let e={projectId:Number(B.projectId),taskId:Number(B.taskId),employeeId:B.employeeId,startDate:B.startDate,startTime:B.startTime,endDate:B.endDate,endTime:B.endTime,memo:B.memo,durationHours:z(B.startDate,B.startTime,B.endDate,B.endTime)},t=localStorage.getItem("accessToken"),s=E?"".concat(A.replace(/\/$/,""),"/timesheets/").concat(E):"".concat(A.replace(/\/$/,""),"/timesheets"),l=await fetch(s,{method:E?"PUT":"POST",headers:{...t?{Authorization:"Bearer ".concat(t)}:{},"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(!l.ok){let e=await l.text().catch(()=>"");throw console.error("save entry failed",l.status,e),Error("Failed to save entry")}D(!1),P(null),H({projectId:"",taskId:"",employeeId:"",startDate:"",startTime:"",endDate:"",endTime:"",memo:""});try{let e=localStorage.getItem("accessToken"),t={"Content-Type":"application/json"};e&&(t.Authorization="Bearer ".concat(e));let s=await fetch(M(),{headers:t,cache:"no-store"});if(s.ok){let e=await s.json();p(e)}}catch(e){}}catch(e){console.error("saveEntry error",e),V((null==e?void 0:e.message)||"Failed to save entry")}finally{R(!1)}},er=async()=>{if(S){R(!0),V(null);try{let e=localStorage.getItem("accessToken"),t=await fetch("".concat(A.replace(/\/$/,""),"/timesheets/").concat(S.id),{method:"DELETE",headers:e?{Authorization:"Bearer ".concat(e)}:void 0});if(!t.ok){let e=await t.text().catch(()=>"");throw console.error("deleteTimesheet failed",t.status,e),Error("Failed to delete timesheet")}_(!1),I(null);try{let e=localStorage.getItem("accessToken"),t={"Content-Type":"application/json"};e&&(t.Authorization="Bearer ".concat(e));let s=await fetch(M(),{headers:t,cache:"no-store"});if(s.ok){let e=await s.json();p(e)}}catch(e){}}catch(e){console.error("deleteTimesheet error",e),V((null==e?void 0:e.message)||"Failed to delete timesheet")}finally{R(!1)}}},en=l.default.useMemo(()=>{let e=new Map;return J.forEach(t=>{var s;null!=t.id&&(null==(s=t.assignedEmployees)?void 0:s.length)&&e.set(String(t.id),t.assignedEmployees)}),e},[J]),ei=l.default.useMemo(()=>{let e=new Set;return(null!=h?h:[]).forEach(t=>{t.timeLogs.forEach(t=>{t.employeeId&&e.add(t.employeeId),t.employees&&t.employees.length>0&&t.employees.forEach(t=>(null==t?void 0:t.employeeId)&&e.add(t.employeeId))})}),["--",...Array.from(e)]},[h]),ed=z(B.startDate,B.startTime,B.endDate,B.endTime);return((0,l.useEffect)(()=>{if(null!=N)return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)};function e(e){let t=e.target;t&&(t.closest("[data-menu-id]")||w(null))}function t(e){"Escape"===e.key&&w(null)}},[N]),g)?(0,s.jsx)("div",{className:"py-6 px-4 text-gray-600",children:"Loading summary…"}):v?(0,s.jsxs)("div",{className:"py-6 px-4 text-red-600",children:["Error loading summaries: ",v]}):h&&0!==h.length?(0,s.jsxs)("div",{className:"space-y-3 px-4 pb-8",children:[h.map(e=>{var t,l,a,r,n;let i=!!b[e.employeeId],d=null==(r=e.timeLogs)||null==(a=r[0])||null==(l=a.employees)||null==(t=l[0])?void 0:t.profileUrl;return(0,s.jsxs)("div",{className:"border rounded-lg bg-white shadow-sm overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 px-4 py-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-50 flex items-center justify-center overflow-hidden border",children:d?(0,s.jsx)("img",{src:d,alt:e.employeeName,className:"w-full h-full object-cover"}):(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.employeeName?e.employeeName.split(" ").map(e=>e[0]).join("").toUpperCase():"?"})}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"font-medium text-sm text-gray-800 truncate",children:e.employeeName}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:null!=(n=e.designation)?n:"—"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsxs)("div",{className:"text-right mr-2",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Total"}),(0,s.jsx)("div",{className:"font-medium text-sm",children:L(e.totalHours)})]}),(0,s.jsx)("button",{onClick:()=>{var t;return t=e.employeeId,void f(e=>({...e,[t]:!e[t]}))},"aria-expanded":i,className:"w-9 h-9 flex items-center justify-center rounded border hover:bg-gray-50",children:i?(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,"aria-hidden":!0,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})}):(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,"aria-hidden":!0,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]})]}),i&&(0,s.jsx)("div",{className:"border-t bg-gray-50 px-4 py-4",children:(0,s.jsx)("div",{className:"overflow-auto",children:(0,s.jsxs)("table",{className:"w-full min-w-[720px] table-fixed text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-xs text-gray-600",children:[(0,s.jsx)("th",{className:"w-1/3 py-2 px-3",children:"Task"}),(0,s.jsx)("th",{className:"w-1/3 py-2 px-3",children:"Time"}),(0,s.jsx)("th",{className:"w-1/6 py-2 px-3 text-center",children:"Total Hours"}),(0,s.jsx)("th",{className:"w-1/6 py-2 px-3 text-center",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:e.timeLogs&&e.timeLogs.length>0?e.timeLogs.map(e=>{var t,l;return(0,s.jsxs)("tr",{className:"border-t bg-white last:border-b",children:[(0,s.jsxs)("td",{className:"py-3 px-3 align-top",children:[(0,s.jsx)("div",{className:"font-medium",children:null!=(t=e.taskName)?t:"Task Name"}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:null!=(l=e.projectName)?l:""})]}),(0,s.jsxs)("td",{className:"py-3 px-3 align-top",children:[(0,s.jsx)("div",{className:"text-xs text-gray-600",children:F(e.startDate,e.startTime)}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:F(e.endDate,e.endTime)})]}),(0,s.jsx)("td",{className:"py-3 px-3 align-top text-center",children:(0,s.jsx)("div",{className:"font-medium",children:L(e.durationHours)})}),(0,s.jsx)("td",{className:"py-3 px-3 align-top text-center relative",children:(0,s.jsxs)("div",{className:"inline-flex items-center gap-2 justify-center relative","data-menu-wrapper":!0,children:[(0,s.jsx)("button",{title:"Actions",onClick:()=>{var t;return t=e.id,void w(e=>e===t?null:t)},className:"p-1 rounded hover:bg-gray-100","aria-haspopup":"true","aria-expanded":N===e.id,children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{d:"M10 6a2 2 0 100-4 2 2 0 000 4zM10 12a2 2 0 100-4 2 2 0 000 4zM10 18a2 2 0 100-4 2 2 0 000 4z"})})}),N===e.id&&(0,s.jsx)("div",{"data-menu-id":!0,className:"absolute right-0 top-full mt-2 w-44 bg-white rounded-md shadow-lg border z-50",children:(0,s.jsxs)("div",{className:"py-1",children:[(0,s.jsxs)("button",{onClick:()=>{I(e),T(!0),w(null),w(null)},className:"w-full text-left px-4 py-2 flex items-center gap-3 text-sm hover:bg-gray-50",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-700",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,s.jsx)("path",{d:"M10 3C6 3 2.7 5.1 1 8c1.7 2.9 5 5 9 5s7.3-2.1 9-5c-1.7-2.9-5-5-9-5zM10 12a4 4 0 110-8 4 4 0 010 8z"}),(0,s.jsx)("path",{d:"M10 7a3 3 0 100 6 3 3 0 000-6z"})]}),(0,s.jsx)("span",{className:"text-gray-800",children:"View"})]}),(0,s.jsxs)("button",{onClick:()=>{el(e),w(null)},className:"w-full text-left px-4 py-2 flex items-center gap-3 text-sm hover:bg-gray-50",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-700",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{d:"M17.414 2.586a2 2 0 010 2.828l-9.9 9.9a1 1 0 01-.465.263l-4 1a1 1 0 01-1.212-1.212l1-4a1 1 0 01.263-.465l9.9-9.9a2 2 0 012.828 0z"})}),(0,s.jsx)("span",{className:"text-gray-800",children:"Edit"})]}),(0,s.jsxs)("button",{onClick:()=>{I(e),_(!0),w(null),V(null),w(null)},className:"w-full text-left px-4 py-2 flex items-center gap-3 text-sm hover:bg-gray-50",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-red-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H3a1 1 0 000 2h14a1 1 0 100-2h-2V3a1 1 0 00-1-1H6zm2 6a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 10-2 0v6a1 1 0 102 0V8z",clipRule:"evenodd"})}),(0,s.jsx)("span",{className:"text-red-600",children:"Delete"})]})]})})]})})]},e.id)}):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:4,className:"py-4 px-3 text-gray-500",children:"No time logs available."})})})]})})})]},e.employeeId)}),k&&S&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[10030] flex items-start justify-center pt-8 px-6",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>T(!1)}),(0,s.jsxs)("div",{className:"relative bg-white w-full max-w-6xl rounded-xl shadow-xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"Timesheet"}),(0,s.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>T(!1),"aria-label":"Close",children:"✕"})]}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 relative bg-white rounded-xl border p-6",children:[(0,s.jsx)("div",{className:"absolute top-4 right-4 text-gray-500",children:"⋮"}),(0,s.jsx)("h4",{className:"text-lg font-medium mb-4",children:"TimeLog Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-y-4 gap-x-6 items-center text-sm",children:[(0,s.jsx)("div",{className:"text-gray-500",children:"Start Time"}),(0,s.jsx)("div",{className:"col-span-2",children:F(S.startDate,S.startTime)}),(0,s.jsx)("div",{className:"text-gray-500",children:"End Time"}),(0,s.jsx)("div",{className:"col-span-2",children:F(S.endDate,S.endTime)}),(0,s.jsx)("div",{className:"text-gray-500",children:"Total Hours"}),(0,s.jsx)("div",{className:"col-span-2",children:"number"==typeof S.durationHours?"".concat(S.durationHours,"h"):"-"}),(0,s.jsx)("div",{className:"text-gray-500",children:"Memo"}),(0,s.jsx)("div",{className:"col-span-2",children:null!=(r=S.memo)?r:"-"}),(0,s.jsx)("div",{className:"text-gray-500",children:"Project"}),(0,s.jsx)("div",{className:"col-span-2",children:null!=(d=null!=(i=null!=(n=S.projectName)?n:S.projectShortCode)?i:S.projectId)?d:"-"}),(0,s.jsx)("div",{className:"text-gray-500",children:"Task"}),(0,s.jsx)("div",{className:"col-span-2",children:null!=(o=S.taskName)?o:"Task ".concat(null!=(c=S.taskId)?c:"-")}),(0,s.jsx)("div",{className:"text-gray-500",children:"Employee"}),(0,s.jsxs)("div",{className:"col-span-2 flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:S.employees&&(null==(e=S.employees[0])?void 0:e.profileUrl)?(0,s.jsx)("img",{src:S.employees[0].profileUrl,alt:null!=(m=S.employees[0].name)?m:"",className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-6 h-6 rounded-full bg-gray-200"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-sm",children:S.employees&&(null==(t=S.employees[0])?void 0:t.name)?S.employees[0].name:S.employeeId}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:S.employees&&(null==(a=S.employees[0])?void 0:a.designation)?S.employees[0].designation:""})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border p-5",children:[(0,s.jsx)("h5",{className:"font-medium mb-3",children:"History"}),(0,s.jsxs)("div",{className:"space-y-4 text-sm text-gray-700",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"text-gray-500",children:"Start Time"}),(0,s.jsx)("div",{children:F(S.startDate,S.startTime)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"text-gray-500",children:"Task"}),(0,s.jsx)("div",{children:null!=(u=S.taskName)?u:"Task ".concat(null!=(x=S.taskId)?x:"-")})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"text-gray-500",children:"End Time"}),(0,s.jsx)("div",{children:F(S.endDate,S.endTime)})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-8 pb-6",children:[(0,s.jsx)("button",{onClick:()=>T(!1),className:"px-6 py-2 rounded-md border text-blue-600",children:"Close"}),(0,s.jsx)("button",{onClick:()=>{S&&el(S),T(!1)},className:"px-6 py-2 rounded-md bg-blue-600 text-white",children:"Edit"})]})]})]})]}),C&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[10020] flex items-start justify-center pt-12 px-4",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>D(!1)}),(0,s.jsxs)("div",{className:"relative bg-white w-full max-w-4xl rounded-xl shadow-xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:E?"Edit TimeLog":"Log Time"}),(0,s.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>D(!1),"aria-label":"Close",children:"✕"})]}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-md border p-6",children:[(0,s.jsx)("h4",{className:"text-md font-medium mb-4",children:"TimeLog Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Project *"}),(0,s.jsxs)("select",{value:B.projectId||"",onChange:e=>{let t=e.target.value;H(e=>({...e,projectId:t,taskId:"",employeeId:""})),t?es(t):(Q([]),ee([]))},className:"w-full border rounded px-3 py-2 text-sm",children:[(0,s.jsx)("option",{value:"",children:"--"}),q&&(0,s.jsx)("option",{value:"",children:"Loading..."}),$&&(0,s.jsx)("option",{value:"",children:"Error loading projects"}),J.map(e=>(0,s.jsx)("option",{value:String(e.id),children:null!=e.id?"#".concat(e.id," - ").concat(e.name||e.shortCode):e.name||e.shortCode},"".concat(e.id,"-").concat(e.shortCode)))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Task *"}),(0,s.jsx)("select",{value:B.taskId||"--",onChange:e=>{var t;let s=e.target.value;if("--"===s){H(e=>({...e,taskId:"",employeeId:""})),ee([]);return}let l=Number(s),a=K.find(e=>e.id===l);H(e=>({...e,taskId:s,employeeId:""})),ee(null!=(t=null==a?void 0:a.assignedEmployees)?t:[])},className:"w-full border rounded px-3 py-2 text-sm",disabled:!!B.projectId&&0===K.length,children:B.projectId?0===K.length?(0,s.jsx)("option",{value:"--",children:"No tasks"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("option",{value:"--",children:"--"}),K.map(e=>(0,s.jsx)("option",{value:String(e.id),children:e.title?"".concat(e.id," - ").concat(e.title):"Task ".concat(e.id)},e.id))]}):(0,s.jsx)("option",{value:"--",children:"--"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Employee *"}),(0,s.jsx)("select",{value:B.employeeId||"--",onChange:e=>H(t=>({...t,employeeId:"--"===e.target.value?"":e.target.value})),className:"w-full border rounded px-3 py-2 text-sm",disabled:!!B.projectId&&0===K.length,children:(()=>{var e;let t=B.projectId&&null!=(e=en.get(B.projectId))?e:[];return B.projectId&&0===K.length?(0,s.jsx)("option",{value:"--",children:"No employees"}):Z.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("option",{value:"--",children:"--"}),Z.map(e=>(0,s.jsx)("option",{value:e.employeeId,children:e.name?"".concat(e.name," (").concat(e.employeeId,")"):e.employeeId},e.employeeId))]}):B.projectId&&t.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("option",{value:"--",children:"--"}),t.map(e=>(0,s.jsx)("option",{value:e.employeeId,children:e.name?"".concat(e.name," (").concat(e.employeeId,")"):e.employeeId},e.employeeId))]}):ei.map(e=>(0,s.jsx)("option",{value:e,children:"--"===e?"--":e},e))})()})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Date *"}),(0,s.jsx)("input",{type:"date",value:B.startDate,onChange:e=>H(t=>({...t,startDate:e.target.value})),className:"w-full border rounded px-3 py-2 text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Time *"}),(0,s.jsx)("input",{type:"time",value:B.startTime,onChange:e=>H(t=>({...t,startTime:e.target.value})),className:"w-full border rounded px-3 py-2 text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Date *"}),(0,s.jsx)("input",{type:"date",value:B.endDate,onChange:e=>H(t=>({...t,endDate:e.target.value})),className:"w-full border rounded px-3 py-2 text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Time *"}),(0,s.jsx)("input",{type:"time",value:B.endTime,onChange:e=>H(t=>({...t,endTime:e.target.value})),className:"w-full border rounded px-3 py-2 text-sm"})]})]}),(0,s.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4 items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Memo *"}),(0,s.jsx)("input",{type:"text",value:B.memo,onChange:e=>H(t=>({...t,memo:e.target.value})),className:"w-full border rounded px-3 py-2 text-sm",placeholder:"Memo"})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Total Hours"}),(0,s.jsxs)("div",{className:"text-2xl font-semibold text-blue-600",children:[ed,"h"]})]})]}),O&&(0,s.jsx)("div",{className:"mt-4 text-sm text-red-600",children:O})]}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-8 pb-6",children:[(0,s.jsx)("button",{onClick:()=>D(!1),className:"px-6 py-2 rounded-md border text-blue-600",disabled:U,children:"Cancel"}),(0,s.jsx)("button",{onClick:ea,className:"px-6 py-2 rounded-md bg-blue-600 text-white shadow",disabled:U,children:U?"Saving...":E?"Update":"Save"})]})]})]})]}),W&&S&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[10040] flex items-start justify-center pt-12 px-4",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>_(!1)}),(0,s.jsx)("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl overflow-hidden",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Delete TimeLog"}),(0,s.jsxs)("p",{className:"text-sm text-gray-700",children:["Are you sure you want to delete timesheet ",(0,s.jsxs)("strong",{children:["#",String(S.id)]}),"? This action cannot be undone."]}),O&&(0,s.jsx)("div",{className:"mt-4 text-sm text-red-600",children:O}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-4 mt-6",children:[(0,s.jsx)("button",{className:"px-4 py-2 rounded border",onClick:()=>_(!1),disabled:U,children:"Cancel"}),(0,s.jsx)("button",{className:"px-4 py-2 rounded bg-red-600 text-white",onClick:er,disabled:U,children:U?"Deleting...":"Delete"})]})]})})]})]}):(0,s.jsx)("div",{className:"py-6 px-4 text-gray-600",children:"No summary found."})}let B="https://6jnqmj85-80.inc1.devtunnels.ms";function H(){var e,t,o,x,u,h,g,j,v;let[y,f]=(0,l.useState)([]),[N,w]=(0,l.useState)(!0),[T,S]=(0,l.useState)(null),[I,C]=(0,l.useState)(null),[D,A]=(0,l.useState)(""),[M,L]=(0,l.useState)(""),[F,z]=(0,l.useState)("All"),[H,U]=(0,l.useState)(!1),[R,O]=(0,l.useState)("all"),[V,W]=(0,l.useState)(1),[_,J]=(0,l.useState)(1),[Y,q]=(0,l.useState)("table"),[G,$]=(0,l.useState)(!1),[X,K]=(0,l.useState)(!1),[Q,Z]=(0,l.useState)(!1),[ee,et]=(0,l.useState)(null),[es,el]=(0,l.useState)(null),[ea,er]=(0,l.useState)({projectId:"",taskId:"",employeeId:"",startDate:"",startTime:"",endDate:"",endTime:"",memo:""}),[en,ei]=(0,l.useState)(null),[ed,ec]=(0,l.useState)(!1),[eo,em]=(0,l.useState)(null),[ex,eu]=(0,l.useState)(!1),[eh,ep]=(0,l.useState)([]),[eg,ej]=(0,l.useState)(!1),[ev,ey]=(0,l.useState)(null),[eb,ef]=(0,l.useState)([]),[eN,ew]=(0,l.useState)([]),ek=(0,l.useMemo)(()=>{let e=new Map;return eh.forEach(t=>{var s;null!=t.id&&(null==(s=t.assignedEmployees)?void 0:s.length)&&e.set(String(t.id),t.assignedEmployees)}),e},[eh]),eT=(0,l.useMemo)(()=>{let e=new Set;return y.forEach(t=>{t.employees&&t.employees.length>0?t.employees.forEach(t=>{(null==t?void 0:t.employeeId)&&e.add(t.employeeId)}):t.employeeId&&e.add(t.employeeId)}),["--",...Array.from(e)]},[y]),eS=(0,l.useMemo)(()=>{let e=new Map;return y.forEach(t=>{var s;null==(s=t.employees)||s.forEach(t=>{(null==t?void 0:t.employeeId)&&!e.has(t.employeeId)&&e.set(t.employeeId,t)})}),e},[y]),eI=e=>{if(!e||"--"===e)return"--";let t=eS.get(e);return(null==t?void 0:t.name)?"".concat(t.name," (").concat(e,")"):e},eC=(0,l.useMemo)(()=>{let e=new Set;return y.forEach(t=>{"number"==typeof t.taskId&&e.add(t.taskId)}),["--",...Array.from(e).map(e=>String(e))]},[y]),eD=e=>{if(!e||"--"===e)return"--";let t=Number(e),s=eb.find(e=>e.id===t);return(null==s?void 0:s.title)?"Task ".concat(t," - ").concat(s.title):"Task ".concat(e)},eE=(e,t)=>(function(e,t){if(!e)return"";try{let s=t?"".concat(e,"T").concat(t):"".concat(e,"T00:00:00"),l=new Date(s);if(Number.isNaN(l.getTime()))return"".concat(e," ").concat(null!=t?t:"");let a=String(l.getDate()).padStart(2,"0"),r=String(l.getMonth()+1).padStart(2,"0"),n=l.getFullYear(),i=l.getHours(),d=String(l.getMinutes()).padStart(2,"0"),c=i>=12?"PM":"AM";return i%=12,0===i&&(i=12),"".concat(a,"/").concat(r,"/").concat(n," ").concat(i,":").concat(d," ").concat(c)}catch(s){return"".concat(e," ").concat(null!=t?t:"")}})(e,t),eA=(e,t,s,l)=>{if(!e||!s)return 0;try{let a=e.split("-").map(Number),r=s.split("-").map(Number),n=0,i=0,d=0,c=0;t&&([n,i]=t.split(":").map(e=>Number(e))),l&&([d,c]=l.split(":").map(e=>Number(e)));let o=new Date(a[0],a[1]-1,a[2],n,i),m=new Date(r[0],r[1]-1,r[2],d,c).getTime()-o.getTime();if(isNaN(m)||m<=0)return 0;return Math.round(m/36e5)}catch(e){return 0}},eM=eA(ea.startDate,ea.startTime,ea.endDate,ea.endTime),eL=(0,l.useCallback)(async e=>{var t,s,l;w(!0),C(null);try{let l=e||T||localStorage.getItem("accessToken"),a=new URLSearchParams({page:String(V),limit:String(9),search:M||"",employee:"all"!==R?R:""}),r="".concat(B,"/timesheets?").concat(a.toString()),n=await fetch(r,{method:"GET",headers:l?{Authorization:"Bearer ".concat(l),Accept:"application/json"}:{Accept:"application/json"},cache:"no-store"});if(401===n.status){try{localStorage.removeItem("accessToken")}catch(e){}S(null),f([]),J(1),w(!1);return}if(!n.ok){let e=await n.text().catch(()=>"");throw console.error("timesheets fetch failed",n.status,e),Error("Failed to load timesheets (".concat(n.status,")"))}let i=await n.json(),d=[];Array.isArray(i)?(d=i,J(Math.max(1,Math.ceil((i.length||0)/9)))):(d=Array.isArray(i.items)?i.items:[],J(null!=(s=i.totalPages)?s:Math.max(1,Math.ceil((null!=(t=i.total)?t:d.length)/9)))),f(d)}catch(e){console.error("loadTimesheets error",e),C(String(null!=(l=null==e?void 0:e.message)?l:e)),f([]),J(1)}finally{w(!1)}},[V,M,R,T]),eF=(0,l.useCallback)(async e=>{ej(!0),ey(null);try{let t=e||T||localStorage.getItem("accessToken"),s=await fetch("".concat(B,"/projects/AllProject"),{method:"GET",headers:t?{Authorization:"Bearer ".concat(t),Accept:"application/json"}:{Accept:"application/json"},cache:"no-store"});if(401===s.status){try{localStorage.removeItem("accessToken")}catch(e){}S(null),ep([]),ej(!1);return}if(!s.ok){let e=await s.text().catch(()=>"");throw console.error("projects fetch failed",s.status,e),Error("Failed to load projects (".concat(s.status,")"))}let l=await s.json();if(Array.isArray(l)){let e=[];l.forEach(t=>{var s,l,a,r,n;let i=(null!=(s=null==t?void 0:t.shortCode)?s:"").toString().trim(),d=null!=(r=null!=(a=null!=(l=null==t?void 0:t.id)?l:null==t?void 0:t.projectId)?a:null==t?void 0:t._id)?r:null,c=(null!=(n=null==t?void 0:t.name)?n:"").toString().trim(),o=Array.isArray(null==t?void 0:t.assignedEmployees)?t.assignedEmployees:[];null!=d&&i&&e.push({id:d,shortCode:i,name:c,assignedEmployees:o})});let t=new Set,s=[];e.forEach(e=>{t.has(String(e.id))||(t.add(String(e.id)),s.push(e))}),ep(s)}else console.warn("unexpected projects response",l),ep([])}catch(e){var t;console.error("loadProjects error",e),ey(String(null!=(t=null==e?void 0:e.message)?t:e)),ep([])}finally{ej(!1)}},[T]),ez=(0,l.useCallback)(async(e,t)=>{if(!e){ef([]),ew([]);return}let s=Number(e);if(!s||Number.isNaN(s)){ef([]),ew([]);return}try{let e=T||localStorage.getItem("accessToken"),a="".concat(B,"/projects/").concat(s,"/tasks"),r=await fetch(a,{method:"GET",headers:e?{Authorization:"Bearer ".concat(e),Accept:"application/json"}:{Accept:"application/json"},cache:"no-store"});if(!r.ok){let e=await r.text().catch(()=>"");console.error("project tasks fetch failed",r.status,e),ef([]),ew([]);return}let n=await r.json(),i=Array.isArray(n)?n:[];if(ef(i),null!=t&&i.length>0){var l;let e=i.find(e=>e.id===t);ew(null!=(l=null==e?void 0:e.assignedEmployees)?l:[])}else ew([])}catch(e){console.error("fetchProjectTasks error",e),ef([]),ew([])}},[T]);(0,l.useEffect)(()=>{let e=setTimeout(()=>{L(e=>e!==D?(W(1),D):e)},400);return()=>clearTimeout(e)},[D]),(0,l.useEffect)(()=>{{let e=localStorage.getItem("accessToken");S(e),eL(e),eF(e)}},[]),(0,l.useEffect)(()=>{T?(eL(T),eF(T)):(eL(null),eF(null))},[eL,eF,T,V,M,R]),(0,l.useEffect)(()=>{ei(null)},[V,Y]);let eP=e=>{if(ef([]),ew([]),e){var t,s,l,a,r,n,i,d;let c=e.employees&&e.employees[0]?e.employees[0]:void 0;el(e.id),er({projectId:void 0!==e.projectId&&null!==e.projectId?String(e.projectId):"",taskId:void 0!==e.taskId&&null!==e.taskId?String(e.taskId):"",employeeId:null!=(s=null!=(t=e.employeeId)?t:null==c?void 0:c.employeeId)?s:"",startDate:null!=(l=e.startDate)?l:"",startTime:null!=(a=e.startTime)?a:"",endDate:null!=(r=e.endDate)?r:"",endTime:null!=(n=e.endTime)?n:"",memo:null!=(i=e.memo)?i:""}),e.projectId&&ez(e.projectId,null!=(d=e.taskId)?d:null)}else el(null),er({projectId:"",taskId:"",employeeId:"",startDate:"",startTime:"",endDate:"",endTime:"",memo:""});et(null),K(!0)},eB=async()=>{Z(!0),et(null);try{if(!ea.projectId||!ea.taskId||!ea.employeeId||!ea.startDate||!ea.startTime||!ea.endDate||!ea.endTime||!ea.memo){et("Please fill all required fields."),Z(!1);return}let e={projectId:Number(ea.projectId),taskId:Number(ea.taskId),employeeId:ea.employeeId,startDate:ea.startDate,startTime:ea.startTime,endDate:ea.endDate,endTime:ea.endTime,memo:ea.memo,durationHours:eA(ea.startDate,ea.startTime,ea.endDate,ea.endTime)},t=T||localStorage.getItem("accessToken"),s=es?"".concat(B,"/timesheets/").concat(es):"".concat(B,"/timesheets"),l=await fetch(s,{method:es?"PUT":"POST",headers:{...t?{Authorization:"Bearer ".concat(t)}:{},"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(!l.ok){let e=await l.text().catch(()=>"");throw console.error("save entry failed",l.status,e),Error("Failed to save entry")}K(!1),el(null),er({projectId:"",taskId:"",employeeId:"",startDate:"",startTime:"",endDate:"",endTime:"",memo:""}),await eL(null!=T?T:null)}catch(e){console.error("saveEntry error",e),et((null==e?void 0:e.message)||"Failed to save entry")}finally{Z(!1)}},eH=e=>{em(e),ec(!0),ei(null)},eU=e=>{em(e),eu(!0),ei(null),et(null)},eR=async()=>{if(eo){Z(!0),et(null);try{let e=T||localStorage.getItem("accessToken"),t=await fetch("".concat(B,"/timesheets/").concat(eo.id),{method:"DELETE",headers:e?{Authorization:"Bearer ".concat(e)}:void 0});if(!t.ok){let e=await t.text().catch(()=>"");throw console.error("deleteTimesheet failed",t.status,e),Error("Failed to delete timesheet")}eu(!1),em(null),await eL(null!=T?T:null)}catch(e){console.error("deleteTimesheet error",e),et((null==e?void 0:e.message)||"Failed to delete timesheet")}finally{Z(!1)}}},eO=(0,l.useMemo)(()=>{let e=M.trim().toLowerCase();return y.filter(t=>{var s,l,a,r;if("All"!==F){let e=(null!=(s=t.employees)?s:[]).some(e=>e.employeeId===F),l=t.employeeId===F;if(!e&&!l)return!1}return!!(!e||String(null!=(l=t.projectShortCode)?l:"").toLowerCase().includes(e)||String(null!=(a=t.memo)?a:"").toLowerCase().includes(e)||(null!=(r=t.employees)?r:[]).some(t=>{var s,l;return(null!=(s=t.name)?s:"").toLowerCase().includes(e)||(null!=(l=t.designation)?l:"").toLowerCase().includes(e)}))})},[y,M,F]);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("main",{className:"w-full",children:(0,s.jsxs)("div",{className:"max-w-[1180px] mx-auto ",children:[(0,s.jsx)(m,{employeeFilter:F,setEmployeeFilter:z,employeeOptions:eT,getEmployeeLabel:eI,onOpenFiltersDrawer:()=>U(!0)}),(0,s.jsx)(p,{searchInput:D,setSearchInput:A,setSearchQuery:L,setCurrentPage:W,viewMode:Y,setViewMode:q,showCalendarModal:G,setShowCalendarModal:$,openLogForm:()=>eP()}),"table"!==Y&&"list"!==Y?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-md overflow-hidden",children:(0,s.jsx)("div",{className:"p-0",children:(0,s.jsxs)("table",{className:"w-full table-auto border-collapse",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-sm text-gray-600 border-b bg-blue-50",children:[(0,s.jsx)("th",{className:"py-3 px-4 w-28 border-r",children:"Code"}),(0,s.jsx)("th",{className:"py-3 px-4 border-r",children:"Task"}),(0,s.jsx)("th",{className:"py-3 px-4 w-48 border-r",children:"Employee"}),(0,s.jsx)("th",{className:"py-3 px-4 w-40 border-r",children:"Start Time"}),(0,s.jsx)("th",{className:"py-3 px-4 w-40 border-r",children:"End Time"}),(0,s.jsx)("th",{className:"py-3 px-4 w-28 border-r",children:"Total Hours"}),(0,s.jsx)("th",{className:"py-3 px-4 w-16",children:"Action"})]})}),(0,s.jsxs)("tbody",{children:[N&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"py-6 text-center text-gray-500",children:"Loading..."})}),!N&&0===eO.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"py-6 text-center text-gray-500",children:I?"Error: ".concat(I):"No timesheets found"})}),!N&&eO.map(e=>(0,s.jsx)(b,{t:e,openMenuId:en,onToggleMenu:e=>ei(t=>t===e?null:e),onCloseMenu:()=>ei(null),onView:eH,onEdit:eP,onDelete:eU,fmtDateTime:eE},e.id))]})]})})}),(0,s.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between text-sm text-gray-600",children:[(0,s.jsxs)("div",{children:["Result per page - ",eO.length]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>W(e=>Math.max(1,e-1)),disabled:1===V,children:(0,s.jsx)(n.ChevronLeft,{})}),(0,s.jsxs)("div",{children:["Page ",V," of ",_]}),(0,s.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>W(e=>Math.min(_,e+1)),disabled:V===_,children:(0,s.jsx)(i.ChevronRight,{})})]})]})]})]})}),(0,s.jsx)("div",{"aria-hidden":!H,onClick:()=>U(!1),className:"fixed inset-0 transition-opacity duration-300 z-[9990] ".concat(H?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),style:{backgroundColor:"rgba(0,0,0,0.3)"}}),(0,s.jsxs)("aside",{"aria-hidden":!H,className:"fixed right-0 top-0 h-full w-[360px] bg-white shadow-xl transform transition-transform duration-300 z-[9999] ".concat(H?"translate-x-0":"translate-x-full"),role:"dialog","aria-modal":"true",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.Search,{className:"w-5 h-5"}),(0,s.jsx)("h3",{className:"font-semibold",children:"Filters"})]}),(0,s.jsx)("button",{onClick:()=>U(!1),className:"p-2 rounded hover:bg-gray-100",children:(0,s.jsx)(c.X,{className:"w-4 h-4"})})]}),(0,s.jsx)("div",{className:"p-4 space-y-4 overflow-auto h-[calc(100%-140px)]",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-2",children:"Employee"}),(0,s.jsxs)(r.Select,{value:R,onValueChange:e=>O(e),children:[(0,s.jsx)(r.SelectTrigger,{className:"w-full rounded border px-3 py-2",children:(0,s.jsx)(r.SelectValue,{placeholder:"All"})}),(0,s.jsxs)(r.SelectContent,{children:[(0,s.jsx)(r.SelectItem,{value:"all",children:"All"}),eT.slice(1).map(e=>(0,s.jsx)(r.SelectItem,{value:e,children:eI(e)},e))]})]})]})}),(0,s.jsxs)("div",{className:"p-4 border-t flex items-center justify-between gap-2",children:[(0,s.jsx)(a.Button,{variant:"outline",onClick:()=>{O("all"),U(!1)},children:"Reset"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a.Button,{variant:"ghost",onClick:()=>U(!1),children:"Close"}),(0,s.jsx)(a.Button,{className:"bg-blue-600 text-white",onClick:()=>{U(!1),W(1),eL(null!=T?T:null)},children:"Apply"})]})]})]}),X&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[10020] flex items-start justify-center pt-12 px-4",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>K(!1)}),(0,s.jsxs)("div",{className:"relative bg-white w-full max-w-4xl rounded-xl shadow-xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:es?"Edit TimeLog":"Log Time"}),(0,s.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>K(!1),"aria-label":"Close",children:(0,s.jsx)(c.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-md border p-6",children:[(0,s.jsx)("h4",{className:"text-md font-medium mb-4",children:"TimeLog Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Project *"}),(0,s.jsxs)("select",{value:ea.projectId||"",onChange:e=>{let t=e.target.value;er(e=>({...e,projectId:t,taskId:"",employeeId:""})),t?ez(t):(ef([]),ew([]))},className:"w-full border rounded px-3 py-2 text-sm",children:[(0,s.jsx)("option",{value:"",children:"--"}),eg&&(0,s.jsx)("option",{value:"",children:"Loading..."}),ev&&(0,s.jsx)("option",{value:"",children:"Error loading projects"}),eh.map(e=>(0,s.jsx)("option",{value:String(e.id),children:null!=e.id?"#".concat(e.id," - ").concat(e.name||e.shortCode):e.name||e.shortCode},"".concat(e.id,"-").concat(e.shortCode)))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Task *"}),(0,s.jsx)("select",{value:ea.taskId||"--",onChange:e=>{var t;let s=e.target.value;if("--"===s){er(e=>({...e,taskId:"",employeeId:""})),ew([]);return}let l=Number(s),a=eb.find(e=>e.id===l);er(e=>({...e,taskId:s,employeeId:""})),ew(null!=(t=null==a?void 0:a.assignedEmployees)?t:[])},className:"w-full border rounded px-3 py-2 text-sm",disabled:!!ea.projectId&&0===eb.length,children:ea.projectId?0===eb.length?(0,s.jsx)("option",{value:"--",children:"No tasks"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("option",{value:"--",children:"--"}),eb.map(e=>(0,s.jsx)("option",{value:String(e.id),children:eD(String(e.id))},e.id))]}):eC.map(e=>(0,s.jsx)("option",{value:e,children:"--"===e?"--":eD(e)},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Employee *"}),(0,s.jsx)("select",{value:ea.employeeId||"--",onChange:e=>er(t=>({...t,employeeId:"--"===e.target.value?"":e.target.value})),className:"w-full border rounded px-3 py-2 text-sm",disabled:!!ea.projectId&&0===eb.length,children:(()=>{var e;let t=ea.projectId&&null!=(e=ek.get(ea.projectId))?e:[];return ea.projectId&&0===eb.length?(0,s.jsx)("option",{value:"--",children:"No employees"}):eN.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("option",{value:"--",children:"--"}),eN.map(e=>(0,s.jsx)("option",{value:e.employeeId,children:e.name?"".concat(e.name," (").concat(e.employeeId,")"):e.employeeId},e.employeeId))]}):ea.projectId&&t.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("option",{value:"--",children:"--"}),t.map(e=>(0,s.jsx)("option",{value:e.employeeId,children:e.name?"".concat(e.name," (").concat(e.employeeId,")"):e.employeeId},e.employeeId))]}):eT.map(e=>(0,s.jsx)("option",{value:e,children:eI(e)},e))})()})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Date *"}),(0,s.jsx)("input",{type:"date",value:ea.startDate,onChange:e=>er(t=>({...t,startDate:e.target.value})),className:"w-full border rounded px-3 py-2 text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Time *"}),(0,s.jsx)("input",{type:"time",value:ea.startTime,onChange:e=>er(t=>({...t,startTime:e.target.value})),className:"w-full border rounded px-3 py-2 text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Date *"}),(0,s.jsx)("input",{type:"date",value:ea.endDate,onChange:e=>er(t=>({...t,endDate:e.target.value})),className:"w-full border rounded px-3 py-2 text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Time *"}),(0,s.jsx)("input",{type:"time",value:ea.endTime,onChange:e=>er(t=>({...t,endTime:e.target.value})),className:"w-full border rounded px-3 py-2 text-sm"})]})]}),(0,s.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4 items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Memo *"}),(0,s.jsx)("input",{type:"text",value:ea.memo,onChange:e=>er(t=>({...t,memo:e.target.value})),className:"w-full border rounded px-3 py-2 text-sm",placeholder:"Memo"})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Total Hours"}),(0,s.jsxs)("div",{className:"text-2xl font-semibold text-blue-600",children:[eM,"h"]})]})]}),ee&&(0,s.jsx)("div",{className:"mt-4 text-sm text-red-600",children:ee})]}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-8 pb-6",children:[(0,s.jsx)("button",{onClick:()=>K(!1),className:"px-6 py-2 rounded-md border text-blue-600",disabled:Q,children:"Cancel"}),(0,s.jsx)("button",{onClick:eB,className:"px-6 py-2 rounded-md bg-blue-600 text-white shadow",disabled:Q,children:Q?"Saving...":es?"Update":"Save"})]})]})]})]}),ed&&eo&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[10030] flex items-start justify-center pt-8 px-6",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>ec(!1)}),(0,s.jsxs)("div",{className:"relative bg-white w-full max-w-6xl rounded-xl shadow-xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"Timesheet"}),(0,s.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>ec(!1),"aria-label":"Close",children:(0,s.jsx)(c.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 relative bg-white rounded-xl border p-6",children:[(0,s.jsx)("div",{className:"absolute top-4 right-4 text-gray-500",children:"⋮"}),(0,s.jsx)("h4",{className:"text-lg font-medium mb-4",children:"TimeLog Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-y-4 gap-x-6 items-center text-sm",children:[(0,s.jsx)("div",{className:"text-gray-500",children:"Start Time"}),(0,s.jsx)("div",{className:"col-span-2",children:eE(eo.startDate,eo.startTime)}),(0,s.jsx)("div",{className:"text-gray-500",children:"End Time"}),(0,s.jsx)("div",{className:"col-span-2",children:eE(eo.endDate,eo.endTime)}),(0,s.jsx)("div",{className:"text-gray-500",children:"Total Hours"}),(0,s.jsx)("div",{className:"col-span-2",children:"number"==typeof eo.durationHours?"".concat(eo.durationHours,"h"):"-"}),(0,s.jsx)("div",{className:"text-gray-500",children:"Memo"}),(0,s.jsx)("div",{className:"col-span-2",children:null!=(x=eo.memo)?x:"-"}),(0,s.jsx)("div",{className:"text-gray-500",children:"Project"}),(0,s.jsx)("div",{className:"col-span-2",children:null!=(h=null!=(u=eo.projectShortCode)?u:eo.projectId)?h:"-"}),(0,s.jsx)("div",{className:"text-gray-500",children:"Task"}),(0,s.jsxs)("div",{className:"col-span-2",children:["Task ",null!=(g=eo.taskId)?g:"-"]}),(0,s.jsx)("div",{className:"text-gray-500",children:"Employee"}),(0,s.jsxs)("div",{className:"col-span-2 flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:eo.employees&&(null==(e=eo.employees[0])?void 0:e.profileUrl)?(0,s.jsx)("img",{src:eo.employees[0].profileUrl,alt:null!=(j=eo.employees[0].name)?j:"",className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-6 h-6 rounded-full bg-gray-200"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-sm",children:eo.employees&&(null==(t=eo.employees[0])?void 0:t.name)?eo.employees[0].name:eo.employeeId}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:eo.employees&&(null==(o=eo.employees[0])?void 0:o.designation)?eo.employees[0].designation:""})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border p-5",children:[(0,s.jsx)("h5",{className:"font-medium mb-3",children:"History"}),(0,s.jsxs)("div",{className:"space-y-4 text-sm text-gray-700",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"text-gray-500",children:"Start Time"}),(0,s.jsx)("div",{children:eE(eo.startDate,eo.startTime)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"text-gray-500",children:"Task"}),(0,s.jsxs)("div",{children:["Task ",null!=(v=eo.taskId)?v:"-"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"text-gray-500",children:"End Time"}),(0,s.jsx)("div",{children:eE(eo.endDate,eo.endTime)})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-8 pb-6",children:[(0,s.jsx)("button",{onClick:()=>ec(!1),className:"px-6 py-2 rounded-md border text-blue-600",children:"Close"}),(0,s.jsx)("button",{onClick:()=>{eo&&eP(eo),ec(!1)},className:"px-6 py-2 rounded-md bg-blue-600 text-white",children:"Edit"})]})]})]})]}),ex&&eo&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[10040] flex items-start justify-center pt-12 px-4",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>eu(!1)}),(0,s.jsx)("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl overflow-hidden",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Delete TimeLog"}),(0,s.jsxs)("p",{className:"text-sm text-gray-700",children:["Are you sure you want to delete timesheet"," ",(0,s.jsxs)("strong",{children:["RTA-",String(eo.id).padStart(2,"0")]}),"? This action cannot be undone."]}),ee&&(0,s.jsx)("div",{className:"mt-4 text-sm text-red-600",children:ee}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-4 mt-6",children:[(0,s.jsx)("button",{className:"px-4 py-2 rounded border",onClick:()=>eu(!1),disabled:Q,children:"Cancel"}),(0,s.jsx)("button",{className:"px-4 py-2 rounded bg-red-600 text-white",onClick:eR,disabled:Q,children:Q?"Deleting...":"Delete"})]})]})})]}),"weekly"===Y&&(0,s.jsx)(k,{open:!0,onClose:()=>q("table")}),"TimesheetSummary"===Y&&(0,s.jsx)(P,{}),G&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[10050] flex items-start justify-center pt-8 px-6",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>$(!1)}),(0,s.jsxs)("div",{className:"relative bg-white w-full max-w-[1180px] rounded-xl shadow-xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"Calendar"}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("button",{className:"px-3 py-1 rounded hover:bg-gray-100",onClick:()=>$(!1),"aria-label":"Close",children:"Close"})})]}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4",children:(0,s.jsx)(E,{events:y,onEventClick:e=>{eP(e),$(!1)}})})}),(0,s.jsx)("div",{className:"flex items-center justify-end gap-4 px-6 py-4 border-t",children:(0,s.jsx)("button",{onClick:()=>$(!1),className:"px-4 py-2 rounded border",children:"Close"})})]})]})]})}}]);