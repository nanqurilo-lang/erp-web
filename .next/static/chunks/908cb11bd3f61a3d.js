(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,65650,e=>{"use strict";e.s(["default",()=>d]);var a=e.i(843476),l=e.i(271645),t=e.i(522016),s=e.i(618566);function d(){let e=(0,s.useRouter)(),d=(0,s.useParams)(),r=null==d?void 0:d.id,[n,i]=(0,l.useState)({title:"",leadId:"",pipeline:"",dealStage:"",dealCategory:"",dealAgent:"",dealWatchers:[],value:"",expectedCloseDate:"",dealContact:""}),[o,c]=(0,l.useState)([]),[u,m]=(0,l.useState)([]),[g,p]=(0,l.useState)(!1),[x,h]=(0,l.useState)(!0),[f,b]=(0,l.useState)(null),[y,j]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=async()=>{try{var e,a;let l=localStorage.getItem("accessToken");if(!l)return void b("No access token found. Please log in.");let t=await fetch("/api/hr/employee",{headers:{Authorization:"Bearer ".concat(l)}});if(!t.ok)throw Error("Failed to fetch employees");let s=await t.json();c(s.content||[]);let d=await fetch("/api/deals/stages",{headers:{Authorization:"Bearer ".concat(l)}});if(!d.ok)throw Error("Failed to fetch deal stages");let n=await d.json();m(n);let o=await fetch("/api/deals/get/".concat(r),{headers:{Authorization:"Bearer ".concat(l)}});if(!o.ok)throw Error("Failed to fetch deal details");let u=await o.json();i({title:u.title||"",leadId:u.leadId?String(u.leadId):"",pipeline:u.pipeline||"",dealStage:u.dealStage||(null!=(a=null==(e=n[0])?void 0:e.name)?a:""),dealCategory:u.dealCategory||"",dealAgent:u.dealAgent||"",dealWatchers:u.dealWatchers||[],value:u.value?String(u.value):"",expectedCloseDate:u.expectedCloseDate?u.expectedCloseDate.split("T")[0]:"",dealContact:u.dealContact||""})}catch(e){console.error(e),b("Failed to load deal data. Please try again later.")}finally{h(!1)}};r&&e()},[r]);let v=e=>{let{name:a,value:l}=e.target;i(e=>({...e,[a]:l}))},C=async a=>{if(a.preventDefault(),p(!0),b(null),j(null),!n.title||!n.pipeline||!n.dealStage||!n.dealCategory||!n.dealAgent||!n.value||!n.expectedCloseDate){b("Please fill all required fields."),p(!1);return}try{let a=localStorage.getItem("accessToken");if(!a)return void b("No access token found. Please log in.");let l={title:n.title,leadId:n.leadId?Number(n.leadId):void 0,pipeline:n.pipeline,dealStage:n.dealStage,dealCategory:n.dealCategory,dealAgent:n.dealAgent,dealWatchers:n.dealWatchers,value:parseFloat(n.value),expectedCloseDate:n.expectedCloseDate,dealContact:n.dealContact};if(!(await fetch("/api/deals/create/".concat(r),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(l)})).ok)throw Error("Failed to update deal");j("Deal updated successfully!"),setTimeout(()=>e.push("/leads/admin/get/".concat(r)),2e3)}catch(e){console.error(e),b("Failed to update deal. Please try again.")}finally{p(!1)}};return x?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen text-lg font-semibold",children:"Loading deal details..."}):(0,a.jsxs)("div",{className:"p-6 max-w-4xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Edit Deal"}),(0,a.jsxs)("form",{onSubmit:C,className:"bg-white p-6 border rounded-2xl shadow-sm",children:[f&&(0,a.jsx)("div",{className:"mb-4 text-red-600 text-sm font-semibold",children:f}),y&&(0,a.jsx)("div",{className:"mb-4 text-green-600 text-sm font-semibold",children:y}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,a.jsx)("input",{type:"text",name:"title",value:n.title,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lead ID"}),(0,a.jsx)("input",{type:"number",name:"leadId",value:n.leadId,onChange:v,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pipeline *"}),(0,a.jsx)("input",{type:"text",name:"pipeline",value:n.pipeline,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deal Stage *"}),(0,a.jsx)("select",{name:"dealStage",value:n.dealStage,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600",children:u.map(e=>(0,a.jsx)("option",{value:e.name,children:e.name},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),(0,a.jsx)("input",{type:"text",name:"dealCategory",value:n.dealCategory,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deal Agent *"}),(0,a.jsxs)("select",{name:"dealAgent",value:n.dealAgent,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600",children:[(0,a.jsx)("option",{value:"",children:"Select Deal Agent"}),o.map(e=>(0,a.jsxs)("option",{value:e.employeeId,children:[e.name," (",e.employeeId,")"]},e.employeeId))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value ($) *"}),(0,a.jsx)("input",{type:"number",name:"value",value:n.value,onChange:v,required:!0,min:"0",step:"0.01",className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Close Date *"}),(0,a.jsx)("input",{type:"date",name:"expectedCloseDate",value:n.expectedCloseDate,onChange:v,required:!0,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deal Contact"}),(0,a.jsx)("input",{type:"text",name:"dealContact",value:n.dealContact,onChange:v,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-600"})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deal Watchers"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:o.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:n.dealWatchers.includes(e.employeeId),onChange:a=>{var l,t;return l=e.employeeId,t=a.target.checked,void i(e=>{let a=e.dealWatchers||[],s=t?[...a,l]:a.filter(e=>e!==l);return{...e,dealWatchers:s}})}}),e.name," (",e.employeeId,")"]},e.employeeId))})]}),(0,a.jsxs)("div",{className:"mt-6 flex gap-4",children:[(0,a.jsx)("button",{type:"submit",disabled:g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition ".concat(g?"opacity-50 cursor-not-allowed":""),children:g?"Updating...":"Update Deal"}),(0,a.jsx)(t.default,{href:"/deals/get/",className:"px-4 py-2 text-blue-600 hover:underline",children:"Cancel"})]})]})]})}}]);