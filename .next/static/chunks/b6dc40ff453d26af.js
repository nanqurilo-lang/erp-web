(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,453155,e=>{"use strict";e.s(["default",()=>eC],453155),e.i(247167);var t=e.i(843476),s=e.i(271645),a=e.i(618566),l=e.i(581949),n=e.i(927591),r=e.i(288683),i=e.i(93609);let c="https://6jnqmj85-80.inc1.devtunnels.ms";function d(e){let{projectId:a}=e,[d,o]=(0,s.useState)([]),[m,x]=(0,s.useState)(!0),[u,p]=(0,s.useState)(null),[h,g]=(0,s.useState)([]),[j,y]=(0,s.useState)(!1),[v,b]=(0,s.useState)(!1),[f,N]=(0,s.useState)(null),[w,C]=(0,s.useState)(!1),[S,k]=(0,s.useState)(null),[D,T]=(0,s.useState)(null),[I,E]=(0,s.useState)(null),A={title:"",category:"",startDate:"",dueDate:"",noDueDate:!1,taskStageId:"",assignedEmployeeIds:[],description:"",labelIds:[],milestoneId:"",priority:"LOW",isPrivate:!1,timeEstimateMinutes:"",isDependent:!1,projectId:a,taskFile:null},[P,L]=(0,s.useState)(A),M=e=>"".concat(c).concat(e),U=async()=>{try{let e=localStorage.getItem("accessToken"),t=await l.default.get("".concat(c,"/status"),{headers:{Authorization:e?"Bearer ".concat(e):""}});Array.isArray(t.data)?g(t.data):g([])}catch(e){console.warn("Failed to fetch statuses:",e),g([])}},z=async()=>{x(!0),p(null);try{let e=localStorage.getItem("accessToken"),t="".concat(c,"/projects/").concat(a,"/tasks"),s=await l.default.get(t,{headers:{"Content-Type":"application/json",Authorization:e?"Bearer ".concat(e):""}});o(Array.isArray(s.data)?s.data:[])}catch(s){var e,t;p((null==s||null==(t=s.response)||null==(e=t.data)?void 0:e.message)||(null==s?void 0:s.message)||"Failed to load tasks")}finally{x(!1)}};(0,s.useEffect)(()=>{U(),z()},[a]);let O=e=>L(t=>({...t,...e})),F=async e=>{e.preventDefault();try{let e=new FormData;e.append("title",P.title),e.append("category",P.category||""),e.append("startDate",P.startDate||""),e.append("dueDate",P.dueDate||""),e.append("noDueDate",String(P.noDueDate)),e.append("taskStageId",P.taskStageId||""),e.append("assignedEmployeeIds",JSON.stringify(P.assignedEmployeeIds)),e.append("description",P.description||""),e.append("labelIds",JSON.stringify(P.labelIds)),e.append("milestoneId",P.milestoneId||""),e.append("priority",P.priority||""),e.append("isPrivate",String(P.isPrivate)),e.append("timeEstimateMinutes",String(P.timeEstimateMinutes||"")),e.append("isDependent",String(P.isDependent)),e.append("projectId",String(a)),P.taskFile&&e.append("taskFile",P.taskFile),await (0,r.postAPI)(M("/api/projects/tasks"),e,{headers:{"Content-Type":"multipart/form-data"}}),y(!1),L(A),await z()}catch(e){var t,s;alert("Create task failed: "+((null==e||null==(s=e.response)||null==(t=s.data)?void 0:t.message)||(null==e?void 0:e.message)||"unknown"))}},R=async e=>{if(e.preventDefault(),f)try{let e=new FormData;e.append("title",P.title),e.append("category",P.category||""),e.append("noDueDate",String(P.noDueDate)),e.append("description",P.description||""),e.append("labelIds",JSON.stringify(P.labelIds)),e.append("priority",P.priority||""),e.append("isPrivate",String(P.isPrivate)),e.append("timeEstimateMinutes",String(P.timeEstimateMinutes||"")),e.append("isDependent",String(P.isDependent)),e.append("projectId",String(a)),e.append("assignedEmployeeIds",JSON.stringify(P.assignedEmployeeIds)),P.taskFile&&e.append("taskFile",P.taskFile),await (0,r.putAPI)(M("/api/projects/tasks/".concat(f.id)),e,{headers:{"Content-Type":"multipart/form-data"}}),b(!1),N(null),L(A),await z()}catch(e){var t,s;alert("Update task failed: "+((null==e||null==(s=e.response)||null==(t=s.data)?void 0:t.message)||(null==e?void 0:e.message)||"unknown"))}},B=async e=>{if(confirm("Are you sure to delete this task?"))try{await (0,r.deleteAPI)(M("/api/projects/".concat(a,"/tasks/").concat(e))),T(null),await z()}catch(e){var t,s;alert("Delete failed: "+((null==e||null==(s=e.response)||null==(t=s.data)?void 0:t.message)||(null==e?void 0:e.message)||"unknown"))}},_=e=>{var t;switch(("string"==typeof e?e:null!=(t=null==e?void 0:e.name)?t:"").toLowerCase()){case"complete":case"completed":case"complete":case"complete":return"bg-green-600";case"to-do":case"to do":case"todo":return"bg-yellow-500";case"doing":return"bg-blue-600";case"incomplete":return"bg-red-600";case"waiting":case"waiting for approval":return"bg-gray-600";default:return"bg-gray-400"}},H=async(e,t)=>{o(s=>s.map(s=>s.id===e.id?{...s,taskStage:{id:t.id,name:t.name},taskStageId:t.id}:s));let s=localStorage.getItem("accessToken");try{let a="".concat(c,"/api/projects/tasks/").concat(e.id,"/status?statusId=").concat(t.id);await l.default.patch(a,{},{headers:{"Content-Type":"application/json",Authorization:s?"Bearer ".concat(s):""}}),E(null)}catch(e){console.error("Failed to update status:",e),alert("Failed to update status on server. Refreshing tasks."),await z(),E(null)}},G=e=>{if(!e&&0!==e)return"--";let t=Math.floor((e||0)/60),s=(e||0)%60;return t&&s?"".concat(t,"h ").concat(s,"m"):t?"".concat(t,"h"):"".concat(s,"m")};return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Tasks"}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("div",{className:"flex items-center gap-4",children:(0,t.jsx)("button",{onClick:()=>{L({...A,projectId:a}),y(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded shadow-sm hover:bg-blue-700",children:"+ Add Task"})}),(0,t.jsx)("div",{className:"flex items-center gap-3",children:(0,t.jsx)("input",{type:"search",placeholder:"Search",onChange:e=>{let t=e.target.value.toLowerCase();t?o(e=>e.filter(e=>(e.title||"").toLowerCase().includes(t)||(e.projectName||"").toLowerCase().includes(t))):z()},className:"border px-3 py-2 rounded-md text-sm"})})]}),m?(0,t.jsx)("div",{className:"py-6 text-center text-gray-500",children:"Loading tasks..."}):u?(0,t.jsx)("div",{className:"py-6 text-center text-red-500",children:u}):(0,t.jsxs)("div",{className:"overflow-x-auto",children:[(0,t.jsxs)("table",{className:"min-w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-blue-50 text-left text-gray-600",children:[(0,t.jsx)("th",{className:"px-4 py-3",children:"Code"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Task"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Completed On"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Start Date"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Due Date"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Hours Logged"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Estimated Time"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Milestones"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Assigned to"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Status"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Action"})]})}),(0,t.jsx)("tbody",{children:0===d.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:11,className:"py-6 text-center text-gray-500",children:"No tasks found"})}):d.map(e=>{var s,a,l,r,i,c,d;let o=e.dueDate&&!e.noDueDate&&new Date(e.dueDate)<new Date,m=(e=>{var t,s,a,l;if(e.taskStage&&e.taskStage.name)return e.taskStage;if(e.taskStageId){let t=h.find(t=>t.id===e.taskStageId);if(t)return t}let n=(e=>{if(h&&h.length)return h.find(t=>String(t.name).toLowerCase().includes(String(e).toLowerCase()))})(String((null==(t=e.taskStage)?void 0:t.name)||""));return null!=n?n:{id:null!=(a=e.taskStageId)?a:0,name:null!=(l=null==(s=e.taskStage)?void 0:s.name)?l:"Doing"}})(e),x=null!=(a=null==m?void 0:m.name)?a:"Doing";return(0,t.jsxs)("tr",{className:"border-b last:border-b-0 bg-white hover:bg-gray-50",children:[(0,t.jsxs)("td",{className:"px-4 py-4 align-top",children:["RTA-",String(e.id).padStart(2,"0")]}),(0,t.jsxs)("td",{className:"px-4 py-4 align-top",children:[(0,t.jsx)("div",{className:"font-medium",children:e.title}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:null!=(l=e.projectName)?l:"Project ".concat(e.projectId)})]}),(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:"--"}),(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:e.startDate?new Date(e.startDate).toLocaleDateString():"--"}),(0,t.jsx)("td",{className:"px-4 py-4 align-top ".concat(o?"text-red-600":""),children:e.noDueDate?"--":e.dueDate?new Date(e.dueDate).toLocaleDateString():"--"}),(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:G(null!=(r=e.hoursLoggedMinutes)?r:null)}),(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:G(null!=(i=e.timeEstimateMinutes)?i:null)}),(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:null!=(c=null==(s=e.milestone)?void 0:s.title)?c:"--"}),(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:(0,t.jsx)("div",{className:"flex -space-x-2",children:(e.assignedEmployees||[]).slice(0,3).map(e=>(0,t.jsx)("div",{className:"w-8 h-8 rounded-full border-2 border-white overflow-hidden bg-gray-100",children:e.profileUrl?(0,t.jsx)("img",{src:e.profileUrl,alt:e.name,className:"w-full h-full object-cover"}):(0,t.jsx)(n.UserIcon,{className:"w-full h-full text-gray-400 p-1"})},e.employeeId))})}),(0,t.jsx)("td",{className:"px-4 py-4 align-top relative",children:(0,t.jsxs)("div",{className:"relative inline-block",children:[(0,t.jsxs)("button",{onClick:t=>{t.stopPropagation(),T(null),E(t=>t===e.id?null:e.id)},className:"inline-flex items-center gap-2 px-3 py-1 rounded-full border text-xs bg-white hover:bg-gray-50",title:"Change status",children:[m&&m.labelColor?(0,t.jsx)("span",{style:{width:8,height:8,borderRadius:9999,display:"inline-block",background:"#".concat(String(m.labelColor).replace(/[^0-9a-fA-F]/g,"").slice(0,6))}}):(0,t.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(_(null!=(d=null==m?void 0:m.name)?d:"Doing"))}),(0,t.jsx)("span",{children:String(x)}),(0,t.jsx)("span",{className:"text-xs",children:"▾"})]}),I===e.id&&(0,t.jsx)("div",{onClick:e=>e.stopPropagation(),className:"absolute right-0 mt-2 z-30 w-44 bg-white border rounded-md shadow-lg text-sm",children:h.length>0?h.map(s=>(0,t.jsxs)("button",{onClick:()=>H(e,s),className:"w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center gap-2 ".concat(s.id===(null==m?void 0:m.id)?"font-medium":""),children:[s.labelColor?(0,t.jsx)("span",{style:{width:8,height:8,borderRadius:9999,background:"#".concat(String(s.labelColor).replace(/[^0-9a-fA-F]/g,"").slice(0,6))}}):(0,t.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(_(s.name))}),(0,t.jsx)("span",{children:s.name})]},s.id)):["To Do","Doing","Completed","Incomplete","Waiting for Approval"].map(s=>(0,t.jsxs)("button",{onClick:()=>{H(e,{id:0,name:s})},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(_(s))})," ",(0,t.jsx)("span",{children:s})]},s))})]})}),(0,t.jsxs)("td",{className:"px-4 py-4 align-top relative",children:[(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),E(null),T(t=>t===e.id?null:e.id)},className:"p-1 rounded hover:bg-gray-100","aria-haspopup":"true","aria-expanded":D===e.id,title:"More",children:"⋮"}),D===e.id&&(0,t.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"absolute right-2 top-10 z-20 w-48 bg-white border rounded-md shadow-md",children:[(0,t.jsx)("button",{onClick:()=>{k(e),C(!0),T(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"View"}),(0,t.jsx)("button",{onClick:()=>{var t;N(e),L({title:e.title||"",category:(null==(t=e.categoryId)?void 0:t.id)?String(e.categoryId.id):"",startDate:e.startDate?e.startDate:"",dueDate:e.dueDate?e.dueDate:"",noDueDate:!!e.noDueDate,taskStageId:e.taskStageId?String(e.taskStageId):"",assignedEmployeeIds:e.assignedEmployeeIds||[],description:e.description||"",labelIds:(e.labels||[]).map(e=>String(e.id)),milestoneId:e.milestoneId?String(e.milestoneId):"",priority:e.priority||"LOW",isPrivate:!!e.isPrivate,timeEstimateMinutes:e.timeEstimateMinutes?String(e.timeEstimateMinutes):"",isDependent:!!e.isDependent,projectId:e.projectId,taskFile:null}),b(!0),T(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Edit"}),(0,t.jsx)("button",{onClick:()=>{T(null),B(e.id)},className:"w-full text-left px-4 py-2 text-red-600 hover:bg-gray-50",children:"Delete"})]})]})]},e.id)})})]}),(0,t.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between text-sm text-gray-600 rounded-b-md mt-4",children:[(0,t.jsxs)("div",{children:["Result per page - ",d.length?d.length:0]}),(0,t.jsx)("div",{children:"Page 1 of 1"})]})]}),j&&(0,t.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4",children:(0,t.jsxs)("form",{onSubmit:F,className:"bg-white w-full max-w-3xl rounded-lg p-6 shadow-lg overflow-auto max-h-[90vh]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Add Task"}),(0,t.jsx)("button",{type:"button",onClick:()=>y(!1),className:"text-gray-500",children:"Close"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Title"}),(0,t.jsx)("input",{required:!0,value:P.title,onChange:e=>O({title:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Category (id)"}),(0,t.jsx)("input",{value:P.category,onChange:e=>O({category:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Start Date"}),(0,t.jsx)("input",{type:"date",value:P.startDate,onChange:e=>O({startDate:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Due Date"}),(0,t.jsx)("input",{type:"date",value:P.dueDate,onChange:e=>O({dueDate:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:P.noDueDate,onChange:e=>O({noDueDate:e.target.checked})}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"No Due Date"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Task Stage ID"}),(0,t.jsx)("input",{value:P.taskStageId,onChange:e=>O({taskStageId:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col md:col-span-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Description"}),(0,t.jsx)("textarea",{value:P.description,onChange:e=>O({description:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Assigned Employee IDs (comma separated)"}),(0,t.jsx)("input",{value:P.assignedEmployeeIds.join(","),onChange:e=>O({assignedEmployeeIds:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Label IDs (comma separated)"}),(0,t.jsx)("input",{value:P.labelIds.join(","),onChange:e=>O({labelIds:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Milestone ID"}),(0,t.jsx)("input",{value:P.milestoneId,onChange:e=>O({milestoneId:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Priority"}),(0,t.jsxs)("select",{value:P.priority,onChange:e=>O({priority:e.target.value}),className:"border px-3 py-2 rounded",children:[(0,t.jsx)("option",{value:"LOW",children:"LOW"}),(0,t.jsx)("option",{value:"MEDIUM",children:"MEDIUM"}),(0,t.jsx)("option",{value:"HIGH",children:"HIGH"}),(0,t.jsx)("option",{value:"URGENT",children:"URGENT"})]})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Time Estimate (minutes)"}),(0,t.jsx)("input",{type:"number",value:P.timeEstimateMinutes,onChange:e=>O({timeEstimateMinutes:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:P.isPrivate,onChange:e=>O({isPrivate:e.target.checked})}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Private"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:P.isDependent,onChange:e=>O({isDependent:e.target.checked})}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Is Dependent"})]}),(0,t.jsxs)("label",{className:"flex flex-col md:col-span-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Attach file (optional)"}),(0,t.jsx)("input",{type:"file",onChange:e=>{var t;return O({taskFile:(null==(t=e.target.files)?void 0:t[0])||null})}})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 rounded border",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-600 text-white",children:"Save"})]})]})}),v&&f&&(0,t.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4",children:(0,t.jsxs)("form",{onSubmit:R,className:"bg-white w-full max-w-3xl rounded-lg p-6 shadow-lg overflow-auto max-h-[90vh]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Edit Task"}),(0,t.jsx)("button",{type:"button",onClick:()=>{b(!1),N(null)},className:"text-gray-500",children:"Close"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Title"}),(0,t.jsx)("input",{required:!0,value:P.title,onChange:e=>O({title:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Category (id)"}),(0,t.jsx)("input",{value:P.category,onChange:e=>O({category:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col md:col-span-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Description"}),(0,t.jsx)("textarea",{value:P.description,onChange:e=>O({description:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Assigned Employee IDs (comma separated)"}),(0,t.jsx)("input",{value:P.assignedEmployeeIds.join(","),onChange:e=>O({assignedEmployeeIds:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Label IDs (comma separated)"}),(0,t.jsx)("input",{value:P.labelIds.join(","),onChange:e=>O({labelIds:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Priority"}),(0,t.jsxs)("select",{value:P.priority,onChange:e=>O({priority:e.target.value}),className:"border px-3 py-2 rounded",children:[(0,t.jsx)("option",{value:"LOW",children:"LOW"}),(0,t.jsx)("option",{value:"MEDIUM",children:"MEDIUM"}),(0,t.jsx)("option",{value:"HIGH",children:"HIGH"}),(0,t.jsx)("option",{value:"URGENT",children:"URGENT"})]})]}),(0,t.jsxs)("label",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Time Estimate (minutes)"}),(0,t.jsx)("input",{type:"number",value:P.timeEstimateMinutes,onChange:e=>O({timeEstimateMinutes:e.target.value}),className:"border px-3 py-2 rounded"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:P.isPrivate,onChange:e=>O({isPrivate:e.target.checked})}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Private"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:P.isDependent,onChange:e=>O({isDependent:e.target.checked})}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Is Dependent"})]}),(0,t.jsxs)("label",{className:"flex flex-col md:col-span-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Attach file (optional)"}),(0,t.jsx)("input",{type:"file",onChange:e=>{var t;return O({taskFile:(null==(t=e.target.files)?void 0:t[0])||null})}})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{b(!1),N(null)},className:"px-4 py-2 rounded border",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-600 text-white",children:"Update"})]})]})}),(0,t.jsx)(i.default,{open:w,task:S,onClose:()=>{C(!1),k(null)}})]})}let o="https://6jnqmj85-80.inc1.devtunnels.ms",m=l.default.create({baseURL:o||"/",timeout:15e3});function x(e){let{projectId:a}=e,[l,r]=(0,s.useState)(null),[i,c]=(0,s.useState)([]),[d,x]=(0,s.useState)(!1),[u,p]=(0,s.useState)(null),[h,g]=(0,s.useState)(!1),[j,y]=(0,s.useState)(""),[v,b]=(0,s.useState)(""),[f,N]=(0,s.useState)(null),w=async()=>{try{var e;x(!0),p(null);let t="".concat(o,"/api/projects/").concat(a),s=await m.get(t);r(s),c(null!=(e=null==s?void 0:s.assignedEmployees)?e:[])}catch(e){p(e.message),r(null),c([])}finally{x(!1)}};(0,s.useEffect)(()=>{w()},[a]);let C=async()=>{let e=j.trim();if(!e)return alert("Enter employee IDs");let t=e.split(",").map(e=>e.trim());try{x(!0),p(null);let e="".concat(o,"/api/projects/").concat(a,"/assign");await m.post(e,{employeeIds:t}),g(!1),y(""),w()}catch(e){p(e.message)}finally{x(!1)}},S=async e=>{if(confirm("Remove ".concat(e,"   from project?")))try{N(e),p(null);let t="".concat(o,"/api/projects/").concat(a,"/assign/").concat(e);await m.delete(t),(null==l?void 0:l.projectAdminId)===e&&await m.patch("".concat(o,"/api/projects/").concat(a),{projectAdminId:null}),w()}catch(e){p(e.message)}finally{N(null)}},k=async e=>{if(confirm("Make ".concat(e," Project Admin?")))try{N(e),p(null);let t="".concat(o,"/projects/").concat(a,"/admin?userId=").concat(e);await m.post(t),w()}catch(e){p(e.message)}finally{N(null)}},D=async()=>{if(confirm("Remove Project Admin?"))try{N("admin"),p(null);let e="".concat(o,"/projects/").concat(a,"/admin");await m.delete(e),w()}catch(e){p(e.message)}finally{N(null)}},T=i.filter(e=>{var t,s;let a=v.toLowerCase();return(null==(t=e.name)?void 0:t.toLowerCase().includes(a))||e.employeeId.toLowerCase().includes(a)||(null==(s=e.designation)?void 0:s.toLowerCase().includes(a))});return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Member"}),(0,t.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,t.jsx)("button",{onClick:()=>g(!0),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"+ Add Project Members"}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("input",{type:"search",placeholder:"Search",className:"border px-3 py-2 rounded",value:v,onChange:e=>b(e.target.value)}),(0,t.jsx)("button",{onClick:w,className:"bg-gray-100 px-3 py-2 rounded",children:"Refresh"})]})]}),d&&(0,t.jsx)("div",{className:"text-center py-5",children:"Loading…"}),u&&(0,t.jsx)("div",{className:"p-3 bg-red-50 text-red-600 rounded mb-3",children:u}),!d&&(0,t.jsxs)("table",{className:"min-w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-blue-50",children:[(0,t.jsx)("th",{className:"px-4 py-3",children:"Name"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"User Role"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Action"})]})}),(0,t.jsxs)("tbody",{children:[T.map(e=>{var s;return(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsxs)("td",{className:"px-4 py-4 flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden",children:e.profileUrl?(0,t.jsx)("img",{src:e.profileUrl,className:"w-full h-full object-cover"}):(0,t.jsx)(n.UserIcon,{className:"w-6 h-6 text-gray-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:null!=(s=e.designation)?s:e.department})]})]}),(0,t.jsxs)("td",{className:"px-4 py-4",children:[(0,t.jsx)("input",{type:"radio",checked:(null==l?void 0:l.projectAdminId)===e.employeeId,onChange:()=>k(e.employeeId)}),(0,t.jsx)("span",{className:"ml-1",children:"Project Admin"}),(null==l?void 0:l.projectAdminId)===e.employeeId&&(0,t.jsx)("button",{onClick:()=>D(),disabled:f,className:"ml-3 px-3 py-1 border rounded text-sm bg-white",children:f?"Removing...":"Remove Admin"})]}),(0,t.jsx)("td",{className:"px-4 py-4",children:(0,t.jsx)("button",{onClick:()=>S(e.employeeId),disabled:f===e.employeeId,className:"text-red-600",children:f===e.employeeId?"Removing…":"Delete"})})]},e.employeeId)}),0===T.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:3,className:"py-6 text-center text-gray-500",children:"No members found"})})]})]}),h&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white p-6 rounded w-full max-w-md",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Add Project Members"}),(0,t.jsx)("input",{className:"border px-3 py-2 w-full rounded",placeholder:"EMP-015, EMP-010",value:j,onChange:e=>y(e.target.value)}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Example: EMP-015, EMP-010"}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,t.jsx)("button",{className:"px-4 py-2 border rounded",onClick:()=>g(!1),children:"Cancel"}),(0,t.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:C,children:"Add"})]})]})})]})}m.interceptors.request.use(e=>{let t=localStorage.getItem("accessToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),m.interceptors.response.use(e=>e.data,e=>{var t,s,a;return Promise.reject(Error((null==e||null==(s=e.response)||null==(t=s.data)?void 0:t.message)||(null==e||null==(a=e.response)?void 0:a.statusText)||e.message||"Request failed"))});var u=e.i(427217);let p=localStorage.getItem("accessToken");function h(e){var a,l,r,i,c,d,o,m;let{gatewayPath:x="/timesheets",mainBase:h,authToken:g=p}=e,j=(h||"https://6jnqmj85-80.inc1.devtunnels.ms").replace(/\/$/,""),[y,v]=(0,s.useState)([]),[b,f]=(0,s.useState)(!1),[N,w]=(0,s.useState)(null),[C,S]=(0,s.useState)(0),[k,D]=(0,s.useState)(""),[T,I]=(0,s.useState)("All"),[E,A]=(0,s.useState)(!1),[P,L]=(0,s.useState)(!1),[M,U]=(0,s.useState)(null),[z,O]=(0,s.useState)(null),[F,R]=(0,s.useState)({projectId:"",taskId:"",employeeId:"",startDate:"",startTime:"",endDate:"",endTime:"",memo:""}),[B,_]=(0,s.useState)(null),[H,G]=(0,s.useState)(!1),[J,q]=(0,s.useState)(null),[W,V]=(0,s.useState)(!1),X=e=>{let t=String(e||"");return t.startsWith("http://")||t.startsWith("https://")?t:t.startsWith("/")?"".concat(j).concat(t):"".concat(j,"/").concat(t)},K=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={...e};return g&&(t.Authorization="Bearer ".concat(g)),t},$=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3,a=new AbortController,l=setTimeout(()=>a.abort(),s);try{let s={...t,signal:a.signal},n=await fetch(e,s);clearTimeout(l);let r=n.headers.get("content-type")||"",i=await n.text().catch(()=>"");if(!n.ok){if(r.includes("application/json"))try{let e=JSON.parse(i||"{}"),t=(null==e?void 0:e.message)||JSON.stringify(e);throw Error("HTTP ".concat(n.status," ").concat(n.statusText," — ").concat(t))}catch(e){throw Error("HTTP ".concat(n.status," ").concat(n.statusText," — ").concat(i.slice(0,300)))}if(r.includes("text/html")||i.trim().startsWith("<!DOCTYPE html"))throw Error("HTTP ".concat(n.status," ").concat(n.statusText," — server returned HTML (likely auth)."));throw Error("HTTP ".concat(n.status," ").concat(n.statusText," ").concat(i?"- "+i.slice(0,300):""))}if(r.includes("application/json"))return JSON.parse(i||"[]");return i}catch(e){if("AbortError"===e.name)throw Error("Request timed out");if("Failed to fetch"===e.message)throw Error("Network Error - check CORS / server availability");throw e}finally{clearTimeout(l)}},Y=async()=>{f(!0),w(null);try{let e=X(x),t=await $(e,{method:"GET",headers:K({"Content-Type":"application/json"}),credentials:"same-origin"});Array.isArray(t)?v(t):(null==t?void 0:t.data)&&Array.isArray(t.data)?v(t.data):(console.warn("Unexpected timesheets response:",t),v([]),w("Unexpected response shape from server. See console."))}catch(e){console.error("fetchTimesheets error:",e),v([]),w((null==e?void 0:e.message)||"Failed to load timesheets")}finally{f(!1)}};(0,s.useEffect)(()=>{Y()},[C]);let Z=(0,s.useMemo)(()=>{let e=new Map;return y.forEach(t=>{let s=t.employees&&t.employees[0];s&&s.employeeId?e.set(s.employeeId,s):t.employeeId&&e.set(t.employeeId,{employeeId:t.employeeId})}),Array.from(e.values())},[y]),Q=y.filter(e=>{if("All"!==T&&e.employeeId!==T)return!1;if(!k)return!0;let t=k.toLowerCase(),s=e.employees&&e.employees[0];return String(e.employeeId||"").toLowerCase().includes(t)||String(e.projectId||"").toLowerCase().includes(t)||String(e.taskId||"").toLowerCase().includes(t)||String(e.memo||"").toLowerCase().includes(t)||String((null==s?void 0:s.name)||"").toLowerCase().includes(t)}),ee=e=>e<10?"0".concat(e):"".concat(e),et=(e,t)=>((e,t)=>{if(!e)return"-";try{let[l,n,r]=e.split("-").map(Number),i=0,c=0;if(t){var s,a;let e=t.split(":").map(Number);i=null!=(s=e[0])?s:0,c=null!=(a=e[1])?a:0}let d=new Date(l,n-1,r,i,c),o=ee(d.getDate()),m=ee(d.getMonth()+1),x=d.getFullYear(),u=d.getHours(),p=ee(d.getMinutes()),h=u>=12?"PM":"AM";u=u%12||12;let g=ee(u);return"".concat(o,"/").concat(m,"/").concat(x," ").concat(g,":").concat(p," ").concat(h)}catch(s){return e+(t?" ".concat(t):"")}})(e,t),es=(e,t,s,a)=>{if(!e||!s)return 0;try{let l=e.split("-").map(Number),n=s.split("-").map(Number),r=0,i=0,c=0,d=0;t&&([r,i]=t.split(":").map(e=>Number(e))),a&&([c,d]=a.split(":").map(e=>Number(e)));let o=new Date(l[0],l[1]-1,l[2],r,i),m=new Date(n[0],n[1]-1,n[2],c,d).getTime()-o.getTime();if(isNaN(m)||m<=0)return 0;return Math.round(m/36e5)}catch(e){return 0}},ea=es(F.startDate,F.startTime,F.endDate,F.endTime),el=e=>{if(e){var t,s,a,l,n,r,i,c;O(e.id),R({projectId:String(null!=(t=e.projectId)?t:""),taskId:String(null!=(s=e.taskId)?s:""),employeeId:null!=(a=e.employeeId)?a:"",startDate:null!=(l=e.startDate)?l:"",startTime:null!=(n=e.startTime)?n:"",endDate:null!=(r=e.endDate)?r:"",endTime:null!=(i=e.endTime)?i:"",memo:null!=(c=e.memo)?c:""})}else O(null),R({projectId:"",taskId:"",employeeId:"",startDate:"",startTime:"",endDate:"",endTime:"",memo:""});U(null),A(!0)},en=async()=>{if(J){L(!0),U(null);try{let e=X("".concat(x,"/").concat(J.id));await $(e,{method:"DELETE",headers:K({"Content-Type":"application/json"}),credentials:"same-origin"}),V(!1),q(null),S(e=>e+1)}catch(e){console.error("deleteTimesheet error:",e),U((null==e?void 0:e.message)||"Failed to delete timesheet")}finally{L(!1)}}},er=async()=>{L(!0),U(null);try{if(!F.projectId||!F.taskId||!F.employeeId||!F.startDate||!F.startTime||!F.endDate||!F.endTime||!F.memo){U("Please fill all required fields."),L(!1);return}let e={projectId:Number(F.projectId),taskId:Number(F.taskId),employeeId:F.employeeId,startDate:F.startDate,startTime:F.startTime,endDate:F.endDate,endTime:F.endTime,memo:F.memo,durationHours:es(F.startDate,F.startTime,F.endDate,F.endTime)},t=X(x)+(z?"/".concat(z):"");await $(t,{method:z?"PUT":"POST",headers:K({"Content-Type":"application/json"}),credentials:"same-origin",body:JSON.stringify(e)}),A(!1),S(e=>e+1)}catch(e){console.error("saveEntry error:",e),U((null==e?void 0:e.message)||"Failed to save entry")}finally{L(!1)}};return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Timesheet"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("label",{className:"text-sm",children:"Employee"}),(0,t.jsxs)("select",{value:T,onChange:e=>I(e.target.value),className:"border rounded px-3 py-2 text-sm",children:[(0,t.jsx)("option",{value:"All",children:"All"}),Z.map(e=>(0,t.jsx)("option",{value:e.employeeId,children:e.name?"".concat(e.name," (").concat(e.employeeId,")"):e.employeeId},e.employeeId))]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)("button",{onClick:()=>el(),className:"bg-blue-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-blue-700",children:"+ Log Time"})}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:()=>S(e=>e+1),className:"bg-gray-100 px-3 py-2 rounded text-sm border hover:bg-gray-200",children:"Refresh"}),(0,t.jsx)("input",{type:"search",placeholder:"Search employee, memo, project...",value:k,onChange:e=>D(e.target.value),className:"border px-3 py-2 rounded-md text-sm"})]})]}),b?(0,t.jsx)("div",{className:"py-6 text-center text-gray-500",children:"Loading timesheets..."}):(0,t.jsxs)(t.Fragment,{children:[N&&(0,t.jsxs)("div",{className:"mb-4 p-3 rounded bg-red-50 text-red-700",children:[(0,t.jsx)("strong",{children:"Error:"})," ",N]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-blue-50 text-left text-gray-600",children:[(0,t.jsx)("th",{className:"px-4 py-3",children:"Code"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Task"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Employee"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Start Time"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"End Time"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Total Hours"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Action"})]})}),(0,t.jsx)("tbody",{children:0===Q.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:7,className:"py-6 text-center text-gray-500",children:"No timesheets found"})}):Q.map(e=>{var s,a,l,r;let i=e.employees&&e.employees[0],c="RTA-".concat(String(e.id).padStart(2,"0")),d="Task ".concat(null!=(s=e.taskId)?s:"-"," · Project ").concat(null!=(a=e.projectId)?a:"-");return(0,t.jsxs)("tr",{className:"border-b last:border-b-0 bg-white hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:c}),(0,t.jsxs)("td",{className:"px-4 py-4 align-top",children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:d}),(0,t.jsx)("div",{className:"text-xs text-gray-400",children:null!=(l=e.memo)?l:""})]}),(0,t.jsxs)("td",{className:"px-4 py-4 align-top flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:(null==i?void 0:i.profileUrl)?(0,t.jsx)("img",{src:i.profileUrl,alt:null!=(r=null==i?void 0:i.name)?r:"",className:"w-full h-full object-cover"}):(0,t.jsx)(n.UserIcon,{className:"w-6 h-6 text-gray-400 p-1"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:(null==i?void 0:i.name)||e.employeeId}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:(null==i?void 0:i.designation)||(null==i?void 0:i.department)||e.employeeId})]})]}),(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:et(e.startDate,e.startTime)}),(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:et(e.endDate,e.endTime)}),(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:"number"==typeof e.durationHours?"".concat(e.durationHours,"h"):"-"}),(0,t.jsx)("td",{className:"px-4 py-4 align-top",children:(0,t.jsxs)("div",{className:"relative inline-block text-left",children:[(0,t.jsx)("button",{onClick:()=>_(B===e.id?null:e.id),className:"px-2 py-1 border rounded text-sm","aria-haspopup":"true","aria-expanded":B===e.id,title:"More",children:"⋮"}),B===e.id&&(0,t.jsxs)("div",{className:"absolute right-0 mt-2 z-30 w-40 bg-white border rounded-md shadow-lg text-sm",children:[(0,t.jsx)("button",{onClick:()=>{q(e),G(!0),_(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"View"}),(0,t.jsx)("button",{onClick:()=>{el(e),_(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Edit"}),(0,t.jsx)("button",{onClick:()=>{q(e),V(!0),_(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50 text-red-600",children:"Delete"})]})]})})]},e.id)})})]})})]}),E&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>A(!1)}),(0,t.jsxs)("div",{className:"relative bg-white w-full max-w-4xl rounded-xl shadow-xl overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:z?"Edit TimeLog":"Log Time"}),(0,t.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>A(!1),"aria-label":"Close",children:(0,t.jsx)(u.XMarkIcon,{className:"w-6 h-6 text-gray-500"})})]}),(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-md border p-6",children:[(0,t.jsx)("h4",{className:"text-md font-medium mb-4",children:"TimeLog Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Project *"}),(0,t.jsx)("input",{value:F.projectId,onChange:e=>R(t=>({...t,projectId:e.target.value})),className:"w-full border rounded px-3 py-2",placeholder:"Project ID",type:"text"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Task *"}),(0,t.jsx)("input",{value:F.taskId,onChange:e=>R(t=>({...t,taskId:e.target.value})),className:"w-full border rounded px-3 py-2",placeholder:"Task ID",type:"text"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Employee *"}),(0,t.jsxs)("select",{value:F.employeeId,onChange:e=>R(t=>({...t,employeeId:e.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,t.jsx)("option",{value:"",children:"--"}),Z.map(e=>(0,t.jsx)("option",{value:e.employeeId,children:e.name?"".concat(e.name," (").concat(e.employeeId,")"):e.employeeId},e.employeeId))]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Date *"}),(0,t.jsx)("input",{type:"date",value:F.startDate,onChange:e=>R(t=>({...t,startDate:e.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Time *"}),(0,t.jsx)("input",{type:"time",value:F.startTime,onChange:e=>R(t=>({...t,startTime:e.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Date *"}),(0,t.jsx)("input",{type:"date",value:F.endDate,onChange:e=>R(t=>({...t,endDate:e.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Time *"}),(0,t.jsx)("input",{type:"time",value:F.endTime,onChange:e=>R(t=>({...t,endTime:e.target.value})),className:"w-full border rounded px-3 py-2"})]})]}),(0,t.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4 items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Memo *"}),(0,t.jsx)("input",{type:"text",value:F.memo,onChange:e=>R(t=>({...t,memo:e.target.value})),className:"w-full border rounded px-3 py-2",placeholder:"Memo"})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Total Hours"}),(0,t.jsxs)("div",{className:"text-2xl font-semibold text-blue-600",children:[ea,"h"]})]})]}),M&&(0,t.jsx)("div",{className:"mt-4 text-sm text-red-600",children:M})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-8 pb-6",children:[(0,t.jsx)("button",{onClick:()=>A(!1),className:"px-6 py-2 rounded-md border text-blue-600",disabled:P,children:"Cancel"}),(0,t.jsx)("button",{onClick:er,className:"px-6 py-2 rounded-md bg-blue-600 text-white shadow",disabled:P,children:P?"Saving...":z?"Update":"Save"})]})]})]})]}),H&&J&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-8 px-6",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>G(!1)}),(0,t.jsxs)("div",{className:"relative bg-white w-full max-w-6xl rounded-xl shadow-xl overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold",children:"Timesheet"}),(0,t.jsx)("button",{className:"p-2 rounded hover:bg-gray-100",onClick:()=>G(!1),"aria-label":"Close",children:(0,t.jsx)(u.XMarkIcon,{className:"w-6 h-6 text-gray-500"})})]}),(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 relative bg-white rounded-xl border p-6",children:[(0,t.jsx)("div",{className:"absolute top-4 right-4 text-gray-500",children:"⋮"}),(0,t.jsx)("h4",{className:"text-lg font-medium mb-4",children:"TimeLog Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-y-4 gap-x-6 items-center text-sm",children:[(0,t.jsx)("div",{className:"text-gray-500",children:"Start Time"}),(0,t.jsx)("div",{className:"col-span-2",children:et(J.startDate,J.startTime)}),(0,t.jsx)("div",{className:"text-gray-500",children:"End Time"}),(0,t.jsx)("div",{className:"col-span-2",children:et(J.endDate,J.endTime)}),(0,t.jsx)("div",{className:"text-gray-500",children:"Total Hours"}),(0,t.jsx)("div",{className:"col-span-2",children:"number"==typeof J.durationHours?"".concat(J.durationHours,"h"):"-"}),(0,t.jsx)("div",{className:"text-gray-500",children:"Memo"}),(0,t.jsx)("div",{className:"col-span-2",children:null!=(i=J.memo)?i:"-"}),(0,t.jsx)("div",{className:"text-gray-500",children:"Project"}),(0,t.jsxs)("div",{className:"col-span-2",children:["Project ",null!=(c=J.projectId)?c:"-"]}),(0,t.jsx)("div",{className:"text-gray-500",children:"Task"}),(0,t.jsxs)("div",{className:"col-span-2",children:["Task ",null!=(d=J.taskId)?d:"-"]}),(0,t.jsx)("div",{className:"text-gray-500",children:"Employee"}),(0,t.jsxs)("div",{className:"col-span-2 flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:J.employees&&(null==(a=J.employees[0])?void 0:a.profileUrl)?(0,t.jsx)("img",{src:J.employees[0].profileUrl,alt:null!=(o=J.employees[0].name)?o:"",className:"w-full h-full object-cover"}):(0,t.jsx)(n.UserIcon,{className:"w-6 h-6 text-gray-400 p-1"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:J.employees&&(null==(l=J.employees[0])?void 0:l.name)?J.employees[0].name:J.employeeId}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:J.employees&&(null==(r=J.employees[0])?void 0:r.designation)?J.employees[0].designation:""})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border p-5",children:[(0,t.jsx)("h5",{className:"font-medium mb-3",children:"History"}),(0,t.jsxs)("div",{className:"space-y-4 text-sm text-gray-700",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"text-gray-500",children:"Start Time"}),(0,t.jsx)("div",{children:et(J.startDate,J.startTime)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"text-gray-500",children:"Task"}),(0,t.jsxs)("div",{children:["Task ",null!=(m=J.taskId)?m:"-"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"text-gray-500",children:"End Time"}),(0,t.jsx)("div",{children:et(J.endDate,J.endTime)})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-8 pb-6",children:[(0,t.jsx)("button",{onClick:()=>G(!1),className:"px-6 py-2 rounded-md border text-blue-600",children:"Close"}),(0,t.jsx)("button",{onClick:()=>{el(J),G(!1)},className:"px-6 py-2 rounded-md bg-blue-600 text-white",children:"Edit"})]})]})]})]}),W&&J&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>V(!1)}),(0,t.jsx)("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl overflow-hidden",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Delete TimeLog"}),(0,t.jsxs)("p",{className:"text-sm text-gray-700",children:["Are you sure you want to delete timesheet ",(0,t.jsxs)("strong",{children:["RTA-",String(J.id).padStart(2,"0")]}),"? This action cannot be undone."]}),M&&(0,t.jsx)("div",{className:"mt-4 text-sm text-red-600",children:M}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-4 mt-6",children:[(0,t.jsx)("button",{className:"px-4 py-2 rounded border",onClick:()=>V(!1),disabled:P,children:"Cancel"}),(0,t.jsx)("button",{className:"px-4 py-2 rounded bg-red-600 text-white",onClick:en,disabled:P,children:P?"Deleting...":"Delete"})]})]})})]})]})}let g=localStorage.getItem("accessToken");function j(e){var a,l,n;let{projectId:r,gatewayPath:i="/api/projects",authToken:c=g,mainBase:d}=e,o=(d||"https://6jnqmj85-80.inc1.devtunnels.ms").replace(/\/$/,""),[m,x]=(0,s.useState)([]),[p,h]=(0,s.useState)(!1),[j,y]=(0,s.useState)(null),[v,b]=(0,s.useState)(0),[f,N]=(0,s.useState)(!1),[w,C]=(0,s.useState)(!1),[S,k]=(0,s.useState)(!1),[D,T]=(0,s.useState)(!1),[I,E]=(0,s.useState)(null),[A,P]=(0,s.useState)(!1),[L,M]=(0,s.useState)(null),[U,z]=(0,s.useState)({title:"",milestoneCost:"",status:"INCOMPLETE",summary:"",startDate:"",endDate:""}),[O,F]=(0,s.useState)(null),[R,B]=(0,s.useState)(null),_=e=>{let t=String(e||"");return t.startsWith("http://")||t.startsWith("https://")?t:t.startsWith("/")?"".concat(o).concat(t):"".concat(o,"/").concat(t)},H=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={...e};return c&&(t.Authorization="Bearer ".concat(c)),t},G=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3,a=new AbortController,l=setTimeout(()=>a.abort(),s);try{let s={...t,signal:a.signal},n=await fetch(e,s);clearTimeout(l);let r=n.headers.get("content-type")||"",i=await n.text().catch(()=>"");if(!n.ok){if(r.includes("text/html")||i.trim().startsWith("<!DOCTYPE html"))throw Error("HTTP ".concat(n.status," ").concat(n.statusText," — server returned HTML. Snippet: ").concat(i.slice(0,300)));if(r.includes("application/json"))try{let e=JSON.parse(i||"{}");throw Error("HTTP ".concat(n.status," ").concat(n.statusText," — ").concat(JSON.stringify(e)))}catch(e){}throw Error("HTTP ".concat(n.status," ").concat(n.statusText," ").concat(i?"- "+i.slice(0,300):""))}if(r.includes("application/json"))return JSON.parse(i||"[]");return i}catch(e){if("AbortError"===e.name)throw Error("Request timed out");if("Failed to fetch"===e.message)throw Error("Network Error - check CORS / server availability");throw e}finally{clearTimeout(l)}},J=(0,s.useMemo)(()=>{if(null==r)return null;let e=String(r).trim();if(/{{\s*projectId\s*}}/.test(e))return"__INVALID_PLACEHOLDER__";let t=Number(e);return Number.isNaN(t)?"__INVALID_NUMBER__":t},[r]),q=async()=>{h(!0),y(null);try{if(null===J){y("projectId is required."),x([]),h(!1);return}if("__INVALID_PLACEHOLDER__"===J){y('projectId looks like a template placeholder ("{{projectId}}"). Pass a real numeric id.'),x([]),h(!1);return}if("__INVALID_NUMBER__"===J){y('projectId "'.concat(r,'" is not a valid number.')),x([]),h(!1);return}let e=_("".concat(i,"/").concat(J,"/milestones"));console.info("[milestones] GET",e,"AuthPresent:",!!c);let t=await G(e,{method:"GET",headers:H({"Content-Type":"application/json"}),credentials:"same-origin"});Array.isArray(t)?x(t):(null==t?void 0:t.data)&&Array.isArray(t.data)?x(t.data):(null==t?void 0:t.milestones)&&Array.isArray(t.milestones)?x(t.milestones):(console.warn("Unexpected milestones response:",t),x([]),y("Unexpected response shape from server. See console."))}catch(e){console.error("fetchMilestones error:",e),x([]),y((null==e?void 0:e.message)||"Failed to load milestones")}finally{h(!1)}};(0,s.useEffect)(()=>{q()},[r,v]);let W=e=>"number"!=typeof e?"-":"$".concat(e.toFixed(2)),V=async()=>{P(!0),M(null);try{var e,t;if(!(null==(e=U.title)?void 0:e.trim())){M("Title is required."),P(!1);return}if("number"!=typeof J){M("Invalid projectId."),P(!1);return}let s={title:U.title.trim(),milestoneCost:Number(U.milestoneCost||0),status:(U.status||"INCOMPLETE").toUpperCase(),summary:(null==(t=U.summary)?void 0:t.trim())||"",startDate:U.startDate?new Date(U.startDate).toISOString():null,endDate:U.endDate?new Date(U.endDate).toISOString():null},a=_("".concat(i,"/").concat(J,"/milestones"));await G(a,{method:"POST",headers:H({"Content-Type":"application/json"}),credentials:"same-origin",body:JSON.stringify(s)}),N(!1),z({title:"",milestoneCost:"",status:"INCOMPLETE",summary:"",startDate:"",endDate:""}),b(e=>e+1)}catch(e){console.error("createMilestone error:",e),M((null==e?void 0:e.message)||"Failed to create milestone")}finally{P(!1)}},X=async()=>{P(!0),M(null);try{var e,t;if(!(null==I?void 0:I.id)){M("No milestone selected for update."),P(!1);return}if(!(null==(e=U.title)?void 0:e.trim())){M("Title is required."),P(!1);return}let s={title:U.title.trim(),milestoneCost:Number(U.milestoneCost||0),status:(U.status||"INCOMPLETE").toUpperCase(),summary:(null==(t=U.summary)?void 0:t.trim())||"",startDate:U.startDate?new Date(U.startDate).toISOString():null,endDate:U.endDate?new Date(U.endDate).toISOString():null},a=_("".concat(i,"/").concat(J,"/milestones/").concat(I.id));await G(a,{method:"PUT",headers:H({"Content-Type":"application/json"}),credentials:"same-origin",body:JSON.stringify(s)}),k(!1),E(null),b(e=>e+1)}catch(e){console.error("updateMilestone error:",e),M((null==e?void 0:e.message)||"Failed to update milestone")}finally{P(!1)}},K=async()=>{P(!0),M(null);try{if(!(null==I?void 0:I.id)){M("No milestone selected for delete."),P(!1);return}let e=_("".concat(i,"/").concat(J,"/milestones/").concat(I.id));await G(e,{method:"DELETE",headers:H({"Content-Type":"application/json"}),credentials:"same-origin"}),T(!1),E(null),b(e=>e+1)}catch(e){console.error("deleteMilestone error:",e),M((null==e?void 0:e.message)||"Failed to delete milestone")}finally{P(!1)}},$=async(e,t)=>{P(!0),M(null);try{if(!(null==e?void 0:e.id)){M("Invalid milestone"),P(!1);return}let s=_("".concat(i,"/").concat(J,"/milestones/").concat(e.id,"/status")),a=new FormData;a.append("status",String(t).toUpperCase()),await G(s,{method:"PATCH",headers:H(),credentials:"same-origin",body:a}),B(null),F(null),b(e=>e+1)}catch(e){console.error("changeStatus error:",e),M((null==e?void 0:e.message)||"Failed to change status")}finally{P(!1)}},Y=e=>{let t=String(e||"").toLowerCase();return"complete"===t||"completed"===t};return(0,t.jsxs)("div",{className:"p-6 bg-white rounded shadow-sm border border-gray-200",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Milestones"}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)("button",{onClick:()=>{z({title:"",milestoneCost:"",status:"INCOMPLETE",summary:"",startDate:"",endDate:""}),M(null),N(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"+ Create Milestone"})}),(0,t.jsx)("div",{className:"flex items-center gap-3",children:(0,t.jsx)("button",{onClick:()=>b(e=>e+1),className:"bg-gray-100 px-3 py-2 rounded text-sm border hover:bg-gray-200",title:"Refresh",children:"Refresh"})})]}),(0,t.jsxs)("div",{className:"rounded-md border overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-blue-50 text-gray-700 text-sm",children:(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-0 items-center px-4 py-3",children:[(0,t.jsx)("div",{className:"col-span-4 font-medium",children:"Title"}),(0,t.jsx)("div",{className:"col-span-2 font-medium",children:"Milestone Cost"}),(0,t.jsx)("div",{className:"col-span-2 font-medium",children:"Task Count"}),(0,t.jsx)("div",{className:"col-span-2 font-medium",children:"Status"}),(0,t.jsx)("div",{className:"col-span-2 font-medium text-right",children:"Action"})]})}),p?(0,t.jsx)("div",{className:"p-6 text-center text-gray-500",children:"Loading milestones..."}):j?(0,t.jsx)("div",{className:"p-6 text-center text-red-600",children:j}):0===m.length?(0,t.jsx)("div",{className:"p-6 text-center text-gray-500",children:"No milestones found"}):(0,t.jsx)("div",{children:m.map(e=>{var s,a;return(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-0 items-center px-4 py-4 border-t",children:[(0,t.jsx)("div",{className:"col-span-4 text-sm",children:e.title}),(0,t.jsx)("div",{className:"col-span-2 text-sm",children:W(e.milestoneCost)}),(0,t.jsx)("div",{className:"col-span-2 text-sm",children:String(null!=(s=e.taskCount)?s:"00").padStart(2,"0")}),(0,t.jsx)("div",{className:"col-span-2 text-sm",children:(0,t.jsxs)("div",{className:"relative inline-block",children:[(0,t.jsxs)("button",{onClick:()=>{var t;return B(R===e.id?null:null!=(t=e.id)?t:null)},className:"inline-flex items-center justify-between w-full gap-2 px-3 py-1 rounded-md border text-sm bg-white ".concat(Y(e.status)?"border-green-200":"border-gray-200"),title:"Change status","aria-haspopup":"true","aria-expanded":R===e.id,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full ".concat((e=>{let t=String(e||"").toLowerCase();return"complete"===t||"completed"===t||"COMPLETED"===String(e)?"bg-green-600":"bg-red-600"})(e.status))}),(0,t.jsx)("span",{className:"uppercase",children:String(e.status||"INCOMPLETE").toUpperCase()})]}),(0,t.jsx)("svg",{className:"w-3 h-3 shrink-0 text-gray-500",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:(0,t.jsx)("path",{d:"M6 8l4 4 4-4",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})})]}),R===e.id&&(0,t.jsxs)("div",{className:"absolute mt-2 right-0 z-20 w-44 bg-white border rounded-md shadow-lg",children:[(0,t.jsxs)("button",{onClick:()=>$(e,"COMPLETED"),className:"w-full text-left px-4 py-2 hover:bg-gray-50 text-sm flex items-center justify-between ".concat(Y(e.status)?"font-semibold":""),children:[(0,t.jsx)("span",{children:"COMPLETED"}),Y(e.status)&&(0,t.jsx)("svg",{className:"w-4 h-4 text-green-600",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)("path",{d:"M5 10l3 3 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),(0,t.jsxs)("button",{onClick:()=>$(e,"INCOMPLETE"),className:"w-full text-left px-4 py-2 hover:bg-gray-50 text-sm flex items-center justify-between ".concat(Y(e.status)?"":"font-semibold"),children:[(0,t.jsx)("span",{children:"INCOMPLETE"}),!Y(e.status)&&(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-600",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)("path",{d:"M5 10l3 3 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})]})}),(0,t.jsxs)("div",{className:"col-span-2 text-right relative",children:[(0,t.jsx)("button",{onClick:()=>{var t;return F(O===e.id?null:null!=(t=e.id)?t:null)},className:"px-3 py-1 rounded text-sm border hover:bg-gray-50","aria-haspopup":"true","aria-expanded":O===e.id,title:"Actions",children:"⋮"}),O===e.id&&(0,t.jsxs)("div",{className:"absolute right-0 mt-2 z-30 w-44 bg-white border rounded-md shadow-lg text-sm",children:[(0,t.jsx)("button",{onClick:()=>{E(e),C(!0),F(null),F(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"View"}),(0,t.jsx)("button",{onClick:()=>{var t,s;E(e),z({title:e.title||"",milestoneCost:String(null!=(t=e.milestoneCost)?t:""),status:(e.status||"INCOMPLETE").toUpperCase(),summary:null!=(s=e.summary)?s:"",startDate:e.startDate?String(e.startDate).slice(0,10):"",endDate:e.endDate?String(e.endDate).slice(0,10):""}),M(null),k(!0),F(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Edit"}),(0,t.jsx)("button",{onClick:()=>{E(e),T(!0),F(null)},className:"w-full text-left px-4 py-2 hover:bg-gray-50 text-red-600",children:"Delete"})]})]})]},null!=(a=e.id)?a:Math.random())})}),(0,t.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between text-sm text-gray-600",children:[(0,t.jsxs)("div",{children:["Result per page - ",m.length?m.length:0]}),(0,t.jsx)("div",{children:"Page 1 of 1"})]})]}),f&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>N(!1)}),(0,t.jsxs)("div",{className:"relative bg-white w-full max-w-3xl rounded-lg shadow-xl overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Create Milestone"}),(0,t.jsx)("button",{onClick:()=>N(!1),className:"p-2 rounded hover:bg-gray-100",children:(0,t.jsx)(u.XMarkIcon,{className:"w-6 h-6 text-gray-500"})})]}),(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"md:col-span-1",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Title *"}),(0,t.jsx)("input",{type:"text",value:U.title,onChange:e=>z(t=>({...t,title:e.target.value})),className:"w-full border rounded px-3 py-2",placeholder:"Project Closure"})]}),(0,t.jsxs)("div",{className:"md:col-span-1",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Cost"}),(0,t.jsx)("input",{type:"number",value:U.milestoneCost,onChange:e=>z(t=>({...t,milestoneCost:e.target.value})),className:"w-full border rounded px-3 py-2",placeholder:"0.00",min:0})]}),(0,t.jsxs)("div",{className:"md:col-span-1",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Status"}),(0,t.jsxs)("select",{value:U.status,onChange:e=>z(t=>({...t,status:e.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,t.jsx)("option",{value:"INCOMPLETE",children:"INCOMPLETE"}),(0,t.jsx)("option",{value:"COMPLETED",children:"COMPLETED"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-3",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Summary *"}),(0,t.jsx)("textarea",{value:U.summary,onChange:e=>z(t=>({...t,summary:e.target.value})),className:"w-full border rounded px-3 py-2 min-h-[100px]",placeholder:"Conduct a project review to evaluate overall success and lessons learned..."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Date"}),(0,t.jsx)("input",{type:"date",value:U.startDate,onChange:e=>z(t=>({...t,startDate:e.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Date"}),(0,t.jsx)("input",{type:"date",value:U.endDate,onChange:e=>z(t=>({...t,endDate:e.target.value})),className:"w-full border rounded px-3 py-2"})]})]}),L&&(0,t.jsx)("div",{className:"mt-4 text-sm text-red-600",children:L}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-6 pb-6",children:[(0,t.jsx)("button",{onClick:()=>N(!1),className:"px-6 py-2 rounded-md border text-blue-600",disabled:A,children:"Cancel"}),(0,t.jsx)("button",{onClick:V,className:"px-6 py-2 rounded-md bg-blue-600 text-white",disabled:A,children:A?"Saving...":"Save"})]})]})]})]}),w&&I&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>C(!1)}),(0,t.jsxs)("div",{className:"relative bg-white w-full max-w-2xl rounded-lg shadow-xl overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Milestone Details"}),(0,t.jsx)("button",{onClick:()=>C(!1),className:"p-2 rounded hover:bg-gray-100",children:(0,t.jsx)(u.XMarkIcon,{className:"w-6 h-6 text-gray-500"})})]}),(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Title:"})," ",I.title]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Milestone Cost:"})," ",W(I.milestoneCost)]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Task Count:"})," ",null!=(a=I.taskCount)?a:0]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Status:"})," ",String(null!=(l=I.status)?l:"INCOMPLETE").toUpperCase()]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Summary:"}),(0,t.jsx)("div",{className:"mt-1 p-2 bg-gray-50 rounded text-sm",children:null!=(n=I.summary)?n:"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Start Date:"})," ",I.startDate?new Date(I.startDate).toLocaleDateString():"-"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"End Date:"})," ",I.endDate?new Date(I.endDate).toLocaleDateString():"-"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Created At:"})," ",I.createdAt?new Date(I.createdAt).toLocaleString():"-"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Raw:"})," ",(0,t.jsx)("pre",{className:"text-xs bg-gray-50 p-2 rounded",children:JSON.stringify(I,null,2)})]})]}),(0,t.jsx)("div",{className:"flex items-center justify-center gap-6 mt-6 pb-6",children:(0,t.jsx)("button",{onClick:()=>C(!1),className:"px-6 py-2 rounded-md border text-blue-600",children:"Close"})})]})]})]}),S&&I&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>k(!1)}),(0,t.jsxs)("div",{className:"relative bg-white w-full max-w-3xl rounded-lg shadow-xl overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Edit Milestone"}),(0,t.jsx)("button",{onClick:()=>k(!1),className:"p-2 rounded hover:bg-gray-100",children:(0,t.jsx)(u.XMarkIcon,{className:"w-6 h-6 text-gray-500"})})]}),(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"md:col-span-1",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Title *"}),(0,t.jsx)("input",{type:"text",value:U.title,onChange:e=>z(t=>({...t,title:e.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,t.jsxs)("div",{className:"md:col-span-1",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Cost"}),(0,t.jsx)("input",{type:"number",value:U.milestoneCost,onChange:e=>z(t=>({...t,milestoneCost:e.target.value})),className:"w-full border rounded px-3 py-2",min:0})]}),(0,t.jsxs)("div",{className:"md:col-span-1",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Status"}),(0,t.jsxs)("select",{value:U.status,onChange:e=>z(t=>({...t,status:e.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,t.jsx)("option",{value:"INCOMPLETE",children:"INCOMPLETE"}),(0,t.jsx)("option",{value:"COMPLETED",children:"COMPLETED"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-3",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Milestone Summary *"}),(0,t.jsx)("textarea",{value:U.summary,onChange:e=>z(t=>({...t,summary:e.target.value})),className:"w-full border rounded px-3 py-2 min-h-[100px]"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"Start Date"}),(0,t.jsx)("input",{type:"date",value:U.startDate,onChange:e=>z(t=>({...t,startDate:e.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2",children:"End Date"}),(0,t.jsx)("input",{type:"date",value:U.endDate,onChange:e=>z(t=>({...t,endDate:e.target.value})),className:"w-full border rounded px-3 py-2"})]})]}),L&&(0,t.jsx)("div",{className:"mt-4 text-sm text-red-600",children:L}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-6 pb-6",children:[(0,t.jsx)("button",{onClick:()=>k(!1),className:"px-6 py-2 rounded-md border text-blue-600",disabled:A,children:"Cancel"}),(0,t.jsx)("button",{onClick:X,className:"px-6 py-2 rounded-md bg-blue-600 text-white",disabled:A,children:A?"Saving...":"Save"})]})]})]})]}),D&&I&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-12 px-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>T(!1)}),(0,t.jsx)("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl overflow-hidden",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Delete Milestone"}),(0,t.jsxs)("p",{className:"text-sm text-gray-700",children:["Are you sure you want to delete milestone ",(0,t.jsx)("strong",{children:I.title})," ? This action cannot be undone."]}),L&&(0,t.jsx)("div",{className:"mt-4 text-sm text-red-600",children:L}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-4 mt-6",children:[(0,t.jsx)("button",{className:"px-4 py-2 rounded border",onClick:()=>T(!1),disabled:A,children:"Cancel"}),(0,t.jsx)("button",{className:"px-4 py-2 rounded bg-red-600 text-white",onClick:K,disabled:A,children:A?"Deleting...":"Delete"})]})]})})]})]})}let y="https://6jnqmj85-80.inc1.devtunnels.ms",v=e=>{if(!e)return null;let t=String(e).replace(/[^0-9a-fA-F]/g,"");return t.length>=6?"#".concat(t.slice(0,6)):null},b=e=>{let t=e.toLowerCase();return t.includes("complete")||t.includes("complete")?"#10b981":t.includes("to-do")||t.includes("todo")||t.includes("to do")?"#f59e0b":t.includes("doing")?"#2563eb":t.includes("incomplete")?"#ef4444":t.includes("wait")||t.includes("waiting")?"#9ca3af":"#6b7280"},f=(e,t,s,a)=>{let l=(a-90)*Math.PI/180;return{x:e+s*Math.cos(l),y:t+s*Math.sin(l)}};function N(e){let{projectId:a}=e,[n,r]=(0,s.useState)([]),[i,c]=(0,s.useState)([]),[d,o]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),u=localStorage.getItem("accessToken")||"";(0,s.useEffect)(()=>{let e=!0;return(async()=>{o(!0),x(null);try{let[t,s]=await Promise.all([l.default.get("".concat(y,"/status"),{headers:{Authorization:u?"Bearer ".concat(u):""}}),l.default.get("".concat(y,"/projects/").concat(a,"/tasks"),{headers:{Authorization:u?"Bearer ".concat(u):""}})]);e&&(r(Array.isArray(t.data)?t.data:[]),c(Array.isArray(s.data)?s.data:[]))}catch(a){var t,s,n;console.error("Failed to load task statistics:",null!=(n=null!=(s=null==a||null==(t=a.response)?void 0:t.data)?s:null==a?void 0:a.message)?n:a),e&&(x("Failed to load task statistics"),r([]),c([]))}finally{e&&o(!1)}})(),()=>{e=!1}},[a,u]);let p=(0,s.useMemo)(()=>{let e=new Map;return n.forEach(t=>e.set(t.id,{status:t,count:0})),i.forEach(t=>{var s,a,l,r,i,c;let d=null!=(r=null!=(l=t.taskStageId)?l:null==(s=t.taskStage)?void 0:s.id)?r:null;if(null!=d){let t=Array.from(e.keys()).find(e=>e===d);if(void 0!==t){let s=e.get(t);s.count+=1,e.set(t,s);return}}let o=null!=(i=null==(a=t.taskStage)?void 0:a.name)?i:"",m=n.find(e=>o&&String(e.name).toLowerCase().includes(o.toLowerCase()));if(m){let t=null!=(c=e.get(m.id))?c:{status:m,count:0};t.count+=1,e.set(m.id,t);return}let x="unknown";e.has(x)||e.set(x,{status:{id:0,name:"Other",labelColor:null},count:0});let u=e.get(x);u.count+=1,e.set(x,u)}),Array.from(e.values())},[n,i]),h=p.reduce((e,t)=>e+t.count,0)||0,g=0,j=p.filter(e=>e.count>0).map(e=>{let t=0===h?0:e.count/h,s=g;g+=360*t;let a=v(e.status.labelColor)||b(e.status.name);return{...e,start:s,end:g,color:a}});return(0,t.jsx)("div",{children:d?(0,t.jsx)("div",{className:"py-6 text-center text-gray-500",children:"Loading task statistics..."}):m?(0,t.jsx)("div",{className:"py-6 text-center text-red-500",children:m}):(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsxs)("svg",{viewBox:"0 0 100 100",width:"180",height:"180",className:"flex-shrink-0",children:[0===j.length&&(0,t.jsx)("circle",{cx:"50",cy:"50",r:"40",fill:"#e5e7eb"}),j.map((e,s)=>(0,t.jsx)("path",{d:((e,t,s,a,l)=>{let n=f(e,t,s,l),r=f(e,t,s,a);return"M ".concat(e," ").concat(t," L ").concat(n.x," ").concat(n.y," A ").concat(s," ").concat(s," 0 ").concat(l-a<=180?"0":"1"," 0 ").concat(r.x," ").concat(r.y," Z")})(50,50,40,e.start,e.end),fill:e.color,stroke:"#ffffff",strokeWidth:"0.5"},s))]})}),(0,t.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,t.jsx)("ul",{className:"space-y-3 text-sm",children:p.map((e,s)=>{let a=v(e.status.labelColor)||b(e.status.name);return(0,t.jsxs)("li",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{style:{width:18,height:12,background:a},className:"rounded-sm inline-block"}),(0,t.jsx)("span",{className:"flex-1",children:e.status.name}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:e.count})]},s)})}),(0,t.jsxs)("div",{className:"mt-4 text-xs text-gray-500",children:["Total tasks: ",h]})]})]})})}function w(){var e,l,r,i;let{id:c}=(0,a.useParams)()||{},[o,m]=(0,s.useState)(null),[u,p]=(0,s.useState)(!0),[g,y]=(0,s.useState)("overview"),v=async e=>{try{let t=await fetch("/api/work/project/".concat(c),{headers:e?{Authorization:"Bearer ".concat(e)}:void 0});if(!t.ok)throw Error("Failed to fetch");let s=await t.json();m(Array.isArray(s)?s[0]:s)}catch(e){m({id:Number(c||1),shortCode:"PRJ-001",name:"Project Name",category:"Website",startDate:"2025-08-02",deadline:"2025-09-12",client:{name:"John Doe",profilePictureUrl:"https://i.pravatar.cc/80?img=5"},summary:"Short description of the project and goals.",currency:"$",budget:0,hoursEstimate:40,assignedEmployees:[{employeeId:"1",name:"Aman Sharma",designation:"Developer",department:"Engineering"},{employeeId:"2",name:"Riya Singh",designation:"Designer",department:"Design"}],progressPercent:76,totalTimeLoggedMinutes:300,createdBy:"Admin",createdAt:new Date().toISOString(),pinned:!1,archived:!1})}finally{p(!1)}};if((0,s.useEffect)(()=>{v(localStorage.getItem("accessToken")||"")},[c]),u)return(0,t.jsx)("p",{className:"p-8 text-center",children:"Loading project..."});if(!o)return(0,t.jsx)("p",{className:"p-8 text-center text-red-600",children:"Project not found"});let b=o.totalTimeLoggedMinutes?Math.floor(o.totalTimeLoggedMinutes/60):0;return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,t.jsxs)("div",{className:"px-6 py-6",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("h1",{className:"text-3xl font-semibold text-gray-800",children:o.name})}),(0,t.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2 bg-white rounded-xl border border-gray-200 p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[(0,t.jsx)("div",{className:"w-36 h-20",children:(0,t.jsxs)("svg",{viewBox:"0 0 100 50",className:"w-full h-full",children:[(0,t.jsx)("path",{d:"M5 50 A45 45 0 0 1 95 50",fill:"none",stroke:"#e6e6e6",strokeWidth:"10",strokeLinecap:"round"}),(0,t.jsx)("path",{d:"M5 50 A45 45 0 0 1 75 18",fill:"none",stroke:"#f5c518",strokeWidth:"10",strokeLinecap:"round"}),(0,t.jsxs)("text",{x:"50",y:"40",fontSize:"8",textAnchor:"middle",fill:"#374151",children:[o.progressPercent,"%"]})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Start Date"}),(0,t.jsx)("p",{className:"font-medium",children:new Date(o.startDate).toLocaleDateString()})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"End Date"}),(0,t.jsx)("p",{className:"font-medium",children:o.noDeadline?"No Deadline":o.deadline?new Date(o.deadline).toLocaleDateString():"TBD"})]})]}),(0,t.jsx)("div",{className:"hidden lg:block max-w-xs text-gray-600",children:o.summary?(0,t.jsx)("p",{children:o.summary}):(0,t.jsx)("p",{className:"text-sm text-gray-400",children:"No summary available"})})]})}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-4 flex items-center gap-4",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:(null==(e=o.client)?void 0:e.profilePictureUrl)?(0,t.jsx)("img",{src:o.client.profilePictureUrl,alt:"client",className:"w-full h-full object-cover"}):(0,t.jsx)(n.UserIcon,{className:"w-8 h-8 text-gray-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Client"}),(0,t.jsx)("p",{className:"font-medium",children:(null==(l=o.client)?void 0:l.name)||"Client ID: ".concat(null!=(i=null==(r=o.client)?void 0:r.name)?i:"")}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"Qurilo Solutions"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-xl border border-gray-200 p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Task Statistics"}),(0,t.jsx)(N,{projectId:o.id})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Project Budget"}),(0,t.jsxs)("div",{className:"text-2xl font-semibold text-blue-600 mt-2",children:[o.currency,o.budget.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Hours Logged"}),(0,t.jsxs)("div",{className:"text-2xl font-semibold text-blue-600 mt-2",children:[b,"hrs 0 min"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-3 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Earnings"}),(0,t.jsxs)("div",{className:"text-lg font-semibold text-blue-600 mt-1",children:[o.currency,"0.00"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-3 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Expenses"}),(0,t.jsxs)("div",{className:"text-lg font-semibold text-blue-600 mt-1",children:[o.currency,"0.00"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-3 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Profit"}),(0,t.jsxs)("div",{className:"text-lg font-semibold text-blue-600 mt-1",children:[o.currency,"0.00"]})]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-xl border border-gray-200 p-4",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("h4",{className:"text-lg font-medium",children:"Assigned Employees"})}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:o.assignedEmployees&&o.assignedEmployees.length?o.assignedEmployees.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden",children:e.profileUrl?(0,t.jsx)("img",{src:e.profileUrl,alt:e.name,className:"w-full h-full object-cover"}):(0,t.jsx)(n.UserIcon,{className:"w-5 h-5 text-gray-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[e.designation?e.designation+", ":"",e.department]})]})]},e.employeeId)):(0,t.jsx)("p",{className:"text-gray-500 text-center py-6",children:"No employees assigned"})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:[(0,t.jsx)("h4",{className:"text-lg font-medium mb-2",children:"Project Summary"}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 space-y-2",children:[(0,t.jsxs)("div",{children:["Created by: ",o.summary]}),(0,t.jsxs)("div",{children:["Created on: ",new Date(o.createdAt||"").toLocaleDateString()]}),o.pinned&&(0,t.jsxs)("div",{children:["Pinned on: ",new Date(o.pinnedAt||"").toLocaleDateString()]}),o.archived&&(0,t.jsxs)("div",{children:["Archived on: ",new Date(o.archivedAt||"").toLocaleDateString()]})]})]})]})]}),o&&(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(d,{projectId:o.id})}),(0,t.jsxs)("div",{className:"mt-6 grid grid-cols-1 lg:grid-rows-2 gap-2",children:[(0,t.jsx)(x,{projectId:o.id}),(0,t.jsx)(h,{gatewayPath:"https://erp.skavosystem.com/timesheets"}),(0,t.jsx)(j,{projectId:o.id})]})]})})}var C=e.i(519455),S=e.i(107233),k=e.i(386532),D=e.i(55453),T=e.i(513942),I=e.i(540508),E=e.i(737785),A=e.i(38453),P=e.i(339917),L=e.i(158649),M=e.i(257456),U=e.i(101882),z=e.i(910704),O=e.i(811681),F=e.i(299116);let R="".concat("https://6jnqmj85-80.inc1.devtunnels.ms");function B(e){var a;let{projectId:l}=e,[n,r]=(0,s.useState)([]),[i,c]=(0,s.useState)(!0),[d,o]=(0,s.useState)({search:"",project:"All",client:"All",status:"All",startDate:"",endDate:""}),[m,x]=(0,s.useState)({view:!1,edit:!1,upload:!1,payment:!1,create:!1,receipt:!1,viewReceipt:!1,viewPayment:!1,viewCredit:!1,createCredit:!1}),[u,p]=(0,s.useState)(null),h=async()=>{try{var e;c(!0);let t=await fetch("".concat(R,"/api/invoices/project/").concat(l),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}}),s=await t.json();r(Array.isArray(s)?s:null!=(e=s.invoices)?e:[])}catch(e){console.error("Failed to load invoices",e)}finally{c(!1)}};return(0,s.useEffect)(()=>{l&&h()},[l]),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Invoices"}),(0,t.jsxs)(C.Button,{onClick:()=>x(e=>({...e,create:!0})),children:[(0,t.jsx)(S.Plus,{className:"mr-2 h-4 w-4"}),"Create Invoice"]})]}),(0,t.jsx)(k.default,{filters:d,setFilters:o,invoices:n}),(0,t.jsx)(D.default,{invoices:n,loading:i,filters:d,setActiveInvoice:p,setModal:x}),(0,t.jsx)(T.default,{open:m.create,onClose:()=>x(e=>({...e,create:!1})),refresh:h,invoices:n}),(0,t.jsx)(I.default,{open:m.view,onClose:()=>x(e=>({...e,view:!1})),invoice:u,setModal:x,refresh:h}),(0,t.jsx)(E.default,{open:m.edit,onClose:()=>x(e=>({...e,edit:!1})),invoice:u,refresh:h}),(0,t.jsx)(A.default,{open:m.upload,onClose:()=>x(e=>({...e,upload:!1})),invoice:u,refresh:h}),(0,t.jsx)(P.default,{open:m.payment,onClose:()=>x(e=>({...e,payment:!1})),invoice:u,refresh:h}),(0,t.jsx)(L.default,{open:m.receipt,onClose:()=>x(e=>({...e,receipt:!1})),invoice:u,refresh:h}),(0,t.jsx)(M.default,{open:m.viewReceipt,onClose:()=>x(e=>({...e,viewReceipt:!1})),invoice:u}),(0,t.jsx)(U.default,{open:m.payment,onClose:()=>x(e=>({...e,payment:!1})),clientId:null==u||null==(a=u.client)?void 0:a.clientId,onSaved:h}),(0,t.jsx)(z.default,{open:m.viewPayment,onClose:()=>x(e=>({...e,viewPayment:!1})),invoiceNumber:null==u?void 0:u.invoiceNumber}),(0,t.jsx)(O.default,{open:m.createCredit,onClose:()=>x(e=>({...e,createCredit:!1})),invoiceNumber:null==u?void 0:u.invoiceNumber,onCreated:h}),(0,t.jsx)(F.default,{open:m.viewCredit,onClose:()=>x(e=>({...e,viewCredit:!1})),invoiceNumber:null==u?void 0:u.invoiceNumber})]})}var _=e.i(657688),H=e.i(541071),G=e.i(37727),J=e.i(727612);let q="".concat("https://6jnqmj85-80.inc1.devtunnels.ms");function W(e){let{projectId:a,onAdd:l,onSearch:n,onAction:r}=e,[i,c]=(0,s.useState)([]),[d,o]=(0,s.useState)(!1),[m,x]=(0,s.useState)(null),[u,p]=(0,s.useState)(""),[h,g]=(0,s.useState)(!1),[j,y]=(0,s.useState)("pre filled"),[v,b]=(0,s.useState)(()=>a?String(a):"pre filled"),[f,N]=(0,s.useState)("pre filled"),[w,C]=(0,s.useState)(""),[S,k]=(0,s.useState)("USD"),[D,T]=(0,s.useState)(""),[I,E]=(0,s.useState)("Net Banking"),[A,P]=(0,s.useState)(""),L=(0,s.useRef)(null),[M,U]=(0,s.useState)(null),[z,O]=(0,s.useState)(!1),[F,R]=(0,s.useState)([]),[B,W]=(0,s.useState)("");(0,s.useEffect)(()=>{if(!a&&0!==a){c([]),x("No client selected."),o(!1);return}let e=new AbortController;String(a);let t="".concat(q,"/api/payments/project/").concat(a);o(!0),x(null);let s=localStorage.getItem("accessToken");return fetch(t,{method:"GET",signal:e.signal,headers:{Accept:"application/json",Authorization:s?"Bearer ".concat(s):""}}).then(async e=>{if(!e.ok){let t=await e.text().catch(()=>"");throw Error("HTTP ".concat(e.status," ").concat(t))}return e.json()}).then(e=>{if(!Array.isArray(e))return void c([]);c(e.map(e=>{var t,s,a,l,n,r,i,c,d,o,m,x,u,p,h,g,j,y,v;return{id:e.id,code:null!=(d=null==(t=e.project)?void 0:t.projectCode)?d:void 0,project:null!=(o=null==(s=e.project)?void 0:s.projectName)?o:void 0,invoice:null!=(m=null==(a=e.invoice)?void 0:a.invoiceNumber)?m:void 0,client:{clientId:null==(l=e.client)?void 0:l.clientId,name:null!=(x=null==(n=e.client)?void 0:n.name)?x:void 0,companyName:null!=(u=null==(r=e.client)?void 0:r.companyName)?u:void 0,profilePictureUrl:null!=(p=null==(i=e.client)?void 0:i.profilePictureUrl)?p:void 0},orderNumber:null!=(h=e.orderNumber)?h:void 0,amount:"number"==typeof e.amount?e.amount:e.amount?Number(e.amount):void 0,currency:null!=(g=e.currency)?g:void 0,paidOn:null!=(j=e.paymentDate)?j:void 0,paymentGateway:null!=(y=null==(c=e.paymentGateway)?void 0:c.name)?y:void 0,status:e.status?"completed"===String(e.status).toLowerCase()?"Complete":e.status:void 0,receiptFileUrl:null!=(v=e.receiptFileUrl)?v:void 0}}))}).catch(e=>{"AbortError"!==e.name&&(console.error("Error fetching payments:",e),x("Failed to load payments."),c([]))}).finally(()=>{o(!1)}),()=>e.abort()},[a]);let V=(0,s.useMemo)(()=>{let e=u.trim().toLowerCase();return e?i.filter(t=>{var s,a,l,n,r,i,c,d;return String(null!=(l=t.code)?l:"").toLowerCase().includes(e)||String(null!=(n=t.project)?n:"").toLowerCase().includes(e)||String(null!=(r=t.invoice)?r:"").toLowerCase().includes(e)||String(null!=(i=null==(s=t.client)?void 0:s.name)?i:"").toLowerCase().includes(e)||String(null!=(c=null==(a=t.client)?void 0:a.companyName)?c:"").toLowerCase().includes(e)||String(null!=(d=t.orderNumber)?d:"").toLowerCase().includes(e)}):i},[i,u]),X=async()=>{try{let e=await fetch("".concat(q,"/api/payment-gateways"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken")||""),Accept:"application/json"}});if(!e.ok){console.error("Failed to fetch gateways",e.status),R([]);return}let t=await e.json();Array.isArray(t)?R(t.map(e=>({id:e.id,name:e.name}))):R([])}catch(e){console.error("fetchGateways error",e),R([])}},K=async()=>{let e=B.trim();if(!e)return void alert("Enter gateway name");try{let t=localStorage.getItem("accessToken")||"",s=await fetch("".concat(q,"/api/payment-gateways"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:e})});if(!s.ok){let e=await s.text().catch(()=>"");console.error("POST gateway failed",s.status,e),alert("Failed to create gateway");return}let a=await s.json();R(e=>[...e,{id:a.id,name:a.name}]),E(a.name),O(!1)}catch(e){console.error("handleSaveGateway error",e),alert("Failed to create gateway")}},$=async e=>{if(confirm("Delete this gateway?"))try{let a=localStorage.getItem("accessToken")||"",l=await fetch("".concat(q,"/api/payment-gateways/").concat(encodeURIComponent(String(e))),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}});if(!l.ok){console.error("Failed delete gateway",l.status),alert("Failed to delete gateway");return}if(R(t=>t.filter(t=>t.id!==e)),F.find(t=>t.id===e&&t.name===I)){var t,s;let a=F.filter(t=>t.id!==e);E(null!=(s=null==(t=a[0])?void 0:t.name)?s:"")}}catch(e){console.error("handleDeleteGateway error",e),alert("Failed to delete gateway")}};return(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg border p-5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Payments"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{children:(0,t.jsx)("button",{onClick:()=>{if(l)try{l()}catch(e){}b(a?String(a):v),g(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"+ Add Payment"})}),(0,t.jsx)("div",{children:(0,t.jsx)("input",{type:"search",placeholder:"Search",value:u,onChange:e=>{p(e.target.value),n&&n(e.target.value)},className:"border rounded px-3 py-2 text-sm w-56"})})]})]}),d?(0,t.jsx)("div",{className:"py-6 text-center text-gray-600",children:"Loading payments..."}):m?(0,t.jsx)("div",{className:"py-6 text-center text-red-600",children:m}):(0,t.jsxs)("div",{className:"rounded-lg border overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-[#e8f3ff] px-4 py-3 flex text-sm text-gray-700 font-medium",children:[(0,t.jsx)("div",{className:"w-1/12",children:"Code"}),(0,t.jsx)("div",{className:"w-2/12",children:"Project"}),(0,t.jsx)("div",{className:"w-1/12",children:"Invoice"}),(0,t.jsx)("div",{className:"w-2/12",children:"Client"}),(0,t.jsx)("div",{className:"w-1/12",children:"Order#"}),(0,t.jsx)("div",{className:"w-1/12",children:"Amount"}),(0,t.jsx)("div",{className:"w-1/12",children:"Paid On"}),(0,t.jsx)("div",{className:"w-1/12",children:"Payment Gateway"}),(0,t.jsx)("div",{className:"w-1/12",children:"Status"}),(0,t.jsx)("div",{className:"w-10 text-center",children:"Action"})]}),(0,t.jsx)("div",{className:"px-4 py-4",children:0===V.length?(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"No payments to display."}):(0,t.jsx)("div",{className:"space-y-3",children:V.map(e=>{var s,a,l,n,i,c,d,o,m,x,u,p,h,g,j,y;return(0,t.jsxs)("div",{className:"flex items-center rounded-md border px-4 py-3 bg-white",style:{boxShadow:"0 0 0 1px rgba(0,0,0,0.02) inset"},children:[(0,t.jsx)("div",{className:"w-1/12 text-sm",children:null!=(d=e.code)?d:"--"}),(0,t.jsx)("div",{className:"w-2/12 text-sm",children:null!=(o=e.project)?o:"--"}),(0,t.jsx)("div",{className:"w-1/12 text-sm",children:null!=(m=e.invoice)?m:"--"}),(0,t.jsxs)("div",{className:"w-2/12 flex items-center gap-3 text-sm",children:[(0,t.jsx)("div",{className:"h-7 w-7 rounded-full overflow-hidden bg-gray-100 relative flex-shrink-0",children:(null==(s=e.client)?void 0:s.profilePictureUrl)?(0,t.jsx)(_.default,{src:e.client.profilePictureUrl,alt:null!=(x=null==(a=e.client)?void 0:a.name)?x:"client",fill:!0,sizes:"28px",style:{objectFit:"cover"},unoptimized:!0}):(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-xs text-gray-500",children:null!=(u=null==(n=e.client)||null==(l=n.name)?void 0:l.charAt(0))?u:"U"})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:null!=(p=null==(i=e.client)?void 0:i.name)?p:"--"}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:null!=(h=null==(c=e.client)?void 0:c.companyName)?h:""})]})]}),(0,t.jsx)("div",{className:"w-1/12 text-sm",children:null!=(g=e.orderNumber)?g:"--"}),(0,t.jsx)("div",{className:"w-1/12 text-sm",children:((e,t)=>{if(null==e)return"--";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:t||"USD",maximumFractionDigits:2}).format(Number(e))}catch(s){return"".concat(null!=t?t:"$"," ").concat(Number(e).toFixed(2))}})(e.amount,e.currency)}),(0,t.jsx)("div",{className:"w-1/12 text-sm",children:(e=>{if(!e)return"--";try{let t=new Date(e),s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear();return"".concat(s,"/").concat(a,"/").concat(l)}catch(t){return e}})(e.paidOn)}),(0,t.jsx)("div",{className:"w-1/12 text-sm",children:null!=(j=e.paymentGateway)?j:"--"}),(0,t.jsx)("div",{className:"w-1/12 text-sm",children:"Complete"===e.status?(0,t.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)("span",{className:"h-2 w-2 rounded-full bg-emerald-600 block"}),(0,t.jsx)("span",{children:"Complete"})]}):"Pending"===e.status?(0,t.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)("span",{className:"h-2 w-2 rounded-full bg-yellow-500 block"}),(0,t.jsx)("span",{children:"Pending"})]}):(0,t.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)("span",{className:"h-2 w-2 rounded-full bg-red-500 block"}),(0,t.jsx)("span",{children:null!=(y=e.status)?y:"--"})]})}),(0,t.jsx)("div",{className:"w-10 text-center",children:(0,t.jsx)("button",{onClick:()=>r?r(e):void 0,className:"p-2 rounded hover:bg-gray-100 inline-flex items-center justify-center",title:"Actions",children:(0,t.jsx)(H.MoreHorizontal,{size:16})})})]},e.id)})})})]})]}),h&&(0,t.jsxs)("div",{className:"fixed inset-0 z-[10000] flex items-start justify-center pt-8 px-4 overflow-y-auto",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>g(!1)}),(0,t.jsxs)("div",{className:"relative w-full max-w-4xl bg-white rounded-xl shadow-2xl overflow-y-auto z-10",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Add Payment Details"}),(0,t.jsx)("button",{onClick:()=>g(!1),className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:(0,t.jsx)(G.X,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,t.jsx)("h4",{className:"font-medium mb-3",children:"Payment Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-600",children:"Project *"}),(0,t.jsx)("input",{className:"w-full border rounded px-3 py-2",value:j,onChange:e=>y(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-600",children:"Client *"}),(0,t.jsx)("input",{className:"w-full border rounded px-3 py-2",value:v,onChange:e=>b(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-600",children:"Invoice *"}),(0,t.jsx)("input",{className:"w-full border rounded px-3 py-2",value:f,onChange:e=>N(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-600",children:"Amount *"}),(0,t.jsx)("input",{className:"w-full border rounded px-3 py-2",value:w,onChange:e=>C(e.target.value),placeholder:"---"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-600",children:"Currency *"}),(0,t.jsxs)("select",{value:S,onChange:e=>k(e.target.value),className:"w-full border rounded px-3 py-2",children:[(0,t.jsx)("option",{value:"USD",children:"USD $"}),(0,t.jsx)("option",{value:"USD",children:"USD ₹"}),(0,t.jsx)("option",{value:"EUR",children:"EUR €"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-600",children:"Transaction Id"}),(0,t.jsx)("input",{className:"w-full border rounded px-3 py-2",value:D,onChange:e=>T(e.target.value)})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("label",{className:"text-sm text-gray-600",children:"Payment Gateway"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("select",{value:I,onChange:e=>E(e.target.value),className:"w-full border rounded px-3 py-2",children:F.length>0?F.map(e=>(0,t.jsx)("option",{value:e.name,children:e.name},e.id)):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("option",{children:"Net Banking"}),(0,t.jsx)("option",{children:"Credit Card"}),(0,t.jsx)("option",{children:"PayPal"})]})}),(0,t.jsx)("button",{className:"px-3 py-2 bg-gray-100 rounded",type:"button",onClick:()=>{W(""),O(!0),X()},title:"Add payment gateway",children:"Add"})]})]})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("label",{className:"text-sm text-gray-600 block mb-2",children:"Receipt"}),(0,t.jsxs)("div",{onClick:()=>{var e;return null==(e=L.current)?void 0:e.click()},className:"border-2 border-dashed rounded-lg h-28 flex items-center justify-center cursor-pointer text-gray-500",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"mb-1",children:"Choose a file"}),(0,t.jsx)("div",{className:"text-xs text-gray-400",children:M?M.name:"Drag & drop or click"})]}),(0,t.jsx)("input",{ref:L,type:"file",className:"hidden",onChange:e=>{var t,s;return U(null!=(s=null==(t=e.target.files)?void 0:t[0])?s:null)}})]})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("label",{className:"text-sm text-gray-600 block mb-2",children:"Remark"}),(0,t.jsx)("textarea",{rows:4,value:A,onChange:e=>P(e.target.value),className:"w-full p-3 border rounded",placeholder:"Enter a summary of payment"})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,t.jsx)("button",{className:"px-4 py-2 border rounded",onClick:()=>g(!1),children:"Cancel"}),(0,t.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:()=>{null==M||M.name,g(!1)},children:"Save"})]})]})]})]}),z&&(0,t.jsxs)("div",{className:"fixed inset-0 z-[11000] flex items-start justify-center pt-12 px-4 overflow-y-auto",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:()=>O(!1)}),(0,t.jsxs)("div",{className:"relative w-full max-w-3xl bg-white rounded-xl shadow-2xl overflow-y-auto z-20",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Add Payment Gateway"}),(0,t.jsx)("button",{onClick:()=>O(!1),className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:(0,t.jsx)(G.X,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"rounded border overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-[#e8f3ff] px-4 py-2 flex text-sm text-gray-700 font-medium",children:[(0,t.jsx)("div",{className:"w-1/12",children:"#"}),(0,t.jsx)("div",{className:"w-11/12",children:"Gateway"}),(0,t.jsx)("div",{className:"w-12 text-center",children:"Action"})]}),(0,t.jsx)("div",{className:"px-4 py-2",children:0===F.length?(0,t.jsx)("div",{className:"text-sm text-gray-500 p-2",children:"No gateways"}):F.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center py-2 border-b last:border-b-0",children:[(0,t.jsx)("div",{className:"w-1/12 text-sm",children:s+1}),(0,t.jsx)("div",{className:"w-11/12 text-sm",children:e.name}),(0,t.jsx)("div",{className:"w-12 text-center",children:(0,t.jsx)("button",{onClick:()=>$(e.id),className:"inline-flex items-center justify-center p-1 rounded hover:bg-red-50 text-red-600",title:"Delete gateway",children:(0,t.jsx)(J.Trash2,{size:16})})})]},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-600",children:"Payment Gateway Name *"}),(0,t.jsx)("input",{value:B,onChange:e=>W(e.target.value),placeholder:"--",className:"w-full border rounded px-3 py-2 mt-2"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-3 pt-2",children:[(0,t.jsx)("button",{className:"px-4 py-2 border rounded",onClick:()=>O(!1),children:"Cancel"}),(0,t.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:K,children:"Save"})]})]})]})]})]})}let V="".concat("https://6jnqmj85-80.inc1.devtunnels.ms");function X(e){let{projectId:a,authToken:l}=e,n=(0,s.useRef)(null),[r,i]=(0,s.useState)([]),[c,d]=(0,s.useState)(!1),[o,m]=(0,s.useState)(null),[x,u]=(0,s.useState)({}),[p,h]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(!a)return;let e=!0;return d(!0),h(null),fetch("".concat(V,"/files/projects/").concat(a),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}}).then(e=>e.json()).then(t=>{e&&i((Array.isArray(t)?t:[]).map(e=>({id:e.id,filename:e.filename,url:e.url,mimeType:e.mimeType,size:e.size,uploadedBy:e.uploadedBy,createdAt:e.createdAt})))}).catch(()=>h("Failed to load files")).finally(()=>e&&d(!1)),()=>{e=!1}},[a,l]);let g=async e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(!s)return;let l="local-".concat(Date.now()),r=s.type.startsWith("image/")?URL.createObjectURL(s):null;i(e=>[{id:l,filename:s.name,url:r,mimeType:s.type},...e]),u(e=>({...e,[l]:!0})),h(null);try{let e=new FormData;e.append("file",s);let t=await fetch("".concat(V,"/files/projects/").concat(a),{method:"POST",body:e,headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}});if(!t.ok)throw Error("Upload failed");let n=await t.json();i(e=>e.map(e=>e.id===l?{id:n.id,filename:n.filename,url:n.url,mimeType:n.mimeType,size:n.size,uploadedBy:n.uploadedBy,createdAt:n.createdAt}:e))}catch(e){i(e=>e.filter(e=>e.id!==l)),h("Upload failed")}finally{u(e=>{let t={...e};return delete t[l],t}),n.current&&(n.current.value="")}},j=async e=>{i(t=>t.filter(t=>t.id!==e));try{await fetch("".concat(V,"/files/projects/").concat(a,"/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}})}catch(e){h("Delete failed")}},y=(e,t,s)=>{if(!e)return;let a=document.createElement("a");a.href=e,a.target="_blank",t&&(a.download=s||"file"),document.body.appendChild(a),a.click(),a.remove()};return(0,t.jsxs)("div",{className:"bg-white rounded-lg border p-5",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Upload file"}),(0,t.jsxs)("div",{onClick:()=>{var e;return null==(e=n.current)?void 0:e.click()},className:"border-2 border-dashed rounded-lg h-28 flex items-center justify-center cursor-pointer text-gray-500",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",fill:"#bdbdbd",viewBox:"0 0 24 24",className:"mx-auto mb-2",children:(0,t.jsx)("path",{d:"M12 16a1 1 0 0 1-1-1v-4.586l-1.293 1.293a1 1 0 1 1-1.414-1.414l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.414L13 10.414V15a1 1 0 0 1-1 1Zm7-1a5 5 0 0 0-4.546-4.978A7 7 0 0 0 5.062 9.2 5 5 0 0 0 6 19h13a4 4 0 0 0 0-8Z"})}),(0,t.jsx)("div",{className:"text-sm font-medium",children:"Choose a file"})]}),(0,t.jsx)("input",{ref:n,type:"file",className:"hidden",onChange:g})]}),c&&(0,t.jsx)("p",{className:"text-sm mt-3 text-gray-500",children:"Loading…"}),p&&(0,t.jsx)("p",{className:"text-sm mt-3 text-red-500",children:p}),(0,t.jsx)("div",{className:"mt-6 grid grid-cols-6 gap-4",children:r.map(e=>{var s;return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"h-20 border rounded bg-gray-50 flex items-center justify-center overflow-hidden",children:e.url&&(null==(s=e.mimeType)?void 0:s.startsWith("image/"))?(0,t.jsx)(_.default,{src:e.url,alt:e.filename||"file",fill:!0,className:"object-cover",unoptimized:!0}):(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"File"})}),(0,t.jsx)("button",{onClick:()=>m(o===e.id?null:e.id),className:"absolute top-1 right-1 p-1 rounded hover:bg-white",children:(0,t.jsx)(H.MoreHorizontal,{size:16})}),o===e.id&&(0,t.jsxs)("div",{className:"absolute right-0 mt-7 w-36 bg-white border rounded shadow z-20",children:[(0,t.jsx)("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>y(e.url,!0,e.filename||void 0),children:"Download"}),(0,t.jsx)("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>y(e.url),children:"View"}),(0,t.jsx)("button",{className:"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-gray-50",onClick:()=>j(e.id),children:"Delete"})]})]}),(0,t.jsx)("div",{className:"mt-2 text-sm",children:(0,t.jsxs)("div",{className:"font-medium truncate",children:[e.filename||"Untitled",x[String(e.id)]&&(0,t.jsxs)("span",{className:"text-xs text-gray-400",children:[" ","· uploading…"]})]})})]},String(e.id))})})]})}var K=e.i(323585),$=e.i(248256),Y=e.i(270756),Z=e.i(286536),Q=e.i(688511);let ee="".concat("https://6jnqmj85-80.inc1.devtunnels.ms");function et(e){let{projectId:a,authToken:l}=e,[n,r]=(0,s.useState)([]),[i,c]=(0,s.useState)(!1),[d,o]=(0,s.useState)(null),[m,x]=(0,s.useState)(null),[u,p]=(0,s.useState)(!1),[h,g]=(0,s.useState)(""),[j,y]=(0,s.useState)(""),[v,b]=(0,s.useState)(!0),[f,N]=(0,s.useState)(!1),[w,C]=(0,s.useState)(!1),[k,D]=(0,s.useState)(null),[T,I]=(0,s.useState)(!1),[E,A]=(0,s.useState)(null),[P,L]=(0,s.useState)(""),[M,U]=(0,s.useState)(""),[z,O]=(0,s.useState)(!0),[F,R]=(0,s.useState)(!1),B={Authorization:"Bearer ".concat(l||localStorage.getItem("accessToken")||"")};(0,s.useEffect)(()=>{a&&(async()=>{c(!0),o(null);try{let e=await fetch("".concat(ee,"/projects/").concat(a,"/notes"),{headers:B});if(!e.ok)throw Error("Failed to load notes");let t=await e.json();r(Array.isArray(t)?t.map(e=>{var t,s;return{id:e.id,title:null!=(t=e.title)?t:"Untitled",content:null!=(s=e.content)?s:"---",isPublic:!!e.isPublic,createdBy:e.createdBy,createdAt:e.createdAt}}):[])}catch(e){o(e.message)}finally{c(!1)}})()},[a]);let _=async()=>{if(!h.trim())return void o("Note title is required");N(!0);try{let e=await fetch("".concat(ee,"/projects/").concat(a,"/notes"),{method:"POST",headers:{"Content-Type":"application/json",...B},body:JSON.stringify({title:h,content:j,isPublic:v})});if(!e.ok)throw Error("Failed to save note");let t=await e.json();r(e=>{var s;return[{id:t.id,title:t.title,content:null!=(s=t.content)?s:"---",isPublic:t.isPublic,createdBy:t.createdBy,createdAt:t.createdAt},...e]}),p(!1),g(""),y(""),b(!0)}catch(e){o(e.message)}finally{N(!1)}},H=async()=>{if(E){R(!0);try{let e=await fetch("".concat(ee,"/notes/project/").concat(E),{method:"PUT",headers:{"Content-Type":"application/json",...B},body:JSON.stringify({title:P,content:M,isPublic:z})});if(!e.ok)throw Error("Failed to update note");let t=await e.json();r(e=>e.map(e=>e.id===E?{...e,title:t.title,content:t.content,isPublic:t.isPublic}:e)),I(!1)}catch(e){o(e.message)}finally{R(!1)}}},G=async e=>{r(t=>t.filter(t=>t.id!==e.id));try{await fetch("".concat(ee,"/projects/").concat(a,"/notes/").concat(e.id),{method:"DELETE",headers:B})}catch(e){o("Delete failed")}};return(0,t.jsxs)("div",{className:"bg-white rounded border",children:[(0,t.jsx)("div",{className:"p-4 flex justify-end border-b",children:(0,t.jsxs)("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-3 py-2 text-sm rounded flex items-center gap-2",children:[(0,t.jsx)(S.Plus,{size:16})," Add Note"]})}),(0,t.jsxs)("div",{className:"p-4",children:[i&&(0,t.jsx)("p",{children:"Loading…"}),d&&(0,t.jsx)("p",{className:"text-red-600",children:d}),(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-blue-50",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left",children:"Note Title"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Note Type"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right",children:"Action"})]})}),(0,t.jsx)("tbody",{children:n.map(e=>(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"px-4 py-3",children:e.title}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[e.isPublic?(0,t.jsx)($.Globe,{size:14}):(0,t.jsx)(Y.Lock,{size:14}),e.isPublic?"Public":"Private"]})}),(0,t.jsxs)("td",{className:"px-4 py-3 text-right relative",children:[(0,t.jsx)("button",{onClick:()=>x(m===e.id?null:e.id),children:(0,t.jsx)(K.MoreVertical,{size:18})}),m===e.id&&(0,t.jsxs)("div",{className:"absolute right-0 mt-2 bg-white border rounded shadow w-40 z-20",children:[(0,t.jsxs)("button",{className:"w-full px-3 py-2 flex gap-2 hover:bg-gray-50",onClick:()=>{D(e),C(!0),x(null)},children:[(0,t.jsx)(Z.Eye,{size:14})," View"]}),(0,t.jsxs)("button",{className:"w-full px-3 py-2 flex gap-2 hover:bg-gray-50",onClick:()=>{var t;A(e.id),L(e.title),U(null!=(t=e.content)?t:""),O(e.isPublic),I(!0),x(null)},children:[(0,t.jsx)(Q.Edit,{size:14})," Edit"]}),(0,t.jsxs)("button",{className:"w-full px-3 py-2 flex gap-2 text-red-600 hover:bg-gray-50",onClick:()=>G(e),children:[(0,t.jsx)(J.Trash2,{size:14})," Delete"]})]})]})]},e.id))})]})]}),w&&k&&(0,t.jsxs)(es,{onClose:()=>C(!1),children:[(0,t.jsx)(ea,{title:k.title,onClose:()=>C(!1)}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"border rounded-lg p-6 space-y-4",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-700",children:"Project Note Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,t.jsx)("div",{className:"text-gray-500",children:"Note Title"}),(0,t.jsx)("div",{className:"col-span-2",children:k.title}),(0,t.jsx)("div",{className:"text-gray-500",children:"Note Type"}),(0,t.jsx)("div",{className:"col-span-2",children:k.isPublic?"Public":"Private"}),(0,t.jsx)("div",{className:"text-gray-500",children:"Note Detail"}),(0,t.jsx)("div",{className:"col-span-2 whitespace-pre-wrap",children:k.content||"---"})]})]})})]}),u&&(0,t.jsxs)(es,{onClose:()=>!f&&p(!1),children:[(0,t.jsx)(ea,{title:"Add Project Note",onClose:()=>p(!1)}),(0,t.jsxs)(el,{children:[(0,t.jsx)(er,{label:"Note Title *",value:h,onChange:g}),(0,t.jsx)(ec,{value:v,onChange:b}),(0,t.jsx)(ei,{label:"Note Detail",value:j,onChange:y})]}),(0,t.jsx)(en,{loading:f,onCancel:()=>p(!1),onSave:_,saveText:"Save"})]}),T&&(0,t.jsxs)(es,{onClose:()=>!F&&I(!1),children:[(0,t.jsx)(ea,{title:"Update Project Note",onClose:()=>I(!1)}),(0,t.jsxs)(el,{children:[(0,t.jsx)(er,{label:"Note Title *",value:P,onChange:L}),(0,t.jsx)(ec,{value:z,onChange:O}),(0,t.jsx)(ei,{label:"Note Detail",value:M,onChange:U})]}),(0,t.jsx)(en,{loading:F,onCancel:()=>I(!1),onSave:H,saveText:"Update"})]})]})}function es(e){let{children:s,onClose:a}=e;return(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex justify-center pt-12",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:a}),(0,t.jsx)("div",{className:"relative bg-white w-[900px] max-w-[95%] rounded border shadow",children:s})]})}function ea(e){let{title:s,onClose:a}=e;return(0,t.jsxs)("div",{className:"p-4 border-b flex justify-between",children:[(0,t.jsx)("h4",{className:"font-medium",children:s}),(0,t.jsx)("button",{onClick:a,children:(0,t.jsx)(G.X,{size:18})})]})}function el(e){let{children:s}=e;return(0,t.jsx)("div",{className:"p-6 space-y-4",children:s})}function en(e){let{onCancel:s,onSave:a,loading:l,saveText:n}=e;return(0,t.jsxs)("div",{className:"p-4 border-t flex justify-center gap-4",children:[(0,t.jsx)("button",{className:"border px-6 py-2 rounded",onClick:s,children:"Cancel"}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-6 py-2 rounded",disabled:l,onClick:a,children:l?"Saving…":n})]})}function er(e){let{label:s,value:a,onChange:l}=e;return(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs text-gray-600",children:s}),(0,t.jsx)("input",{className:"w-full border px-3 py-2 rounded",value:a,onChange:e=>l(e.target.value)})]})}function ei(e){let{label:s,value:a,onChange:l}=e;return(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs text-gray-600",children:s}),(0,t.jsx)("textarea",{className:"w-full border px-3 py-2 rounded min-h-[120px]",value:a,onChange:e=>l(e.target.value)})]})}function ec(e){let{value:s,onChange:a}=e;return(0,t.jsxs)("div",{className:"flex gap-6",children:[(0,t.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"radio",checked:s,onChange:()=>a(!0)}),"Public"]}),(0,t.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"radio",checked:!s,onChange:()=>a(!1)}),"Private"]})]})}let ed="".concat("https://6jnqmj85-80.inc1.devtunnels.ms");function eo(e){let{projectId:a}=e,[l,n]=(0,s.useState)([]),[r,i]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{a&&(async()=>{try{i(!0),localStorage.getItem("token")||localStorage.getItem("authToken");let e=await fetch("".concat(ed,"/projects/").concat(a,"/activity"),{cache:"no-store",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}}),t=await e.text(),s=t?JSON.parse(t):[];n(Array.isArray(s)?s:[])}catch(e){console.error("Failed to load activity",e),n([])}finally{i(!1)}})()},[a]),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Activity"}),(0,t.jsxs)("div",{className:"border rounded-md overflow-hidden",children:[r&&(0,t.jsx)("div",{className:"p-6 text-center text-gray-400",children:"Loading activity…"}),!r&&0===l.length&&(0,t.jsx)("div",{className:"p-6 text-center text-gray-400",children:"No activity found"}),!r&&l.map(e=>{let{day:s,month:a,time:l}=function(e){let t=new Date(e);return{day:t.toLocaleDateString("en-US",{day:"2-digit"}),month:t.toLocaleDateString("en-US",{month:"short"}),time:t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}}(e.createdAt);return(0,t.jsxs)("div",{className:"flex gap-4 p-4 border-b last:border-b-0",children:[(0,t.jsxs)("div",{className:"w-14 border rounded-md text-center overflow-hidden",children:[(0,t.jsx)("div",{className:"text-xs text-gray-500 border-b py-1",children:a}),(0,t.jsx)("div",{className:"text-lg font-semibold py-2",children:s})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-sm text-gray-800",children:function(e){switch(e){case"PROJECT_FILE_UPLOADED":return"New file uploaded to the project.";case"FILE_DELETED":return"File deleted from the project.";case"PROJECT_NOTE_CREATED":return"New note added to the project.";case"PROJECT_NOTE_UPDATED":return"Project note updated.";case"TASK_CREATED":return"New task created.";case"TASK_UPDATED":return"Task updated.";case"TASK_DELETED":return"Task deleted.";case"TASK_STATUS_CHANGED":return"Task status changed.";case"TASK_FILE_UPLOADED":return"File uploaded to a task.";case"TIMELOG_CREATED":return"Time logged on the project.";case"TIMELOG_UPDATED":return"Time log updated.";case"TIMELOG_DELETED":return"Time log deleted.";case"PROJECT_ASSIGNED_EMPLOYEES_ADDED":return"Employee assigned to the project.";case"DISCUSSION_ROOM_CREATED":return"Discussion room created.";case"DISCUSSION_MESSAGE_DELETED":return"Discussion message deleted.";case"PROJECT_CREATED":return"Project created.";default:return e.replaceAll("_"," ").toLowerCase()}}(e.action)}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:l})]})]},e.id)})]})]})}var em=e.i(239616),ex=e.i(569074),eu=e.i(194983),ep=e.i(178583),eh=e.i(592930),eg=e.i(269638),ej=e.i(440160),ey=e.i(31592),ev=e.i(315636);let eb="".concat("https://6jnqmj85-80.inc1.devtunnels.ms");function ef(e){let{projectId:a,roomId:l,onClose:n}=e,[r,i]=(0,s.useState)(null),[c,d]=(0,s.useState)([]),[o,m]=(0,s.useState)(""),[x,u]=(0,s.useState)(null),[p,h]=(0,s.useState)(null),[g,j]=(0,s.useState)(""),[y,v]=(0,s.useState)(null),[b,f]=(0,s.useState)(null),N=(0,s.useRef)(null),w=(0,s.useRef)(null),C=localStorage.getItem("employeeId"),S=e=>{let t=new Date(e);return"".concat(t.toLocaleDateString("en-GB")," | ").concat(t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}))},k=async()=>{let e=await fetch("".concat(eb,"/api/projects/").concat(a,"/discussion-rooms/").concat(l),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}});i(await e.json())},D=async()=>{let e=await fetch("".concat(eb,"/api/projects/discussion-rooms/").concat(l,"/messages"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}}),t=await e.json();t.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()),d(t)};(0,s.useEffect)(()=>{k(),D()},[l]),(0,s.useEffect)(()=>{var e;null==(e=N.current)||e.scrollIntoView({behavior:"smooth"})},[c]),(0,s.useEffect)(()=>{let e=new ey.default("".concat(eb,"/ws-discussion")),t=new ev.Client({webSocketFactory:()=>e,debug:()=>{},connectHeaders:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))},onConnect:()=>{t.subscribe("/topic/discussion-rooms/".concat(l),e=>{let t=JSON.parse(e.body);d(e=>e.some(e=>e.id===t.id)?e:[...e,t])})}});return t.activate(),w.current=t,()=>{t.deactivate()}},[l]);let T=async()=>{if(!o&&!x)return;let e=new FormData;o&&e.append("content",o),x&&e.append("file",x),e.append("parentMessageId",""),await fetch("".concat(eb,"/api/projects/discussion-rooms/").concat(l,"/messages"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))},body:e}),m(""),u(null),D()},I=async()=>{p&&(await fetch("".concat(eb,"/api/projects/discussion-rooms/").concat(l,"/messages/").concat(p.id),{method:"PUT",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken")),"Content-Type":"text/plain"},body:g}),h(null),j(""))},E=async e=>{v(null),await fetch("".concat(eb,"/api/projects/discussion-rooms/").concat(l,"/messages/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}})},A=async e=>{v(null);let t=c.find(t=>t.isBestReply&&t.id!==e.id);if(!e.isBestReply&&t)return void alert("Please unmark the current Best Reply first.");let s=e.isBestReply?"unmark-best-reply":"mark-best-reply";await fetch("".concat(eb,"/api/projects/discussion-rooms/").concat(l,"/messages/").concat(e.id,"/").concat(s),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}})};return r?(0,t.jsxs)("div",{className:"fixed inset-0 bg-white z-50 flex flex-col",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center px-6 py-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Discussion"}),(0,t.jsx)(G.X,{className:"cursor-pointer",onClick:n})]}),(0,t.jsxs)("div",{className:"px-6 py-4 border-b",children:[(0,t.jsx)("h2",{className:"font-medium text-lg",children:r.title}),(0,t.jsxs)("p",{className:"text-sm text-gray-400",children:["Requested On ",S(r.createdAt)]})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[c.map((e,s)=>{var a,l,n;let r,i=0===s,c=(null==(a=e.sender)?void 0:a.employeeId)===C;return(0,t.jsx)("div",{className:"border rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("img",{src:(null==(l=e.sender)?void 0:l.profileUrl)||"/avatar.png",className:"h-9 w-9 rounded-full"}),(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"font-medium",children:null==(n=e.sender)?void 0:n.name}),e.isBestReply&&(0,t.jsx)("span",{className:"bg-green-100 text-green-700 text-xs font-medium px-3 py-1 rounded-full",children:"Best Reply"})]}),"TEXT"===e.messageType&&(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.content}),"FILE"===e.messageType&&e.fileUrl&&(0,t.jsxs)("div",{className:"relative mt-2 border rounded p-2 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(null==(r=e.mimeType)?void 0:r.startsWith("image/"))?(0,t.jsx)("img",{src:e.fileUrl,className:"h-16 w-16 rounded object-cover"}):(0,t.jsx)(ep.FileText,{size:32}),(0,t.jsx)("span",{className:"text-sm",children:e.fileName})]}),(0,t.jsx)(K.MoreVertical,{size:16,className:"cursor-pointer",onClick:()=>f(b===e.id?null:e.id)}),b===e.id&&(0,t.jsxs)("div",{className:"absolute right-2 top-10 bg-white border rounded shadow w-40 z-50",children:[(0,t.jsxs)("button",{onClick:()=>{window.open(e.fileUrl,"_blank"),f(null)},className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 w-full",children:[(0,t.jsx)(Z.Eye,{size:14}),"View"]}),(0,t.jsxs)("button",{onClick:()=>{((e,t)=>{if(!e)return;let s=document.createElement("a");s.href=e,s.download=t||"",document.body.appendChild(s),s.click(),document.body.removeChild(s)})(e.fileUrl,e.fileName),f(null)},className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 w-full",children:[(0,t.jsx)(ej.Download,{size:14}),"Download"]})]})]})]})]}),(0,t.jsxs)("div",{className:"relative flex items-center gap-3 text-xs text-gray-400",children:[S(e.createdAt),i&&c&&(0,t.jsxs)("button",{onClick:()=>{h(e),j(e.content||"")},className:"flex items-center gap-1 border px-3 py-1 rounded",children:[(0,t.jsx)(eh.Edit2,{size:14}),"Edit"]}),!i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(K.MoreVertical,{size:16,className:"cursor-pointer",onClick:()=>v(y===e.id?null:e.id)}),y===e.id&&(0,t.jsxs)("div",{className:"absolute right-0 top-6 bg-white border rounded shadow w-56 z-50",children:[c&&(0,t.jsxs)("button",{onClick:()=>{h(e),j(e.content||""),v(null)},className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 w-full",children:[(0,t.jsx)(eh.Edit2,{size:14}),"Edit"]}),(0,t.jsxs)("button",{onClick:()=>A(e),className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 w-full",children:[(0,t.jsx)(eg.CheckCircle,{size:14}),e.isBestReply?"Unmark Best Reply":"Mark as Best Reply"]}),(0,t.jsxs)("button",{onClick:()=>E(e.id),className:"flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-gray-100 w-full",children:[(0,t.jsx)(J.Trash2,{size:14}),"Delete"]})]})]})]})]})},e.id)}),(0,t.jsx)("div",{ref:N})]}),(0,t.jsxs)("div",{className:"border-t px-6 py-4",children:[(0,t.jsx)("h1",{children:"Reply *"}),(0,t.jsx)("textarea",{value:o,onChange:e=>m(e.target.value),className:"border rounded px-3 py-2 w-full mb-3 min-h-[80px]"}),(0,t.jsx)("h1",{children:"Add File *"}),(0,t.jsxs)("label",{className:"border border-dashed rounded flex flex-col items-center py-6 cursor-pointer text-gray-400 mb-4",children:[(0,t.jsx)(ex.Upload,{}),(0,t.jsx)("span",{className:"text-sm mt-2",children:x?x.name:"Choose a file"}),(0,t.jsx)("input",{type:"file",hidden:!0,onChange:e=>{var t;return u((null==(t=e.target.files)?void 0:t[0])||null)}})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{onClick:T,className:"bg-blue-600 text-white px-6 py-2 rounded",children:"Reply"})})]}),p&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white w-[500px] rounded p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"font-medium",children:"Update Reply"}),(0,t.jsx)(G.X,{className:"cursor-pointer",onClick:()=>h(null)})]}),(0,t.jsx)("textarea",{value:g,onChange:e=>j(e.target.value),className:"border rounded w-full p-3 min-h-[100px]"}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,t.jsx)("button",{onClick:()=>h(null),className:"px-4 py-2 border rounded",children:"Cancel"}),(0,t.jsx)("button",{onClick:I,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Save"})]})]})})]}):null}let eN="".concat("https://6jnqmj85-80.inc1.devtunnels.ms");function ew(e){let{projectId:a}=e,[l,n]=(0,s.useState)([]),[r,i]=(0,s.useState)([]),[c,d]=(0,s.useState)(!1),[o,m]=(0,s.useState)(!1),[x,u]=(0,s.useState)(!1),[p,h]=(0,s.useState)(null),[g,j]=(0,s.useState)({categoryName:"",colorCode:""}),[y,v]=(0,s.useState)({categoryId:"",title:"",initialMessage:"",file:null}),b=async()=>{try{let e=await fetch("".concat(eN,"/api/projects/discussion-categories"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}}),t=await e.json();n(Array.isArray(t)?t:[])}catch(e){n([])}},f=async()=>{try{d(!0);let e=await fetch("".concat(eN,"/api/projects/").concat(a,"/discussion-rooms"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}}),t=await e.json();i(Array.isArray(t)?t:[])}catch(e){i([])}finally{d(!1)}};(0,s.useEffect)(()=>{b(),f()},[]);let N=async()=>{if(!g.categoryName||!g.colorCode)return;let e=await fetch("".concat(eN,"/api/projects/discussion-categories"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))},body:JSON.stringify(g)}),t=await e.json();n(e=>[...e,t]),j({categoryName:"",colorCode:""}),m(!1)},w=async e=>{await fetch("".concat(eN,"/api/projects/discussion-categories/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}}),b()},C=async()=>{if(!y.categoryId||!y.title||!y.initialMessage)return;let e=new FormData;e.append("title",y.title),e.append("categoryId",y.categoryId),e.append("initialMessage",y.initialMessage),y.file&&e.append("initialFile",y.file),await fetch("".concat(eN,"/api/projects/").concat(a,"/discussion-rooms"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))},body:e}),v({categoryId:"",title:"",initialMessage:"",file:null}),u(!1),f()},k=async e=>{await fetch("".concat(eN,"/api/projects/").concat(a,"/discussion-rooms/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))}}),f()};return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Discussion"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:()=>u(!0),className:"flex items-center gap-2 bg-blue-600 text-white px-3 py-1.5 rounded text-sm",children:[(0,t.jsx)(S.Plus,{size:16}),"New Discussion"]}),(0,t.jsxs)("button",{onClick:()=>m(!0),className:"flex items-center gap-2 border border-blue-500 text-blue-600 px-3 py-1.5 rounded text-sm",children:[(0,t.jsx)(em.Settings,{size:16}),"Discussion Category"]})]})]}),r.map(e=>{var s,a,l,n,r;let i=(null==(s=e.lastMessage)?void 0:s.createdAt)||e.updatedAt||e.createdAt;return(0,t.jsxs)("div",{onClick:()=>h(e.id),className:"border rounded-md p-4 mb-3 flex justify-between items-center cursor-pointer",children:[(0,t.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,t.jsx)("img",{src:(null==(a=e.createdByUser)?void 0:a.profileUrl)||"/avatar.png",className:"h-10 w-10 rounded-full"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.title}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:(e=>{if(!e)return"";let t=new Date(e),s=t.toLocaleDateString("en-GB"),a=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return"replied at ".concat(s," | ").concat(a)})(i)}),(null==(l=e.lastMessage)?void 0:l.messageType)==="FILE"&&(0,t.jsx)("img",{src:e.lastMessage.fileUrl,className:"h-16 mt-2 rounded"}),(null==(n=e.lastMessage)?void 0:n.messageType)==="TEXT"&&(0,t.jsx)("p",{className:"text-sm text-gray-500",children:e.lastMessage.content})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(eu.MessageCircle,{size:14}),null!=(r=e.messageCount)?r:0]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"h-2 w-2 rounded-full",style:{background:e.category.colorCode}}),e.category.categoryName]}),(0,t.jsx)(J.Trash2,{size:16,className:"text-red-500 cursor-pointer",onClick:t=>{t.stopPropagation(),k(e.id)}})]})]},e.id)}),0===r.length&&(0,t.jsx)("div",{className:"border rounded-md p-4 text-gray-400 text-center",children:"Team discussion will appear here"}),x&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg w-[700px] p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,t.jsx)("h4",{className:"font-medium text-lg",children:"New Discussion"}),(0,t.jsx)(G.X,{className:"cursor-pointer",onClick:()=>u(!1)})]}),(0,t.jsxs)("select",{value:y.categoryId,onChange:e=>v({...y,categoryId:e.target.value}),className:"border rounded px-3 py-2 w-full mb-3 text-sm",children:[(0,t.jsx)("option",{value:"",children:"Select category"}),l.map(e=>(0,t.jsx)("option",{value:e.id,children:e.categoryName},e.id))]}),(0,t.jsx)("input",{placeholder:"Title",value:y.title,onChange:e=>v({...y,title:e.target.value}),className:"border rounded px-3 py-2 w-full mb-3 text-sm"}),(0,t.jsx)("textarea",{placeholder:"Reply",value:y.initialMessage,onChange:e=>v({...y,initialMessage:e.target.value}),className:"border rounded px-3 py-2 w-full mb-4 text-sm min-h-[100px]"}),(0,t.jsxs)("label",{className:"border border-dashed rounded flex flex-col items-center justify-center py-6 cursor-pointer text-gray-400 mb-4",children:[(0,t.jsx)(ex.Upload,{}),(0,t.jsx)("span",{className:"text-sm mt-2",children:"Choose a file"}),(0,t.jsx)("input",{type:"file",hidden:!0,onChange:e=>{var t;return v({...y,file:(null==(t=e.target.files)?void 0:t[0])||null})}})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,t.jsx)("button",{onClick:()=>u(!1),className:"border px-6 py-2 rounded text-sm",children:"Cancel"}),(0,t.jsx)("button",{onClick:C,className:"bg-blue-600 text-white px-6 py-2 rounded text-sm",children:"Save"})]})]})}),o&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg w-[600px] p-5",children:[(0,t.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,t.jsx)("h4",{className:"font-medium",children:"Discussion Category"}),(0,t.jsx)(G.X,{className:"cursor-pointer",onClick:()=>m(!1)})]}),l.map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center border-b py-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"h-2 w-2 rounded-full",style:{background:e.colorCode}}),e.categoryName]}),(0,t.jsx)(J.Trash2,{size:14,className:"text-red-500 cursor-pointer",onClick:()=>w(e.id)})]},e.id)),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[(0,t.jsx)("input",{placeholder:"Category Name",value:g.categoryName,onChange:e=>j({...g,categoryName:e.target.value}),className:"border rounded px-3 py-2 text-sm"}),(0,t.jsx)("input",{placeholder:"#3498db",value:g.colorCode,onChange:e=>j({...g,colorCode:e.target.value}),className:"border rounded px-3 py-2 text-sm"})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,t.jsx)("button",{onClick:()=>m(!1),className:"border px-4 py-2 rounded text-sm",children:"Cancel"}),(0,t.jsx)("button",{onClick:N,className:"bg-blue-600 text-white px-4 py-2 rounded text-sm",children:"Save"})]})]})}),p&&(0,t.jsx)(ef,{projectId:a,roomId:p,onClose:()=>h(null)})]})}function eC(){let e=(0,a.useParams)(),n=null==e?void 0:e.id,[r,i]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[o,m]=(0,s.useState)(!0),[x,u]=(0,s.useState)("overview");return((0,s.useEffect)(()=>{if(!n)return;let e=localStorage.getItem("accessToken")||"";(async()=>{try{let[t,s]=await Promise.all([l.default.get("/api/work/project/".concat(n),{headers:{Authorization:"Bearer ".concat(e)}}),l.default.get("".concat("https://6jnqmj85-80.inc1.devtunnels.ms","/projects/").concat(n,"/metrics"),{headers:{Authorization:"Bearer ".concat(e)}})]);i(Array.isArray(t.data)?t.data[0]:t.data),d(s.data)}catch(e){console.error(e)}finally{m(!1)}})()},[n]),o)?(0,t.jsx)("div",{className:"p-8 text-center",children:"Loading project..."}):r?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-6",children:[(0,t.jsx)("h1",{className:"text-3xl font-semibold text-gray-800 mb-4",children:r.name}),(0,t.jsx)("div",{className:"bg-white rounded-t-xl border",children:(0,t.jsx)("nav",{className:"flex gap-6 px-6 h-14 items-center",children:[{key:"overview",label:"Overview"},{key:"invoices",label:"Invoices"},{key:"payments",label:"Payments"},{key:"files",label:"Files"},{key:"notes",label:"Notes"},{key:"activity",label:"Activity"},{key:"discussion",label:"Discussion"}].map(e=>{let s=x===e.key;return(0,t.jsxs)("button",{onClick:()=>u(e.key),className:"relative text-sm font-medium py-3 ".concat(s?"text-blue-600":"text-gray-600"),children:[e.label,s&&(0,t.jsx)("span",{className:"absolute -bottom-3 left-0 w-full h-0.5 bg-blue-500 rounded"})]},e.key)})})}),(0,t.jsxs)("div",{className:"bg-white rounded-b-xl border border-t-0 p-6",children:["overview"===x&&(0,t.jsx)(w,{project:r,metrics:c}),"invoices"===x&&(0,t.jsx)(B,{projectId:r.id}),"payments"===x&&(0,t.jsx)(W,{projectId:r.id}),"files"===x&&(0,t.jsx)(X,{projectId:r.id}),"notes"===x&&(0,t.jsx)(et,{projectId:r.id}),"activity"===x&&(0,t.jsx)(eo,{projectId:r.id}),"discussion"===x&&(0,t.jsx)(ew,{projectId:r.id})]})]})}):(0,t.jsx)("div",{className:"p-8 text-center text-red-500",children:"Project not found"})}}]);