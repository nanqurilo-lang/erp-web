(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,721959,e=>{"use strict";e.s(["default",()=>k]);var t=e.i(843476),l=e.i(618566),s=e.i(283599),a=e.i(271645),d=e.i(515288),r=e.i(519455),n=e.i(487486),i=e.i(871689),o=e.i(522016);let c="".concat("https://6jnqmj85-80.inc1.devtunnels.ms"),x="".concat(c,"/deals"),m="".concat(c,"/employee/all?page=0&size=20"),u="".concat(c,"/deals/dealCategory"),h=async e=>{let t=localStorage.getItem("accessToken");if(!t)throw Error("No access token found. Please log in.");let l=await fetch(e,{cache:"no-store",headers:{Authorization:"Bearer ".concat(t),Accept:"application/json"}});if(!l.ok){let e="Failed to load data.";try{let t=await l.json();e=(null==t?void 0:t.message)||(null==t?void 0:t.error)||e}catch(t){e=await l.text()||e}throw Error(e)}return l.json()};function j(e){return e&&"null"!==e?e:"--"}function v(e){return e?new Date(e).toLocaleString():"--"}function p(e){return e?new Date(e).toLocaleDateString():"--"}function f(e){return null==e||isNaN(Number(e))?"--":new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:0}).format(e)}function g(e){var l,s,d,r,n,i,o,x,m,u,h,j,v,g,N;let{deal:b,lead:y,onClose:w}=e,[C,k]=(0,a.useState)([]),[S,D]=(0,a.useState)(!1),[E,L]=(0,a.useState)(null),[T,A]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("accessToken");if(!e)return;let t=await fetch("".concat(c,"/deals/").concat(b.id,"/files"),{headers:{Authorization:"Bearer ".concat(e),Accept:"application/json"}});if(!t.ok)return;let l=await t.json();Array.isArray(l)&&k(l)}catch(e){}})()},[b.id]);let P=async()=>{var e,t;if(!E)return void A("Select a file first.");A(null),D(!0);try{let t=localStorage.getItem("accessToken");if(!t)throw Error("No access token.");let l=new FormData;l.append("file",E);let s=await fetch("".concat(c,"/deals/").concat(b.id,"/files"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:l});if(!s.ok)throw Error(await s.text());let a=await s.json(),d=a&&(a.name||a.url)?{name:a.name||E.name,url:a.url}:{name:E.name};k(e=>[d,...e]),L(null),(null==(e=document.getElementById("deal-file-input"))?void 0:e.value)&&(document.getElementById("deal-file-input").value="")}catch(e){A(null!=(t=null==e?void 0:e.message)?t:"Upload failed.")}finally{D(!1)}},B=null!=(s=null==y?void 0:y.companyName)?s:"",I=null!=(d=null==y?void 0:y.email)?d:"",W=null!=(n=null!=(r=null==y?void 0:y.mobileNumber)?r:b.leadMobile)?n:"";return(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:w}),(0,t.jsx)("div",{className:"fixed inset-0 flex items-start justify-center px-4 pt-8",children:(0,t.jsxs)("div",{className:"max-w-5xl w-full bg-white rounded-lg shadow-lg border overflow-auto",style:{maxHeight:"92vh"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold",children:["Deal ",null!=(i=b.id)?i:""]}),(0,t.jsx)("button",{onClick:w,className:"text-muted-foreground p-1 rounded hover:bg-slate-100",children:(0,t.jsx)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{className:"p-6 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 rounded-lg border p-4",children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Deal Information"}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mb-4",children:[null!=(o=b.pipeline)?o:"Default Pipeline"," â†’ ",null!=(x=b.dealStage)?x:"--"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Deal Name"}),(0,t.jsx)("div",{className:"font-medium",children:null!=(m=b.title)?m:"Deal ".concat(b.id)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Lead Contact"}),(0,t.jsx)("div",{children:null!=(u=b.leadName)?u:"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Email"}),(0,t.jsx)("div",{children:I?(0,t.jsx)("a",{className:"text-sky-600 underline",href:"mailto:".concat(I),children:I}):"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Company Name"}),(0,t.jsx)("div",{children:null!=B?B:"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Deal Category"}),(0,t.jsx)("div",{children:null!=(h=b.dealCategory)?h:"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Deal Agent"}),(0,t.jsx)("div",{children:null!=(v=null!=(j=null==(l=b.dealAgentMeta)?void 0:l.name)?j:b.dealAgent)?v:"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Deal Watcher"}),(0,t.jsx)("div",{children:b.dealWatchersMeta&&b.dealWatchersMeta.length?b.dealWatchersMeta[0].name:"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Close Date"}),(0,t.jsx)("div",{children:b.expectedCloseDate?p(b.expectedCloseDate):"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Deal Value"}),(0,t.jsx)("div",{children:f(null!=(g=b.value)?g:0)})]})]})]}),(0,t.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,t.jsx)("h4",{className:"font-medium mb-3",children:"Lead Contact Details"}),(0,t.jsxs)("div",{className:"text-sm grid gap-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Name"}),(0,t.jsx)("div",{children:null!=(N=b.leadName)?N:"--"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Email"}),(0,t.jsx)("div",{children:I?(0,t.jsx)("a",{className:"text-sky-600 underline",href:"mailto:".concat(I),target:"_blank",rel:"noreferrer",children:I}):"--"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Mobile"}),(0,t.jsx)("div",{children:W?(0,t.jsx)("a",{className:"text-sky-600 underline",href:"tel:".concat(W),children:W}):"--"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Company Name"}),(0,t.jsx)("div",{children:null!=B?B:"--"})]}),(0,t.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,t.jsxs)("a",{href:I?"mailto:".concat(I):"#",className:"px-3 py-2 border rounded text-sm inline-flex items-center gap-2",target:"_blank",rel:"noreferrer",children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8l7.89 5.26a3 3 0 003.22 0L21 8"})}),"Email"]}),(0,t.jsxs)("a",{href:W?"tel:".concat(W):"#",className:"px-3 py-2 border rounded text-sm inline-flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M22 16.92V21a1 1 0 01-1.11 1A19.86 19.86 0 013 5.11 1 1 0 014 4h4.09a1 1 0 01.95.68 12.05 12.05 0 00.7 2.28 1 1 0 01-.24 1.02L8.91 10.9"})}),"Call"]})]})]})]}),(0,t.jsxs)("div",{className:"lg:col-span-3 mt-4 rounded-lg border p-4",children:[(0,t.jsxs)("div",{className:"flex gap-6 border-b pb-3 text-sm",children:[(0,t.jsx)("button",{className:"pb-2 border-b-2 border-sky-600 text-sky-600 font-medium",children:"Files"}),(0,t.jsx)("button",{className:"pb-2 border-b-2 border-transparent text-slate-700",children:"Follow Up"}),(0,t.jsx)("button",{className:"pb-2 border-b-2 border-transparent text-slate-700",children:"People"}),(0,t.jsx)("button",{className:"pb-2 border-b-2 border-transparent text-slate-700",children:"Notes"}),(0,t.jsx)("button",{className:"pb-2 border-b-2 border-transparent text-slate-700",children:"Comments"}),(0,t.jsx)("button",{className:"pb-2 border-b-2 border-transparent text-slate-700",children:"Tags"})]}),(0,t.jsxs)("div",{className:"mt-4 text-sm",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Upload File"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{id:"deal-file-input",type:"file",onChange:e=>{var t,l;A(null),L(null!=(l=null==(t=e.target.files)?void 0:t[0])?l:null)},className:"text-sm"}),(0,t.jsx)("button",{onClick:P,disabled:S,className:"px-3 py-2 rounded bg-blue-600 text-white ".concat(S?"opacity-60":"hover:bg-blue-700"),children:S?"Uploading...":"Upload"}),T&&(0,t.jsx)("div",{className:"text-destructive text-xs",children:T})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"text-sm font-medium mb-2",children:"Files"}),0===C.length?(0,t.jsx)("div",{className:"text-muted-foreground",children:"No files uploaded."}):(0,t.jsx)("ul",{className:"list-disc pl-5 text-sm",children:C.map((e,l)=>(0,t.jsx)("li",{children:e.url?(0,t.jsx)("a",{href:e.url,className:"text-sky-600 underline",target:"_blank",rel:"noreferrer",children:e.name}):e.name},l))})]}),(0,t.jsx)("div",{className:"mt-4",children:"Follow ups / files listing area â€” replicate your existing UI here as needed."})]})]})]})]})})]})}function N(e){let{onClose:l,onSaved:s}=e,[d,r]=(0,a.useState)([]),[n,i]=(0,a.useState)(!0),[o,c]=(0,a.useState)(""),[x,m]=(0,a.useState)(null),h=async()=>{i(!0),m(null);try{let e=localStorage.getItem("accessToken");if(!e)throw Error("No access token.");let t=await fetch(u,{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error(await t.text());let l=await t.json();r(l)}catch(t){var e;m(null!=(e=null==t?void 0:t.message)?e:"Failed to load categories")}finally{i(!1)}};(0,a.useEffect)(()=>{h()},[]);let j=async()=>{if(!o.trim())return void m("Category name required.");m(null);try{let e=localStorage.getItem("accessToken");if(!e)throw Error("No access token.");let t=await fetch(u,{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({categoryName:o})});if(!t.ok)throw Error(await t.text());await h(),s()}catch(t){var e;m(null!=(e=null==t?void 0:t.message)?e:"Failed to add category")}},v=async e=>{if(confirm("Delete this category?"))try{let t=localStorage.getItem("accessToken");if(!t)throw Error("No access token.");let l=await fetch("".concat(u,"/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}});if(!l.ok)throw Error(await l.text());await h(),s()}catch(e){var t;alert("Error: "+(null!=(t=null==e?void 0:e.message)?t:e))}};return(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:l}),(0,t.jsx)("div",{className:"fixed inset-0 flex items-start justify-center px-4 pt-12",children:(0,t.jsxs)("div",{className:"max-w-3xl w-full bg-white rounded-lg shadow-lg border overflow-auto",style:{maxHeight:"80vh"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Deal Category"}),(0,t.jsx)("button",{onClick:l,className:"text-muted-foreground p-1 rounded hover:bg-slate-100",children:(0,t.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{className:"p-6",children:[x&&(0,t.jsx)("div",{className:"text-destructive mb-3",children:x}),(0,t.jsx)("div",{className:"rounded-lg border p-4 mb-4",children:(0,t.jsx)("div",{className:"overflow-auto",children:(0,t.jsxs)("table",{className:"min-w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-sky-50 text-left",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 w-12",children:"#"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Category Name"}),(0,t.jsx)("th",{className:"px-4 py-2 w-24",children:"Action"})]})}),(0,t.jsx)("tbody",{children:n?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:3,className:"px-4 py-4 text-center text-muted-foreground",children:"Loadingâ€¦"})}):0===d.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:3,className:"px-4 py-4 text-center text-muted-foreground",children:"No categories."})}):d.map((e,l)=>(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"px-4 py-3",children:l+1}),(0,t.jsx)("td",{className:"px-4 py-3",children:e.categoryName}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("button",{onClick:()=>v(e.id),className:"text-destructive px-2 py-1 rounded border",children:"ðŸ—‘"})})]},e.id))})]})})}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm text-muted-foreground mb-2",children:"Deal Category Name *"}),(0,t.jsx)("input",{value:o,onChange:e=>c(e.target.value),className:"w-full p-2 border rounded-md"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,t.jsx)("button",{onClick:l,className:"px-6 py-2 border rounded-full text-blue-600 hover:bg-blue-50",children:"Cancel"}),(0,t.jsx)("button",{onClick:j,className:"px-6 py-2 rounded-full text-white bg-blue-600 hover:bg-blue-700",children:"Save"})]})]})]})})]})}function b(e){var l,s;let{lead:d,onClose:r,onCreated:n,possibleAgents:i,possibleWatchers:o}=e,[c,m]=(0,a.useState)({leadContact:null!=(l=null==d?void 0:d.id)?l:"",title:"",pipeline:"",dealStage:"Qualified",dealCategory:"",dealAgent:"",dealWatchers:[],value:"",closeDate:""}),[h,j]=(0,a.useState)(!1),[v,p]=(0,a.useState)(null),[f,g]=(0,a.useState)(!1),b=(0,a.useRef)(null),[y,w]=(0,a.useState)(null),[C,k]=(0,a.useState)([]),[S,D]=(0,a.useState)(!0),[E,L]=(0,a.useState)(!1),T=(e,t)=>m(l=>({...l,[e]:t}));(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]);let A=async()=>{D(!0);try{let e=localStorage.getItem("accessToken");if(!e)throw Error("No access token.");let t=await fetch(u,{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error(await t.text());let l=await t.json();k(l),!c.dealCategory&&l.length>0&&m(e=>({...e,dealCategory:l[0].categoryName}))}catch(e){console.error("Failed to load categories",e)}finally{D(!1)}};(0,a.useEffect)(()=>{A()},[]);let P=async e=>{null==e||e.preventDefault();let t=c.title.trim()?c.pipeline.trim()?c.dealStage.trim()?c.closeDate.trim()?null:"Close date is required.":"Deal stage is required.":"Pipeline is required.":"Deal Name is required.";if(t)return void p(t);p(null),j(!0);try{let e=localStorage.getItem("accessToken");if(!e)throw Error("No access token.");let t={title:c.title,pipeline:c.pipeline||void 0,dealStage:c.dealStage||void 0,dealCategory:c.dealCategory||void 0,dealAgent:c.dealAgent||void 0,dealWatchers:c.dealWatchers&&c.dealWatchers.length?c.dealWatchers:void 0,value:c.value?Number(c.value):void 0,closeDate:c.closeDate||void 0,leadId:d.id},l=await fetch(x,{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!l.ok){let e=await l.text().catch(()=>"");throw Error(e||"Failed to create deal.")}let s=await l.json();n(s),r()}catch(e){var l;p(null!=(l=null==e?void 0:e.message)?l:"Failed to create deal.")}finally{j(!1)}};return(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:r}),(0,t.jsx)("div",{className:"fixed inset-0 flex items-start justify-center px-4 pt-12",children:(0,t.jsxs)("div",{className:"max-w-4xl w-full bg-white rounded-lg shadow-lg border overflow-auto",style:{maxHeight:"92vh"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Add Deal Information"}),(0,t.jsx)("button",{onClick:r,className:"text-muted-foreground p-1 rounded hover:bg-slate-100",children:(0,t.jsx)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("form",{onSubmit:P,className:"p-6",children:[v&&(0,t.jsx)("div",{className:"text-destructive text-sm mb-3",children:v}),(0,t.jsxs)("div",{className:"rounded-lg border p-6",children:[(0,t.jsx)("h4",{className:"font-medium mb-4",children:"Deal Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Lead Contact *"}),(0,t.jsx)("select",{className:"w-full p-2 border rounded-md bg-white text-sm",value:String(c.leadContact),onChange:e=>T("leadContact",Number(e.target.value)),children:(0,t.jsx)("option",{value:"",children:null!=(s=null==d?void 0:d.name)?s:"--"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Deal Name *"}),(0,t.jsx)("input",{className:"w-full p-2 border rounded-md text-sm",value:c.title,onChange:e=>T("title",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Pipeline *"}),(0,t.jsxs)("select",{className:"w-full p-2 border rounded-md bg-white text-sm",value:c.pipeline,onChange:e=>T("pipeline",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"--"}),(0,t.jsx)("option",{children:"Default Pipeline"}),(0,t.jsx)("option",{children:"Sales"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Deal Stages *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("select",{className:"w-full p-2 border rounded-md bg-white text-sm",value:c.dealStage,onChange:e=>T("dealStage",e.target.value),children:[(0,t.jsx)("option",{children:"Qualified"}),(0,t.jsx)("option",{children:"Generated"}),(0,t.jsx)("option",{children:"Proposal"}),(0,t.jsx)("option",{children:"Won"}),(0,t.jsx)("option",{children:"Lost"})]}),(0,t.jsx)("div",{className:"absolute left-3 top-3 w-2 h-2 rounded-full bg-sky-600"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Deal Category"}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)("select",{className:"flex-1 p-2 border rounded-l-md bg-white text-sm",value:c.dealCategory,onChange:e=>T("dealCategory",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"--"}),!S&&C.map(e=>(0,t.jsx)("option",{value:e.categoryName,children:e.categoryName},e.id))]}),(0,t.jsx)("button",{type:"button",onClick:()=>L(!0),className:"px-3 py-2 border rounded-r-md bg-gray-200 text-sm",children:"Add"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Deal Agent"}),(0,t.jsxs)("select",{className:"w-full p-2 border rounded-md bg-white text-sm",value:c.dealAgent,onChange:e=>T("dealAgent",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"--"}),i.map(e=>(0,t.jsx)("option",{value:e.employeeId,children:e.name},e.employeeId))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Deal Value"}),(0,t.jsxs)("div",{className:"flex items-stretch",children:[(0,t.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border bg-slate-100 text-sm",children:"USD $"}),(0,t.jsx)("input",{type:"number",className:"w-full p-2 border rounded-r-md text-sm",value:c.value,onChange:e=>T("value",e.target.value)})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Close Date *"}),(0,t.jsx)("input",{type:"date",className:"w-full p-2 border rounded-md text-sm",value:c.closeDate,onChange:e=>T("closeDate",e.target.value)})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Deal Watcher"}),(0,t.jsxs)("button",{type:"button",ref:b,onClick:()=>{let e=b.current;if(!e)return void g(!0);let t=e.getBoundingClientRect(),l=t.bottom+8;w({top:l,left:t.left,width:t.width}),g(e=>!e)},className:"w-full p-2 border rounded-md text-left bg-white text-sm flex items-center justify-between",children:[(0,t.jsx)("span",{className:"truncate",children:(()=>{let e=o.filter(e=>c.dealWatchers.includes(e.employeeId||""));return 0===e.length?"--":e.map(e=>e.name).join(", ")})()}),(0,t.jsx)("svg",{className:"w-4 h-4 transform ".concat(f?"rotate-180":""),viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{d:"M6 8l4 4 4-4",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),f&&y&&(0,t.jsx)("div",{style:{position:"fixed",top:y.top+window.scrollY,left:y.left,width:y.width,zIndex:60},children:(0,t.jsx)("div",{className:"bg-white border rounded-md shadow-lg p-3 max-h-[60vh] overflow-auto",children:0===o.length?(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"No employees"}):(0,t.jsx)("div",{className:"grid gap-2",children:o.map(e=>(0,t.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",className:"mt-1",checked:c.dealWatchers.includes(e.employeeId||""),onChange:t=>{var l,s;return l=e.employeeId||"",s=t.target.checked,void m(e=>{let t=e.dealWatchers||[],a=s?[...t,l]:t.filter(e=>e!==l);return{...e,dealWatchers:a}})}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm",children:e.name}),e.designation&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.designation})]})]},e.employeeId))})})}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:"Click to open and select watchers"})]})]})]}),(0,t.jsxs)("div",{className:"mt-6 flex items-center justify-center gap-6",children:[(0,t.jsx)("button",{type:"button",onClick:r,className:"px-6 py-2 border rounded-full text-blue-600 hover:bg-blue-50",disabled:h,children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:h,className:"px-6 py-2 rounded-full text-white ".concat(h?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:h?"Creating...":"Create"})]})]})]})}),E&&(0,t.jsx)(N,{onClose:()=>{L(!1)},onSaved:()=>{A()}})]})}function y(e){var l,s,d,n,i,o,x,m,u,h,j,v,p,f,g;let{lead:N,onClose:b,onSaved:y}=e,[w,C]=(0,a.useState)({name:null!=(l=null==N?void 0:N.name)?l:"",email:null!=(s=null==N?void 0:N.email)?s:"",clientCategory:null!=(d=null==N?void 0:N.clientCategory)?d:"",leadSource:null!=(n=null==N?void 0:N.leadSource)?n:"",leadOwner:null!=(i=null==N?void 0:N.leadOwner)?i:"",addedBy:null!=(o=null==N?void 0:N.addedBy)?o:"",autoConvertToClient:!!(null==N?void 0:N.autoConvertToClient),companyName:null!=(x=null==N?void 0:N.companyName)?x:"",officialWebsite:null!=(m=null==N?void 0:N.officialWebsite)?m:"",mobileNumber:String(null!=(u=null==N?void 0:N.mobileNumber)?u:""),officePhone:null!=(h=null==N?void 0:N.officePhone)?h:"",city:null!=(j=null==N?void 0:N.city)?j:"",state:null!=(v=null==N?void 0:N.state)?v:"",postalCode:null!=(p=null==N?void 0:N.postalCode)?p:"",country:null!=(f=null==N?void 0:N.country)?f:"",companyAddress:null!=(g=null==N?void 0:N.companyAddress)?g:""}),[k,S]=(0,a.useState)(!1),[D,E]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&b()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[b]);let L=(e,t)=>C(l=>({...l,[e]:t})),T=async e=>{null==e||e.preventDefault();let t=w.name.trim()&&w.email.trim()?null:"Name and Email are required.";if(t)return void E(t);E(null),S(!0);try{let e=localStorage.getItem("accessToken");if(!e)throw Error("No access token.");let t={name:w.name,email:w.email,clientCategory:w.clientCategory||void 0,leadSource:w.leadSource||void 0,leadOwner:w.leadOwner||void 0,addedBy:w.addedBy||void 0,autoConvertToClient:!!w.autoConvertToClient,companyName:w.companyName||void 0,officialWebsite:w.officialWebsite||void 0,mobileNumber:w.mobileNumber?Number(w.mobileNumber):void 0,officePhone:w.officePhone||void 0,city:w.city||void 0,state:w.state||void 0,postalCode:w.postalCode||void 0,country:w.country||void 0,companyAddress:w.companyAddress||void 0},l=await fetch("".concat(c,"/leads/").concat(N.id),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!l.ok){let e=await l.text().catch(()=>"");throw Error(e||"Update failed")}await l.json(),alert("Lead updated successfully."),await y()}catch(e){var l;E(null!=(l=null==e?void 0:e.message)?l:"Failed to update lead.")}finally{S(!1)}};return(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:b}),(0,t.jsx)("div",{className:"fixed inset-0 flex items-start justify-center px-4 pt-12",children:(0,t.jsxs)("div",{className:"max-w-4xl w-full bg-white rounded-lg shadow-lg border overflow-auto",style:{maxHeight:"92vh"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Update Lead Contact"}),(0,t.jsx)("button",{onClick:b,className:"text-muted-foreground p-1 rounded hover:bg-slate-100",children:(0,t.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("form",{onSubmit:T,className:"p-6 space-y-6",children:[D&&(0,t.jsx)("div",{className:"text-destructive text-sm",children:D}),(0,t.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,t.jsx)("h4",{className:"font-medium mb-3",children:"Contact Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Name *"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.name,onChange:e=>L("name",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Email *"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.email,onChange:e=>L("email",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Lead Source"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.leadSource,onChange:e=>L("leadSource",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Lead Owner"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.leadOwner,onChange:e=>L("leadOwner",e.target.value)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 md:col-span-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"autoConvert",checked:!!w.autoConvertToClient,onChange:e=>L("autoConvertToClient",e.target.checked)}),(0,t.jsx)("label",{htmlFor:"autoConvert",className:"text-sm",children:'Auto Convert lead to client when the deal stage is set to "WIN".'})]})]})]}),(0,t.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,t.jsx)("h4",{className:"font-medium mb-3",children:"Company Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Company Name"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.companyName,onChange:e=>L("companyName",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Official Website"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.officialWebsite,onChange:e=>L("officialWebsite",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Mobile Number"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.mobileNumber,onChange:e=>L("mobileNumber",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Office Phone No."}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.officePhone,onChange:e=>L("officePhone",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"City"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.city,onChange:e=>L("city",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"State"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.state,onChange:e=>L("state",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Postal Code"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.postalCode,onChange:e=>L("postalCode",e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Country"}),(0,t.jsx)("input",{className:"w-full border rounded-md p-2",value:w.country,onChange:e=>L("country",e.target.value)})]}),(0,t.jsxs)("div",{className:"md:col-span-3",children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Company Address"}),(0,t.jsx)("textarea",{className:"w-full border rounded-md p-2 h-28",value:w.companyAddress,onChange:e=>L("companyAddress",e.target.value)})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:b,disabled:k,children:"Cancel"}),(0,t.jsx)(r.Button,{type:"submit",onClick:T,disabled:k,children:k?"Updating...":"Update"})]})]})]})})]})}function w(e){var l,s,d;let{leadId:r,initial:n,onClose:i,onSaved:o}=e,x=!!(null==n?void 0:n.id),[m,u]=(0,a.useState)({noteTitle:null!=(l=null==n?void 0:n.noteTitle)?l:"",noteType:null!=(s=null==n?void 0:n.noteType)?s:"PUBLIC",noteDetails:null!=(d=null==n?void 0:n.noteDetails)?d:""}),[h,j]=(0,a.useState)(!1),[v,p]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&i()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[i]);let f=(e,t)=>u(l=>({...l,[e]:t})),g=async e=>{null==e||e.preventDefault();let t=m.noteTitle.trim()?null:"Note Title is required.";if(t)return void p(t);p(null),j(!0);try{let e=localStorage.getItem("accessToken");if(!e)throw Error("No access token.");let t=x?"".concat(c,"/leads/").concat(r,"/notes/").concat(null==n?void 0:n.id):"".concat(c,"/leads/").concat(r,"/notes"),l=await fetch(t,{method:x?"PUT":"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({noteTitle:m.noteTitle,noteType:m.noteType,noteDetails:m.noteDetails})});if(!l.ok){let e=await l.text().catch(()=>"");throw Error(e||"Failed to save note.")}let s=await l.json();o(s)}catch(e){var l;p(null!=(l=null==e?void 0:e.message)?l:"Save failed")}finally{j(!1)}};return(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:i}),(0,t.jsx)("div",{className:"fixed inset-0 flex items-start justify-center px-4 pt-12",children:(0,t.jsxs)("div",{className:"max-w-3xl w-full bg-white rounded-lg shadow-lg border overflow-auto",style:{maxHeight:"90vh"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:x?"Edit Lead Note":"Add Lead Note"}),(0,t.jsx)("button",{onClick:i,className:"text-muted-foreground p-1 rounded hover:bg-slate-100",children:(0,t.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("form",{onSubmit:g,className:"p-6",children:[v&&(0,t.jsx)("div",{className:"text-destructive text-sm mb-3",children:v}),(0,t.jsxs)("div",{className:"rounded-lg border p-6",children:[(0,t.jsx)("h4",{className:"font-medium mb-4",children:"Lead Note Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Note Title *"}),(0,t.jsx)("input",{className:"w-full p-2 border rounded-md text-sm",value:m.noteTitle,onChange:e=>f("noteTitle",e.target.value),placeholder:"Enter Note Title"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Note Type"}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"radio",checked:"PUBLIC"===m.noteType,onChange:()=>f("noteType","PUBLIC")}),(0,t.jsx)("span",{children:"Public"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"radio",checked:"PRIVATE"===m.noteType,onChange:()=>f("noteType","PRIVATE")}),(0,t.jsx)("span",{children:"Private"})]})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-xs text-muted-foreground mb-2",children:"Note Detail"}),(0,t.jsx)("textarea",{className:"w-full p-3 border rounded-md text-sm h-36",value:m.noteDetails,onChange:e=>f("noteDetails",e.target.value),placeholder:"Enter details..."})]})]})]}),(0,t.jsxs)("div",{className:"mt-6 flex items-center justify-center gap-6",children:[(0,t.jsx)("button",{type:"button",onClick:i,className:"px-6 py-2 border rounded-full text-blue-600 hover:bg-blue-50",disabled:h,children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:h,className:"px-6 py-2 rounded-full text-white ".concat(h?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"),children:h?"Saving...":"Save"})]})]})]})})]})}function C(e){var l,s;let{note:a,onClose:d}=e;return(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:d}),(0,t.jsx)("div",{className:"fixed inset-0 flex items-start justify-center px-4 pt-12",children:(0,t.jsxs)("div",{className:"max-w-3xl w-full bg-white rounded-lg shadow-lg border overflow-auto",style:{maxHeight:"90vh"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:null!=(l=a.noteTitle)?l:"My Note"}),(0,t.jsx)("button",{onClick:d,className:"text-muted-foreground p-1 rounded hover:bg-slate-100",children:(0,t.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"rounded-lg border p-6",children:[(0,t.jsx)("h4",{className:"font-medium mb-4",children:"Project Note Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,t.jsx)("div",{className:"text-muted-foreground",children:"Note Title"}),(0,t.jsx)("div",{className:"md:col-span-2",children:null!=(s=a.noteTitle)?s:"--"}),(0,t.jsx)("div",{className:"text-muted-foreground",children:"Note Type"}),(0,t.jsx)("div",{className:"md:col-span-2",children:"PUBLIC"===a.noteType?"Public":"Private"}),(0,t.jsx)("div",{className:"text-muted-foreground",children:"Note Detail"}),(0,t.jsx)("div",{className:"md:col-span-2",children:a.noteDetails?a.noteDetails:"---"})]})]})})]})})]})}function k(e){var x,u,N,k,S,D,E;let{params:L}=e,T=(0,l.useRouter)(),{data:A,error:P,isLoading:B,mutate:I}=(0,s.default)("/api/leads/admin/get/".concat(L.id),h,{refreshInterval:3e4,revalidateOnFocus:!0}),[W,M]=(0,a.useState)("profile"),[z,O]=(0,a.useState)(!1),F=(0,a.useRef)(null),[U,R]=(0,a.useState)(!1),{data:V,error:q,isLoading:H,mutate:J}=(0,s.default)("deals"===W?"".concat(c,"/deals/lead/").concat(L.id):null,h,{refreshInterval:3e4,revalidateOnFocus:!0}),{data:G}=(0,s.default)(m,h,{refreshInterval:0}),Q=G&&Array.isArray(G.content)?G.content.map(e=>{var t,l,s;return{employeeId:e.employeeId,name:e.name,designation:null!=(t=e.designationName)?t:null,department:null!=(l=e.departmentName)?l:null,profileUrl:null!=(s=e.profilePictureUrl)?s:null}}):[],[_,K]=(0,a.useState)(!1),[Y,$]=(0,a.useState)(null),[X,Z]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=e=>{if(!F.current)return;let t=e.target;z&&!F.current.contains(t)&&O(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[z]);let ee=async()=>{if(O(!1),confirm("Convert this lead to client?"))try{let e=localStorage.getItem("accessToken");if(!e)throw Error("No access token.");let t=await fetch("".concat(c,"/leads/").concat(L.id,"/convert"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error(await t.text());alert("Converted to client."),await I(),T.push("/leads")}catch(t){var e;alert("Error: "+(null!=(e=null==t?void 0:t.message)?e:t))}},et=async()=>{if(O(!1),confirm("Delete this lead?"))try{let e=localStorage.getItem("accessToken");if(!e)throw Error("No access token.");let t=await fetch("".concat(c,"/leads/").concat(L.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error(await t.text());alert("Deleted."),T.push("/leads")}catch(t){var e;alert("Error: "+(null!=(e=null==t?void 0:t.message)?e:t))}},el=async e=>{J&&J(t=>t?[e,...t]:[e],!1)},[es,ea]=(0,a.useState)([]),[ed,er]=(0,a.useState)(!1),[en,ei]=(0,a.useState)(null),[eo,ec]=(0,a.useState)(!1),[ex,em]=(0,a.useState)(null),[eu,eh]=(0,a.useState)(null),[ej,ev]=(0,a.useState)(null),ep=(0,a.useRef)(null),[ef,eg]=(0,a.useState)(null),eN=e=>"".concat(c,"/leads/").concat(e,"/notes"),eb=async()=>{er(!0),ei(null);try{let e=localStorage.getItem("accessToken");if(!e)throw Error("No access token.");let t=await fetch(eN(L.id),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error(await t.text());let l=await t.json();ea(Array.isArray(l)?l:[])}catch(t){var e;ei(null!=(e=null==t?void 0:t.message)?e:"Failed to load notes")}finally{er(!1)}};(0,a.useEffect)(()=>{"notes"===W&&eb()},[W,L.id]);let ey=async e=>{if(e&&confirm("Delete this note?"))try{let t=localStorage.getItem("accessToken");if(!t)throw Error("No access token.");let l=await fetch("".concat(eN(L.id),"/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}});if(!l.ok)throw Error(await l.text());ea(t=>t.filter(t=>t.id!==e)),eh(null),ev(null)}catch(e){var t;alert("Error: "+(null!=(t=null==e?void 0:e.message)?t:e))}};return(0,a.useEffect)(()=>{if(null==eu)return;let e=e=>{let t=e.target;ep.current&&(ep.current.contains(t)||(eh(null),ev(null)))},t=()=>{eh(null),ev(null)},l=()=>{eh(null),ev(null)};return document.addEventListener("mousedown",e),window.addEventListener("scroll",t,!0),window.addEventListener("resize",l),()=>{document.removeEventListener("mousedown",e),window.removeEventListener("scroll",t,!0),window.removeEventListener("resize",l)}},[eu]),(0,t.jsxs)("main",{className:"min-h-screen bg-gray-50",children:[(0,t.jsxs)("div",{className:"container mx-auto max-w-6xl px-4 py-8",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:()=>T.back(),"aria-label":"Back",children:(0,t.jsx)(i.ArrowLeft,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-semibold",children:null!=(N=null==A?void 0:A.name)?N:"â€”"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Detailed information about the selected lead."})]})]}),(0,t.jsx)("div",{className:"mb-4 border-b bg-white rounded-t",children:(0,t.jsxs)("nav",{className:"flex items-center gap-6 px-4",children:[(0,t.jsx)("button",{onClick:()=>M("profile"),className:"py-3 text-sm ".concat("profile"===W?"border-b-2 border-sky-600 text-sky-600":"text-muted-foreground"),children:"Profile"}),(0,t.jsx)("button",{onClick:()=>M("deals"),className:"py-3 text-sm ".concat("deals"===W?"border-b-2 border-sky-600 text-sky-600":"text-muted-foreground"),children:"Deals"}),(0,t.jsx)("button",{onClick:()=>M("notes"),className:"py-3 text-sm ".concat("notes"===W?"border-b-2 border-sky-600 text-sky-600":"text-muted-foreground"),children:"Notes"})]})}),(0,t.jsx)(d.Card,{className:"p-6",children:B?(0,t.jsx)("div",{className:"py-12 text-center text-muted-foreground",children:"Loading lead detailsâ€¦"}):P?(0,t.jsxs)("div",{className:"py-12 text-center",children:[(0,t.jsx)("p",{className:"text-destructive",children:"Failed to load lead details."}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:null==P?void 0:P.message}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(r.Button,{variant:"ghost",onClick:()=>T.back(),children:"Back to Leads"})})]}):A?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"profile"===W?"Profile Information":"deals"===W?"Deals":"Notes"}),(0,t.jsxs)("div",{className:"relative",ref:F,children:[(0,t.jsx)("button",{onClick:()=>O(e=>!e),className:"p-2 rounded hover:bg-slate-100","aria-label":"More actions",children:(0,t.jsxs)("svg",{className:"w-5 h-5 text-muted-foreground",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,t.jsx)("circle",{cx:"5",cy:"12",r:"1.5"}),(0,t.jsx)("circle",{cx:"12",cy:"12",r:"1.5"}),(0,t.jsx)("circle",{cx:"19",cy:"12",r:"1.5"})]})}),z&&(0,t.jsx)("div",{className:"absolute right-0 mt-2 w-44 rounded-md border bg-white shadow-lg z-30",children:(0,t.jsxs)("ul",{className:"py-1",children:[(0,t.jsx)("li",{children:(0,t.jsx)("button",{onClick:()=>{O(!1),R(!0)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 flex items-center gap-2 text-sm",children:"Edit"})}),(0,t.jsx)("li",{children:(0,t.jsx)("button",{onClick:ee,className:"w-full text-left px-4 py-2 hover:bg-slate-50 flex items-center gap-2 text-sm",children:"Change to Client"})}),(0,t.jsx)("li",{children:(0,t.jsx)("button",{onClick:et,className:"w-full text-left px-4 py-2 hover:bg-slate-50 flex items-center gap-2 text-sm text-destructive",children:"Delete"})})]})})]})]}),"profile"===W&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"rounded-lg border p-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("dl",{className:"hidden md:block md:col-span-1 space-y-4 text-sm text-muted-foreground",children:[(0,t.jsx)("dt",{children:"Name"}),(0,t.jsx)("dt",{children:"Email"}),(0,t.jsx)("dt",{children:"Lead Owner"}),(0,t.jsx)("dt",{children:"Source"}),(0,t.jsx)("dt",{children:"Company Name"}),(0,t.jsx)("dt",{children:"Website"}),(0,t.jsx)("dt",{children:"Mobile"}),(0,t.jsx)("dt",{children:"Office Phone Number"}),(0,t.jsx)("dt",{children:"City"}),(0,t.jsx)("dt",{children:"State"}),(0,t.jsx)("dt",{children:"Country"}),(0,t.jsx)("dt",{children:"Postal Code"}),(0,t.jsx)("dt",{children:"Address"})]}),(0,t.jsx)("div",{className:"md:col-span-2",children:(0,t.jsxs)("div",{className:"grid gap-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Name"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.name)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Email"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.email)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Lead Owner"}),(0,t.jsx)("div",{className:"text-sm",children:null!=(S=null!=(k=null==A||null==(x=A.leadOwnerMeta)?void 0:x.name)?k:null==A?void 0:A.leadOwner)?S:"--"})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Source"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.leadSource)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Company Name"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.companyName)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Website"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.officialWebsite)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Mobile"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.mobileNumber)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Office Phone Number"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.officePhone)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"City"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.city)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"State"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.state)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Country"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.country)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Postal Code"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.postalCode)})]}),(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-48 md:hidden text-sm text-muted-foreground",children:"Address"}),(0,t.jsx)("div",{className:"text-sm",children:j(null==A?void 0:A.companyAddress)})]})]})})]})}),(0,t.jsxs)("div",{className:"mt-6 text-sm text-muted-foreground grid md:grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:["Created: ",v(null==A?void 0:A.createdAt)]}),(0,t.jsxs)("div",{className:"text-right",children:["Status: ",(0,t.jsx)(n.Badge,{variant:"secondary",children:null!=(D=null==A?void 0:A.status)?D:"--"})]})]})]}),"deals"===W&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(r.Button,{onClick:()=>K(!0),children:"+ Add Deal"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-muted-foreground mr-2",children:"Pipeline"}),(0,t.jsxs)("select",{className:"border rounded p-2 text-sm",children:[(0,t.jsx)("option",{children:(null==A?void 0:A.deals)&&(null==(u=A.deals)?void 0:u.length)?null==A?void 0:A.deals:null!=(E=null==A?void 0:A.pipeline)?E:"Default Pipeline"}),(0,t.jsx)("option",{children:"Sales"}),(0,t.jsx)("option",{children:"Default Pipeline "})]})]})]}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Result per page - 8"})]}),(0,t.jsx)("div",{className:"rounded-lg border overflow-auto",children:(0,t.jsxs)("table",{className:"min-w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-sky-50 text-left",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2",children:"Deal Name"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Lead Name"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Contact Details"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Value"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Close Date"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Follow Up"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Deal Agent"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Deal Watcher"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Stage"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Action"})]})}),(0,t.jsx)("tbody",{children:H?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:10,className:"px-4 py-6 text-center text-muted-foreground",children:"Loading dealsâ€¦"})}):q?(0,t.jsx)("tr",{children:(0,t.jsxs)("td",{colSpan:10,className:"px-4 py-6 text-center text-destructive",children:["Failed to load deals: ",null==q?void 0:q.message]})}):V&&0!==V.length?V.map(e=>{var l,s,a,d,r,n,i,x,m,u,h,v;return(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"font-medium",children:null!=(a=e.title)?a:"Deal ".concat(e.id)}),(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:null!=(d=e.dealCategory)?d:"--"})]}),(0,t.jsx)("td",{className:"px-4 py-3",children:null!=(n=null!=(r=e.leadName)?r:null==A?void 0:A.name)?n:"--"}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"text-xs",children:j(e.leadMobile)}),(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:null!=(i=null==A?void 0:A.email)?i:"--"})]}),(0,t.jsx)("td",{className:"px-4 py-3",children:f(null!=(x=e.value)?x:0)}),(0,t.jsx)("td",{className:"px-4 py-3",children:e.expectedCloseDate?p(e.expectedCloseDate):e.updatedAt?p(e.updatedAt):"--"}),(0,t.jsx)("td",{className:"px-4 py-3",children:e.followups&&e.followups.length>0?(0,t.jsx)("div",{className:"text-sm",children:p(e.followups[0].nextDate)}):(0,t.jsx)("div",{className:"text-muted-foreground",children:"------"})}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"text-sm",children:null!=(u=null!=(m=null==(l=e.dealAgentMeta)?void 0:l.name)?m:e.dealAgent)?u:"--"}),(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:null!=(h=null==(s=e.dealAgentMeta)?void 0:s.designation)?h:""})]}),(0,t.jsx)("td",{className:"px-4 py-3",children:e.dealWatchersMeta&&e.dealWatchersMeta.length>0?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm",children:e.dealWatchersMeta[0].name}),(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:e.dealWatchersMeta[0].designation})]}):(0,t.jsx)("div",{className:"text-muted-foreground",children:"--"})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsxs)("select",{defaultValue:e.dealStage,className:"border rounded p-1 text-sm",children:[(0,t.jsx)("option",{children:null!=(v=e.dealStage)?v:"Generated"}),(0,t.jsx)("option",{children:"Generated "}),(0,t.jsx)("option",{children:"Qualified"}),(0,t.jsx)("option",{children:"Proposal"}),(0,t.jsx)("option",{children:"Won"}),(0,t.jsx)("option",{children:"Lost"})]})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>{$(e),Z(null!=A?A:null)},className:"text-sm px-2 py-1 border rounded hover:bg-slate-50",children:(0,t.jsx)(o.default,{href:"/deals/get/".concat(e.id),children:"View"})}),(0,t.jsx)("button",{onClick:()=>{T.push("/deals/create/DealEdit/".concat(e.id))},className:"text-sm px-2 py-1 border rounded hover:bg-slate-50",children:"Edit"}),(0,t.jsx)("button",{onClick:async()=>{if(confirm("Delete this deal?"))try{let t=localStorage.getItem("accessToken");if(!t)throw Error("No access token.");let l=await fetch("".concat(c,"/deals/").concat(e.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}});if(!l.ok)throw Error(await l.text());alert("Deal deleted."),await J()}catch(e){var t;alert("Error: "+(null!=(t=null==e?void 0:e.message)?t:e))}},className:"text-sm px-2 py-1 border rounded text-destructive hover:bg-slate-50",children:"Delete"})]})})]},e.id)}):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:10,className:"px-4 py-6 text-center text-muted-foreground",children:"No deals found for this lead."})})})]})}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-between text-sm text-muted-foreground",children:[(0,t.jsx)("div",{children:"Page 1 of 1 "}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{className:"px-2 py-1",disabled:!0,children:"â€¹"}),(0,t.jsx)("button",{className:"px-2 py-1",disabled:!0,children:"â€º"})]})]})]}),"notes"===W&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,t.jsx)("div",{className:"flex items-center gap-4",children:(0,t.jsx)("button",{onClick:()=>{em(null),ec(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded",children:"+ Add Note"})}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Result per page - 8"})]}),(0,t.jsx)("div",{className:"rounded-lg border overflow-auto",children:(0,t.jsxs)("table",{className:"min-w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-sky-50 text-left",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2",children:"Note Title"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Note Type"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Created"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Action"})]})}),(0,t.jsx)("tbody",{children:ed?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:4,className:"px-4 py-6 text-center text-muted-foreground",children:"Loading notesâ€¦"})}):en?(0,t.jsx)("tr",{children:(0,t.jsxs)("td",{colSpan:4,className:"px-4 py-6 text-center text-destructive",children:["Failed to load notes: ",en]})}):es&&0!==es.length?es.map(e=>(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"font-medium",children:e.noteTitle}),e.noteDetails&&(0,t.jsx)("div",{className:"text-muted-foreground text-xs truncate max-w-xl",children:e.noteDetails})]}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("div",{className:"flex items-center gap-2 text-sm",children:"PUBLIC"===e.noteType?(0,t.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-sky-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("circle",{cx:"12",cy:"12",r:"3",strokeWidth:"1.5"})}),(0,t.jsx)("span",{children:"Public"})]}):(0,t.jsxs)("div",{className:"inline-flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,t.jsx)("path",{d:"M12 2v6",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,t.jsx)("span",{children:"Private"})]})})}),(0,t.jsx)("td",{className:"px-4 py-3",children:v(e.createdAt)}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("button",{onClick:t=>((e,t)=>{if(e.stopPropagation(),!t)return;let l=e.currentTarget.getBoundingClientRect(),s=l.bottom+8+window.scrollY,a=l.right-160;eh(e=>e===t?null:t),ev({top:s,left:Math.max(a,8)})})(t,e.id),className:"p-1 rounded hover:bg-slate-100","aria-label":"Note actions",children:(0,t.jsxs)("svg",{className:"w-5 h-5 text-muted-foreground",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,t.jsx)("circle",{cx:"5",cy:"12",r:"1.5"}),(0,t.jsx)("circle",{cx:"12",cy:"12",r:"1.5"}),(0,t.jsx)("circle",{cx:"19",cy:"12",r:"1.5"})]})})})]},e.id)):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:4,className:"px-4 py-6 text-center text-muted-foreground",children:"No notes found for this lead."})})})]})}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-between text-sm text-muted-foreground",children:[(0,t.jsx)("div",{children:"Page 1 of 1"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{className:"px-2 py-1",disabled:!0,children:"â€¹"}),(0,t.jsx)("button",{className:"px-2 py-1",disabled:!0,children:"â€º"})]})]}),null!=eu&&ej&&(0,t.jsx)("div",{ref:ep,style:{position:"fixed",top:ej.top,left:ej.left,zIndex:70,minWidth:160},children:(0,t.jsx)("div",{className:"rounded-md border bg-white shadow-lg",children:(0,t.jsxs)("ul",{className:"py-1",children:[(0,t.jsx)("li",{children:(0,t.jsx)("button",{onClick:()=>{var e;let t=null!=(e=es.find(e=>e.id===eu))?e:null;t&&eg(t),eh(null),ev(null)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 text-sm",children:"View"})}),(0,t.jsx)("li",{children:(0,t.jsx)("button",{onClick:()=>{var e;let t=null!=(e=es.find(e=>e.id===eu))?e:null;t&&(em(t),ec(!0)),eh(null),ev(null)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 text-sm",children:"Edit"})}),(0,t.jsx)("li",{children:(0,t.jsx)("button",{onClick:()=>{ey(null!=eu?eu:void 0),eh(null),ev(null)},className:"w-full text-left px-4 py-2 hover:bg-slate-50 text-sm text-destructive",children:"Delete"})})]})})})]})]}):(0,t.jsx)("div",{className:"py-12 text-center text-muted-foreground",children:"No lead found."})})]}),U&&A&&(0,t.jsx)(y,{lead:A,onClose:()=>R(!1),onSaved:async()=>{R(!1),await I()}}),_&&A&&(0,t.jsx)(b,{lead:A,onClose:()=>K(!1),onCreated:el,possibleAgents:Q,possibleWatchers:Q}),Y&&(0,t.jsx)(g,{deal:Y,lead:X,onClose:()=>{$(null),Z(null)}}),eo&&A&&(0,t.jsx)(w,{leadId:A.id,initial:ex,onClose:()=>{ec(!1),em(null)},onSaved:e=>{ec(!1),em(null),eh(null),eb()}}),ef&&(0,t.jsx)(C,{note:ef,onClose:()=>{eg(null)}})]})}}]);